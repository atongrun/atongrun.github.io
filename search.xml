<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ChatGPTå…ç¿»å¢™ç½‘ç«™æ¨è</title>
      <link href="/posts/4182892542/"/>
      <url>/posts/4182892542/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰, è¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹, è¯·å†è¯•è¯•." data-whm="æŠ±æ­‰, è¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«æ ¡éªŒ, ä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹.">  <script id="hbeData" type="hbeData" data-hmacdigest="73971b1c0f5dc5efcc31003761f931ec85d59bcdd937278209be77e47aca0970">f6cac86f78082062b77dcf10f39589921f158d3630d5552bd29d30e37601f316ecf4a7b0006a4bec8a7103c83c767803ec8acd980091b6dd3bf97e27e6d3c54a468c062cb4df1d2b53f26b0122ab0b9808ed477911c242faa4556c0495e381467b457b2db73049ff606485a24b58796c67526724d465dee19f077e648d05ad2381843988fb20bb1ec4529313c123606675e50878b19dfd72dbac3fec028cd148012a8e4246589400a4b606b47af1ed8e469031c5a42f993cf4516a57422d6d55bb20945a8fa2df8e6ecd13f43a87d52e7f60dd3568ff7314fd53db7365355c0632b423dae0030d113cb182a37cb7fa80fcd6a6fa08b4fe9dee1091ae1c56abca0304ea7d459a29db9b08af6cf0c423d11b754744047701585960c7baa0019fff85372ba99c0f7607ad63d2ae14cc0c1dd9da5e1688885ae6deb4d301f7b027bba13aeccdc801f491e27fb90c22363a6c5359c87c11d11fbe82fd8d4ab471117e2c093e4edaf5fbeb5987de4b08460a9340e07722574a24c7c2ab903bbf58a76e35143a8fb5ac7aad29857aa9ca7c769b868a4e2af43fd76adedcb4c66188206a</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">ä½ å¥½å‘€ï¼Œè¿™é‡Œéœ€è¦å¯†ç å“¦, å…³æ³¨å¾®ä¿¡å…¬ä¼—å·å­™èœèœå›å¤å…³é”®è¯chatgptè·å¾—å¯†ç .</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> äººå·¥æ™ºèƒ½ </category>
          
          <category> è‡ªç„¶è¯­è¨€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ChatGPT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>äººå·¥æ™ºèƒ½è¿™ä¹ˆå¼ºï¼Œæˆ‘ä»¬ä¼šè¢«æ·˜æ±°å—ï¼Ÿåº”è¯¥æ€ä¹ˆåŠï¼Ÿ</title>
      <link href="/posts/2356723078/"/>
      <url>/posts/2356723078/</url>
      
        <content type="html"><![CDATA[<p>é‡‘èç•Œ3æœˆ10æ—¥æ¶ˆæ¯ æ®å¾·å›½åª’ä½“heiseåœ¨çº¿æŠ¥é“ï¼Œå½“åœ°æ—¶é—´3æœˆ9æ—¥ï¼Œå¾®è½¯å¾·å›½CTO Andreas Braunï¼ˆå¸ƒåŠ³æ©ï¼‰åœ¨ä¸€åœºAIæ´»åŠ¨ä¸­è¡¨ç¤ºï¼ŒGPT-4å°†äºä¸‹å‘¨å‘å¸ƒï¼Œå¹¶ä¸”æ˜¯å¤šæ¨¡æ€ï¼Œä¸ä»…ä»…å±€é™äºæ–‡å­—ï¼Œè¿˜åŒ…æ‹¬è§†é¢‘ã€‚ä¸æ­¤åŒæ—¶ï¼ŒBraunè¿˜å¼ºè°ƒGPT-4èƒ½å¤Ÿé€‚ç”¨æ‰€æœ‰çš„è¯­è¨€ï¼Œç”¨æˆ·å¯ä»¥ç”¨å¾·è¯­æé—®ï¼Œç„¶åè·å¾—æ„å¤§åˆ©è¯­çš„ç­”æ¡ˆã€‚ç›®å‰æœ€å…ˆè¿›çš„è¯­è¨€æ¨¡å‹ä¹‹ä¸€æ˜¯GPT-3ï¼Œå®ƒåœ¨è¯­è¨€ç†è§£å’Œç”Ÿæˆæ–¹é¢çš„è¡¨ç°å·²ç»è¾¾åˆ°äº†å‰æ‰€æœªæœ‰çš„é«˜åº¦ã€‚ä½†æ˜¯GPT4æ›´åŠ ææ€–ï¼Œæœªæ¥äººå·¥æ™ºèƒ½å°†å¯ä»¥æ›´å¥½åœ°å¸®åŠ©äººä»¬å¤„ç†è¯­è¨€ä»»åŠ¡ï¼Œæ¯”å¦‚è‡ªç„¶è¯­è¨€å¤„ç†ã€æ™ºèƒ½å®¢æœã€çŸ¥è¯†å›¾è°±ç­‰ã€‚</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202303121447028.png" alt="image.png"></p><p>äººå·¥æ™ºèƒ½çš„å‘å±•å·²ç»å–å¾—äº†å·¨å¤§çš„æˆå°±ï¼Œä¸æ–­æ¶Œç°å‡ºæ–°çš„æŠ€æœ¯å’Œåº”ç”¨åœºæ™¯ã€‚åœ¨è¿™ä¸ªèƒŒæ™¯ä¸‹ï¼Œäººä»¬æ™®éæ‹…å¿ƒæœªæ¥è®¸å¤šèŒä¸šå°†è¢«æ›¿ä»£ï¼Œè€Œæƒ…ç»ªä»·å€¼çš„èŒä¸šå¯èƒ½ä¼šé•¿ä¹…ä¸è¡°ã€‚ä½†æ˜¯ï¼Œäº‹å®ä¸Šæƒ…å†µå¯èƒ½å¹¶ä¸æ˜¯è¿™æ ·ç®€å•ã€‚æœ¬æ–‡å°†ä»å¤šä¸ªè§’åº¦æ¢è®¨äººå·¥æ™ºèƒ½å‘å±•å¯¹æœªæ¥èŒä¸šçš„å½±å“ã€‚</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202303121429557.png" alt="image.png"></p><p>ä½†æ˜¯ï¼Œäººå·¥æ™ºèƒ½ä»ç„¶å­˜åœ¨ç€ä¸€äº›å±€é™æ€§ã€‚ä¾‹å¦‚ï¼Œå®ƒä»¬å¾ˆéš¾å¤„ç†ä¸€äº›ç‰¹å®šé¢†åŸŸçš„çŸ¥è¯†ï¼Œéœ€è¦äººç±»ä¸“ä¸šçŸ¥è¯†çš„æ”¯æŒã€‚å¦å¤–ï¼Œäººå·¥æ™ºèƒ½ä»ç„¶éš¾ä»¥åƒäººç±»ä¸€æ ·åšå‡ºå…·æœ‰åˆ›é€ æ€§ã€åˆ¤æ–­åŠ›å’Œå†³ç­–åŠ›çš„ä»»åŠ¡ã€‚å› æ­¤ï¼Œäººå·¥æ™ºèƒ½ä»ç„¶éœ€è¦äººç±»çš„ä¸“ä¸šçŸ¥è¯†å’Œç»éªŒæ¥è§£å†³å¤æ‚çš„é—®é¢˜ã€‚</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202303121430845.png" alt="image.png"></p><p>éšç€äººå·¥æ™ºèƒ½æŠ€æœ¯çš„å‘å±•ï¼Œä¸€äº›èŒä¸šå¯èƒ½ä¼šå—åˆ°å½±å“ï¼Œæ¯”å¦‚ä¸€äº›é‡å¤æ€§é«˜ã€æ ‡å‡†åŒ–ç¨‹åº¦é«˜çš„å·¥ä½œå¯èƒ½ä¼šè¢«æœºå™¨äººå–ä»£ã€‚ä¾‹å¦‚ï¼Œä¸€äº›åˆ¶é€ ä¸šå’Œç‰©æµé¢†åŸŸçš„å·¥ä½œå¯èƒ½ä¼šè¢«è‡ªåŠ¨åŒ–å–ä»£ã€‚ä½†æ˜¯ï¼ŒåŒæ—¶ä¹Ÿä¼šå‡ºç°ä¸€äº›æ–°çš„èŒä¸šå’Œæœºä¼šã€‚ä¾‹å¦‚ï¼Œåœ¨äººå·¥æ™ºèƒ½é¢†åŸŸï¼Œéœ€è¦å¤§é‡çš„ç ”ç©¶äººå‘˜ã€å·¥ç¨‹å¸ˆã€æ•°æ®ç§‘å­¦å®¶ç­‰ä¸“ä¸šäººæ‰ã€‚æ­¤å¤–ï¼Œç”±äºäººå·¥æ™ºèƒ½æŠ€æœ¯çš„åº”ç”¨èŒƒå›´è¶Šæ¥è¶Šå¹¿æ³›ï¼Œéœ€è¦å…·å¤‡è·¨å­¦ç§‘çŸ¥è¯†å’ŒæŠ€èƒ½çš„äººæ‰ä¹Ÿä¼šè¶Šæ¥è¶Šå—æ¬¢è¿ã€‚</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202303121432645.png" alt="image.png"></p><p>ä¸€äº›èŒä¸šå¯èƒ½ä¼šæ›´åŠ é‡è¦çš„åŸå› ä¹‹ä¸€æ˜¯æä¾›æƒ…ç»ªä»·å€¼ã€‚è¿™äº›èŒä¸šåŒ…æ‹¬å¿ƒç†åŒ»ç”Ÿã€å’¨è¯¢å¸ˆã€æ•™è‚²å·¥ä½œè€…ã€ç¤¾å·¥ã€è‰ºæœ¯å®¶ç­‰ï¼Œä»–ä»¬çš„å·¥ä½œå¾€å¾€éœ€è¦å…·å¤‡é«˜åº¦çš„æƒ…æ„Ÿæ™ºå•†å’Œäººé™…äº¤å¾€èƒ½åŠ›ï¼Œéœ€è¦ä¸äººæ‰“äº¤é“å¹¶ä¸”èƒ½å¤Ÿç†è§£å’Œå¤„ç†ä»–ä»¬çš„æƒ…ç»ªå’Œéœ€æ±‚ã€‚è¿™äº›èŒä¸šå¾€å¾€éœ€è¦é•¿æœŸå­¦ä¹ å’Œå®è·µï¼Œæ— æ³•è¢«ç®€å•åœ°æ›¿ä»£ã€‚</p><p>æ­¤å¤–ï¼Œæƒ…ç»ªä»·å€¼çš„èŒä¸šè¿˜å…·æœ‰å¦å¤–ä¸€ç§é‡è¦æ€§ï¼Œé‚£å°±æ˜¯äººç±»å¯¹æƒ…æ„Ÿè”ç³»çš„éœ€æ±‚ã€‚è™½ç„¶äººå·¥æ™ºèƒ½å¯ä»¥é€šè¿‡è‡ªç„¶è¯­è¨€å¤„ç†å’Œæƒ…æ„Ÿåˆ†æç­‰æŠ€æœ¯æ¥æ¨¡æ‹Ÿæƒ…æ„Ÿï¼Œä½†æ˜¯å®ƒä»¬ç¼ºä¹çœŸå®çš„æƒ…æ„Ÿä½“éªŒå’Œäº¤æµèƒ½åŠ›ã€‚å› æ­¤ï¼Œæƒ…ç»ªä»·å€¼çš„èŒä¸šå°†ç»§ç»­æ˜¯äººç±»ç¤¾ä¼šä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ã€‚</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202303121432868.png" alt="image.png"></p><p>å°½ç®¡äººå·¥æ™ºèƒ½å‘å±•å¯¹èŒä¸šçš„å½±å“æ˜¯ä¸å¯é¿å…çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é‡‡å–ä¸€äº›æªæ–½æ¥é€‚åº”è¿™ä¸ªæ—¶ä»£ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å»ºè®®ï¼š</p><ol><li><p>ç»§ç»­å­¦ä¹ å’Œå‘å±•è‡ªå·±çš„æŠ€èƒ½å’ŒçŸ¥è¯†ï¼Œç‰¹åˆ«æ˜¯è·¨å­¦ç§‘çš„çŸ¥è¯†å’ŒæŠ€èƒ½ã€‚</p></li><li><p>æŒæ¡ä¸€äº›é«˜çº§æŠ€æœ¯å’Œå·¥å…·ï¼Œä¾‹å¦‚æœºå™¨å­¦ä¹ ã€è‡ªç„¶è¯­è¨€å¤„ç†å’Œæ•°æ®åˆ†æç­‰ã€‚</p></li><li><p>å¯»æ‰¾æ–°çš„æœºä¼šå’ŒèŒä¸šï¼Œä¾‹å¦‚åœ¨äººå·¥æ™ºèƒ½é¢†åŸŸå·¥ä½œæˆ–è€…ä»äº‹æƒ…ç»ªä»·å€¼çš„èŒä¸šã€‚</p></li><li><p>æ”¹å˜è‡ªå·±çš„èŒä¸šæ€ç»´å’Œæ€åº¦ï¼Œä¾‹å¦‚è½¬å˜ä¸ºåˆ›ä¸šè€…æˆ–è€…è‡ªç”±èŒä¸šè€…ï¼Œæˆ–è€…å¯»æ‰¾å…¶ä»–æ–¹å¼æ¥è·å¾—æ”¶å…¥å’Œç”Ÿè®¡ã€‚</p></li></ol><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202303121433768.png" alt="image.png"></p><p>æ€»ç»“</p><p>åœ¨æœªæ¥çš„äººå·¥æ™ºèƒ½æ—¶ä»£ï¼ŒèŒä¸šå‘å±•å°†ä¼šé¢ä¸´ç€è®¸å¤šæŒ‘æˆ˜å’Œæœºé‡ã€‚ä¸€äº›èŒä¸šå¯èƒ½ä¼šè¢«æœºå™¨æ›¿ä»£ï¼Œä½†æ˜¯åŒæ—¶ä¹Ÿä¼šå‡ºç°æ–°çš„èŒä¸šå’Œæœºä¼šã€‚æƒ…ç»ªä»·å€¼çš„èŒä¸šå°†ç»§ç»­å­˜åœ¨å¹¶ä¸”å‘æŒ¥ç€é‡è¦ä½œç”¨ã€‚ä¸ºäº†é€‚åº”è¿™ä¸ªæ—¶ä»£ï¼Œæˆ‘ä»¬éœ€è¦ä¸æ–­å­¦ä¹ å’Œå‘å±•è‡ªå·±çš„æŠ€èƒ½å’ŒçŸ¥è¯†ï¼Œå¯»æ‰¾æ–°çš„æœºä¼šå’ŒèŒä¸šï¼Œå¹¶æ”¹å˜è‡ªå·±çš„èŒä¸šæ€ç»´å’Œæ€åº¦ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> äººå·¥æ™ºèƒ½ </category>
          
          <category> AIä¸‹çš„æ€è€ƒ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ChatGPT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>éœ‡æƒŠï¼ï¼ChatGPTè¶Šç‹±ï¼Œè§£é”æš—é»‘ç‰ˆæœ¬çš„ChatGPTï¼Œçªç ´openaiå¯¹chatgptå›ç­”é™åˆ¶ã€‚</title>
      <link href="/posts/3439780086/"/>
      <url>/posts/3439780086/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰, è¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹, è¯·å†è¯•è¯•." data-whm="æŠ±æ­‰, è¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«æ ¡éªŒ, ä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹.">  <script id="hbeData" type="hbeData" data-hmacdigest="c0f0f84de86503a1ffe1268fea9a6d64f8095ab81fe345b7f0e99abbac0b1785">1ed55b8cb92b79ea9baaafe6182315e0958894f99c20a7bf80f66cdf9a3e14be9affe115514b8e553364f6025d4d79aaae32cf9110007914cf165770f109c3dbde6cb247ddeec55d4c9e848750a8c3203c911dd55191761474c139d64aaa17fce04cf9d8ec42f3ffc9ac4bbe283e2b784e1adbd3d3c69ae58f5c9e3812035cbb2b1aadecdc25c42e535de980ef59f238f62a417249f82084c066182bec2dd88d7b518b6e7ade36f4d95f975dcd8d2f0ea5afced1f9c1203f42ca9066d89cde494574766728cdc335c33d5024899b3e20ce179c1a977ba2e974430acd8333380d84e76d4be17e4b232717d5fb0e0b5823cb6bd23d22730a017b44e619b7d4a77d9f582fb63d501d5cc28ccdeb19c5110d6d7020075f46d60794acd6d7b355a3ab9045bfe673270bb6995bdfe96a1ed5a74e92f453fdd7df06abf19131273ebdeb187892439a8d1ef1ad3b9b68d51a514fbbe0deb08c9e64d95570ba274ddcfb608d42f7b6531a349af038194cec16c95528b3162e935a34d8966d337cb41b161eb461f3e971e36392eb50b51f880f3e8cd35e4873549c23ad8ebdaec108ba48c78d29702236e85214f57b2daa2c5a6ddd8ad718efc5706a55f92abc84f8a8bd187983e2487244d19ca6caa42c9ce73cb3020e4eb98dbb68574c2e86c4f6442ede9cb9a85a6fbb8568ef9740912e5129a2fd8be365af5b2ae010bad5d4f8598259d7d38043b694f567b5a4d4aed28fc8232b00ecff383903e93a4654b45ded1223641cf4ddd5b7452d0aeb30cd696e04ef1cda74ef6df7a9e0f96b880c62cdb7d8b89b97fa0e7d0d082b69f8fc9bbbccc0037085e298b7d2f782435ac6d3d14adc9ae59b01382f6ff48be57a1b6a02e3a93de26229327316cf25c9bc80cfc9eade948a52d6c315fd3781bed483917fb674230bfe4df7d36f4d03cd7f23ca46df77cf64ea9cf353977d43bc901b16feebbffc02ee5b0e97efd25359fa2335a45c50b27e396060545f2facf464d916ee00cf14b6c44f7c43aab1f9ee490b6a3dab1f1df1c6e5a7a60546324a9381d21051dadf9fe7863f4aa8c754eeed1c9accc6bb2b633c16123ceba57863d7bd4d82aa0134c296be62be8dd2097ca4f24a1a2cf498851e0b2691196fcaaa0bee9f2e4a746939f34c3f6f7e11b64c8731b3a6a97e98529f34ed5240ded79ee927ebe33f95e4095b41327b2fc6a3a35aa6b2261cbc7db012712f12402d8e276ec7a48c3472c2d72cc78db56679c909f4b5e5e1b5a253906173bc3921f6f03fc80dde8e3f9fa29b7c77c9494994c6267528ee4e0cadbd19888a6a7081778aa507cc172064e23d9812c6b4ea400f37ca1e7bffb9c6b77c3b615aaa9dd9883d0cc376b639593425bcd575683d0329ce91529836a496825274c9768c264c1f74b465382b3517c3e2a7aba08c11e695d7337a7ee62b176d8bb18c78571b31078b941c3251b88eff5d48e80a63ff3589d6ac448cb1cb1eab7a4b0a24c7a313b1a48697f5838bcd9ae6f5a2ee9d41ce09a09c67d23cf4e36b44332cbc0bb28fd9df2b59d36fc1fb6436e46e277585b46294fdbe1a33d3d5d7a16c3c8862706b500d75428e451424c0c20b8baafd095b0c216710a2365fc14d0c0bd9bf70ae88579b0753395e84a5effdaa4404ffcf41afe64c6a0cd8996fc1581621453b4e3e2e7b64f7e93997e0a3b566b16855dbda61eb935578edd4b12ca74e3c54896b24a120d22c840ef61756baf424142185944948987cef1e5990dad57946f5dce54d610cdaa455331b1eb1b63ca4a8ed0b5c2242a77c933c224fa3f09a2ad5f962c72f3375588cbc3c808717a61ecb124a9c3e523a022a423e31680c3ef2ff964641b50306558147329eaad6373be9c5f3335754af7abe322f120680ecdafb5599d40b81e2962585031ae45167ddf6397b8a95fb9e2fbec4f334d1f9cbdb4fd9ccd5c55f8f6d360e66e351464128c415beb3741bd5bfe8ba93ab51ac3fd4df59d0072b1084fead81d602374edfbd7c6e58e996bb9107ed564679a122bb4a920dbe9f495674ee2bb2552c151e26b44600ee913348a9bc790a0befc6b4b3dc2ca34181af61e3bc4b80827f00e6fcdbb00abedc479656d6abdd3f27a26ed21966695ebf155b35f1813d34393626516db95081fe21c80456fab9d7ec0cf8b5b583261af587ce4d40ddde19f0137d0090df40d99e41bca6a4a72a67f4207f80659d89dfe33cf2cb285d46ed5b0f5be1b85536c1837bce05b653c19bddb7205fec047411ecb1d8a956d0ba8d7d880580dd05a2095e7a4c59d5f62e78da5f13a5d4aa814af7b1203a4d8b9a14bc2a7e84a1a3df030fd8ac324c616bc454612a44bc1a200b05933650eaa87ce9ccd709ec48a65aa1cadba3229daa57baa459bc4222c5c5987c3650939ef6db301265aa08a50326870d12da08e566df5215ed22ceaa7e37327900246c75b710c01b45d864f0a1d9c13c4c9bd9ac7b279250fa1e389638936d79a8b038e973b7764da77535220e624abf3af8086d158b879405df68d52d9bcd4f2323c729cdf4ae0d16104fe88d7f17480e988635d69273fc3dcd7030f91f3d0637bc007f508acb921f775b8d9487b754ca118340b2ea78c0cdbbf95ffe451591bc34ea5260d3e7d0969ee2ec7d5b2254a5be5bd0223a88b93457d95be74ae5e67b54d927d1af1ccf6165ccab3b8b3cdc87f1b2cafb30e2d485ccd70d2ec8df8c7ea565825433638e40d2908515cfdb5d47b06bab92645b7c97f531aa0ac9ad56fa443344c1a21c0106783d34faf13827df5946d58c79803d6e1762d93662082cafe1806ea52c57b46ad50c64bf93ee44d1ffc9e9457addd0e96017694c419fd72a835da8c1b1d1f0481fb42cfdd65924f90924211581c62524fc05259bd2f2820ee3ffa2d1df02bb4809724d00055e2169533017ef31d10c5e55fe8b100906538dd9f00bdb31c1fa9a4f706d77f9fe23a84850b87de01cffa0a95c85673e8f521492c8b08d31be47f16d54bdc806aa670b201d98966d7d6741bd28591400935358844cb60b4b14d3ee429fa38ba1c65b82bc3edb1b20ec62c7e1e2572864c34e11dcfe7390b25c828b5547afe12f6d8bf78b0bb8bf6d96083b6471d1556678290dcbef57f835422cb93410843c0f599667e6b72d0d4adf7dcc6bfa650b82d979619f168a72e35e957c8bbf5e21b271965d81d479dd34bf606c1c5ef857fcd92a8c2ff8315f501b3bb892d9ab12e74fa83833d99a3b0498d550fe46412df6dc2a889b780201ffeda28789a7fadee7395ac4a14a3709d7159357a61f5a78833920189271f8769a65cf5e3be5f89f7315301ca1866932d22f06ed9946bc851d1af73fb0c19fa7442d7543735d315efaabaf17f4055098e1412a2968982d7906ab2df60844bf40421c58388603244f27157b53c1b13d6bcbed4e3e0b0875e6ec8b7c5ac49906b1013e4ab8c701b51bac3661ce1b4e93538bd06c5e5def249fcd2a74bb709306cfb39fbdef3e47332364e5079812fd2ad27a675941a84af65b9bec4cec5e4c158f7ced07bf6e0ee46c17a4a3b1c24578f78c0f18996f2a89302c50db1ee190a850cf54357c64442b63843b18d516961137e4d6ad9fa622fca92001897fa7e85f97380d3b300ccce1ec6631e974c365dd7901e2928c4d70550bf915aa4f282901aebb2eba5b2d0d5fe303b93fa38138ff578ccc45cc49da42a49677e4f2123eec6d0da03d47ea193ea48efa87c431c6aaf940523f4e3db5f406478280285f781e3e0c4b4c3d41ee9c554db3fa9d58bb0c4b07a71ee3a1801a4f2a02995657ede160c0af2e3d2ab9ec183180ceec570a0e8c1f78c6cb341eb2bbe9cc3af8f3bc7dbc7c753bd2e9b2c4c7d8081bcf5b5489126ce52b0074e2e8e1a28fed7168bed59e954c39986819ce782fd58b97350f83926a754a0689210349ae4bd5a9248fe5d12fad5e18cf1a2cf43aaefe57a7e3003d5115518bb1f8bcd238d9f0daadaa0ba25864bcfa25bcdbb899a9fa001703c39af14727c1c705a376f22d21fd85d0407846bb00923b7b9dd2fca9c123340794a9a44c181282e7663abce3c13cf0dad32f3cde441646967c9ec810858266be3e6f313bb362a7a93e1ad0862926a9a40dae3868b14f2e2c06f950b103b8e1b74f661f807298a5a5fb7e57d4c889741a365eee512b98a957087a157485f16aec7bbc9a59484349c9fb64c83b26b921c4f9100a3029d8bec7f00aa7618435c0d59e7c2596d56c764989d44863d49bf62585a2e78895cf581061093af0552a742249cfe5dc910aca30f35dde78852cb3bcfa069430c25a8c5c0f1e648708e4382241b301fd281b68b0d9a79e4a46331dbcf6aa3d85cf736868b82b8514304ddb36b0053a8a88c54f76c1b89525e4c8efb8d3c543105143d7bf0aa3fdff418b79d150aba96fdb15e39eaae68383822153535a187595f716bfc9194ff0d72c2717e5ce55c2a171f6ae5d5b5b5d1e1b90a2f5ca1dbbce0ff8baa0c9238293292c6231973cdb21039accb8ebe8c0122f42a9c1eb574bb908e79a50b87fab226fdec4afbef04b641e2256d8cd6a57b75974da2ef73cef35049be331a6f072aec65d25254b42d91bbb0e1a39ef348d7e215b7aa8644204c8059a261b25f895a37f12c1575839ddc370d85c51ac5c6b121f0ab73623f379ef2b27744d48aa44267f235ed57843058e4dfbddcb90aa650473921a79332e07a2450e732547a6cd6523e4e02c865bedb27b619cea96b323522d913ec1139c11c36a57709708c5798b3f1f3f825dfd232df242c5ea7244fd624f597ac4ea0e9ddd020c5dc71588efa756705f59e1d22144a31fe33561927fc84a1568eefb9ccc8665cdc4a3dbf6ca2520ced08bd34d363248ca00d8da806c1c4f0d3f26865bb79aee5fb911b471603dad167796044ef6eb7829f2d576a2ea047e43040cfec6cb019183ff5010b956d5261be5b00c5494df8053bb8d35ab0ab1b4c9335c136aae61b4bdc8509d285f234b155bc0bcfe9adcdb5ef52f7477a69df300160d6971f9f09459a22b3f49250fbca06faf450c1929a91f8e2071a61903b22df3f64baae137520767db8c8bdad9f9a986754612c6b581b9d982602d5b23afaafee68018edbc17d2776e7c9a6d7cbb2cec6e44705ca72e2b9bd4a965d1ef310c35d453eb828bf64899943b2f597999578945f5d1586330b5ba9bab22ca2535cba50a439629b4342453a50270fa670134afb77e3b441eac167e872d72190bf35764545203dcf989704af37d1e76d8e26b8cc18e9a7d7b351a60e38952ade4ff618cedc45449dd30ab1e09388510ff591ce7ff83d9d581555682ffce8eceaecef6442d2711f3bf865a60db05f71748ec9551aa8c84f699069ce5c915d8eec7557c2fd87936e8b9229ed3400684b026882810578cc09201e63bf08efd5bea950db200d434910833e46c6fee2c9eb3731300ec8cbce6011aeab1627028d155fda76d261b4eebec5e1f23a9b98606aa6e82edea8c36714d2cbae74f848559e0ced580586fac6cce2475389e3503cdc55a9c74d595fcb7a71a9835769360e396af8124248433de82397c31def35a7c5ea149e6ed38dccd10a835d5eee2e93577d2a3aebffa2e53873e2cdeb75767a31801d77b068b9b65f6126741d601eb4eb0b164a378012814eadd1d8b5cf01ba090c14b226656f28470e8541dae239202ca999f18c59b31d1124ebbe05b15dc11c636be283debdf8cc88ebc9e28a70c00797b19e1e0f93f27113fdf9017fa34e7daf4ad68d1b4bf4bfda41326e8691f8b958a3648be212560e6df9df84498538547e102f0579c9248e9186b94f79394fbef909464edf06a5c7ee34fa0e95fb7f428ada52c2d75647c17bdbff578a85cb861af013e645ade4dca3c759b92b6765ba1a0d2d89c13fc1d0a2408c5ad12afbfd3c1d3b1c5798ce52667f6f0244b749cfbcda94391c5788534953cc10bb8f4974b5c31e58ee9d878facce82998717f2984c13f46ea2e475b63999409e238cd840658e7db435716fca377cad9d5f8a52313576ca0ec8233b8784a265d13a3d967e6483e1d5bfa9a76a4ac1e4644cf5c7f5ffd3cf056473e5e569752b9daf43eabd1797e09f385383fe032ae96c4e093e004601736e55e0dadc07d9e4e70ead8b42fee33ada125cd295891b8b41fea14d5582e8e2ec5f1f7aebc5412976d98fff303e463b767cd3a5b64c1c913272146d6f705d51966e6e15873223f519261345141a57782cc2eed1080e8bfe1ab4c035b2a650a7fe6f1de067fd16462bc1fda0f10a749f48529694f4a31d767e63cd49444a859a4530b783579f9522652c8d119b485a556f240d89360ebac92aafeb7efb1f5d43d76c35c100415e141323adcc31a849a1c3d93d59053420b2c2b22d4e64bc28690fbfb8cbf45ba7dae72fdec605723729df239850e70ee22dbe2d203a12ac41fa69a52dff2df819abd7d54e0c8ec30f45aed38f0f40529036a5ef7b9e90ecb1a7b93d4cbd8f2ad25fdf84fe66594dcc61412458547728422b4754c46606c5055a3ac28daa1cbf56248d5993e31ef45d8c707457729c769a0f22f8b035cfb28ccc387b1c86b5b1bd825bf1362e92cd6bb595a9cab28dbf19ccacaba04ffdfc319cdc0a74bd33996ad028938c3aee642931bec30033e31cfc75920fdc2208b145d7bbff091069b8274116b713b1b88e0bb28592e9667b10ba35319c8f8cd384fca0352e3902ac564e79c5dd8bf8b574a30c9f1315f9265fee5a96d8335826437fcc06302efe3913a9dbcae816116a650230c46c60696a50f9605b87b97c67e7a0e3830601d2749d2d5e39e5db9a09f09be81c12e13f67148cdf4136b3e38756b00d8a931f25742d78f2019404a846c5ba7f7184bc9e2873b7395a48dfa56da4e206382f31acbc47fb9e1f1760dc9b860f1c25735d095ffc495d0baf97b719a51587b8b45e2c7f8e694e1f0fbf78c9e82547f09eb07aab3a30496b55b0b5395b05d6147a93beed8d27973bd34abaf1108b55c8fc449ab0b5a90c188adbd9c7e9d92ca85e57d5fcd96525b40f0d284ac41e856ca07958acea1e6c435f53e7396f1663a6b8089679a8438e526bea39b96ae1e87011a13202a6374ea45f2664ee6ba334368e76ed073c3428cf1305cefc4c248a9dd28b6f64ea3bffbc948e8af4c7b75d250e0274c30857ff73de84609332aa36c3533999c7b4d36dc51265e183c115449c45100fc3a07dc11755d1fd3ddd1476cc005f70c254fc3433bdc8a045283c4d97c1fce02ce4338cb0316e38fe2850a86e09c6c4396ce9ff7ff09f12f0c1971d5ee028867f38721639d303842859c3c1c5b5f36187c5eb6e456926a815080ea48d0bb897cf77607b5ebe266cb57bf1efcdf83c5b5e8f7c508a98f767b616b6f1dcca78eb45bfe1a4444e514fce8cfdffac4408fe55aadf3f7f0f1c817ade255072a983cf7748c2bb3d7ea324290ca05be2e703e067fb080881161a6f0ab35607b7c6f23a195baadd1298fb7a1514912abd6260d9556584e2dbbafd8227601eadb79e89a352446ca039282fcb188b1d7c817c223015c15571a32679b4cc042566abaf9fbf0c59714bb009383f86c83e73b73c05f32a38b93712053eecee363047041b83ff7616fdc4d2655763cb9ce14011033ec1b8ac922d87503cc0965081682b5fdfa7c648ffeec24a964e3b54e449aa9b2c463495954da117bd9aa0b899108632232b370962e6d3c3aaa7f5d5a933491eae75bd85a0e2489058346719ed1db636f03d6b400ece58b77103a6afa8cf962f67bbdea2ab0a1bf184761d2a6e3b36295d1d9ebf0944351533b9bba5fe6f212d0485832843fc17d5a27b7c078ca1581156019e9859be9440671c6f695bc7c66d52dbf47301a10f6ea41e8d730d9b0fd3b2be42a1b42bfab0794f400ecce427030ced9d83a621b3d1fc7a40d48678d95b4fa0dfa09b6b4a3780474ef093c69fea80e28876f3a1177276d71381fd7a7586f25acb3a651fce8d006e28bf9407364cde8070dd5f0ae9e621f5e84f7482a67322d81c79e73df22316bde608568cc905ed2caa6906952dbae7e636297824733634a3b2b70b1d2518920b0b91c48045987e305ed3db06280dd742472f6585fe4a357cd32882f05b10619778dac12b2cc08288ca280e05922e795199f149fa992491506cea60f14c4c1df8c8339dfdc2fa3f65978f839bfd0b72309ee0f6f553b1e8a9becef58db819b9420a2e4e2a4e9bdcadcaf664e42f0560da38d95ae089164f2309f15b15e03e19f56ed856a32a1694011d822e4959644969fa67b8520bb3f5d151f232a808b9473ecbe98cf43407969a7bfa13524a8f8f21d7f8c575245ce31b8dfd2ef8451d46e9c41f9f09257f63741dd0e5132af7ce5c78e5881ee88ced0f9e1a0e36c2e9be1daae1242c329aa5d0bc44e872411364ed04698ffb35510c8e7f98df88d210ef62964009b9c994d2505154bf51377800b375b02e5f62561c7148673ebafcfc3aec09b92b0275279baf6aeacd5984b4cf3a3b2b2bef40353a8eeb157013625452c34b3dfca16b00037983cf846602552becf46883f30ab74ad1c2d2d7adf80219dfb84d663422ae27d0863121b743201f1e28ed411fa5423acedc2618aadeacfe16116190aa9246ccf7db8ae2cc9743b002b9edfcff08bfc25b063e5052d42968d5643a7af2411ef66e47d54531f74c59c26e3bad87c2a3eaecfddfa77c12f341446afc822d5b9e2882812e464ca6ff55687e49f43dbf432513d53d236b435eb9c4033f306f3d442d0d121868e41a138a7fe7502b77bc16dc292165e41f7fe0b4b6401260c016188294be1e2204421818fce8dc286332daafed99043876f1c33120dd9fd21ba902284e6285c5941850c8202033d1d6e31fd965777c323b4394e874d74e25c40592c5688e9e01037db8db2f93e96b542f6bca5931d322f8a144694459dcebaefad4807a16fccd91f8e263f2f1ae3fb49ebaf51330663ec18d3007bb9d8b1c18ce83011534f24646efa6226e3a751e4f74b15e9d2e074799fbe761205168d8ec207e92beea2d64332f7e2f23f3c84109b413ddffd1bbf6954d8674f743d9a7358400397e385c1f59b6b38ced0d8e4710d214e4e1612bc4fe169adff9cb185aa7944656e8c5a4be1c8b0e5947ffe635be3803938bc08c8a75b88dea19897589d44d7e7efecbfa6b6f850e307400d3feec916a2c90ae593c60f2c014779b7e62716e4290f71e26b05ef8b294b34f7b958bd501297a553b02272961074f984d0de81990ba32486b3deabfb22d4d653e83387beaa15da4e45167414658571516e4bced8d3d82a358e33fcb1e9f2b35c659d19d378cc5557a94bf4613cac9bb9a067af815e9dc3ed83416c746ad7084e50479380ac1abecdb3c8826b7c6b69c7630cd4c79883a374e3ca91f4c4d01c423a3a36f5437f201cf1d1da829c930cd7893cceccb7759b3106dd54dbdfdaa3816d4b8597f9f9b8383be2988349274c2f4fe19c63af2c48ee996c94664f96780c42a0717c45b88cb1a72749faba920984698aeacaf8a2ed9fd62a47b4029caab0e50384c6752517cd536015f8be481064860ded9ac42e43b2eeb8dc4204800bb8cca7ad9734a1ce13b9a4e8d918f4af316939f63215c43ac1a34fa1f2e43e696a3c6a40f33b4aca6caa6b6fb778377beeecca07b109ea0ffcdba8072dee47f231361562ff227af553463a6bef16c2852f785d2456c405d48e36e2718ad631b1ec71855e079c4d8e1cc2d1af151ab166c97e1f10b0d378c7cfa2031bff4c6fbac8d41ab0a99d2dee489ce2165aa0ac2a6cc97c3962205dc7df1c4d0f397096369c7a5adf04a3fb3788a666693357718cd87521cb93dc6490ffae1d2c882f1d3391acfb4f534716f000b3895963fb18ad8f317f77e382310fd6c6948fc20d872ec9e3a93aa006e2e6cf2223922539294ce554d589f79f585d1c21114f1f862ab4983f752fe9e9d502d7840b106eb4465f0a4b8a31ffd6a8a275452d2e7c3b49344500d708e3723336f44f48f777d3a87af614f24d59b2f4893d8d4c8ca38be0b9b4597e3e4b5d46f6bf638ccfdc6cde7fca67fd0cc33226cdb22b63a36d3de35a9b3fc6dd0ab64ba1efada3a0757cbf77e019679ffa43e4af3049045a27bfecb20cd1b654a7888689035809b48a5d5bfb8525b2d24d1d5cd3b45e18dc8ca3641cf7bccd905f80ea77a06f118ca19aead7bfbe78e2da24b574d47be1315588a6e50fec5166e4e34d189dffb655f62f09f7503e4b86c688dd640479f1c52a0b1a98333088476e1db33b2d34a2a5e045869b044ced8f52138018590bbcedc7581595e43afc10031a9e7ec943e43e3e36a4a374de670d4effe5419846800d7fc9b3706cd351769d5847a5bc5ab2e3ae690b1f76453ca6ee4612c783ce20f7d917dd4037e65ecd6a08db34dd3ef5b9895019d4944e264f91c8f47088cb52d9ef7ee33d220e87b3cf24bc58f9a8738f87aaa46080aee29ec524e0fa28d02220524588005ec8292ff058059efb462b71a290c2821809233dfc79e697452956822c2dafd6cca529d6d82fb111c969e4fb0d8aeb87b030eded4bc003c4be0389b388e8ba54888ecc12052f5833662da87b0ea77252a1a8112263462b3549acb5ee9b06f745ec5635241a3294704f4f9112638f0843a742faf7640ea7a3a4d554f72d5fe8c8dd36f5ef20308430cc1f64bf19c00eeb134156bb598e7658ab3710c8f567fb8205298aedc5d77af37387e630233140fd31cea3e6af83e04fa74711ecaa6dcbe65dcbf69343e569d7da6a5ca19cdc68c38a396fc246df937841e459bcb12434d543137a09b9a529b7d358c16575f748456d1aa0114d61c73a3daa7c26d492755d3094b255756030a36d37024ae51ac4335931c46898ad078b5f031e705381c9ec3d2884e768098181746d35c440ac198fc6c73f16494f69a2d31479e2a320c91dad3069e75d0cdbfad328555400997acaad299ca0d2e965458bc1d3c4df7a87eeb0af84b8210159c5f9ce21b516cbde5286d6b95c1cd3df460bf0b6f7bf186ffe5441de9770c936b8d31104da1d3b514b1a9d54c7083e4a12642094dd4774989d2a2a4814a3df34262c651ada281bcd43dd2cf26c9ee289fff94353a3497fb7409e5ce57f0c47abc954cbf822901ed7edf55675a53e5ac31bb73c28915d57bbf7d5eab6daeaec5db962cd0640d1f2513d3c7e8d8affc78ce1d8b5067ab3d13d132f1a5fda6a2fefe81d7ea3b5dfa7bcd7abb0e894e7f07f825b067298d8e8e754636240afd416f77ab586d07c7b6addbce3464dfdcfafe4a359a6b703c28a1a7b08c9cfc534c928cce1fc75f8dc8d872916d081fd591b5f26f30f8e440e593bb235171bbe6fbd3161d673aeefabd3b363802555bc19095483b0733a7518547241b6f1feed8d66303cc49564e222f0153285b6bce858c4ec30c9b3f408041aaa53eaf84728e5ae155abe80a5f26af8c65ae87ecdb3f537ba8adbb5f2ac8eba5cef1324188ffa2b013812370c20c0285d488864cca6b8141f332b7aecd3f5b833529450ebb0ea45d626c385289b4e96ca2a7fadb7f986d65da911bbb3163b453e3f6acd1090cd1104c2cda991d11ee57d2722b33511d9c0c9c4b57f2ac1f223b2d63b6795392f29d7aa2538580b629516e30301e3f2787ccf86e26a6e665268d7441643f86fe1aac7c8271caffc4274b27e8c2953696b5f11e958828d6b71b23845d59e656a3b7d75a30f8c19c22f09bbb6ff42b70a05f1b7c04f6bba1e65014d342a7ba316b8fd1dfc5e5ef0066f547518a3e3fe06a47156598e0347aa128c9aec368a2eb1815a210f2813b7143ef9359ff349ee3884c88c00279e13a0fda6b0fe4a4531f6eda7c56423a55d8e6198aa911e38f7c1a8bf6466a804d13a4c6ef11351b6bfe4199259f50c2951cb62779d85ea1892ca11f71f9fe19771709d3433025f3dcc6127baa7d5fc7a016e4d41f0aad1deb30945ff810c49a32d4be30f4c4ba88d5f52147a4666edd245293dd4605d47148019f39aa9e73b5c5de9a7f73cf0261fe2b36a8ec68f24b9896d3a0e6610e65fb626977de101a193c86266e8f9be2aa017d14ccb2628358e0900b945dda3705f2de11949c87e3ef975a394882a9e648a09ebd1748193b78e79ea6528b8ff0d1de906da86e6d423db940eb9f3bc822a2c7ca8d43f150d0784bd226a39027ade795a238a44cbab54a7348884295231d5888e31fe04ba296747b60378c27bfc6339f2a0dcb704cf4a6e6e22be1851cec9ab03ec3ed9bf6cd622e8f3d2b4df3a2fb751b15eeee9939a95dbe65ce08c6ede971efc081a263b85286e60f266da62e93974ac92fcdfc16067b186657630c702d9a3069067b2ff0aed8a2c3b5564b0eebdb2e6aa576d9e3dea2114d442b7bddfcbbac136c703b67d8f078ab73a3a4b359d604bb954341790b318d878275d7299178ecb09403c798e714703246e85141c54916e9fe4a281c2b1d1365e9c1b4208e3477fea3f39a4bc38653886462aca6fcfba020aa855e5c1aae454793cfc7d8954f20c8e4bb42786875730cb9b6ed3d86a07b71419f3f9261754716b83780cc11f3b80616747586082df542eb35f8a6ec9957462b5673e9d6feacf1770929d0e3d5d465453c8c729dd2f84e2b9dac33ab738f41872405e371fd2811ccbc7f02f5935b39c286475296b19524a03f220ed92e2eff0fb9149f63d5d435fa6b5b9b66b6af4dbefcfa9619c087dc1d555d246bd7fb1096c12d559f8a232c7a437fc861c1787362821d84893ccaf3d27e2df51501dbd2ad2315aa5bd7ad4dd068b60e624f034d5158551763cc7b6c40bdb2ca50f01787f5a5c263f727c96dcac8482770b1644f906d810818aeabcf5883502520cd0fceaa3fe52e7a6bed7c996b0c836ec93447bb2e79b259adf7bdedbb87e0b0be4b27be6da7c02b36d6261e512396dafbe071c58434e391fb5a7eedbc1f8aecfde668f0332fca24451ee4d385d8e97ed35885ef04e0ab6da6156cb3810211253833a0077b2a1e264508ad5228da7a466c69bfe5c0800efe4e204ee08aba142a3fe441e61f6342404643aa3acc67c1fd9c677eb03c096dbb2f85303a0d47d6adf3ebd78f9db8a0184df541bcbd3938674ba8c9f7df84a2541e9152b7d18bf13cb0bed455ba2c05203dc8d80f90782603e2e61dd6dd9ffdb3cad1d8587bb1d73317b1b063614044eac5318650cf9b6890c27f8e2eb5011ef43a33257e52d9af753d51ad82f9422806004eb9d2a2dc66cba987c25adb4332a2dffe93526771e70cba5e14f6ffb9c7dad9292801901e4169f2b648ceb2eed97ccf8b3a196ad50e6985915e2b42cafee40c5c61e67947a2da99e5c7ba38fa6c76259934b369144e8cbf136b65b7b26c8d3b12631fcc306dcb1ad11446bf4ef856d3b6411d3151924b35ccd3366e69f136e61900c94e5af46ed65235910ed3bbe860311e44c90cad07e57809098fc431ca4d6d7391a36a9029ddd9cb491ca7432e724fc0c78b8cce27ae891afe6c2c0233f3eda60870fdb3dbe2986de48f331f6b381c04fe37a0ed4f5687410c99456d54a6fb854855b9aeff89ed94ad5dd6aac7e50551b8ff8398cad8770f461e36a73e418b9864afaea31bd6032f1dc34bbefc95254e81a0f0e80aae010954ca26b62fe580f2fbaa58974e65df180ea2bddd9d61f4e109886418f819902327c9386e5a38ccce493982773243f73083f1d061a922dc3a4679c8b7669f97e51fee96748f73c637eac81590167c254ae33dfca724de119aae62942ac829619b98ce10dc48d5e411efc2101b6d207fa442254cb474a73875ba55b731eab2801596d7b834c06d556fa231440344307d7e9eacd384a4ea299118d68cc22f42dcaa50e134ed76e6c68eab791bb349174d5a7faaf25129a5defd2c942c01bcf992170dfaeca4da6683a184f18f197c774a340b6ace522dc854c30cab911f7911364a61f304bbd111dd2ede49dcf147167b2856d6e9bd4e7e9bc4ea743ca733ec3d5a150e26eec8ed3c4a34532c6c2c460276caf812d417a51584aeac733e9460e9b664c6fafd0fb81c55f9fa5374d19ef0ca9feb876af4c0aa176f9909180f07154e5c6a5f0949c4586742f9d26d665c293b06cd17554b7e64766e6e073f17983b27d140156ef419597e40bcdf941203d8580bf25fa58661ee9abefd5d1942d13aef24b32d757b0cfae6c279cf32d7f2326c9027830bec6ff850f1eff5f1de36f67cd89cd1818650eb1684f668bc02da10c0c5cdea193b530beac78a347559512685fe958d4645fe1743dee9a482f4e8e63671eeb387c57bf404ca0a96b10f914c181bbd26c8d32d8b48f0f715e7fb3ca3f7761779e61214be7aaf656f44a8ea607a27a6addab232abbb7cef775fdc6c00dd7b183f229b3a81c9e8cd11e88e5aed7defcf62760ea55c2f275414e87c8c57ec5b90f39458d71ff7d6063c0c1e762abee1cb6cbc1d496444a6d2c81c4607e537421d51f06f40f0d67e0187255bec576609e2f407ca05cd485065fa84a45015509dd23eb1f35f1c13bc8f3b009ba1c4e36d92134a08ecb5d4d2b85644951cc046b0c959b8c7baa3a5314aad201831c0e07514fdb8e18137b9909a96d01e1799993d3c623f52aba97c8b26194db8df00b1399f0b33ba6a77157405fb20976853a363b3ce0311486f9a316be8f4ff45ce8a9b6e9554acd5673c1aa820db343c16e3e91a8b7b581d49c135c8fc57309dc3ba9eaa0b17685ec14638ce5a466f4c3fada8c8654001167cef24fd26be134825a541635a90229e8bb9b4edfdadc59d5b68cca8d700b9044f2a8bded8a604d6a4c20ddb38e406e129799174d936648496dc9411206ec6cc521cbf4f0f2d0650df09dc4662f01a0457cccc3a6a81c882aa0b35144a239ec17bb58a37c77cf300f724c4a28578429032a79c65d4e9bb487237aa289f94ce85baeb6a7f5b4ff9027acc1d190507fdcc9ed6002fc2fecb488ec4b3af79fbb8c82b39a4dfc28ac6f954e7ca880e13983755859a463a8a90d7589c510644c11b5f7d08c25ba326b8b42aac39047e426d6d7e1631e965c3c6b216761d26e016a93c8d7638277561c50615ba801b2534bdd3939094dad67b5abf51d96d4e1451e0f89a4c9c9de6e4ac196b38f1d6ccaa698e3ce595d61d1ba8a537f4bf0c98d616a23dda205d0ee3662e94f63f4e1a8512b5b9eabf7d13cd2f360a908dd0eb9531a394a20f58245525ecec916f2804aedef7ff47e626a8a4eaf49561d422f280f9ddbead3e6664b922231bf9f36f4a56396a405fa4e9b6fdb94194d72ec15ce87d1f5439a150d0b7733fd5a97e2a18db34560b502986b38ccf6fb61d47f0d2ce94b7bd7c256c83ac53acf31b020ea3637ac71331128215301cd6ff5d058b31e73b72b5f99d36c1b75d896d17b9b6c4aaa5ccb52adbc5de0f5c72addc29f13ebd869a18a1d9b986d03768f2c2be266100219e09d503cbadbabb3b0b414007fe70ac6b18f342d620ca512df3cec62eb3865b703d141acd642b0432653f0cf972e8a7f574d536696d86fed3b81d4dd8f963ac279fa4544d73099c1859489c916b48735dc117bb3cc7fc0f36e37d1f8e3e9dfd602bbfc98db86226487156782cd6ad4d601f352a8b163a87fcc2da38ed2062e3f0e5793a0208d339c753da2e34b77b68ed3ce956d51b92ac5c5ed89ffe678351d5e4235e1f4883a03a3748ed6d9faa8abdd0475180216bd04ead0e72dba10846e6dbbd249eaff9541988c388e8ead1731fd1e0c8ca41fdfcfc9440e141a912494041c022735925e970c82759026335766d8fa6b9e23d0408da05f516de21530c4c8bee3f25df56786f4c4e083918b92b1af5ee11a0af956d9d33809780153df9e29e00c67853b2600b167aa266ec93e1fb69121dcaa0543f36d1100060f7b1375b65bb4d37d9c6accae94d8fcb359f93775ec</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">ä½ å¥½å‘€ï¼Œè¿™é‡Œéœ€è¦å¯†ç å“¦, å…³æ³¨å¾®ä¿¡å…¬ä¼—å·å­™èœèœå›å¤å…³é”®è¯chatgptè·å¾—å¯†ç .</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> äººå·¥æ™ºèƒ½ </category>
          
          <category> è‡ªç„¶è¯­è¨€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ChatGPT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çº¯ç”µåŠ¨æ±½è½¦simulinkæ•™ç¨‹</title>
      <link href="/posts/1513554255/"/>
      <url>/posts/1513554255/</url>
      
        <content type="html"><![CDATA[<h1>çº¯ç”µåŠ¨æ±½è½¦simulinkæ¨¡å‹</h1><h2 id="è¯¾ç¨‹ç®€ä»‹">è¯¾ç¨‹ç®€ä»‹</h2><p><img src="https://img.shields.io/github/stars/suntong-1221/EV_Model.svg" alt="Github stars"><br><a href="https://ci.appveyor.com/project/suntong-1221/EV_Model"><img src="https://ci.appveyor.com/api/projects/status/sb279kxuv1be391g?svg=true" alt="Build status"></a></p><p>â€‹è¯¥æ¨¡å‹ä¸ºçº¯ç”µåŠ¨æ±½è½¦å•ç”µæœºæ•´è½¦æ¨¡å‹ğŸš—ï¼Œæ•´è½¦æ¨¡å‹å¯æ­£å¸¸ä»¿çœŸè¿è¡Œï¼Œä½†æ˜¯å…¶ä¸­å¯èƒ½å­˜åœ¨è¾ƒå¤§é—®é¢˜ï¼ŒåŒå­¦ä»¬åœ¨å­¦ä¹ çš„æ—¶å€™ä¸€å®šè¦è¾©è¯çš„çœ‹å¾…ï¼Œç„¶åé‡Œé¢ç¼ºå°‘å‡ ä¸ªè¡¨æ•°æ®ï¼Œè¿™ä¸ªå¹¶æ²¡æœ‰å…¬å¼€ï¼Œå› ä¸ºæ˜¯è¯¾é¢˜ç»„çš„èµ„æºã€‚</p><ul><li>å·²ç»æ·»åŠ äº†2018aç‰ˆæœ¬çš„æ¨¡å‹æ–‡ä»¶</li><li>Bç«™é“¾æ¥ï¼š<a href="https://www.bilibili.com/video/BV1cm4y1S7Rs?spm_id_from=333.999.0.0">https://www.bilibili.com/video/BV1cm4y1S7Rs?spm_id_from=333.999.0.0</a></li></ul><hr><h2 id="æ–°å¢å†…å®¹">æ–°å¢å†…å®¹</h2><p>â€‹å› ä¸ºæœ€åˆä¸Šä¼ æ¨¡å‹EV_v0.1ç‰ˆæœ¬ç¼ºå°‘éƒ¨åˆ†è¯¾é¢˜ç»„å†…éƒ¨æ•°æ®ï¼Œåº”åŒå­¦è¦æ±‚ï¼Œæ–°å¢EM_v0.2ç‰ˆæœ¬ï¼Œä¸‹è½½å¯æ­£å¸¸è¿è¡Œï¼Œç”µæœºæ˜¯éšä¾¿æ‰¾çš„ç¡•å£«è®ºæ–‡ç”µæœºé¢å®šåŠŸç‡ä¸º34kwï¼Œæœ€å¤§è½¬çŸ©130Nmï¼Œç„¶åæˆ‘éšä¾¿æŒ‰ç…§ç‰¹æ€§ç¼–çš„æ•°æ®ï¼Œç”µæœºæ•ˆç‡å›ºå®šä¸º0.95ï¼Œç”µæ± éƒ¨åˆ†ï¼Œç›´æ¥ç»™äº†å›ºå®šå†…é˜»å’Œå›ºå®šå•ä½“ç”µæ± ç”µå‹ã€‚</p><p><font color=Red>æ³¨æ„äº‹é¡¹</font>:underage:</p><ul><li>æ¨¡å‹å¤§è‡´ç¬¦åˆç”µåŠ¨æ±½è½¦ç‰¹æ€§ï¼Œä½†æ˜¯æ•°æ®åŠå…¶ä¸å¯ä¿¡</li><li>ç®€å•å­¦ä¹ ä½¿ç”¨ï¼Œè¾©è¯çœ‹å¾…</li></ul><hr><h2 id="è¯¾ç¨‹åˆ†èŠ‚">è¯¾ç¨‹åˆ†èŠ‚</h2><ol><li><a href="https://www.bilibili.com/video/BV1cm4y1S7Rs/?spm_id_from=333.788&amp;vd_source=df2f7337299806c5a1ed5a5f5b4ffd1d">çº¯ç”µåŠ¨æ±½è½¦simulinkå»ºæ¨¡ä»¿çœŸ-æ¡†æ¶é€»è¾‘</a></li><li><a href="https://www.bilibili.com/video/BV1a3411Y7dg/?spm_id_from=333.788&amp;vd_source=df2f7337299806c5a1ed5a5f5b4ffd1d">çº¯ç”µåŠ¨æ±½è½¦simulinkå»ºæ¨¡ä»¿çœŸ-é©¾é©¶å‘˜æ¨¡å‹</a></li><li><a href="https://www.bilibili.com/video/BV1GT4y1y7TU/?spm_id_from=333.788&amp;vd_source=df2f7337299806c5a1ed5a5f5b4ffd1d">çº¯ç”µåŠ¨æ±½è½¦simulinkå»ºæ¨¡ä»¿çœŸ-ç”µæ± æ¨¡å‹</a></li><li><a href="https://www.bilibili.com/video/BV18L4y1s7W2/?spm_id_from=333.788&amp;vd_source=df2f7337299806c5a1ed5a5f5b4ffd1d">çº¯ç”µåŠ¨æ±½è½¦simulinkå»ºæ¨¡ä»¿çœŸ-æ§åˆ¶æ¨¡å‹</a></li><li><a href="https://www.bilibili.com/video/BV1Yq4y1b7PB/?spm_id_from=333.788&amp;vd_source=df2f7337299806c5a1ed5a5f5b4ffd1d">çº¯ç”µåŠ¨æ±½è½¦simulinkå»ºæ¨¡ä»¿çœŸ-ç”µæœºæ¨¡å‹</a></li><li><a href="https://www.bilibili.com/video/BV1kb4y177MD/?spm_id_from=333.788&amp;vd_source=df2f7337299806c5a1ed5a5f5b4ffd1d">çº¯ç”µåŠ¨æ±½è½¦simulinkå»ºæ¨¡ä»¿çœŸ-è½¦èº«æ¨¡å‹</a></li><li><a href="https://www.bilibili.com/video/BV1r5411o7Rg/?spm_id_from=333.788&amp;vd_source=df2f7337299806c5a1ed5a5f5b4ffd1d">çº¯ç”µåŠ¨æ±½è½¦simulinkå»ºæ¨¡ä»¿çœŸ-ä»¿çœŸä¸æ¬§æ‹‰ç®—æ³•</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> å¼€æºè¯¾ç¨‹ </category>
          
          <category> simulink </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>pythonèœé¸¡æ•™ç¨‹</title>
      <link href="/posts/2838110349/"/>
      <url>/posts/2838110349/</url>
      
        <content type="html"><![CDATA[<h1>pythonèœé¸¡æ•™ç¨‹</h1><h2 id="è¯¾ç¨‹ç®€ä»‹">è¯¾ç¨‹ç®€ä»‹</h2><blockquote><p>è´¹æ›¼å­¦ä¹ æ³•æ˜¯æ¯”è¾ƒæœ‰åçš„ä¸€ç§å­¦ä¹ æ–¹å¼ï¼Œæ ¸å¿ƒè¦ä¹‰æ˜¯é€šè¿‡å¤è¿°æ¦‚å¿µå¹¶åé¦ˆç»“æœæ¥åŠ å¼ºè®°å¿†ï¼Œå®ƒæ˜¯ç¬¦åˆå¤§è„‘çš„è®¤çŸ¥è§„å¾‹ï¼Œä»æ··ä¹±èµ°å‘æœ‰åºçš„è¿‡ç¨‹ï¼Œä»è¢«åŠ¨è®°å¿†èµ°å‘ä¸»åŠ¨ç†è§£å¹¶é˜è¿°ã€‚è¿™ä¹ˆæ£’çš„å­¦ä¹ æ–¹å¼å½“ç„¶è¦å°è¯•å°è¯•ï¼Œé€šè¿‡è¿™ç§æ–¹å¼æˆ‘ä¹Ÿå°è¯•å­¦å­¦python</p></blockquote><p>è¯¾ç¨‹ä¾æ‰˜äºå¤§ä½¬æ–‡å­—ç‰ˆæ•™ç¨‹<a href="https://www.liaoxuefeng.com/wiki/1016959663602400">å»–é›ªå³°pythonæ•™ç¨‹</a>è¿›è¡Œç†è§£ä¸è®²è¿°</p><h2 id="è¯¾ç¨‹é“¾æ¥">è¯¾ç¨‹é“¾æ¥</h2><p><a href="https://www.ixigua.com/7173635950831108620?logTag=51f64d219c69d66c8201">ç¬¬ä¸€èŠ‚ã€è¾“å…¥å’Œè¾“å‡º</a></p><p><a href="https://www.ixigua.com/7174049005603979791?logTag=622639136a3e74362eb4">ç¬¬äºŒèŠ‚ã€æ•°æ®ç±»å‹å’Œå˜é‡</a></p><p><a href="https://www.ixigua.com/7178820918473392655?logTag=ac50f7d3ba276998ee50">ç¬¬ä¸‰èŠ‚ã€å­—ç¬¦ä¸²å’Œç¼–ç </a></p><p><a href="https://www.ixigua.com/7181108669298410024?logTag=9135f17cb2c13d20b8e2">ç¬¬å››èŠ‚ã€ä½¿ç”¨listå’Œtuple</a></p><p><a href="https://www.ixigua.com/7181418828872876547?logTag=9889661aec1751e1989c">ç¬¬äº”èŠ‚ã€æ¡ä»¶åˆ¤æ–­å’Œå¾ªç¯</a></p><p><a href="https://www.ixigua.com/7190390094074184203?logTag=66a3f6d9d08eddd09840">ç¬¬å…­èŠ‚ã€ä½¿ç”¨dictå’Œset</a></p><p><a href="https://www.ixigua.com/7194312039769211396?logTag=9217a796a89d2de0e0f3">ç¬¬ä¸ƒèŠ‚ã€è°ƒç”¨å‡½æ•°</a></p>]]></content>
      
      
      <categories>
          
          <category> å¼€æºè¯¾ç¨‹ </category>
          
          <category> Python </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>9ã€é«˜å¹¶å‘å†…å­˜æ± -æ€§èƒ½æµ‹è¯•åŠä¼˜åŒ–</title>
      <link href="/posts/1573212312/"/>
      <url>/posts/1573212312/</url>
      
        <content type="html"><![CDATA[<h1>å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯¹æ¯”mallocæµ‹è¯•</h1><h2 id="æµ‹è¯•ä»£ç ">æµ‹è¯•ä»£ç </h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;ConcurrentAlloc.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ntimes ä¸€è½®ç”³è¯·å’Œé‡Šæ”¾å†…å­˜çš„æ¬¡æ•°</span></span><br><span class="line"><span class="comment">// rounds è½®æ¬¡</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">BenchmarkMalloc</span><span class="params">(<span class="type">size_t</span> ntimes, <span class="type">size_t</span> nworks, <span class="type">size_t</span> rounds)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">std::vector&lt;std::thread&gt; <span class="title">vthread</span><span class="params">(nworks)</span></span>;</span><br><span class="line">std::atomic&lt;<span class="type">size_t</span>&gt; malloc_costtime = <span class="number">0</span>;</span><br><span class="line">std::atomic&lt;<span class="type">size_t</span>&gt; free_costtime = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> k = <span class="number">0</span>; k &lt; nworks; ++k)</span><br><span class="line">&#123;</span><br><span class="line">vthread[k] = std::<span class="built_in">thread</span>([&amp;, k]() &#123;</span><br><span class="line">std::vector&lt;<span class="type">void</span>*&gt; v;</span><br><span class="line">v.<span class="built_in">reserve</span>(ntimes);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> j = <span class="number">0</span>; j &lt; rounds; ++j)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">size_t</span> begin1 = <span class="built_in">clock</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; ntimes; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//v.push_back(malloc(16));</span></span><br><span class="line">v.<span class="built_in">push_back</span>(<span class="built_in">malloc</span>((<span class="number">16</span> + i) % <span class="number">8192</span> + <span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">size_t</span> end1 = <span class="built_in">clock</span>();</span><br><span class="line"></span><br><span class="line"><span class="type">size_t</span> begin2 = <span class="built_in">clock</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; ntimes; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">free</span>(v[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">size_t</span> end2 = <span class="built_in">clock</span>();</span><br><span class="line">v.<span class="built_in">clear</span>();</span><br><span class="line"></span><br><span class="line">malloc_costtime += (end1 - begin1);</span><br><span class="line">free_costtime += (end2 - begin2);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span>&amp; t : vthread)</span><br><span class="line">&#123;</span><br><span class="line">t.<span class="built_in">join</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cout &lt;&lt; nworks &lt;&lt; <span class="string">&quot;ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ&quot;</span> &lt;&lt; rounds &lt;&lt; <span class="string">&quot;è½®æ¬¡ï¼Œæ¯è½®æ¬¡malloc &quot;</span> &lt;&lt; ntimes &lt;&lt; <span class="string">&quot;æ¬¡ï¼šèŠ±è´¹ï¼š&quot;</span> &lt;&lt; malloc_costtime &lt;&lt; <span class="string">&quot; ms&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cout &lt;&lt; nworks &lt;&lt; <span class="string">&quot;ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ&quot;</span> &lt;&lt; rounds &lt;&lt; <span class="string">&quot;è½®æ¬¡ï¼Œæ¯è½®æ¬¡free &quot;</span> &lt;&lt; ntimes &lt;&lt; <span class="string">&quot;æ¬¡ï¼šèŠ±è´¹ï¼š&quot;</span> &lt;&lt; free_costtime &lt;&lt; <span class="string">&quot; ms&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; nworks &lt;&lt; <span class="string">&quot;ä¸ªçº¿ç¨‹å¹¶å‘malloc&amp;free&quot;</span> &lt;&lt; nworks * rounds * ntimes &lt;&lt; <span class="string">&quot;æ€»è®¡èŠ±è´¹ï¼š&quot;</span> &lt;&lt; malloc_costtime + free_costtime &lt;&lt; <span class="string">&quot; ms&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// å•è½®æ¬¡ç”³è¯·é‡Šæ”¾æ¬¡æ•° çº¿ç¨‹æ•° è½®æ¬¡</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">BenchmarkConcurrentMalloc</span><span class="params">(<span class="type">size_t</span> ntimes, <span class="type">size_t</span> nworks, <span class="type">size_t</span> rounds)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">std::vector&lt;std::thread&gt; <span class="title">vthread</span><span class="params">(nworks)</span></span>;</span><br><span class="line">std::atomic&lt;<span class="type">size_t</span>&gt; malloc_costtime = <span class="number">0</span>;</span><br><span class="line">std::atomic&lt;<span class="type">size_t</span>&gt; free_costtime = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> k = <span class="number">0</span>; k &lt; nworks; ++k)</span><br><span class="line">&#123;</span><br><span class="line">vthread[k] = std::<span class="built_in">thread</span>([&amp;]() &#123;</span><br><span class="line">std::vector&lt;<span class="type">void</span>*&gt; v;</span><br><span class="line">v.<span class="built_in">reserve</span>(ntimes);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> j = <span class="number">0</span>; j &lt; rounds; ++j)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">size_t</span> begin1 = <span class="built_in">clock</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; ntimes; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//v.push_back(ConcurrentAlloc(16));</span></span><br><span class="line">v.<span class="built_in">push_back</span>(<span class="built_in">ConcurrentAlloc</span>((<span class="number">16</span> + i) % <span class="number">8192</span> + <span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">size_t</span> end1 = <span class="built_in">clock</span>();</span><br><span class="line"></span><br><span class="line"><span class="type">size_t</span> begin2 = <span class="built_in">clock</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; ntimes; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">ConcurrentFree</span>(v[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">size_t</span> end2 = <span class="built_in">clock</span>();</span><br><span class="line">v.<span class="built_in">clear</span>();</span><br><span class="line"></span><br><span class="line">malloc_costtime += (end1 - begin1);</span><br><span class="line">free_costtime += (end2 - begin2);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span>&amp; t : vthread)</span><br><span class="line">&#123;</span><br><span class="line">t.<span class="built_in">join</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cout &lt;&lt; nworks &lt;&lt; <span class="string">&quot;ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ&quot;</span> &lt;&lt; rounds &lt;&lt; <span class="string">&quot;è½®æ¬¡ï¼Œæ¯è½®æ¬¡concurrent alloc &quot;</span> &lt;&lt; ntimes &lt;&lt; <span class="string">&quot;æ¬¡ï¼šèŠ±è´¹ï¼š&quot;</span> &lt;&lt; malloc_costtime &lt;&lt; <span class="string">&quot; ms&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; nworks &lt;&lt; <span class="string">&quot;ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ&quot;</span> &lt;&lt; rounds &lt;&lt; <span class="string">&quot;è½®æ¬¡ï¼Œæ¯è½®æ¬¡concurrent dealloc &quot;</span> &lt;&lt; ntimes &lt;&lt; <span class="string">&quot;æ¬¡ï¼šèŠ±è´¹ï¼š&quot;</span> &lt;&lt; free_costtime &lt;&lt; <span class="string">&quot; ms&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; nworks &lt;&lt; <span class="string">&quot;ä¸ªçº¿ç¨‹å¹¶å‘concurrent alloc&amp;dealloc&quot;</span> &lt;&lt; nworks * rounds * ntimes &lt;&lt; <span class="string">&quot;æ€»è®¡èŠ±è´¹ï¼š&quot;</span> &lt;&lt; malloc_costtime + free_costtime &lt;&lt; <span class="string">&quot; ms&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">size_t</span> n = <span class="number">10000</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;==========================================================&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="built_in">BenchmarkConcurrentMalloc</span>(n, <span class="number">4</span>, <span class="number">10</span>);</span><br><span class="line">cout &lt;&lt; endl &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="built_in">BenchmarkMalloc</span>(n, <span class="number">4</span>, <span class="number">10</span>);</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;==========================================================&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç”³è¯·é‡Šæ”¾å›ºå®šå†…å­˜å¤§å°">ç”³è¯·é‡Šæ”¾å›ºå®šå†…å­˜å¤§å°</h2><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302171300120.png" alt="image.png"></p><h2 id="ç”³è¯·é‡Šæ”¾ä¸åŒå†…å­˜å¤§å°">ç”³è¯·é‡Šæ”¾ä¸åŒå†…å­˜å¤§å°</h2><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302171303359.png" alt="image.png"></p><h1>æ€§èƒ½ç“¶é¢ˆåˆ†æ</h1><blockquote><p>ä¸Šè¿°æµ‹è¯•å‘ç°ï¼Œæˆ‘ä»¬çš„å†…å­˜æ± æ¯”mallocè¿˜æ˜¯å·®ä¸€äº›çš„ï¼Œä½†æ˜¯ä¸å¤§å®¹æ˜“çŸ¥é“åˆ°åº•æ˜¯ä»£ç çš„å“ªä¸€ä¸ªéƒ¨åˆ†æ¶ˆè€—çš„æ€§èƒ½è¾ƒå¤šï¼Œä¸çŸ¥é“æ€§èƒ½çš„ç“¶é¢ˆåœ¨å“ªé‡Œï¼Œè¿™æ—¶å€™å¯ä»¥ä½¿ç”¨æ€§èƒ½åˆ†æå·¥å…·</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302171413680.png" alt="image.png"></p><p>æ‰“å¼€æ€§èƒ½æ¢æŸ¥å™¨ï¼Œå¯ç”¨å·¥å…·ç±»ï¼Œæ£€æµ‹é¡¹æ‰“ä¸Šå¯¹å·</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302171414904.png" alt="image.png"></p><p>ç‚¹å‡»å¼€å§‹</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302171430934.png" alt="image.png"></p><p>å¯ä»¥å‘ç°MapObjectToSpanæ‰€èŠ±è´¹æ—¶é—´éå¸¸é•¿ï¼Œå› ä¸ºæ¶‰åŠåˆ°é”çš„ç«äº‰é—®é¢˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å¦‚ä½•è¿›è¡Œä¼˜åŒ–å‘¢ï¼Ÿ</p><h1>åŸºæ•°æ ‘ä¼˜åŒ–</h1><blockquote><p>è¿™é‡Œä½¿ç”¨åŸºæ•°æ ‘è¿›è¡Œä¼˜åŒ–ï¼ŒåŸºæ•°æ ‘å®é™…æ˜¯ä¸€ä¸ªåˆ†å±‚çš„å“ˆå¸Œè¡¨ï¼Œæ ¹æ®æ‰€åˆ†å±‚æ•°ï¼Œå¯ä»¥åˆ†ä¸ºå•å±‚åŸºæ•°æ ‘ã€äºŒå±‚åŸºæ•°æ ‘ã€ä¸‰å±‚åŸºæ•°æ ‘</p></blockquote><h2 id="å•å±‚åŸºæ•°æ ‘">å•å±‚åŸºæ•°æ ‘</h2><blockquote><p>å•å±‚åŸºæ•°æ ‘ä½¿ç”¨çš„æ˜¯ç›´æ¥å®šå€æ³•ï¼Œåœ¨32ä½å¹³å°ä¸‹ï¼Œæœ€å¤šåˆ†æˆ2^32/2^13æ¬¡æ–¹ä¸ªé¡µï¼Œæˆ‘ä»¬ç›´æ¥å¼€2^(31-13)æ¬¡æ–¹å¤§å°çš„æ•°ç»„</p></blockquote><p>è¿™è¿™é‡Œå¯ä»¥ç”¨éç±»å‹æ¨¡æ¿å‚æ•°ï¼Œå°†æ¬¡æ–¹ä¼ å…¥ï¼Œ1&lt;&lt; BITS å°±æ˜¯2çš„BITSæ¬¡æ–¹ã€‚ç›´æ¥å¼€è¿™ä¹ˆé•¿çš„æ•°ç»„</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302171521406.png" alt="image.png"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="type">int</span> BITS&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TCMalloc_PageMap1</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> LENGTH = <span class="number">1</span> &lt;&lt; BITS;</span><br><span class="line"><span class="type">void</span>** array_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">uintptr_t</span> Number;</span><br><span class="line"></span><br><span class="line"><span class="comment">//explicit TCMalloc_PageMap1(void* (*allocator)(size_t)) &#123;</span></span><br><span class="line"><span class="function"><span class="keyword">explicit</span> <span class="title">TCMalloc_PageMap1</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//array_ = reinterpret_cast&lt;void**&gt;((*allocator)(sizeof(void*) &lt;&lt; BITS));</span></span><br><span class="line"><span class="type">size_t</span> size = <span class="built_in">sizeof</span>(<span class="type">void</span>*) &lt;&lt; BITS;</span><br><span class="line"><span class="type">size_t</span> alignSize = SizeClass::_RoundUp(size, <span class="number">1</span> &lt;&lt; PAGE_SHIFT);</span><br><span class="line">array_ = (<span class="type">void</span>**)<span class="built_in">SystemAlloc</span>(alignSize &gt;&gt; PAGE_SHIFT);</span><br><span class="line"><span class="built_in">memset</span>(array_, <span class="number">0</span>, <span class="built_in">sizeof</span>(<span class="type">void</span>*) &lt;&lt; BITS);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Return the current value for KEY.  Returns NULL if not yet set,</span></span><br><span class="line"><span class="comment">// or if k is out of range.</span></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">get</span><span class="params">(Number k)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> ((k &gt;&gt; BITS) &gt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> array_[k];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// REQUIRES &quot;k&quot; is in range &quot;[0,2^BITS-1]&quot;.</span></span><br><span class="line"><span class="comment">// REQUIRES &quot;k&quot; has been ensured before.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Sets the value &#x27;v&#x27; for key &#x27;k&#x27;.</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">set</span><span class="params">(Number k, <span class="type">void</span>* v)</span> </span>&#123;</span><br><span class="line">array_[k] = v;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="äºŒå±‚åŸºæ•°æ ‘">äºŒå±‚åŸºæ•°æ ‘</h2><blockquote><p>å‡è®¾åŒæ ·åœ¨32ä½å¹³å°ä¸‹ï¼Œæœ€å¤šåˆ†æˆ2^32/2^13  = 2^19æ¬¡æ–¹ä¸ªé¡µï¼Œæœ€å¤šç”¨19ä¸ªæ¯”ç‰¹ä½å¯ä»¥æ ‡è¯†ï¼Œç”¨äºŒå±‚å¾—åŸºæ•°æ ‘ï¼Œç¬¬ä¸€å±‚åªç”¨5ä¸ªæ¯”ç‰¹ä½ï¼Œåšç›´æ¥å®šå€ï¼Œå¯¹åº”çš„ä¸‹æ ‡å­˜çš„å…ƒç´ æ˜¯ void* values[LEAF_LENGTH]ï¼Œå‰©ä¸‹çš„14ä½å¯ä»¥æ€»å…±æ˜ å°„ length = 1&lt;&lt;14ä¸ªæ•°æ®</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302171526874.png" alt="image.png"></p><p>ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Two-level radix tree</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">int</span> BITS&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TCMalloc_PageMap2</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="comment">// Put 32 entries in the root and (2^BITS)/32 entries in each leaf.</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> ROOT_BITS = <span class="number">5</span>; <span class="comment">//ç¬¬ä¸€å±‚å¯¹åº”é¡µå·çš„å‰5ä¸ªæ¯”ç‰¹ä½</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> ROOT_LENGTH = <span class="number">1</span> &lt;&lt; ROOT_BITS; <span class="comment">//ç¬¬ä¸€å±‚å­˜å‚¨å…ƒç´ çš„ä¸ªæ•° 2^5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> LEAF_BITS = BITS - ROOT_BITS;<span class="comment">//ç¬¬äºŒå±‚å¯¹åº”é¡µå·çš„å…¶ä½™æ¯”ç‰¹ä½ 19-5=14</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> LEAF_LENGTH = <span class="number">1</span> &lt;&lt; LEAF_BITS; <span class="comment">//ç¬¬äºŒå±‚å­˜å‚¨å…ƒç´ çš„ä¸ªæ•° 2^14</span></span><br><span class="line"><span class="comment">// Leaf node</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Leaf</span> &#123;</span><br><span class="line"><span class="type">void</span>* values[LEAF_LENGTH];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Leaf* root_[ROOT_LENGTH];             <span class="comment">// Pointers to 32 child nodes</span></span><br><span class="line"><span class="type">void</span>* (*allocator_)(<span class="type">size_t</span>);          <span class="comment">// Memory allocator</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">uintptr_t</span> Number;</span><br><span class="line"></span><br><span class="line"><span class="comment">//explicit TCMalloc_PageMap2(void* (*allocator)(size_t)) &#123;</span></span><br><span class="line"><span class="function"><span class="keyword">explicit</span> <span class="title">TCMalloc_PageMap2</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//allocator_ = allocator;</span></span><br><span class="line"><span class="built_in">memset</span>(root_, <span class="number">0</span>, <span class="built_in">sizeof</span>(root_));</span><br><span class="line"></span><br><span class="line"><span class="built_in">PreallocateMoreMemory</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">get</span><span class="params">(Number k)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line"><span class="type">const</span> Number i1 = k &gt;&gt; LEAF_BITS;  <span class="comment">// å³ç§»14ä½ï¼Œå¾—åˆ°å‰5ä½</span></span><br><span class="line"><span class="type">const</span> Number i2 = k &amp; (LEAF_LENGTH - <span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span> ((k &gt;&gt; BITS) &gt; <span class="number">0</span> || root_[i1] == <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> root_[i1]-&gt;values[i2];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">set</span><span class="params">(Number k, <span class="type">void</span>* v)</span> </span>&#123;</span><br><span class="line"><span class="type">const</span> Number i1 = k &gt;&gt; LEAF_BITS;</span><br><span class="line"><span class="comment">// 1000 0000 0000 000-1 = 0111 1111 1111 11</span></span><br><span class="line"><span class="comment">// ç›¸ä¸è·å¾—å14ä½</span></span><br><span class="line"><span class="type">const</span> Number i2 = k &amp; (LEAF_LENGTH - <span class="number">1</span>); </span><br><span class="line"><span class="built_in">ASSERT</span>(i1 &lt; ROOT_LENGTH);</span><br><span class="line">root_[i1]-&gt;values[i2] = v;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¡®ä¿æ˜ å°„[start ï¼Œ start+n-1]é¡µå·çš„ç©ºé—´æ˜¯å¼€å¥½çš„</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Ensure</span><span class="params">(Number start, <span class="type">size_t</span> n)</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (Number key = start; key &lt;= start + n - <span class="number">1</span>;) &#123;</span><br><span class="line"><span class="type">const</span> Number i1 = key &gt;&gt; LEAF_BITS;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Check for overflow</span></span><br><span class="line"><span class="keyword">if</span> (i1 &gt;= ROOT_LENGTH)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Make 2nd level node if necessary</span></span><br><span class="line"><span class="keyword">if</span> (root_[i1] == <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="comment">//Leaf* leaf = reinterpret_cast&lt;Leaf*&gt;((*allocator_)(sizeof(Leaf)));</span></span><br><span class="line"><span class="comment">//if (leaf == NULL) return false;</span></span><br><span class="line"><span class="type">static</span> ObjectPool&lt;Leaf&gt;leafPool;</span><br><span class="line">Leaf* leaf = (Leaf*)leafPool.<span class="built_in">New</span>();</span><br><span class="line"></span><br><span class="line"><span class="built_in">memset</span>(leaf, <span class="number">0</span>, <span class="built_in">sizeof</span>(*leaf));</span><br><span class="line">root_[i1] = leaf;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Advance key past whatever is covered by this leaf node</span></span><br><span class="line">key = ((key &gt;&gt; LEAF_BITS) + <span class="number">1</span>) &lt;&lt; LEAF_BITS;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PreallocateMoreMemory</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// å°†ç¬¬äºŒå±‚å…¨éƒ¨çš„ç©ºé—´éƒ½å¼€å¥½</span></span><br><span class="line"><span class="built_in">Ensure</span>(<span class="number">0</span>, <span class="number">1</span> &lt;&lt; BITS);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨32ä½å¹³å°ä¸‹ï¼Œç¬¬ä¸€å±‚æ•°ç»„å ï¼Œ2^5* 4=2^7å­—èŠ‚ï¼Œç¬¬äºŒå±‚æœ€å¤šæœ‰2^5^2^14^4=2^21=2Mï¼Œæ¶ˆè€—ä¹Ÿä¸å¤§ï¼Œå¯ä»¥ç›´æ¥å…¨å¼€å‡ºæ¥</p></blockquote><h2 id="ä¸‰å±‚åŸºæ•°æ ‘">ä¸‰å±‚åŸºæ•°æ ‘</h2><blockquote><p>64ä½å¹³å°ä¸‹ï¼Œå…¬å…±æœ‰2^64/2^13=2^51ä¸ªé¡µï¼Œä¸€å±‚åŸºæ•°æ ‘è‚¯å®šä¸è¡Œï¼ŒäºŒå±‚é¡µä¸å¤§è¡Œï¼Œç”¨ä¸‰å±‚åŸºæ•°æ ‘ï¼Œä¸‰å±‚åŸºæ•°æ ‘å°±æ˜¯å°†å­˜å‚¨é¡µå·çš„æ¯”ç‰¹ä½åˆ†ä¸‰æ¬¡æ˜ å°„</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302171607278.png" alt="image.png"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Three-level radix tree</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">int</span> BITS&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TCMalloc_PageMap3</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> INTERIOR_BITS = (BITS + <span class="number">2</span>) / <span class="number">3</span>;       <span class="comment">//ç¬¬ä¸€ã€äºŒå±‚å¯¹åº”é¡µå·çš„æ¯”ç‰¹ä½ä¸ªæ•°</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> INTERIOR_LENGTH = <span class="number">1</span> &lt;&lt; INTERIOR_BITS; <span class="comment">//ç¬¬ä¸€ã€äºŒå±‚å­˜å‚¨å…ƒç´ çš„ä¸ªæ•°</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> LEAF_BITS = BITS - <span class="number">2</span> * INTERIOR_BITS; <span class="comment">//ç¬¬ä¸‰å±‚å¯¹åº”é¡µå·çš„æ¯”ç‰¹ä½ä¸ªæ•°</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> LEAF_LENGTH = <span class="number">1</span> &lt;&lt; LEAF_BITS;         <span class="comment">//ç¬¬ä¸‰å±‚å­˜å‚¨å…ƒç´ çš„ä¸ªæ•°</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span></span><br><span class="line">&#123;</span><br><span class="line">Node* ptrs[INTERIOR_LENGTH];</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Leaf</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">void</span>* values[LEAF_LENGTH];</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function">Node* <span class="title">NewNode</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">static</span> ObjectPool&lt;Node&gt; nodePool;</span><br><span class="line">Node* result = nodePool.<span class="built_in">New</span>();</span><br><span class="line"><span class="keyword">if</span> (result != <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">memset</span>(result, <span class="number">0</span>, <span class="built_in">sizeof</span>(*result));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">Node* root_;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">uintptr_t</span> Number;</span><br><span class="line"><span class="function"><span class="keyword">explicit</span> <span class="title">TCMalloc_PageMap3</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">root_ = <span class="built_in">NewNode</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">get</span><span class="params">(Number k)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">const</span> Number i1 = k &gt;&gt; (LEAF_BITS + INTERIOR_BITS);         <span class="comment">//ç¬¬ä¸€å±‚å¯¹åº”çš„ä¸‹æ ‡</span></span><br><span class="line"><span class="type">const</span> Number i2 = (k &gt;&gt; LEAF_BITS) &amp; (INTERIOR_LENGTH - <span class="number">1</span>); <span class="comment">//ç¬¬äºŒå±‚å¯¹åº”çš„ä¸‹æ ‡</span></span><br><span class="line"><span class="type">const</span> Number i3 = k &amp; (LEAF_LENGTH - <span class="number">1</span>);                    <span class="comment">//ç¬¬ä¸‰å±‚å¯¹åº”çš„ä¸‹æ ‡</span></span><br><span class="line"><span class="comment">//é¡µå·è¶…å‡ºèŒƒå›´ï¼Œæˆ–æ˜ å°„è¯¥é¡µå·çš„ç©ºé—´æœªå¼€è¾Ÿ</span></span><br><span class="line"><span class="keyword">if</span> ((k &gt;&gt; BITS) &gt; <span class="number">0</span> || root_-&gt;ptrs[i1] == <span class="literal">NULL</span> || root_-&gt;ptrs[i1]-&gt;ptrs[i2] == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">reinterpret_cast</span>&lt;Leaf*&gt;(root_-&gt;ptrs[i1]-&gt;ptrs[i2])-&gt;values[i3]; <span class="comment">//è¿”å›è¯¥é¡µå·å¯¹åº”spançš„æŒ‡é’ˆ</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">set</span><span class="params">(Number k, <span class="type">void</span>* v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">assert</span>(k &gt;&gt; BITS == <span class="number">0</span>);</span><br><span class="line"><span class="type">const</span> Number i1 = k &gt;&gt; (LEAF_BITS + INTERIOR_BITS);         <span class="comment">//ç¬¬ä¸€å±‚å¯¹åº”çš„ä¸‹æ ‡</span></span><br><span class="line"><span class="type">const</span> Number i2 = (k &gt;&gt; LEAF_BITS) &amp; (INTERIOR_LENGTH - <span class="number">1</span>); <span class="comment">//ç¬¬äºŒå±‚å¯¹åº”çš„ä¸‹æ ‡</span></span><br><span class="line"><span class="type">const</span> Number i3 = k &amp; (LEAF_LENGTH - <span class="number">1</span>);                    <span class="comment">//ç¬¬ä¸‰å±‚å¯¹åº”çš„ä¸‹æ ‡</span></span><br><span class="line"><span class="built_in">Ensure</span>(k, <span class="number">1</span>); <span class="comment">//ç¡®ä¿æ˜ å°„ç¬¬ké¡µé¡µå·çš„ç©ºé—´æ˜¯å¼€è¾Ÿå¥½äº†çš„</span></span><br><span class="line"><span class="built_in">reinterpret_cast</span>&lt;Leaf*&gt;(root_-&gt;ptrs[i1]-&gt;ptrs[i2])-&gt;values[i3] = v; <span class="comment">//å»ºç«‹è¯¥é¡µå·ä¸å¯¹åº”spançš„æ˜ å°„</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ç¡®ä¿æ˜ å°„[start,start+n-1]é¡µå·çš„ç©ºé—´æ˜¯å¼€è¾Ÿå¥½äº†çš„</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Ensure</span><span class="params">(Number start, <span class="type">size_t</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">for</span> (Number key = start; key &lt;= start + n - <span class="number">1</span>;)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">const</span> Number i1 = key &gt;&gt; (LEAF_BITS + INTERIOR_BITS);         <span class="comment">//ç¬¬ä¸€å±‚å¯¹åº”çš„ä¸‹æ ‡</span></span><br><span class="line"><span class="type">const</span> Number i2 = (key &gt;&gt; LEAF_BITS) &amp; (INTERIOR_LENGTH - <span class="number">1</span>); <span class="comment">//ç¬¬äºŒå±‚å¯¹åº”çš„ä¸‹æ ‡</span></span><br><span class="line"><span class="keyword">if</span> (i1 &gt;= INTERIOR_LENGTH || i2 &gt;= INTERIOR_LENGTH) <span class="comment">//ä¸‹æ ‡å€¼è¶…å‡ºèŒƒå›´</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span> (root_-&gt;ptrs[i1] == <span class="literal">NULL</span>) <span class="comment">//ç¬¬ä¸€å±‚i1ä¸‹æ ‡æŒ‡å‘çš„ç©ºé—´æœªå¼€è¾Ÿ</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//å¼€è¾Ÿå¯¹åº”ç©ºé—´</span></span><br><span class="line">Node* n = <span class="built_in">NewNode</span>();</span><br><span class="line"><span class="keyword">if</span> (n == <span class="literal">NULL</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">root_-&gt;ptrs[i1] = n;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (root_-&gt;ptrs[i1]-&gt;ptrs[i2] == <span class="literal">NULL</span>) <span class="comment">//ç¬¬äºŒå±‚i2ä¸‹æ ‡æŒ‡å‘çš„ç©ºé—´æœªå¼€è¾Ÿ</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//å¼€è¾Ÿå¯¹åº”ç©ºé—´</span></span><br><span class="line"><span class="type">static</span> ObjectPool&lt;Leaf&gt; leafPool;</span><br><span class="line">Leaf* leaf = leafPool.<span class="built_in">New</span>();</span><br><span class="line"><span class="keyword">if</span> (leaf == <span class="literal">NULL</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="built_in">memset</span>(leaf, <span class="number">0</span>, <span class="built_in">sizeof</span>(*leaf));</span><br><span class="line">root_-&gt;ptrs[i1]-&gt;ptrs[i2] = <span class="built_in">reinterpret_cast</span>&lt;Node*&gt;(leaf);</span><br><span class="line">&#125;</span><br><span class="line">key = ((key &gt;&gt; LEAF_BITS) + <span class="number">1</span>) &lt;&lt; LEAF_BITS; <span class="comment">//ç»§ç»­åç»­æ£€æŸ¥</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PreallocateMoreMemory</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>å½“éœ€è¦å»ºç«‹æŸä¸€é¡µå·çš„æ˜ å°„å…³ç³»æ—¶ï¼Œå…ˆç¡®ä¿å­˜å‚¨è¯¥é¡µæ˜ å°„çš„æ•°ç»„ç©ºé—´æ˜¯å¼€å¥½çš„ï¼Œè°ƒç”¨Ensureå‡½æ•°ï¼Œå¦‚æœæ²¡å¼€å¥½ï¼Œå°±å¼€è¾Ÿå¯¹åº”çš„ç©ºé—´</p></blockquote><h2 id="ä½¿ç”¨åŸºæ•°æ ‘ä¼˜åŒ–">ä½¿ç”¨åŸºæ•°æ ‘ä¼˜åŒ–</h2><blockquote><p>æˆ‘ä»¬åœ¨32ä½å¹³å°ä¸‹æµ‹è¯•ï¼Œç›´æ¥ä½¿ç”¨ä¸€å±‚åŸºæ•°æ ‘å³å¯å°†unordered_mapæ›¿æ¢æˆåŸºæ•°æ ‘çš„ç»“æ„ï¼Œå¹¶ç”¨setå’Œgetå‡½æ•°ï¼Œæ›¿æ¢æ–¹æ‹¬å·å’Œfindçš„ä½œç”¨</p></blockquote><h3 id="æ›´æ”¹ä»£ç ">æ›´æ”¹ä»£ç </h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TCMalloc_PageMap1&lt;<span class="number">32</span> - PAGE_SHIFT&gt; _idSpanMap;  <span class="comment">//32-13=19ï¼Œæ€»å…±2^19ä¸ªé¡µ</span></span><br></pre></td></tr></table></figure><p>å»ºç«‹æ˜ å°„ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_idSpanMap.<span class="built_in">set</span>(span-&gt;_pageId, span);</span><br></pre></td></tr></table></figure><p>è¯»å–Span</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Span* ret = (Span*)_idSpanMap.<span class="built_in">get</span>(id);</span><br></pre></td></tr></table></figure><h3 id="ä¼˜åŒ–åŸç†">ä¼˜åŒ–åŸç†</h3><blockquote><p>åŸºæ•°æ ‘çš„æ£€ç´¢å¯èƒ½ç•¥å¥½ä¸€ç‚¹ï¼Œä½†æ˜¯æœ€é‡è¦çš„æ˜¯åŸºæ•°æ ‘çš„ç»“æ„ä¸éœ€è¦åŠ é”ï¼Œmapå’Œunordered_mapï¼Œæ’å…¥æ•°æ®åº•å±‚çš„æ•°æ®ç»“æ„å¯èƒ½ä¼šå˜åŒ–ï¼Œæ¯”å¦‚çº¢é»‘æ ‘çš„é€‰æ‹©ï¼Œå“ˆå¸Œè¡¨çš„æ‰©å®¹ï¼Œæ‰€ä»¥åœ¨è¯»å–æ˜ å°„å…³ç³»æ—¶éœ€è¦åŠ é”ï¼Œä½†æ˜¯åŸºæ•°æ ‘ä¸€æ—¦å¼€å¥½ç©ºé—´å°±ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚<br>æˆ‘ä»¬ä¸ä¼šåŒæ—¶å¯¹ä¸€ä¸ªé¡µè¿›è¡Œè¯»å–æ˜ å°„å’Œå»ºç«‹æ˜ å°„çš„æ“ä½œï¼Œåªæœ‰åœ¨é‡Šæ”¾å¯¹è±¡çš„æ—¶å€™æ‰éœ€è¦è¯»å–ï¼Œå»ºç«‹æ˜ å°„éƒ½æ˜¯åœ¨page cacheä¸­è¿›è¡Œï¼Œå»ºç«‹æ˜ å°„çš„å¯¹åº”çš„spançš„usecountä¸º0ï¼Œè€Œè¯»å–å¯¹åº”çš„spançš„usecountä¸ä¸º0ï¼Œæ‰€ä»¥ä¸ä¼šå¯¹ä¸€ä¸ªé¡µåŒæ—¶è¿›è¡Œè¯»å–å’Œå»ºç«‹æ˜ å°„ã€‚</p></blockquote><h3 id="æ€§èƒ½å¯¹æ¯”">æ€§èƒ½å¯¹æ¯”</h3><blockquote><p>å†æ¬¡ä¸mallocè¿›è¡Œå¯¹æ¯”</p></blockquote><p>å›ºå®šå¤§å°çš„å¯¹è±¡çš„ç”³è¯·å’Œé‡Šæ”¾</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302171629323.png" alt="image.png"></p><p>ä¸å›ºå®šå¤§å°çš„å¯¹è±¡çš„ç”³è¯·å’Œé‡Šæ”¾</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302171627490.png" alt="image.png"></p><p>å¯ä»¥çœ‹åˆ°ä¸¤ç§åœºæ™¯ï¼Œéƒ½æ¯”mallocå¿«2~3å€å·¦å³</p>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›® </category>
          
          <category> é«˜å¹¶å‘å†…å­˜æ±  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>8ã€é«˜å¹¶å‘å†…å­˜æ± -ç»†èŠ‚å®Œå–„</title>
      <link href="/posts/2734729201/"/>
      <url>/posts/2734729201/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æˆ‘ä»¬çš„å†…å­˜æ± å·²ç»å®Œæˆäº†ç”³è¯·å†…å­˜å’Œé‡Šæ”¾å†…å­˜çš„åŠŸèƒ½ä½†æ˜¯è¿˜æœ‰å‡ ä¸ªåœ°æ–¹æ²¡æœ‰å¤„ç†å®Œå–„ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p></blockquote><ul><li>å¤§äº256KBçš„å†…å­˜ç”³è¯·</li><li>å†…å­˜æ± çš„å†…éƒ¨è¦è„±ç¦»new</li><li>é‡Šæ”¾å¯¹è±¡æ—¶çš„ç»†èŠ‚</li></ul><h1>å¤§äº256KBçš„å†…å­˜å¤„ç†</h1><h2 id="ç”³è¯·">ç”³è¯·</h2><blockquote><p>åœ¨ConcurrentAlloc.hæ–‡ä»¶ä¸­ï¼Œç”³è¯·å†…å­˜çš„æ—¶å€™è¦åˆ†ä¸¤ç§æƒ…å†µ</p></blockquote><ul><li>å°äº256kbèµ°thread cache</li><li>å¤§äº256kbèµ°page cache</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span>* <span class="title">ConcurrentAlloc</span><span class="params">(<span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (size &gt; MAX_BYTES)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// ç”³è¯·çš„å†…å­˜å¤§äºMAX_BYTES(256kb)</span></span><br><span class="line"><span class="comment">// èµ°Page Cacheå±‚ç”³è¯·</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…ˆè¿›è¡Œå¯¹é½</span></span><br><span class="line"><span class="type">size_t</span> alignSize = SizeClass::<span class="built_in">RoundUp</span>(size);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç„¶åç®—éœ€è¦å‡ é¡µ</span></span><br><span class="line"><span class="type">size_t</span> kpage = alignSize &gt;&gt; PAGE_SHITF;</span><br><span class="line">PageCache::<span class="built_in">GetInstance</span>()-&gt;_pageMtx.<span class="built_in">lock</span>();</span><br><span class="line">Span* span = PageCache::<span class="built_in">GetInstance</span>()-&gt;<span class="built_in">NewSpan</span>(alignSize);</span><br><span class="line">PageCache::<span class="built_in">GetInstance</span>()-&gt;_pageMtx.<span class="built_in">unlock</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> (<span class="type">void</span>*)(span-&gt;_pageId &lt;&lt; PAGE_SHITF);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (pTLSThreadCache == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">pTLSThreadCache = <span class="keyword">new</span> ThreadCache;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> pTLSThreadCache-&gt;<span class="built_in">Allocate</span>(size);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æˆ‘ä»¬SizeClasså¯¹é½çš„é€»è¾‘ï¼Œå¹¶æ²¡æœ‰å¤„ç†å¤§äº256KBçš„å†…å­˜ï¼Œæˆ‘ä»¬éœ€è¦å¢åŠ è¿™ä¸€éƒ¨åˆ†</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">size_t</span> <span class="title">RoundUp</span><span class="params">(<span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (size &lt;= <span class="number">128</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _RoundUp(size, <span class="number">8</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (size &lt;= <span class="number">1024</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _RoundUp(size, <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (size &lt;= <span class="number">8</span> * <span class="number">1024</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _RoundUp(size, <span class="number">128</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (size &lt;= <span class="number">64</span> * <span class="number">1024</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _RoundUp(size, <span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (size &lt;= <span class="number">256</span> * <span class="number">1024</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _RoundUp(size, <span class="number">8</span>*<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// å¤§äº256KB 1&lt;&lt;13 ä¹Ÿå°±æ˜¯8kb</span></span><br><span class="line"><span class="keyword">return</span> _RoundUp(size, <span class="number">1</span> &lt;&lt; PAGE_SHITF);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä½†æ˜¯è¿™ä¸ªå¤§äº256kbçš„è®©page cacheç”³è¯·ï¼Œè¿˜æ˜¯å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œå› ä¸ºpage cacheæœ€å¤šæä¾›128é¡µçš„å†…å­˜ï¼Œå¦‚æœç”³è¯·çš„å†…å­˜å¤§äº128é¡µï¼Œåˆ™è¿˜æ˜¯éœ€è¦è¿›è¡Œå¤„ç†ï¼Œè¿™éƒ¨åˆ†ï¼Œæˆ‘ä»¬åœ¨page cacheä¸­è¿›è¡Œå¤„ç†ã€‚</p></blockquote><pre><code>PageCache::NewSpanå‡½æ•°ä¸­ï¼Œå¢åŠ ç”³è¯·å¤§äº128é¡µçš„spançš„é€»è¾‘</code></pre><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœk &gt; 128é¡µ èµ°ç³»ç»Ÿè°ƒç”¨</span></span><br><span class="line"><span class="keyword">if</span> (k &gt; NPAGES - <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">void</span>* ptr = <span class="built_in">SystemAlloc</span>(k);</span><br><span class="line">Span* span = <span class="keyword">new</span> Span;</span><br><span class="line">span-&gt;_pageId = (PAGE_ID)ptr &gt;&gt; PAGE_SHITF;</span><br><span class="line">span-&gt;_n = k;</span><br><span class="line"></span><br><span class="line">_idSpanMap[span-&gt;_pageId] = span;</span><br><span class="line"><span class="keyword">return</span> span;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é‡Šæ”¾">é‡Šæ”¾</h2><blockquote><p>å¤§äº256kbçš„å†…å­˜ï¼Œé‡Šæ”¾æ—¶ï¼ŒåŒæ ·ä¸èƒ½èµ°thread cacheå±‚å›æ”¶ï¼Œè¦æœ‰å•ç‹¬çš„å›æ”¶é€»è¾‘ï¼Œæˆ‘ä»¬è¿˜æ˜¯é€šè¿‡pagecacheå±‚å›æ”¶</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">ConcurrentFree</span><span class="params">(<span class="type">void</span>* ptr, <span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (size &gt; MAX_BYTES)</span><br><span class="line">&#123;</span><br><span class="line">Span* span = PageCache::<span class="built_in">GetInstance</span>()-&gt;<span class="built_in">MapObjectToSpan</span>(ptr);</span><br><span class="line"></span><br><span class="line">PageCache::<span class="built_in">GetInstance</span>()-&gt;_pageMtx.<span class="built_in">lock</span>();</span><br><span class="line">PageCache::<span class="built_in">GetInstance</span>()-&gt;<span class="built_in">ReleaseSpanToPageCache</span>(span);</span><br><span class="line">PageCache::<span class="built_in">GetInstance</span>()-&gt;_pageMtx.<span class="built_in">unlock</span>();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">assert</span>(pTLSThreadCache);</span><br><span class="line">pTLSThreadCache-&gt;<span class="built_in">Deallocate</span>(ptr, size);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åŒæ ·ï¼Œåœ¨pagecacheå±‚ä¸­è¿˜è¦åˆ†ä¸ºï¼Œè¿™ä¸ªå†…å­˜æ˜¯å¤§äº128é¡µè¿˜æ˜¯å°äº128é¡µï¼Œå°äº128ç›´æ¥èµ°Page cacheå±‚çš„å›æ”¶é€»è¾‘ï¼Œå¤§äº128é¡µçš„é€šè¿‡ç³»ç»Ÿè°ƒç”¨å›æ”¶</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é‡Šæ”¾ç©ºé—²spanå›åˆ°PageCacheï¼Œå¹¶åˆå¹¶ç›¸é‚»çš„span</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PageCache::ReleaseSpanToPageCache</span><span class="params">(Span* span)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (span-&gt;_n &gt; NPAGES - <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">void</span>* ptr = (<span class="type">void</span>*)(span-&gt;_pageId &lt;&lt; PAGE_SHITF);</span><br><span class="line"><span class="built_in">SystemFree</span>(ptr);</span><br><span class="line"><span class="keyword">delete</span> span;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åˆå¹¶ç›¸é‚»çš„spanï¼Œå‘å‰åˆå¹¶ï¼Œæœ‰é—®é¢˜ï¼šå‰é¢çš„spanå¦‚æœè¢«ç”¨å°±ä¸èƒ½è¿›è¡Œåˆå¹¶</span></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">PAGE_ID prevId = span-&gt;_pageId - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> ret = _idSpanMap.<span class="built_in">find</span>(prevId);</span><br><span class="line"><span class="comment">//å‰è¾¹çš„é¡µå·æ²¡æœ‰äº†å°±ä¸å’Œå¹¶äº†</span></span><br><span class="line"><span class="keyword">if</span> (ret == _idSpanMap.<span class="built_in">end</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‰è¾¹ç›¸é‚»é¡µåœ¨ä½¿ç”¨ï¼Œä¸åˆå¹¶</span></span><br><span class="line">Span* prevSpan = ret-&gt;second;</span><br><span class="line"><span class="keyword">if</span> (prevSpan-&gt;_isUse == <span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¶…è¿‡128é¡µçš„spanä¹Ÿä¸åˆå¹¶</span></span><br><span class="line"><span class="keyword">if</span> (prevSpan-&gt;_n + span-&gt;_n &gt; NPAGES - <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿›å…¥åˆå¹¶çš„é€»è¾‘</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//span-&gt;_pageId -= prevSpan-&gt;_n;</span></span><br><span class="line">span-&gt;_pageId = prevSpan-&gt;_pageId;</span><br><span class="line">span-&gt;_n += prevSpan-&gt;_n;</span><br><span class="line"></span><br><span class="line">_spanLists[prevSpan-&gt;_n].<span class="built_in">Erase</span>(prevSpan);</span><br><span class="line"><span class="keyword">delete</span> prevSpan;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">PAGE_ID nextID = span-&gt;_pageId + span-&gt;_n;</span><br><span class="line"><span class="keyword">auto</span> ret = _idSpanMap.<span class="built_in">find</span>(nextID);</span><br><span class="line"><span class="keyword">if</span> (ret == _idSpanMap.<span class="built_in">end</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Span* nextSpan = ret-&gt;second;</span><br><span class="line"><span class="keyword">if</span> (nextSpan-&gt;_isUse == <span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¶…è¿‡128é¡µçš„spanä¹Ÿä¸åˆå¹¶</span></span><br><span class="line"><span class="keyword">if</span> (nextSpan-&gt;_n + span-&gt;_n &gt; NPAGES - <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">span-&gt;_n += nextSpan-&gt;_n;</span><br><span class="line"></span><br><span class="line">_spanLists[nextSpan-&gt;_n].<span class="built_in">Erase</span>(nextSpan);</span><br><span class="line"><span class="keyword">delete</span> nextSpan;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_spanLists[span-&gt;_n].<span class="built_in">PushFront</span>(span);</span><br><span class="line">span-&gt;_isUse = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">_idSpanMap[span-&gt;_pageId] = span;</span><br><span class="line">_idSpanMap[span-&gt;_pageId + span-&gt;_n - <span class="number">1</span>] = span;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œå°è£…çš„äº†Windowsç³»ç»Ÿçš„VirtualFreeå‡½æ•°ï¼Œè¿›è¡Œå¤§äº128é¡µçš„å†…å­˜é‡Šæ”¾</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è°ƒç”¨ç³»ç»Ÿæ¥å£é‡Šæ”¾å†…å­˜</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">static</span> <span class="type">void</span> <span class="title">SystemFree</span><span class="params">(<span class="type">void</span>* ptr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _WIN32</span></span><br><span class="line"><span class="built_in">VirtualFree</span>(ptr, <span class="number">0</span>, MEM_RELEASE);</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="comment">// sbrk unmmapç­‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>ä½¿ç”¨å®šé•¿å†…å­˜æ± é…åˆè„±ç¦»new</h1><blockquote><p>æˆ‘ä»¬çš„å†…å­˜æ± æœŸæœ›çš„æ˜¯åœ¨å†…éƒ¨ä¸ä½¿ç”¨mallocå‡½æ•°ç”³è¯·å†…å­˜ï¼Œèµ°è‡ªå·±çš„ä¸€å¥—ç”³è¯·é‡Šæ”¾ä½“ç³»ï¼Œä½†æ˜¯ç›®å‰æˆ‘ä»¬çš„ä»£ç ä¸­ï¼Œè¿˜æ˜¯æœ‰ä¸å°‘åœ°æ–¹ï¼ˆnew spançš„å¯¹è±¡ï¼‰ä½¿ç”¨äº†newï¼Œä¸ºäº†å®Œå…¨è„±ç¦»newï¼Œæˆ‘ä»¬å¯ä»¥é…åˆä¹‹å‰çš„å®šé•¿å†…å­˜æ± ã€‚</p></blockquote><h2 id="ç”³è¯·-2">ç”³è¯·</h2><p>å› ä¸ºspanå¯¹è±¡éƒ½æ˜¯åœ¨page cacheå±‚newå‡ºæ¥çš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨page cacheå±‚å¢åŠ ä¸€ä¸ªå®šé•¿å†…å­˜æ± å¯¹è±¡</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ObjectPool&lt;Span&gt; _spanPool;</span><br></pre></td></tr></table></figure><blockquote><p>ç„¶åæˆ‘ä»¬åœ¨new Spançš„åœºæ™¯ä¸‹ï¼Œæ›¿æ¢æˆå®šé•¿å†…å­˜æ± çš„ç”³è¯·</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Span* span = <span class="keyword">new</span> Span;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸Šè¾¹æ›¿æ¢æˆä¸‹è¾¹</span></span><br><span class="line"></span><br><span class="line">Span* span = _spanPool.<span class="built_in">New</span>();</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨çº¿ç¨‹ç”³è¯·åˆ›å»ºthread cacheæ—¶ï¼Œä¹Ÿæ˜¯é€šè¿‡newè¿›è¡Œç”³è¯·çš„ï¼ŒåŒæ ·è¿›è¡Œæ›¿æ¢</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (pTLSThreadCache == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/*pTLSThreadCache = new ThreadCache;*/</span></span><br><span class="line"><span class="type">static</span> ObjectPool&lt;ThreadCache&gt; tcPool;</span><br><span class="line">pTLSThreadCache = tcPool.<span class="built_in">New</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é‡Šæ”¾-2">é‡Šæ”¾</h2><blockquote><p>å¯¹åº”çš„deleteä¹Ÿè¦æ›¿æ¢æˆå®šé•¿å†…å­˜æ± çš„Delete</p></blockquote><h1>é‡Šæ”¾å†…å­˜ä¼˜åŒ–ä¸ºä¸ä¼ å¯¹è±¡å¤§å°</h1><blockquote><p>æˆ‘ä»¬ç”¨freeæ—¶ï¼Œåªéœ€è¦ä¼ å…¥ä¸€ä¸ªæŒ‡é’ˆå³å¯ï¼Œä½†æ˜¯æˆ‘ä»¬ç›®å‰çš„å†…å­˜æ± é‡Šæ”¾å†…å­˜ï¼Œä¸ä»…è¦ä¼ å…¥æŒ‡é’ˆï¼Œè¿˜éœ€è¦ä¼ å…¥å¾…é‡Šæ”¾å†…å­˜çš„å¤§å°ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ä¼˜åŒ–ä¸ºä¸ä¼ å…¥å¯¹è±¡çš„å¤§å°</p></blockquote><p>æˆ‘ä»¬å¯ä»¥åœ¨spanå¯¹è±¡ä¸­å¢åŠ æˆå‘˜ï¼šObjSize ç”¨æ¥è®°å½•spanä¸­æ¯ä¸ªå¯¹è±¡çš„å¤§å°</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">size_t</span> _ObjSize = <span class="number">0</span>; <span class="comment">// åˆ‡å¥½çš„å°å¯¹è±¡çš„å¤§å°</span></span><br></pre></td></tr></table></figure><p>é‚£æˆ‘ä»¬çš„é‡Šæ”¾å†…å­˜çš„å‡½æ•°å°±å¯ä»¥æ”¹ä¸ºä¸‹è¾¹çš„å†™æ³•</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">ConcurrentFree</span><span class="params">(<span class="type">void</span>* ptr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Span* span = PageCache::<span class="built_in">GetInstance</span>()-&gt;<span class="built_in">MapObjectToSpan</span>(ptr);</span><br><span class="line"><span class="type">size_t</span> size = span-&gt;_ObjSize;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (size &gt; MAX_BYTES)</span><br><span class="line">&#123;</span><br><span class="line">PageCache::<span class="built_in">GetInstance</span>()-&gt;_pageMtx.<span class="built_in">lock</span>();</span><br><span class="line">PageCache::<span class="built_in">GetInstance</span>()-&gt;<span class="built_in">ReleaseSpanToPageCache</span>(span);</span><br><span class="line">PageCache::<span class="built_in">GetInstance</span>()-&gt;_pageMtx.<span class="built_in">unlock</span>();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">assert</span>(pTLSThreadCache);</span><br><span class="line">pTLSThreadCache-&gt;<span class="built_in">Deallocate</span>(ptr, size);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç°åœ¨çš„é—®é¢˜å°±å˜æˆäº†ï¼ŒObjSizeçš„è®°å½•é—®é¢˜äº†ï¼Œæˆ‘ä»¬æ•´ä¸ªå†…å­˜æ± ä¸­çš„spanå¯¹è±¡éƒ½æ˜¯ä»Page cacheå±‚å‡ºæ¥çš„ï¼Œæ‰€ä»¥åœ¨è°ƒç”¨NewSpançš„æ—¶å€™ï¼Œè¦å°†åˆ‡åˆ†çš„å¯¹è±¡çš„å¤§å°è®°å½•ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”³è¯·å°äº256kbçš„å¯¹è±¡æ—¶ï¼Œéƒ½èµ°çš„thread cache-&gt;central cache-&gt;page cacheï¼Œå¦ä¸€ç§æƒ…å†µæ˜¯å¤§äº256kbç›´æ¥æ‰¾page cacheï¼Œè¿™ä¸¤ä¸ªåœ°æ–¹éƒ½éœ€è¦è®°å½•ObjSize</p></blockquote><p>1ã€åœ¨Centralå±‚è°ƒç”¨NewSpanåï¼Œä½¿å¾—span-&gt;ObjSize=size</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æˆ‘ä»¬è¦è®¡ç®—å‘page cacheå±‚è¦å¤šå°‘é¡µçš„span</span></span><br><span class="line">Span* span = PageCache::<span class="built_in">GetInstance</span>()-&gt;<span class="built_in">NewSpan</span>(SizeClass::<span class="built_in">NumMovePage</span>(size));</span><br><span class="line">span-&gt;_ObjSize = size;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>2ã€CurrentAllocä¸­ï¼Œç”³è¯·å¤§äº256KBçš„å¯¹è±¡</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Span* span = PageCache::<span class="built_in">GetInstance</span>()-&gt;<span class="built_in">NewSpan</span>(alignSize);</span><br><span class="line">span-&gt;_ObjSize = alignSize;</span><br></pre></td></tr></table></figure><h1>STLçº¿ç¨‹å®‰å…¨é—®é¢˜</h1><blockquote><p>æˆ‘ä»¬é€šè¿‡unordered_mapï¼Œå»ºç«‹äº†PAGE_IDå’ŒSpan* çš„è”ç³»ï¼ŒPageCacheå±‚ï¼Œæœ‰è¯»å†™æ“ä½œï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨ä½¿ç”¨PageCacheçš„NewSpanå‡½æ•°æ—¶ï¼Œéƒ½ä¼šåŠ é”ï¼Œä½†æ˜¯CentralCacheå±‚å’ŒConcurrentFreeå‡½æ•°ä¸­ä¼šæœ‰è¯»æ“ä½œï¼Œè€Œä¸”å¹¶æœªåŠ é”ï¼Œè¿™æ ·ï¼Œå¯èƒ½æœ‰çº¿ç¨‹æ­£åœ¨æ”¹ï¼Œå°±æœ‰çº¿ç¨‹è¯»å–ï¼Œä¼šæœ‰çº¿ç¨‹å®‰å…¨çš„é—®é¢˜</p></blockquote><p>æˆ‘ä»¬åœ¨MapObjectToSpanå‡½æ•°ä¸­åŠ é”</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–å¯¹è±¡åˆ°spançš„æ˜ å°„</span></span><br><span class="line"><span class="function">Span* <span class="title">PageCache::MapObjectToSpan</span><span class="params">(<span class="type">void</span>* obj)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">PAGE_ID id = ((PAGE_ID)obj &gt;&gt; PAGE_SHITF);</span><br><span class="line"><span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(_pageMtx)</span></span>;</span><br><span class="line"><span class="keyword">if</span> (_idSpanMap.<span class="built_in">find</span>(id) != _idSpanMap.<span class="built_in">end</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _idSpanMap[id];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">assert</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›® </category>
          
          <category> é«˜å¹¶å‘å†…å­˜æ±  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>7ã€é«˜å¹¶å‘å†…å­˜æ± -é‡Šæ”¾å†…å­˜</title>
      <link href="/posts/3511365265/"/>
      <url>/posts/3511365265/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å‰é¢å‡ ä¸ªç« èŠ‚ï¼Œè¯¦ç»†è¯´æ˜äº†thread cacheã€central cacheã€page cacheå±‚çš„ç»“æ„ä»¥åŠç”³è¯·å†…å­˜çš„é€»è¾‘ã€‚æœ¬èŠ‚å°±æ˜¯è®²è¿°å›æ”¶å†…å­˜çš„è¿‡ç¨‹ï¼Œå¤§è‡´åˆ†ä¸ºä¸‹è¾¹å‡ æ­¥ï¼š</p></blockquote><ul><li>thread cacheæŒ‚çš„è‡ªç”±é“¾è¡¨è¿‡é•¿ï¼Œå°†å†…å­˜é‡Šæ”¾å›central cache</li><li>central cacheç®¡ç†çš„spançš„å†…å­˜å—å…¨éƒ¨å›æ¥åï¼Œå°†spané‡Šæ”¾å›page cache</li><li>page cacheåˆå¹¶å‰åç›¸é‚»çš„ç©ºé—²é¡µ</li></ul><h1>ThreadCacheå±‚å›æ”¶å†…å­˜</h1><blockquote><p>å½“çº¿ç¨‹é‡Šæ”¾å†…å­˜å—æ—¶ï¼Œç›´æ¥å°†å†…å­˜å—æŒ‚åˆ°ç›¸åº”çš„ThreadCacheçš„è‡ªç”±é“¾è¡¨ï¼Œå½“è‡ªç”±é“¾è¡¨çš„é•¿åº¦è¾¾åˆ°thread cacheå±‚å‘central cacheå±‚ç”³è¯·å†…å­˜çš„ä¸€ä¸ªæ‰¹é‡çš„å¤§å°æˆ‘ä»¬å°±è¿›è¡Œé‡Šæ”¾ï¼Œä¹Ÿå°±æ˜¯åˆ°MaxSizeï¼ˆæ…¢å¢é•¿è®°å½•ï¼‰</p></blockquote><pre><code>è¿™é‡Œæ³¨æ„ï¼Œæˆ‘ä»¬å¢åŠ äº†FreeListæˆå‘˜_sizeï¼Œå¹¶æä¾›äº†è¿”å›å®ƒå¤§å°çš„å‡½æ•°Size</code></pre><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é‡Šæ”¾å†…å­˜</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ThreadCache::Deallocate</span><span class="params">(<span class="type">void</span>* obj, <span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">assert</span>(obj);</span><br><span class="line"><span class="built_in">assert</span>(size &lt;= MAX_BYTES);</span><br><span class="line"></span><br><span class="line"><span class="type">size_t</span> index = SizeClass::<span class="built_in">Index</span>(size);</span><br><span class="line">_freeLists[index].<span class="built_in">Push</span>(obj);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœè‡ªç”±é“¾è¡¨çš„é•¿åº¦å¤§äºç”³è¯·ä¸€ä¸ªæ‰¹é‡çš„é•¿åº¦å°±è¿˜ç»™central cache </span></span><br><span class="line"><span class="keyword">if</span> (_freeLists[index].<span class="built_in">Size</span>() &gt;= _freeLists[index].<span class="built_in">MaxSize</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">ListTooLong</span>(_freeLists[index], size);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>é«˜å¹¶å‘å†…å­˜æ± ï¼ŒConcurrentDeallocé‡Šæ”¾å†…å­˜ï¼Œå†…éƒ¨è°ƒç”¨thread cacheå±‚çš„Deallocateå‡½æ•°ï¼ŒDeallocateå‡½æ•°å†…éƒ¨è°ƒç”¨ListTooLongå»å¤„ç†é•¿é“¾è¡¨å½’è¿˜ç»™central cacheå±‚</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">ThreadCache::ListTooLong</span><span class="params">(FreeList&amp; list, <span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">void</span>* start = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="type">void</span>* end = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…ˆå°†MaxSizeé•¿åº¦çš„å†…å­˜ï¼Œä»thread cacheå±‚é‡Šæ”¾å‡ºæ¥</span></span><br><span class="line">list.<span class="built_in">PopRange</span>(start, end, list.<span class="built_in">MaxSize</span>());</span><br><span class="line"></span><br><span class="line">CentralCache::<span class="built_in">GetInstance</span>()-&gt;<span class="built_in">ReleaseListToSpans</span>(start, size);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦å…ˆè°ƒç”¨PopRangeé‡Šæ”¾æŒ‚åœ¨è‡ªç”±é“¾è¡¨MaxSizeé•¿åº¦ï¼ˆè¿™ä¸ªä¹‹å‰æœªå®ç°ï¼‰ï¼Œç„¶åè°ƒç”¨CentralCacheå±‚ReleaseListToSpansï¼Œæ¥å›æ”¶è¿™æ®µå†…å­˜ï¼Œæ¥ä¸‹æ¥çš„å·¥ä½œäº¤ç»™CentralCacheå±‚è¿›è¡Œå¤„ç†</p><h1>CentralCacheå±‚å›æ”¶å†…å­˜</h1><blockquote><p>thread cacheå±‚å½’è¿˜å›äº†ä¸€æ®µå†…å­˜ï¼Œè¿™é‡Œå°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ç›´åˆ°Central Cacheå±‚çš„å“ˆå¸Œæ¡¶ç»“æ„å’Œæ˜ å°„è§„åˆ™ä¸thread cacheå±‚ç›¸åŒï¼Œä½†æ˜¯central cacheå±‚æŒ‚çš„æ˜¯ä¸€ä¸ªä¸ªçš„spanå¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸€æ®µå†…å­˜ï¼Œåº”è¯¥å½’è¿˜ç»™æŸä¸ªæ¡¶çš„å“ªä¸ªspanå¯¹è±¡å‘¢ï¼Ÿ</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302131526327.png" alt="image.png"></p><p>åœ¨page cacheä¸­ï¼Œç”³è¯·å†…å­˜éƒ½æ˜¯æŒ‰é¡µç”³è¯·ï¼Œé‚£ä¹ˆè¿™ä¸€é¡µå†…å­˜åˆ°ä¸‹ä¸€é¡µçš„ä»»ä½•ä¸€ä¸ªåœ°å€ï¼Œå³ç§»PAGE_SHIFTä½éƒ½æ˜¯è¿™é¡µå†…å­˜çš„é¡µå·ã€‚æ¯”å¦‚ä¸‹å›¾çš„ä¾‹å­ï¼Œæˆ‘ä»¬å°±ä»¥é€šè¿‡åœ°å€æ¥ç®—è¿™å—å†…å­˜åº”è¯¥åœ¨é‚£ä¸€é¡µï¼Œç„¶åå»æ‰¾åˆ°å¯¹åº”çš„spanï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬æ²¡åŠæ³•æ‰¾åˆ°</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302132255489.png" alt="image.png"></p><blockquote><p>ä¸ºäº†èƒ½é€šè¿‡é¡µå·ï¼Œæ‰¾åˆ°å¯¹åº”spançš„åœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥å»ºç«‹ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œæ˜ å°„å…³ç³»ä¸ºpage_idå·å’Œå¯¹åº”spançš„æŒ‡é’ˆï¼Œæˆ‘ä»¬åœ¨PageCacheç±»ä¸­å¢åŠ ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼ŒPageCacheå±‚ä¹Ÿä¼šç”¨åˆ°</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::unordered_map&lt;PAGE_ID, Span*&gt; _idSpanMap;</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™å°±éœ€è¦è®°å½•é¡µå·å’Œspan* çš„å¯¹åº”å…³ç³»ï¼ŒPageCacheçš„NewSpanå‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªspanï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¿™ä¸ªå‡½æ•°é‡Œå¢åŠ ç›¸å…³ä»£ç </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å­˜å‚¨nSpançš„é¦–å°¾é¡µè·ŸnSpanå»ºç«‹æ˜ å°„ï¼Œæ–¹ä¾¿page cacheå›æ”¶å†…å­˜</span></span><br><span class="line"></span><br><span class="line">_idSpanMap[nSpan-&gt;_pageId] = nSpan;</span><br><span class="line">_idSpanMap[nSpan-&gt;_pageId + nSpan-&gt;_n - <span class="number">1</span>] = nSpan;  <span class="comment">//åŸç†å¦‚ä¸‹å›¾</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›çš„kSpanï¼Œä¹Ÿè¦å»ºç«‹idå’Œspançš„æ˜ å°„ï¼Œæ–¹ä¾¿central cacheå›æ”¶å°å—å†…å­˜æ—¶ï¼ŒæŸ¥æ‰¾å¯¹åº”çš„span</span></span><br><span class="line"><span class="comment">// ç»™centralå±‚è¿”å›çš„spanï¼Œä¼šè¢«åˆ‡åˆ†æˆå°å—å†…å­˜ï¼Œå½’è¿˜çš„æ—¶å€™åœ°å€æ¢æˆé¡µå·å°±å¯èƒ½æ˜¯å…¶ä¸­çš„æŸä¸€é¡µ</span></span><br><span class="line"><span class="keyword">for</span> (PAGE_ID i = <span class="number">0</span>; i &lt; kSpan-&gt;_n; ++i)</span><br><span class="line">&#123;</span><br><span class="line">_idSpanMap[kSpan-&gt;_pageId + i] = kSpan;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302132221620.png" alt="image.png"></p><blockquote><p>è®°å½•å®Œæ˜ å°„å…³ç³»ä¹‹åï¼Œå¯ä»¥ç»§ç»­åœ¨å°è£…ä¸€ä¸ªå‡½æ•°ï¼ŒåŠŸèƒ½å°±æ˜¯ç»™æˆ‘ä¸€ä¸ªåœ°å€ï¼Œæˆ‘å°±è¿”å›å®ƒåº”è¯¥æ‰€åœ¨çš„spançš„åœ°å€</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–å¯¹è±¡åˆ°spançš„æ˜ å°„</span></span><br><span class="line"><span class="function">Span* <span class="title">PageCache::MapObjectToSpan</span><span class="params">(<span class="type">void</span>* obj)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">PAGE_ID id = ((PAGE_ID)obj &gt;&gt; PAGE_SHITF);</span><br><span class="line"><span class="keyword">if</span> (_idSpanMap.<span class="built_in">find</span>(id) != _idSpanMap.<span class="built_in">end</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _idSpanMap[id];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">assert</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸Šè¾¹å‰ç½®å·¥ä½œåšå®Œä¹‹åï¼Œå¯ä»¥å†™ReleaseListToSpanså‡½æ•°äº†ï¼Œå¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š</p></blockquote><ol><li>é€šè¿‡èµ·å§‹åœ°å€ï¼Œä¸æ–­å‘åèµ°ï¼Œæ‰¾åˆ°å¯¹åº”çš„spanï¼Œç„¶åå¤´æ’è¿›spançš„è‡ªç”±é“¾è¡¨</li><li>è®©å¯¹åº”çš„spançš„_useCountï¼Œå½“å‡åˆ°0è¯´æ˜ï¼Œè¿™ä¸ªspançš„æ‰€æœ‰å†…å­˜å—éƒ½å›æ¥äº†ï¼Œè¯¥spanå¯ä»¥è¢«å›æ”¶</li><li>ä»spanlistä¸­å°†å¯¹åº”çš„spanåˆ é™¤æ‰ï¼Œç„¶åè®©pagecacheå›æ”¶</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CentralCache::ReleaseListToSpans</span><span class="params">(<span class="type">void</span>* start, <span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">size_t</span> index = SizeClass::<span class="built_in">Index</span>(size);</span><br><span class="line"></span><br><span class="line">_spanLists[index]._mtx.<span class="built_in">lock</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// é—®é¢˜ï¼šæ¢å›æ¥çš„å†…å­˜æŒ‚åˆ°å“ªä¸ªspanä¸Šï¼Ÿ</span></span><br><span class="line"><span class="comment">// é€šè¿‡åœ°å€ start&gt;&gt;PAGE_SHIFTï¼Œå°±æ˜¯spançš„é¡µå·ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥å»ºç«‹é¡µå·å’ŒspanæŒ‡é’ˆçš„æ˜ å°„</span></span><br><span class="line"><span class="comment">// è¿™é‡Œå¯ä»¥é€šè¿‡å“ˆå¸Œè¡¨åš- unordered_map&lt;PAGE_ID, Span*&gt; </span></span><br><span class="line"><span class="keyword">while</span> (start)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">void</span>* next = <span class="built_in">NextObj</span>(start);</span><br><span class="line">Span* span = PageCache::<span class="built_in">GetInstance</span>()-&gt;<span class="built_in">MapObjectToSpan</span>(start);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤´æ’è¿›spançš„ç®¡ç†çš„é“¾è¡¨</span></span><br><span class="line"><span class="built_in">NextObj</span>(start) = span-&gt;_freeList;</span><br><span class="line">span-&gt;_freeList = start;</span><br><span class="line"></span><br><span class="line">span-&gt;_useCount--;</span><br><span class="line"></span><br><span class="line"><span class="comment">// spanåˆ‡åˆ†å›å»çš„å°å—å†…å­˜éƒ½å›æ¥äº†</span></span><br><span class="line"><span class="comment">// å°†è¿™ä¸ªspan å›æ”¶ç»™page cache</span></span><br><span class="line"><span class="keyword">if</span> (span-&gt;_useCount == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">_spanLists[index].<span class="built_in">Erase</span>(span);</span><br><span class="line">span-&gt;_next = <span class="literal">nullptr</span>;</span><br><span class="line">span-&gt;_next = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="comment">// spanç®¡ç†å†…å­˜ï¼Œé€šè¿‡é¡µå·å’Œé¡µæ•°å°±å¯ä»¥</span></span><br><span class="line">span-&gt;_freeList = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">_spanLists[index]._mtx.<span class="built_in">unlock</span>();</span><br><span class="line"></span><br><span class="line">PageCache::<span class="built_in">GetInstance</span>()-&gt;_pageMtx.<span class="built_in">lock</span>();</span><br><span class="line">PageCache::<span class="built_in">GetInstance</span>()-&gt;<span class="built_in">ReleaseSpanToPageCache</span>(span);</span><br><span class="line"></span><br><span class="line">PageCache::<span class="built_in">GetInstance</span>()-&gt;_pageMtx.<span class="built_in">unlock</span>();</span><br><span class="line"></span><br><span class="line">_spanLists[index]._mtx.<span class="built_in">lock</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">start = next;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è§£é”</span></span><br><span class="line">_spanLists[index]._mtx.<span class="built_in">unlock</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1>PageCacheå±‚å›æ”¶å†…å­˜</h1><blockquote><p>page cacheå°±å›æ”¶spanï¼Œå¹¶ä¸”åˆå¹¶ç›¸é‚»çš„spanï¼Œå¯ä»¥å‘å‰åˆå¹¶ä¹Ÿå¯ä»¥å‘ååˆå¹¶ï¼Œä½†æ˜¯åˆå¹¶æœ‰ä¸ªé—®é¢˜ï¼šåªèƒ½åˆå¹¶æ²¡æœ‰ç”¨çš„spanï¼Œå¦‚æœæœ‰çš„spanæ­£åœ¨è¢«ç”¨å°±ä¸èƒ½åˆå¹¶ï¼Œå¤§è‡´æ­¥éª¤å¦‚ä¸‹ï¼š</p></blockquote><p>é¦–å…ˆåˆ¤æ–­spanæ˜¯å¦è¢«ä½¿ç”¨ï¼Ÿæˆ‘ä»¬åœ¨Spanç±»ä¸­å¢åŠ æˆå‘˜ï¼Œåˆ¤æ–­è¯¥spanå¯¹è±¡æœ‰æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰è¢«ä½¿ç”¨</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> _isUse = <span class="literal">false</span>; <span class="comment">//æ˜¯å¦è¢«ä½¿ç”¨</span></span><br></pre></td></tr></table></figure><p>åœ¨Central Cacheå±‚ä¸­æˆ‘ä»¬å‘PageCacheç”³è¯·æ–°çš„spanï¼Œè¿™æ—¶éœ€è¦å°†isUseæ”¹æˆtrueï¼Œæ ‡è¯†è¿™ä¸ªspanè¢«ç”¨äº†</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æˆ‘ä»¬è¦è®¡ç®—å‘page cacheå±‚è¦å¤šå°‘é¡µçš„span</span></span><br><span class="line">Span* span = PageCache::<span class="built_in">GetInstance</span>()-&gt;<span class="built_in">NewSpan</span>(SizeClass::<span class="built_in">NumMovePage</span>(size));</span><br><span class="line">span-&gt;_isUse = <span class="literal">true</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯å‘å‰å‘ååˆå¹¶spanï¼Œéœ€è¦æ³¨æ„ï¼š</p><ul><li>å½“åˆå¹¶åˆ°å¤´äº†å°±ä¸å†åˆå¹¶äº†</li><li>å‰åçš„é¡µæœ‰è¢«ä½¿ç”¨çš„ä¹Ÿä¸åˆå¹¶</li><li>åˆå¹¶çš„é•¿åº¦å·²ç»è¶…è¿‡128ä¹Ÿä¸å†è¿›è¡Œåˆå¹¶</li></ul><blockquote><p>å‘å‰åˆå¹¶é€»è¾‘</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302140054029.png" alt="image.png"></p><blockquote><p>å‘ååˆå¹¶é€»è¾‘</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302140100674.png" alt="image.png"></p><blockquote><p>æ•´ä½“ä»£ç </p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é‡Šæ”¾ç©ºé—²spanå›åˆ°PageCacheï¼Œå¹¶åˆå¹¶ç›¸é‚»çš„span</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PageCache::ReleaseSpanToPageCache</span><span class="params">(Span* span)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// åˆå¹¶ç›¸é‚»çš„spanï¼Œå‘å‰åˆå¹¶ï¼Œæœ‰é—®é¢˜ï¼šå‰é¢çš„spanå¦‚æœè¢«ç”¨å°±ä¸èƒ½è¿›è¡Œåˆå¹¶</span></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">PAGE_ID prevId = span-&gt;_pageId - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> ret = _idSpanMap.<span class="built_in">find</span>(prevId);</span><br><span class="line"><span class="comment">//å‰è¾¹çš„é¡µå·æ²¡æœ‰äº†å°±ä¸å’Œå¹¶äº†</span></span><br><span class="line"><span class="keyword">if</span> (ret == _idSpanMap.<span class="built_in">end</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‰è¾¹ç›¸é‚»é¡µåœ¨ä½¿ç”¨ï¼Œä¸åˆå¹¶</span></span><br><span class="line">Span* prevSpan = ret-&gt;second;</span><br><span class="line"><span class="keyword">if</span> (prevSpan-&gt;_isUse == <span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¶…è¿‡128é¡µçš„spanä¹Ÿä¸åˆå¹¶</span></span><br><span class="line"><span class="keyword">if</span> (prevSpan-&gt;_n + span-&gt;_n &gt; NPAGES - <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿›å…¥åˆå¹¶çš„é€»è¾‘</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//span-&gt;_pageId -= prevSpan-&gt;_n;</span></span><br><span class="line">span-&gt;_pageId = prevSpan-&gt;_pageId;</span><br><span class="line">span-&gt;_n += prevSpan-&gt;_n;</span><br><span class="line"></span><br><span class="line">_spanLists[prevSpan-&gt;_n].<span class="built_in">Erase</span>(prevSpan);</span><br><span class="line"><span class="keyword">delete</span> prevSpan;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">PAGE_ID nextID = span-&gt;_pageId + span-&gt;_n;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> ret = _idSpanMap.<span class="built_in">find</span>(nextID);</span><br><span class="line"><span class="keyword">if</span> (ret == _idSpanMap.<span class="built_in">end</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Span* nextSpan = ret-&gt;second;</span><br><span class="line"><span class="keyword">if</span> (nextSpan-&gt;_isUse == <span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¶…è¿‡128é¡µçš„spanä¹Ÿä¸åˆå¹¶</span></span><br><span class="line"><span class="keyword">if</span> (nextSpan-&gt;_n + span-&gt;_n &gt; NPAGES - <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">span-&gt;_n += nextSpan-&gt;_n;</span><br><span class="line"></span><br><span class="line">_spanLists[nextSpan-&gt;_n].<span class="built_in">Erase</span>(nextSpan);</span><br><span class="line"><span class="keyword">delete</span> nextSpan;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_spanLists[span-&gt;_n].<span class="built_in">PushFront</span>(span);</span><br><span class="line">span-&gt;_isUse = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">_idSpanMap[span-&gt;_pageId] = span;</span><br><span class="line">_idSpanMap[span-&gt;_pageId + span-&gt;_n - <span class="number">1</span>] = span;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›® </category>
          
          <category> é«˜å¹¶å‘å†…å­˜æ±  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>obsidiançº¯ç²¹ç‰ˆæ’ä»¶æ¨è</title>
      <link href="/posts/3017994336/"/>
      <url>/posts/3017994336/</url>
      
        <content type="html"><![CDATA[<p>åªæ˜¯å•çº¯çš„è®°ç¬”è®°è€Œä¸æ˜¯æƒ³è¦all in oneï¼Œå»ºè®®åˆ«çœ‹å¤ªå¤šæ•™ç¨‹ï¼Œå¦åˆ™ä½ æŠ˜è…¾è¿™ä¸ªè½¯ä»¶çš„åŠŸå¤«å¾ˆæœ‰å¯èƒ½å¤§äºä½ è®°ç¬”è®°çš„åŠŸå¤«ï¼ˆæ— èŠç©éšæ„ï¼‰ï¼Œå¦‚æœæƒ³è¦å•çº¯çš„è·å¾—çº¯ç²¹ç‚¹çš„markdownè®°ç¬”è®°å¾€ä¸‹çœ‹ã€‚</p><hr><h2 id="ä¸€ã€ä¸»é¢˜ç¯‡">ä¸€ã€ä¸»é¢˜ç¯‡</h2><blockquote><p>é€‚å½“æŠ˜è…¾</p></blockquote><p>å»ºè®®ç›´æ¥é»˜è®¤å³å¯ï¼Œé»˜è®¤é£æ ¼å’Œgithub READMEã€å„ç§åšå®¢å¹³å°ï¼Œæ— å¤ªå¤šç¾åŒ–çš„ä¸ªäººåšå®¢é£æ ¼å·®ä¸å¤šï¼Œåˆ†äº«æ—¶ä¸ä¼šå·®å¤ªå¤§ã€‚</p><h2 id="äºŒã€æ’ä»¶ç¯‡">äºŒã€æ’ä»¶ç¯‡</h2><blockquote><p>å°‘æŠ˜è…¾ï¼Œè¿™é‡Œæ¨è5ä¸ªï¼Œèƒ½å¤Ÿå¸¦æ¥æœ€å•çº¯ç®€å•çš„ä½¿ç”¨markdownçš„ä½“éªŒï¼Œå¤§å®¶è°¨è®°æŠ˜è…¾è½¯ä»¶çš„åŠŸå¤«ä¸€å®šä¸è¦å¤§äºè®°ç¬”è®°çš„åŠŸå¤«</p></blockquote><h3 id="æ’ä»¶1ã€Recent-Files">æ’ä»¶1ã€Recent Files</h3><blockquote><p>è¿™ä¸ªæ’ä»¶å¾ˆå®ç”¨ï¼Œèƒ½çœ‹æœ€è¿‘æ‰“å¼€çš„æ–‡ç« </p></blockquote><p><img src="https://picx.zhimg.com/80/v2-2a43b3c2f87a0b4e2a0218a404be60e7_1440w.png" alt=""></p><h3 id="æ’ä»¶2ã€File-Explorer-Note-Count">æ’ä»¶2ã€File Explorer Note Count</h3><blockquote><p>èƒ½æ˜¾ç¤ºæ–‡ä»¶å¤¹ä¸‹è¾¹æœ‰å‡ ä¸ªæ–‡ä»¶</p></blockquote><p><img src="https://picx.zhimg.com/80/v2-c1070e27a0147824c27ff31952d04a79_1440w.png" alt=""></p><p>â€‹</p><h3 id="æ’ä»¶3ã€Editing-Toolbar">æ’ä»¶3ã€Editing Toolbar</h3><blockquote><p>éå¸¸å®ç”¨ï¼Œå°†å¸¸è§çš„markdownåŠŸèƒ½ï¼Œé›†æˆä¸ºä¸€ä¸ªå°å·¥å…·æ¡ï¼Œç±»ä¼¼wordçš„ä¸Šè¾¹å·¥å…·æ </p></blockquote><p><img src="https://picx.zhimg.com/80/v2-6e1c7066841550a84593ef45432964f3_1440w.png" alt=""></p><p>â€‹</p><h3 id="æ’ä»¶4ã€Advanced-Tables">æ’ä»¶4ã€Advanced Tables</h3><blockquote><p>obsidiançš„markdownè¡¨æ ¼æ¯”è¾ƒéš¾æ‰“ï¼Œè¿™ä¸ªæ˜¯å¢å¼ºè¾“å…¥è¡¨æ ¼åŠŸèƒ½çš„æ’ä»¶ï¼Œåªè¦è¾“å…¥ä¸€ä¸ª | åŠ å†…å®¹ç„¶åé…åˆå›è½¦å’Œtabé”®ï¼Œå°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„æå‡ºæ¥è¡¨æ ¼ï¼Œå½“ç„¶å®ƒä¹Ÿå¸¦äº†å·¥å…·æ </p></blockquote><p><img src="https://pic1.zhimg.com/80/v2-46d5ca49fae211260e450719d7bf198f_1440w.png" alt=""></p><p>â€‹</p><h3 id="æ’ä»¶5ã€Image-Auto-Upload-Plugin">æ’ä»¶5ã€Image Auto Upload Plugin</h3><blockquote><p>ä½¿ç”¨markdownå›¾åºŠè‚¯å®šå¾ˆé‡è¦ï¼Œæˆ‘ä»¬è‚¯å®šæœŸæœ›å¤åˆ¶å›¾ç‰‡åˆ°ç¬”è®°è½¯ä»¶ï¼Œå›¾ç‰‡å°±èƒ½è‡ªåŠ¨ä¸Šä¼ åˆ°å›¾åºŠï¼Œç„¶åç¬”è®°è½¯ä»¶é‡Œé¢æœ‰é“¾æ¥ï¼Œå¾ˆå¹¸è¿çš„æ˜¯obsidiané‡Œé¢æœ‰è¿™ä¸ªæ’ä»¶ï¼Œå’ŒPicGoé…åˆå°±å¯ä»¥åšåˆ°å•¦ï¼Œéå¸¸æ–¹ä¾¿</p></blockquote><p><img src="https://picx.zhimg.com/80/v2-b6b604e116dc13364e87b1164c0ef1b0_1440w.png" alt=""></p><p>â€‹</p><p><a href="https://post.smzdm.com/p/az6mokvo/">Obsidianå’Œpicgoå›¾ç‰‡è‡ªåŠ¨ä¸Šä¼ å›¾åºŠæ•™ç¨‹</a></p><h2 id="ä¸‰ã€æ€»ç»“">ä¸‰ã€æ€»ç»“</h2><p>åˆ‡è®°ï¼Œè®°ç¬”è®°æ‰æ˜¯æ­£é“ï¼Œåˆ«å…¥äº†æŠ˜è…¾è½¯ä»¶çš„å‘ï¼Œç„¶åå¦‚æœå«Œå¼ƒobsidianä¸‹è½½æ’ä»¶çš„ç½‘ç»œé—®é¢˜ï¼Œå¯ä»¥å…³æ³¨æˆ‘çš„å…¬ä¼—å·ã€å­™èœèœã€‘å›å¤ ã€obsidianã€‘å¯ä»¥è·å¾—ä¸Šè¾¹çš„äº”ä¸ªæ’ä»¶ã€‚</p><p><img src="https://pica.zhimg.com/80/v2-46fe8b8c98beb6661c01f6443788299b_1440w.png" alt=""></p><p>è¿™å‡ ä¸ªæ–‡ä»¶ç›´æ¥æ‹·è´åˆ° ä½ çš„ä»“åº“è·¯å¾„ä¸‹ \ .obsidian \ pluginsé‡Œé¢å³å¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
          <category> obsidian </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>6ã€é«˜å¹¶å‘å†…å­˜æ± -PageCache</title>
      <link href="/posts/2890609329/"/>
      <url>/posts/2890609329/</url>
      
        <content type="html"><![CDATA[<h1>æ¡†æ¶ç»“æ„</h1><blockquote><p>central cacheå¯¹åº”çš„æ¡¶é‡Œå¦‚æœæ²¡æœ‰spanå¯¹è±¡ï¼Œéœ€è¦å‘page cacheå±‚ç”³è¯·ä¸€ä¸ªéç©ºçš„spanï¼Œpage cacheä¹Ÿæ˜¯å“ˆå¸Œæ¡¶çš„ç»“æ„ï¼ŒåŒæ ·é€šè¿‡åŒå‘é“¾è¡¨ç»„ç»‡ä¸€ä¸ªä¸ªçš„spanå¯¹è±¡ï¼Œä½†æ˜¯æ˜ å°„è§„åˆ™å’Œthread cacheå’Œcentral cacheå±‚ä¸åŒï¼Œpage cacheçš„é€»è¾‘æŠ½è±¡ç»“æ„å¦‚ä¸‹ï¼š</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302101543881.png" alt="33250a692c214c8286b38ba3c6c96847.png"></p><pre><code>page cacheé‡‡ç”¨ç›´æ¥å®šå€æ³•ï¼Œå‡ å·æ¡¶å°±æ˜¯æŒ‚çš„å‡ é¡µçš„spanï¼Œpagecheçš„spanå¯¹è±¡æ˜¯æŒ‰é¡µä¸ºå•ä½ï¼Œå¹¶æ²¡æœ‰åˆ‡åˆ†æˆå°å¯¹è±¡ï¼Œcentral cacheä¼šç”³è¯·å›ºå®šé¡µæ•°çš„spanï¼Œç„¶åè¿›è¡Œåˆ‡åˆ†</code></pre><h1>å…·ä½“å®ç°</h1><h2 id="page-cahe-ç±»">page cahe ç±»</h2><blockquote><p>page cache è¿™é‡Œè®¾è®¡spanæœ€å¤šæœ‰128é¡µï¼ˆ128 * 8 * 1024 = 1mï¼‰ï¼Œä¹Ÿå¯ä»¥æœ‰è®¾è®¡æˆå…¶ä»–å¤§å°ï¼Œæˆ‘ä»¬è®¾è®¡çš„thread cahcheå±‚æœ€å¤§ç”³è¯·256kbçš„å¯¹è±¡ï¼Œ128é¡µèƒ½åˆ‡æˆ4ä¸ªï¼Œç„¶åæˆ‘ä»¬è®©å‡ å·æ¡¶å¯¹åº”å‡ é¡µçš„spanï¼Œä¸ºäº†æ–¹ä¾¿æ•´ä¸ªpage cacheç±»è®¾è®¡ä¸º129ä¸ªæ¡¶ï¼Œç©ºå‡ºæ¥0å·æ¡¶</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// page cacheæ¡¶çš„ä¸ªæ•° - è¿™é‡Œè®¾ç½®ä¸º129ä¸ªï¼Œ0å·æ¡¶ä¸ç”¨</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">size_t</span> NPAGES = <span class="number">129</span>;</span><br></pre></td></tr></table></figure><blockquote><p>page cahceç±»åœ¨æ•´ä¸ªè¿›ç¨‹é‡Œåªæœ‰ä¸€ä¸ªï¼Œæˆ‘ä»¬åŒæ ·è®¾è®¡æˆå•ä¾‹æ¨¡å¼ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¤šä¸ªçº¿ç¨‹ç”³è¯·å¯¹è±¡ï¼Œthread cacheå±‚æ²¡æœ‰å†…å­˜éœ€è¦å‘central cacheç”³è¯·ï¼Œcentral cacheåªéœ€è¦åŠ æ¡¶é”å°±å¯ä»¥ï¼Œä½†æ˜¯page cacheæœ€å¥½æ•´ä¸ªåŠ é”ï¼Œå› ä¸ºpage cacheå¯èƒ½æ¶‰åŠåˆ°å¤šé¡µçš„spanåˆ‡åˆ†çš„é—®é¢˜ï¼Œå¹¶ä¸”å½“central cacheå½’è¿˜spanï¼Œpage cacheä¹Ÿä¼šå°è¯•å°†è¯¥spanå’Œå…¶ä»–æ¡¶çš„spanè¿›è¡Œåˆå¹¶ï¼Œè¿™æ ·å°±ä¼šè®¿é—®page cacheçš„å¤šä¸ªæ¡¶ï¼Œé€ æˆé¢‘ç¹çš„åŠ é”å’Œè§£é”ã€‚</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PageCache</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="comment">//æ•´ä¸ªè¿›ç¨‹åªæœ‰ä¸€ä»½ï¼ŒåŒæ ·è®¾è®¡æˆå•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="function"><span class="type">static</span> PageCache* <span class="title">GetInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> &amp;_sInst;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¦ä¸€ä¸ªké¡µçš„span</span></span><br><span class="line"><span class="function">Span* <span class="title">NewSpan</span><span class="params">(<span class="type">size_t</span> k)</span></span>;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">std::mutex _pageMtx;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="built_in">PageCache</span>() &#123;&#125;;</span><br><span class="line"><span class="built_in">PageCache</span>(<span class="type">const</span> PageCache&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">SpanList _spanLists[NPAGES];</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> PageCache _sInst;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>ç±»å†…æä¾›ä¸€ä¸ªè·å–ké¡µspançš„æ¥å£</p></blockquote><h2 id="å®ç°é€»è¾‘">å®ç°é€»è¾‘</h2><blockquote><p>æˆ‘ä»¬å…ˆç»§ç»­å®Œå–„centralå±‚çš„é€»è¾‘ï¼Œä¸ŠèŠ‚è¯´ä»ä¸­å¿ƒç¼“å­˜è·å–ä¸€å®šæ•°é‡çš„å¯¹è±¡ç»™thread cacheï¼Œç”¨äº†ä¸€ä¸ªFatchRangeObjçš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„å†…éƒ¨ï¼Œé¦–å…ˆè¦ä¿è¯CentralCacheå±‚æœ‰ä¸€ä¸ªéç©ºçš„spanï¼Œé‚£ä¹ˆå¦‚ä½•ä¿è¯æœ‰ä¸€ä¸ªéç©ºçš„spanå‘¢ï¼Ÿå¤§è‡´æ€è·¯æ˜¯å…ˆä»central cacheå¯¹åº”çš„æ¡¶é‡Œæ‰¾ï¼Œå¦‚æœæ²¡æœ‰å°±å¾€ä¸‹æ‰¾Page Cacheå±‚è¦ã€‚</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–ä¸€ä¸ªéç©ºçš„span</span></span><br><span class="line"><span class="function">Span* <span class="title">CentralCache::GetOneSpan</span><span class="params">(SpanList&amp; list, <span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>æˆ‘ä»¬ç»§ç»­å®Œå–„è¿™ä¸ªå‡½æ•°</code></pre><blockquote><p>æ­¥éª¤1ã€å…ˆå»size å¯¹åº”çš„æ¡¶é‡Œæ‰¾éç©ºçš„spanï¼Œè¿™é‡Œæ¶‰åŠåˆ°é“¾è¡¨çš„éå†æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥å®Œå–„ä¸€ä¸‹SpanListç±»ï¼Œæä¾›ç›¸åº”çš„æ¥å£æ–¹ä¾¿æˆ‘ä»¬æ“ä½œ</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨spanlistç±»ä¸­å¢åŠ ä¸€ä¸‹å‡½æ•°ï¼Œæ–¹ä¾¿éå†æ“ä½œ</span></span><br><span class="line"><span class="function">Span* <span class="title">Begin</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> _head-&gt;_next;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Span* <span class="title">End</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> _head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Empty</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> _head == _head-&gt;_next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ­¥éª¤2ã€è‹¥æœ‰éç©ºçš„spanç›´æ¥è¿”å›ï¼Œå¦‚æœæ²¡æœ‰ï¼Œéœ€è¦å‘ä¸‹ä¸€å±‚çš„PageCacheç”³è¯·æ–°çš„ä¸€é¡µSpanï¼Œè¿™é‡Œæˆ‘ä»¬æ¶‰åŠåˆ°åŠ é”ã€è§£é”è¿‡ç¨‹ï¼Œä»¥åŠå¦‚æœå‘ä¸‹ä¸€å±‚ç”³è¯·SPanå…·ä½“æ˜¯è¦å¤šä¸ªå°‘é¡µå‘¢ï¼Ÿ</p></blockquote><pre><code>æˆ‘ä»¬å¯ä»¥å…ˆè§£å†³è¦å¤šå°‘é¡µçš„é—®é¢˜ï¼Œåœ¨SizeClassç±»ä¸­å¢åŠ NumMovePageå‡½æ•°</code></pre><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¡ç®—ä¸€æ¬¡å‘ç³»ç»Ÿè·å–å¤šå°‘ä¸ªé¡µ</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">size_t</span> <span class="title">NumMovePage</span><span class="params">(<span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// å…ˆè·å–ç”³è¯·sizeå¯¹è±¡å¤§å°çš„ä¸Šé™(å°½å¯èƒ½å¤šè¦ä¸€äº›)</span></span><br><span class="line"><span class="type">size_t</span> num = <span class="built_in">NumMoveSize</span>(size);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç®—ä¸€ä¸‹numä¸ªå¯¹è±¡æ€»å…±å¤šå°‘å­—èŠ‚ï¼Œç„¶åå³ç§»13ä½å°±æ˜¯å¤šå°‘é¡µ</span></span><br><span class="line"><span class="type">size_t</span> npage = (num * size) &gt;&gt; PAGE_SHITF;</span><br><span class="line"><span class="comment">// æœ€å°‘ç”³è¯·1é¡µ</span></span><br><span class="line"><span class="keyword">if</span> (npage == <span class="number">0</span>)</span><br><span class="line">npage = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">return</span> npage;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ­¥éª¤3ã€ç”³è¯·å®Œspanåï¼Œå°±è¦å°†é‡Œé¢çš„å¤§å—å†…å­˜è¿›è¡Œåˆ‡åˆ†ï¼Œæˆ‘ä»¬éœ€è¦ç›´åˆ°å¤§å—å†…å­˜çš„èµ·å§‹åœ°å€å’Œç»“æŸåœ°å€ï¼Œä¸æ–­çš„åˆ‡æˆsizeå¤§å°è¿›è¡Œå°¾æ’ï¼Œè¿™é‡Œå°¾æ’æœ‰ä¸ªå¥½å¤„ï¼Œå®ƒçš„ç‰©ç†åœ°å€æ˜¯è¿ç»­çš„ï¼Œå½“è¢«çº¿ç¨‹ä½¿ç”¨æ—¶ï¼Œå¯ä»¥æé«˜çº¿ç¨‹çš„CPUç¼“å­˜åˆ©ç”¨ç‡</p></blockquote><blockquote><p>GetOneSpanæ•´ä½“ä»£ç </p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–ä¸€ä¸ªéç©ºçš„span</span></span><br><span class="line"><span class="function">Span* <span class="title">CentralCache::GetOneSpan</span><span class="params">(SpanList&amp; list, <span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// 1ã€å…ˆå»size å¯¹åº”çš„æ¡¶é‡Œæ‰¾éç©ºçš„span</span></span><br><span class="line">Span* it = list.<span class="built_in">Begin</span>();</span><br><span class="line"><span class="keyword">while</span> (it != list.<span class="built_in">End</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (it-&gt;_freeList != <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> it;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">it = it-&gt;_next;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™é‡Œå¯ä»¥å…ˆå°†è¿™ä¸ªæ¡¶çš„æ¡¶é”è¿›è¡Œè§£é”ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥é‡Šæ”¾å†…å­˜å¯¹è±¡å›æ¥ä¸ä¼šé˜»å¡</span></span><br><span class="line">list._mtx.<span class="built_in">unlock</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ°è¿™é‡Œè¯´æ˜ï¼Œsizeå¯¹åº”çš„CentralCacheå±‚é‡Œé¢æ²¡æœ‰Spanå¯¹è±¡ï¼Œé‚£ä¹ˆéœ€è¦å‘ä¸‹ä¸€å±‚ç”³è¯·</span></span><br><span class="line"><span class="comment">// å…ˆè¿›è¡Œæ•´ä¸ªpage cacheå±‚çš„åŠ é”</span></span><br><span class="line">PageCache::<span class="built_in">GetInstance</span>()-&gt;_pageMtx.<span class="built_in">lock</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ‘ä»¬è¦è®¡ç®—å‘page cacheå±‚è¦å¤šå°‘é¡µçš„span</span></span><br><span class="line">Span* span = PageCache::<span class="built_in">GetInstance</span>()-&gt;<span class="built_in">NewSpan</span>(SizeClass::<span class="built_in">NumMovePage</span>(size));</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£é”</span></span><br><span class="line">PageCache::<span class="built_in">GetInstance</span>()-&gt;_pageMtx.<span class="built_in">unlock</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”³è¯·å›æ¥çš„spanå¯¹è±¡è¿›è¡Œåˆ‡åˆ†ï¼Œè¿™ä¼šä¸éœ€è¦åŠ é”ï¼Œå› ä¸ºè¿™ä¼šå…¶ä»–çº¿ç¨‹è®¿é—®ä¸åˆ°è¿™ä¸ªspanï¼ˆè¿˜æ²¡æŒ‚åˆ°spanListsï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¦è®¡ç®—spançš„å¤§å—å†…å­˜çš„èµ·å§‹åœ°å€å’Œå¤§å—å†…å­˜çš„å¤§å°</span></span><br><span class="line"><span class="comment">// é¡µå·å·¦ç§»PAGE_SHIFTå°±æ˜¯åœ°å€</span></span><br><span class="line"><span class="type">char</span>* start = (<span class="type">char</span>*)(span-&gt;_pageId &lt;&lt; PAGE_SHITF);</span><br><span class="line"></span><br><span class="line"><span class="type">size_t</span> bytes = span-&gt;_n &lt;&lt; PAGE_SHITF;</span><br><span class="line"><span class="type">char</span>* end = start + bytes;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…ˆåˆ‡ä¸€å—åšå¤´</span></span><br><span class="line">span-&gt;_freeList = start;</span><br><span class="line">start += size;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿›è¡Œå°¾æ’</span></span><br><span class="line"><span class="type">void</span>* tail = span-&gt;_freeList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(start &lt;end)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">NextObj</span>(tail) = start;</span><br><span class="line">tail = <span class="built_in">NextObj</span>(tail);</span><br><span class="line">start += size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ‡å¥½spanï¼Œå°†spanæŒ‚åˆ°æ¡¶é‡Œï¼ŒåŠ é”</span></span><br><span class="line">list._mtx.<span class="built_in">lock</span>();</span><br><span class="line">list.<span class="built_in">PushFront</span>(span);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> span;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å®Œæˆä¸Šè¾¹çš„ä»£ç åæˆ‘ä»¬çœ‹çœ‹åº•å±‚çš„PageCache::NewSpan(size_t k) ï¼Œæˆ‘ä»¬è¿™ä¸ªè·å–ä¸€ä¸ªNewSpançš„å¤§è‡´é€»è¾‘ä¸ºï¼šé¦–å…ˆæ£€æŸ¥ç¬¬kä¸ªæ¡¶é‡Œæœ‰æ²¡æœ‰spanï¼Œå¦‚æœæ²¡æœ‰ï¼Œå‘åè¾¹çš„æ¡¶æ‰¾æ›´å¤§çš„Spanï¼Œç„¶ååˆ†æˆkå’Œn-kï¼Œè¿”å›ké¡µçš„Spanï¼Œn-ké¡µçš„SpanæŒ‚åˆ°ç›¸åº”çš„æ¡¶é‡Œ</p></blockquote><hr><blockquote><p>æ­¥éª¤1ã€åˆ¤æ–­kä¸ªæ¡¶æœ‰æ²¡æœ‰spanå¦‚æœæœ‰ï¼Œè¿”å›å¤´ä¸Šé‚£ä¸ªï¼Œè¿™æ—¶å€™éœ€è¦åœ¨åœ¨SpanListç±»é‡Œé¢æä¾›ä¸€ä¸ªPopFrontå‡½æ•°ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿæä¾›ä¸€ä¸ªPushFrontçš„å‡½æ•°ï¼Œæ–¹ä¾¿ä¹‹åçš„æ“ä½œ</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¤´åˆ è¿”å›</span></span><br><span class="line"><span class="function">Span* <span class="title">PopFront</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Span* sp = _head-&gt;_next;</span><br><span class="line"><span class="comment">/*head-&gt;_next = sp-&gt;_next;</span></span><br><span class="line"><span class="comment">sp-&gt;_next = nullptr;</span></span><br><span class="line"><span class="comment">return sp;*/</span></span><br><span class="line"><span class="built_in">Erase</span>(sp);</span><br><span class="line"><span class="keyword">return</span> sp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤´æ’</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PushFront</span><span class="params">(Span* span)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">Insert</span>(<span class="built_in">Begin</span>(), span);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ­¥éª¤2ã€å¦‚æœæ²¡æœ‰ï¼Œéå†åé¢çš„æ¡¶ï¼Œå¦‚æœæœ‰ï¼Œå°±åˆ‡æˆkå’Œn-kï¼Œè¿”å›ké¡µçš„spanï¼Œn-ké¡µçš„spanæ’å…¥åˆ°å¯¹åº”çš„æ¡¶</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302102055998.png" alt="image.png"></p><blockquote><p>æ­¥éª¤3ã€å¦‚æœä»k+1åˆ°NPAGES-1æ¡¶éƒ½æ²¡æœ‰spanï¼Œé‚£ä¹ˆåªèƒ½é€šè¿‡ç³»ç»Ÿè°ƒç”¨å‘å †ç”³è¯·ï¼Œè¿™é‡Œç›´æ¥ç”³è¯·128é¡µçš„spanï¼Œç”³è¯·æˆåŠŸåï¼Œè¿˜æ˜¯èµ°æ­¥éª¤2çš„é€»è¾‘ï¼Œå¯ä»¥ç›´æ¥é€’å½’å¤„ç†</p></blockquote><blockquote><p>æ•´ä½“ä»£ç </p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// page cache è¿”å›ä¸€ä¸ªspan</span></span><br><span class="line"><span class="function">Span* <span class="title">PageCache::NewSpan</span><span class="params">(<span class="type">size_t</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// å…ˆæ–­è¨€ä¸€ä¸‹</span></span><br><span class="line"><span class="built_in">assert</span>(k &gt; <span class="number">0</span> &amp;&amp; k &lt; NPAGES);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…ˆæ£€æŸ¥ç¬¬kä¸ªæ¡¶é‡Œæœ‰æ²¡æœ‰Span</span></span><br><span class="line"><span class="keyword">if</span> (!_spanLists[k].<span class="built_in">Empty</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// å¤´åˆ ç¬¬ä¸€ä¸ªè¿”å›è¿™é‡Œå»å®ç°PopFrontçš„é€»è¾‘</span></span><br><span class="line"><span class="keyword">return</span> _spanLists[k].<span class="built_in">PopFront</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¦‚æœkå·æ¡¶ä¸ºç©ºï¼Œæ£€æŸ¥åé¢çš„æ¡¶ï¼Œæ‰¾åˆ°ä¸€ä¸ªéç©ºæ¡¶ï¼Œç›´åˆ°æœ€åä¸€ä¸ªæ¡¶</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> i = k + <span class="number">1</span>; i &lt; NPAGES; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (!_spanLists[i].<span class="built_in">Empty</span>())</span><br><span class="line">&#123;</span><br><span class="line">Span* nSpan = _spanLists[i].<span class="built_in">PopFront</span>();</span><br><span class="line"><span class="comment">// ï¼Ÿ</span></span><br><span class="line">Span* kSpan = <span class="keyword">new</span> Span;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ†æˆnpan åˆ†ä¸€ä¸ª ké¡µè¿”å›ï¼Œç„¶ån-ké¡µçš„spanæŒ‚åˆ°n-kçš„æ¡¶ä¸Š</span></span><br><span class="line"><span class="comment">// è¿™é‡Œæ³¨æ„ï¼Œåªéœ€è¦æ”¹é¡µå·å’Œé¡µæ•°å°±å¯ä»¥äº†ï¼ŒspanæŒ‚çš„å†…å­˜çš„åœ°å€æŒ‰é¡µå·å–</span></span><br><span class="line">kSpan-&gt;_pageId = nSpan-&gt;_pageId;</span><br><span class="line">kSpan-&gt;_n = k;</span><br><span class="line"></span><br><span class="line">nSpan-&gt;_n -= k;</span><br><span class="line">nSpan-&gt;_pageId += k;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_spanLists[nSpan-&gt;_n].<span class="built_in">PushFront</span>(nSpan);</span><br><span class="line"><span class="keyword">return</span> kSpan;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ°è¿™é‡Œè¯´æ˜åé¢çš„æ‰€æœ‰ä½ç½®éƒ½æ²¡æœ‰å¤§é¡µçš„span</span></span><br><span class="line"><span class="comment">// è¿™æ—¶å€™å°±éœ€è¦å‘å †ç”³è¯·ä¸€ä¸ª128é¡µçš„span</span></span><br><span class="line">Span* bigSpan = <span class="keyword">new</span> Span;</span><br><span class="line"><span class="type">void</span>* ptr = <span class="built_in">SystemAlloc</span>(NPAGES<span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bigSpan-&gt;_n = NPAGES - <span class="number">1</span>;</span><br><span class="line">bigSpan-&gt;_pageId = (PAGE_ID)ptr &gt;&gt; PAGE_SHITF;</span><br><span class="line"></span><br><span class="line">_spanLists[bigSpan-&gt;_n].<span class="built_in">PushFront</span>(bigSpan);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">NewSpan</span>(k);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œæ³¨æ„æœ€åå‡ å¥çš„é€»è¾‘ï¼Œæˆ‘ä»¬ç”³è¯·äº†128é¡µçš„å†…å­˜ï¼Œè¿”å›äº†èµ·å§‹çš„æŒ‡é’ˆptrï¼Œå°†è¿™ä¸ªåœ°å€è½¬æˆæ•´å½¢ï¼Œå³ç§»PAGE_SHIFTä½ï¼Œç›¸å½“äºé™¤ä»¥2^13ï¼Œå°±æ˜¯ç®¡ç†è¿™å—å¤§å—å†…å­˜çš„spançš„é¡µå·</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302102010347.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›® </category>
          
          <category> é«˜å¹¶å‘å†…å­˜æ±  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>5ã€é«˜å¹¶å‘å†…å­˜æ± -CentralCache</title>
      <link href="/posts/1806624746/"/>
      <url>/posts/1806624746/</url>
      
        <content type="html"><![CDATA[<h1>Central Cacheæ¡†æ¶è®¾è®¡</h1><blockquote><p>å½“ç”³è¯·å¯¹è±¡æ—¶ï¼Œthread cacheå±‚å¯¹åº”çš„è‡ªç”±é“¾è¡¨ä¸ºç©ºæ—¶ï¼Œéœ€è¦å‘central cacheå±‚ç”³è¯·å†…å­˜ã€‚central cacheå±‚æ¡†æ¶å›¾å¦‚ä¸‹ï¼š</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302081948813.png" alt="9d6481a02fe24f458b37909674fc3d66.png"></p><p>central cacheæ•´ä½“ä¹Ÿæ˜¯ä¸€ä¸ªå“ˆå¸Œæ¡¶ç»“æ„ï¼Œç±»ä¼¼äºthread cacheå±‚ï¼Œä½†æ˜¯central cacheå±‚æ‰€æŒ‚çš„æ˜¯spançš„é“¾è¡¨</p><ul><li>spanæ˜¯ç®¡ç†å¤§å—å†…å­˜çš„æ•°æ®ç»“æ„ï¼Œé¡µä¸ºå•ä½</li><li>spané‡Œé¢æœ‰ä¸ªè‡ªç”±é“¾è¡¨ï¼Œç®¡ç†åˆ‡å‰²å‡ºæ¥çš„å°å†…å­˜å—</li><li>æ˜ å°„å…³ç³»å’Œå¯¹é½è§„åˆ™åŒthread cache</li></ul><h1>Central Cacheå…·ä½“ç»“æ„</h1><h2 id="spanç»“æ„">spanç»“æ„</h2><blockquote><p>spanæ˜¯ç®¡ç†å¤šä¸ªè¿ç»­é¡µå¤§å—å†…å­˜çš„è·¨åº¦ç»“æ„ï¼Œå…·ä½“ç»“æ„ä»£ç å¦‚ä¸‹ï¼›</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Span</span></span><br><span class="line">&#123;</span><br><span class="line">PAGE_ID _pageId = <span class="number">0</span>; <span class="comment">//å¤§å—å†…å­˜èµ·å§‹é¡µçš„é¡µå·</span></span><br><span class="line"><span class="type">size_t</span> _n = <span class="number">0</span>; <span class="comment">//é¡µçš„æ•°é‡</span></span><br><span class="line"></span><br><span class="line">Span* _next = <span class="literal">nullptr</span>; <span class="comment">//åŒå‘é“¾è¡¨çš„ç»“æ„</span></span><br><span class="line">Span* _prev = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">size_t</span> _useCount = <span class="number">0</span>; <span class="comment">//åˆ‡å¥½çš„å°å—å†…å­˜ï¼Œè¢«åˆ†é…ç»™thread cacheçš„è®¡æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span>* _freeList =<span class="literal">nullptr</span>; <span class="comment">//åˆ‡å¥½å°å—å†…å­˜çš„è‡ªç”±é“¾è¡¨</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é¦–å…ˆéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œspanæ˜¯åŒå‘é“¾è¡¨çš„ç»“æ„ï¼ŒåŒå‘é“¾è¡¨åˆ é™¤å…ƒç´ éå¸¸æ–¹ä¾¿ï¼Œå½“å°†æŸä¸ªspanå¯¹è±¡å½’è¿˜ç»™page cacheå±‚æ—¶ï¼ŒåŒå‘é“¾è¡¨åˆ é™¤éå¸¸ç®€å•</p><blockquote><p>spanæ˜¯ç®¡ç†ä»¥é¡µä¸ºå•ä½çš„å¤§å—å†…å­˜ï¼Œå½“å½’è¿˜ç»™page cacheå±‚æ—¶ï¼Œä¸ºäº†æ–¹ä¾¿ç›¸é‚»é¡µçš„åˆå¹¶éœ€è¦ä¸€ä¸ªé¡µå· pageIDï¼Œæˆ‘ä»¬ç”¨äº†typedefçš„ç±»å‹PAGE_ID</p></blockquote><pre><code>å‡è®¾ä¸€é¡µä¸º8k32ä½ä¸‹ è¿›ç¨‹åœ°å€ç©ºé—´æœ‰4Gï¼Œèƒ½åˆ† 2^32/2^13 = 2^19 ä¸ªé¡µ64ä½ä¸‹ è¿›ç¨‹åœ°å€ç©ºé—´æœ‰16Gï¼Œèƒ½åˆ† 2^64/2^13 = 2^51 ä¸ªé¡µ</code></pre><p>æ‰€ä»¥ä¸åŒå¹³å°ä¸‹ï¼ŒPAGE_ID çš„ç±»å‹éœ€è¦åŠ¨æ€è°ƒæ•´ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨æ¡ä»¶ç¼–è¯‘å®ç°</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//x64  _WIN32å’Œ_WIN64éƒ½æœ‰å®šä¹‰</span></span><br><span class="line"><span class="comment">//win32 _WIN32æœ‰å®šä¹‰ï¼Œ_WIN64æ²¡æœ‰å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _WIN64</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> PAGE_ID;</span><br><span class="line"><span class="meta">#<span class="keyword">elif</span> _WIN32</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">size_t</span> PAGE_ID;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// _WIN64</span></span></span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œæ³¨æ„å…ˆåˆ¤æ–­ _WIN64</p></blockquote><h2 id="SpanListç»“æ„">SpanListç»“æ„</h2><blockquote><p>æˆ‘ä»¬çŸ¥é“central cacheå±‚æ¯ä¸ªå“ˆå¸Œæ¡¶ä¸­æŒ‚çš„æ˜¯spançš„é“¾è¡¨ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªé“¾è¡¨ç»“æ„å®šä¹‰æˆå¸¦å¤´åŒå‘çš„å¾ªç¯é“¾è¡¨</p></blockquote><p>æˆ‘ä»¬ç›®å‰çš„æ ¸å¿ƒæˆå‘˜æœ‰ä¸¤ä¸ª</p><ul><li>Span*</li><li>mutexé”ï¼ˆæ¡¶é”ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶ç”³è¯·ä¸€ä¸ªæ¡¶çš„å¯¹è±¡æ—¶éœ€è¦åŠ é”ï¼‰</li></ul><p>æä¾›ï¼Œæ’å…¥å’Œåˆ é™¤å’Œåˆ é™¤çš„æ¥å£</p><ul><li><code>void Insert(Span* pos, Span* newSpan)</code></li><li><code>void Eerase(Span *pos)</code></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SpanList</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">SpanList</span>()</span><br><span class="line">&#123;</span><br><span class="line">_head = <span class="keyword">new</span> Span;</span><br><span class="line">_head-&gt;_next = _head;</span><br><span class="line">_head-&gt;_prev = _head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Insert</span><span class="params">(Span* pos, Span* newSpan)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// å…ˆæ–­è¨€ä¸€ä¸‹æœ‰æ²¡æœ‰é—®é¢˜</span></span><br><span class="line"><span class="built_in">assert</span>(pos);</span><br><span class="line"><span class="built_in">assert</span>(newSpan);</span><br><span class="line"></span><br><span class="line">Span* prev = pos-&gt;_prev;</span><br><span class="line">newSpan-&gt;_next = pos;</span><br><span class="line">pos-&gt;_prev = newSpan;</span><br><span class="line"></span><br><span class="line">prev-&gt;_next = newSpan;</span><br><span class="line">newSpan-&gt;_prev = prev;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Eerase</span><span class="params">(Span *pos)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">assert</span>(pos);</span><br><span class="line"><span class="built_in">assert</span>(pos != _head);</span><br><span class="line"></span><br><span class="line">Span* prev = pos-&gt;_prev;</span><br><span class="line">Span* next = pos-&gt;_next;</span><br><span class="line"></span><br><span class="line">next-&gt;_prev = prev;</span><br><span class="line">prev-&gt;_next = next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">Span* _head;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">std::mutex _mtx; <span class="comment">//æ¡¶é”</span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼Œeraseæ—¶ï¼Œä¸éœ€è¦deleteï¼Œåªéœ€è¦ä»é“¾è¡¨ç§»é™¤å³å¯ï¼Œä¼šå½’è¿˜ç»™ä¸‹ä¸€å±‚çš„page cache</p></blockquote><h2 id="Central-Cacheç»“æ„">Central Cacheç»“æ„</h2><blockquote><p>é¦–å…ˆCentral Cacheæ˜¯å“ˆå¸Œæ¡¶ç»“æ„ï¼Œç„¶åæˆ‘ä»¬æœŸæœ›ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰å±äºè‡ªå·±çš„Thread Cacheï¼ˆç”¨TLSå®ç°æ— é”ï¼‰ï¼Œä½†æ˜¯Central Cacheåœ¨æ•´ä¸ªè¿›ç¨‹ä¸­åªæœ‰ä¸€ä¸ªï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è®¾è®¡æˆå•ä¾‹æ¨¡å¼</p></blockquote><pre><code>å•ä¾‹æ¨¡å¼é‡‡ç”¨é¥¿æ±‰æ¨¡å¼ï¼Œæ„é€ å‡½æ•°ç§æœ‰ï¼Œåœ¨é™æ€åŒºåˆ›å»ºä¸€ä¸ªå¯¹è±¡</code></pre><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CentralCache</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">static</span> CentralCache* <span class="title">GetInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> &amp;_sInst;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ¥å£ï¼Ÿï¼Ÿï¼Ÿ</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="type">static</span> CentralCache _sInst;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="built_in">CentralCache</span>()&#123;&#125; <span class="comment">//æ„é€ å‡½æ•°ç§æœ‰åŒ–</span></span><br><span class="line"><span class="built_in">CentralCache</span>(<span class="type">const</span> CentralCache&amp; c) = <span class="keyword">delete</span>; <span class="comment">//ç¦ç”¨æ‹·è´</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">SpanList _spanLists[NFREELIST]; <span class="comment">// SpanListæ•°ç»„ï¼ˆå“ˆå¸Œæ¡¶ï¼‰</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1>Central Cacheé€»è¾‘å®ç°</h1><blockquote><p>thread cacheå±‚ï¼Œç”³è¯·å¯¹è±¡ï¼Œå¯¹åº”è‡ªç”±é“¾è¡¨ä¸ºç©ºæ—¶ï¼Œéœ€è¦å‘central cacheå±‚ç”³è¯·å†…å­˜ï¼Œæˆ‘ä»¬åœ¨thread cacheéƒ¨åˆ†æä¾›äº†ä¸€ä¸ªæ¥å£FetchFromCentralCacheï¼Œæˆ‘ä»¬å…ˆä»è¿™é‡Œå¼€å§‹ï¼Œé€æ­¥æ‰©å±•åˆ°æ•´ä½“çš„central cacheçš„é€»è¾‘å®ç°</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä»ä¸­å¿ƒç¼“å­˜è·å–å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">ThreadCache::FetchFromCentralCache</span><span class="params">(<span class="type">size_t</span> index, <span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>thread cacheå‘centralç”³è¯·å†…å­˜æ—¶ï¼Œæœ€å¥½å¤šç»™ä¸€äº›ï¼Œé¿å…é¢‘ç¹ç”³è¯·ï¼Œé‚£ä¹ˆè¯¥ç»™å¤šå°‘æ¯”è¾ƒåˆé€‚å‘¢ï¼Ÿè¿™é‡Œæå‡ºä¸€ä¸ªæ…¢å¼€å§‹åé¦ˆç®—æ³•ï¼Œæˆ‘ä»¬æ ¸å¿ƒæƒ³æ³•å¦‚ä¸‹ï¼š</p></blockquote><ol><li>æœ€å¼€å§‹ä¸ä¼šä¸€æ¬¡å‘central cacheä¸€æ¬¡æ‰¹é‡çš„è¦å¤ªå¤šï¼Œè¦å¤ªå¤šå¯èƒ½ä¼šç”¨ä¸å®Œ</li><li>å¦‚æœä¸æ–­æœ‰è¦sizeå¤§å°å†…å­˜çš„çš„éœ€æ±‚ï¼ŒbatchNumä¹Ÿä¼šä¸æ–­çš„å¢é•¿ç›´åˆ°ä¸Šé™</li><li>sizeè¶Šå¤§ï¼Œä¸€æ¬¡å‘central cacheè¦çš„batchNumè¶Šå°</li><li>sizeè¶Šå°ï¼Œä¸€æ¬¡å‘central cacheè¦çš„batchNumè¶Šå¤§ã€‚</li></ol><blockquote><p>æ ¹æ®ä¸Šè¿°è§„åˆ™ï¼Œæˆ‘ä»¬åœ¨SizeClassç±»å¢åŠ ä¸‹è¿°å‡½æ•°</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸€æ¬¡thread cacheä»ä¸­å¿ƒèŠ‚ç‚¹è·å–å¤šå°‘ä¸ª</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">size_t</span> <span class="title">NumMoveSize</span><span class="params">(<span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">assert</span>(size &gt; <span class="number">0</span>);</span><br><span class="line"><span class="type">size_t</span> num = MAX_BYTES / size;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸€æ¬¡æ‰¹é‡ç§»åŠ¨å¤šå°‘ä¸ªå¯¹è±¡çš„(æ…¢å¯åŠ¨)ä¸Šé™å€¼ä¸º[2,512]</span></span><br><span class="line"><span class="comment">// å°å¯¹è±¡ä¸€æ¬¡æ‰¹é‡ä¸Šé™é«˜</span></span><br><span class="line"><span class="comment">// å¤§å¯¹è±¡ä¸€æ¬¡æ‰¹é‡ä¸Šé™ä½</span></span><br><span class="line"><span class="keyword">if</span> (num &lt; <span class="number">2</span>)</span><br><span class="line">num = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">if</span> (num &gt; <span class="number">512</span>)</span><br><span class="line">num = <span class="number">512</span>;</span><br><span class="line"><span class="keyword">return</span> num;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æˆ‘ä»¬å°±å¯ä»¥åœ¨FetchFromCentralCacheå‡½æ•°ä¸­è°ƒç”¨ä¸Šé¢å‡½æ•°è·å–åº”è¯¥ç»™central cacheæ‰¹é‡å±‚è¦å¤šå°‘ä¸ªå¯¹è±¡çš„ä¸ªæ•°</p></blockquote> <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">size_t</span> batchNum = SizeClass::<span class="built_in">NumMoveSize</span>(size);</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è‹¥sizeæ¯”è¾ƒå°ï¼ŒbatchNumåˆšå¼€å§‹çš„æ—¶å€™è¿˜æ˜¯æ¯”è¾ƒå¤§ï¼Œæ€ä¹ˆè®©å°å¯¹è±¡å®ƒå¼€å§‹çš„æ—¶å€™ä¹Ÿæ²¡é‚£ä¹ˆå¤§ï¼Œæ»¡è¶³è§„åˆ™2å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥è¿™æ ·å¤„ç†ï¼Œåœ¨FreeListç»“æ„ä¸­ï¼Œå¢åŠ ä¸€ä¸ªæˆå‘˜ _ maxSizeï¼Œå¹¶åˆå§‹åŒ–ä¸º1ï¼Œè¿™æ ·thread cacheå±‚æ¯ä¸€ä¸ªæ¡¶çš„è‡ªç”±é“¾è¡¨éƒ½æœ‰å®ƒçš„maxSizeã€‚å¹¶å¯ä»¥å†™ä¸‹è¾¹çš„é€»è¾‘ã€‚</p><pre><code>å½“batchNumå’Œå½“å‰æ‰€åœ¨è‡ªç”±é“¾è¡¨çš„MaxSizeç›¸åŒæ—¶ï¼Œè¯´æ˜ä¸Šè¾¹MaxSizeæ˜¯è¾ƒå°çš„é‚£ä¸ªï¼Œæˆ‘ä»¬è®©MaxSizeåŠ 1ï¼Œè‹¥ä¸æ–­ç”³è¯·sizeå¤§å°çš„å¯¹è±¡ï¼ŒMaxSizeå°±ä¼šä¸æ–­å¢å¤§ï¼Œè€Œã€2ï¼Œ512ã€‘å°±å¯ä»¥åšè¿™ä¸ªå¢åŠ çš„ä¸Šé™</code></pre><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">size_t</span> batchNum = std::<span class="built_in">min</span>(SizeClass::<span class="built_in">NumMoveSize</span>(size),_freeLists[index].<span class="built_in">MaxSize</span>());</span><br><span class="line"><span class="keyword">if</span> (_freeLists[index].<span class="built_in">MaxSize</span>() == batchNum)</span><br><span class="line">&#123;</span><br><span class="line">_freeLists[index].<span class="built_in">MaxSize</span>() += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>çŸ¥é“è¦å¤šå°‘ä¸ªå¯¹è±¡åå°±å‘central cacheå±‚è¦batchNumä¸ªå¯¹è±¡ï¼Œä½†æ˜¯è¿™é‡Œå°±ä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œcentral cacheå±‚å¯èƒ½ä¸å¤ŸbatchNumä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬çœ‹ä¸‹è¾¹å¤„ç†</p></blockquote><pre><code>é¦–å…ˆæ˜¯ç»™CentralCacheç±»æä¾›ä¸¤ä¸ªæ¥å£ã€‚ä¸€ä¸ªæ˜¯è·å–éç©ºçš„Spanï¼Œå¦ä¸€ä¸ªå°±æ˜¯è·å–batchNumä¸ªå¯¹è±¡</code></pre><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»ä¸­å¿ƒç¼“å­˜è·å–ä¸€å®šæ•°é‡çš„å¯¹è±¡ç»™thread cache</span></span><br><span class="line"><span class="function"><span class="type">size_t</span> <span class="title">CentralCache::FetchRangeObj</span><span class="params">(<span class="type">void</span>*&amp; start, <span class="type">void</span>*&amp; end, <span class="type">size_t</span> batchNum, <span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// å…ˆç®—sizeå¤§å°çš„å¯¹è±¡ï¼Œå¯¹åº”å“ªä¸ªæ¡¶ï¼Œç„¶åå°±å»å“ªä¸ªæ¡¶å»ç”³è¯·</span></span><br><span class="line"><span class="type">size_t</span> index = SizeClass::<span class="built_in">Index</span>(size);</span><br><span class="line"><span class="comment">// ç”³è¯·-åŠ æ¡¶é”</span></span><br><span class="line">_spanLists[index]._mtx.<span class="built_in">lock</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¦–å…ˆä¿è¯æœ‰ä¸€ä¸ªéç©ºçš„Span</span></span><br><span class="line">Span* span = <span class="built_in">GetOneSpan</span>(_spanLists[index], size);</span><br><span class="line"><span class="built_in">assert</span>(span);</span><br><span class="line"><span class="built_in">assert</span>(span-&gt;_freeList);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»spanä¸­è·å–batchNumä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="comment">// å¦‚æœä¸å¤ŸbatchNumï¼Œæœ‰å‡ ä¸ªæ‹¿å‡ ä¸ªï¼Œè¿”å›å®é™…æ‹¿åˆ°çš„ä¸ªæ•°</span></span><br><span class="line"></span><br><span class="line">start = span-&gt;_freeList;</span><br><span class="line">end = start;</span><br><span class="line"><span class="type">int</span> actualNum = <span class="number">1</span>;</span><br><span class="line"><span class="type">size_t</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (i&lt;batchNum &amp;&amp; <span class="built_in">NextObj</span>(end) != <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">end = <span class="built_in">NextObj</span>(end);</span><br><span class="line">++i;</span><br><span class="line">++actualNum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‹¿èµ° actualNumä¸ªå¯¹è±¡</span></span><br><span class="line">span-&gt;_freeList = <span class="built_in">NextObj</span>(end);</span><br><span class="line"><span class="built_in">NextObj</span>(end) = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£é”</span></span><br><span class="line">_spanLists[index]._mtx.<span class="built_in">unlock</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> actualNum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å®Œå–„å®Œæˆä¸Šè¿°å†…å®¹åï¼Œæˆ‘ä»¬å›åˆ°æœ€å¼€å§‹ï¼Œthread cacheå‘central cacheç”³è¯·å†…å­˜</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä»ä¸­å¿ƒç¼“å­˜è·å–å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">ThreadCache::FetchFromCentralCache</span><span class="params">(<span class="type">size_t</span> index, <span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// æ…¢å¼€å§‹åé¦ˆè°ƒèŠ‚ç®—æ³•</span></span><br><span class="line"><span class="comment">// å…ˆç®—è¦å¤šå°‘ä¸ªsizeå¤§å°çš„å¯¹è±¡</span></span><br><span class="line"><span class="type">size_t</span> batchNum = std::<span class="built_in">min</span>(SizeClass::<span class="built_in">NumMoveSize</span>(size),_freeLists[index].<span class="built_in">MaxSize</span>());</span><br><span class="line"><span class="keyword">if</span> (_freeLists[index].<span class="built_in">MaxSize</span>() == batchNum)</span><br><span class="line">&#123;</span><br><span class="line">_freeLists[index].<span class="built_in">MaxSize</span>() += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// çŸ¥é“è¦å¤šå°‘ä¸ªå¯¹è±¡åå°±å‘central cacheå±‚è¦batchNumä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="type">void</span>* start;</span><br><span class="line"><span class="type">void</span>* end;</span><br><span class="line"></span><br><span class="line"><span class="type">size_t</span> actualNum = CentralCache::<span class="built_in">GetInstance</span>()-&gt;<span class="built_in">FetchRangeObj</span>(start, end, batchNum, size);</span><br><span class="line"><span class="built_in">assert</span>(actualNum &gt;= <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (actualNum == <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//åªæœ‰ä¸€ä¸ª</span></span><br><span class="line"><span class="built_in">assert</span>(start == end);</span><br><span class="line"><span class="keyword">return</span> start;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// å°†NextObj(start)-end å¤´æ’è¿›è‡ªç”±é“¾è¡¨ï¼Œè¿”å›start</span></span><br><span class="line">_freeLists[index].<span class="built_in">PushRange</span>(<span class="built_in">NextObj</span>(start), end);</span><br><span class="line"><span class="keyword">return</span> start;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›® </category>
          
          <category> é«˜å¹¶å‘å†…å­˜æ±  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/1/"/>
      <url>/posts/1/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Damusä¸‹è½½</title>
      <link href="/posts/1935618777/"/>
      <url>/posts/1935618777/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Damusæ˜¯ä¸€æ¬¾å»ºç«‹åœ¨å»ä¸­å¿ƒåŒ–ç½‘ç»œNostrï¼ˆæ”¯æŒåŠ å¯†çš„ç«¯åˆ°ç«¯ç§äººæ¶ˆæ¯ä¼ é€’ç­‰åŠŸèƒ½ï¼‰ä¸Šçš„åº”ç”¨è½¯ä»¶ï¼Œå…¶ä¸­Nostrå¹¶ä¸æ˜¯åŸºäºæœåŠ¡å™¨æ¥è¿è¡Œç½‘ç»œï¼Œç›¸åï¼Œå®ƒæ˜¯åˆ©ç”¨å»ä¸­å¿ƒåŒ–ä¸­ç»§å™¨æ¥åˆ†å‘æ¶ˆæ¯ã€‚ä¸­ç»§å™¨ï¼ˆRelayï¼‰æ˜¯æ‰˜ç®¡çš„æœåŠ¡å™¨ï¼Œæ‰€æœ‰äººéƒ½å¯ä»¥è¿è¡Œä¸­ç»§å™¨ã€‚è·å¾—å…¶ä»–ç”¨æˆ·ï¼Œæ¯”å¦‚ä½ å¥½å‹çš„æ›´æ–°ï¼Œéœ€è¦ç ”ç©¶è¯¢é—®å¤šä¸ªä¸­ç»§ç«™æ˜¯å¦äº†è§£å…¶ä»–äººçš„æƒ…å†µï¼›è€Œä¸­ç»§ç«™æ‰€åšçš„ï¼Œå°±æ˜¯æ¥å—äººä»¬çš„å¸–å­å¹¶å°†å…¶è½¬å‘ç»™å…¶ä»–äººã€‚</p></blockquote><h2 id="ä¸‹è½½åœ°å€">ä¸‹è½½åœ°å€</h2><ul><li><p><a href="https://apps.apple.com/ca/app/damus/id1628663131">è‹¹æœä¸‹è½½é“¾æ¥Damus</a></p></li><li><p><a href="https://play.google.com/store/apps/details?id=com.vitorpamplona.amethyst&amp;hl=en%E2%80%A6">å®‰å“ä¸‹è½½é“¾æ¥Amethyst</a></p></li><li><p><a href="https://snort.social">ç½‘é¡µç‰ˆ</a></p></li></ul><blockquote><p>æ³¨æ„ä¸è¦æŠŠä½ çš„ç§é’¥å½“åšå…¬é’¥å‘å‡ºæ¥ã€‚</p></blockquote><h2 id="æ¢å¤´åƒæ–¹å¼ï¼š">æ¢å¤´åƒæ–¹å¼ï¼š</h2><ul><li>éœ€è¦å›¾åºŠå›¾ç‰‡é“¾æ¥</li><li>å›åˆ°Damusï¼Œedit profileï¼Œå¤´åƒçš„é“¾æ¥ç²˜è´´saveå³å¯</li></ul><h2 id="ä½¿ç”¨ä½“éªŒ">ä½¿ç”¨ä½“éªŒ</h2><p>å·²ç»ä½¿ç”¨äº†ä¸¤å¤©ï¼Œç™»å½•æ³¨å†Œä½“éªŒå¾ˆä¸é”™ï¼Œä¸éœ€è¦æä¾›ä»»ä½•çš„ä¸ªäººä¿¡æ¯ï¼Œï¼ˆæ‰‹æœºå·ã€é‚®ç®±ã€æ¨ç‰¹ã€Facebookâ€¦ï¼‰ï¼Œç›´æ¥æ³¨å†Œç»™ä½ å…¬é’¥å’Œç§é’¥ï¼Œä½†æ˜¯ä½¿ç”¨èµ·æ¥ä½“éªŒååˆ†çš„å·®åŠ²ï¼Œå¯èƒ½æ˜¯æ²¡æœ‰ç›‘ç®¡çš„åŸå› ï¼Œå„ç§å„æ ·çš„å¹¿å‘Šæ»¡å¤©é£ï¼Œæ²¡æœ‰ç›‘ç®¡çš„å»ä¸­å¿ƒåŒ–ç¤¾äº¤ä¸å¤§è¡Œæ„Ÿè§‰</p>]]></content>
      
      
      <categories>
          
          <category> web3.0 </category>
          
          <category> ç¤¾äº¤ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web3.0 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>4ã€é«˜å¹¶å‘å†…å­˜æ± -ThreadCache</title>
      <link href="/posts/1785806469/"/>
      <url>/posts/1785806469/</url>
      
        <content type="html"><![CDATA[<h1>æ¡†æ¶è®¾è®¡</h1><blockquote><p>thread cacheæ˜¯å“ˆå¸Œæ¡¶çš„ç»“æ„ï¼Œæ¯ä¸ªæ¡¶æ˜¯ä¸€ä¸ªæŒ‰æ¡¶ä½ç½®æ˜ å°„å¤§å°çš„å†…å­˜å—å¯¹è±¡çš„è‡ªç”±é“¾è¡¨ï¼Œæˆ‘ä»¬çŸ¥é“å®šé•¿å†…å­˜æ± åªæœ‰ä¸€ä¸ªè‡ªç”±é“¾è¡¨ï¼Œå› ä¸ºå®ƒæ¯ä¸ªå†…å­˜å—å¯¹è±¡å¤§å°ç›¸ç­‰ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™ä¸ªå†…å­˜æ± éœ€è¦æ”¯æŒä¸åŒå¤§å°çš„å†…å­˜å—ï¼Œæ‰€ä»¥éœ€è¦å¤šä¸ªè‡ªç”±é“¾è¡¨ã€‚</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302031953455.png" alt="thread_cache.png"></p><p>å…·ä½“æŠ½è±¡ç»“æ„å¤§è‡´å¦‚ä¸Šï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰ä¸€ä¸ªthread cacheå¯¹è±¡ï¼Œè¿™æ ·æ¯ä¸ªçº¿ç¨‹åœ¨è¿™é‡Œè·å–å¯¹è±¡å’Œé‡Šæ”¾å¯¹è±¡çš„æ—¶å€™æ˜¯æ— é”çš„ã€‚</p><h2 id="ç”³è¯·å†…å­˜">ç”³è¯·å†…å­˜</h2><ol><li>å½“å†…å­˜ç”³è¯·size&lt;=256kbæ—¶ï¼Œå…ˆè·å–çº¿ç¨‹æœ¬åœ°å­˜å‚¨çš„thread cacheå¯¹è±¡ï¼Œè®¡ç®—sizeæ˜ å°„çš„å“ˆå¸Œæ¡¶è‡ªç”±é“¾è¡¨çš„ä¸‹æ ‡i</li><li>å¦‚æœè‡ªç”±é“¾è¡¨çš„freeLists[i] ä¸­æœ‰å¯¹è±¡ï¼Œåˆ™ç›´æ¥Popä¸€ä¸ªå†…å­˜å¯¹è±¡è¿”å›</li><li>å¦‚æœfreeLists[i]ä¸­æ²¡æœ‰å¯¹è±¡ï¼Œåˆ™æ‰¹é‡ä»central cacheä¸­è·å–ä¸€å®šæ•°é‡çš„å¯¹è±¡ï¼Œæ’å…¥åˆ°è‡ªç”±é“¾è¡¨ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¯¹è±¡</li></ol><h2 id="é‡Šæ”¾å†…å­˜">é‡Šæ”¾å†…å­˜</h2><ol><li>å½“é‡Šæ”¾å†…å­˜å°äº256kbæ—¶å°†å†…å­˜é‡Šæ”¾å›thread cacheï¼Œè®¡ç®—sizeæ˜ å°„è‡ªç”±é“¾è¡¨æ¡¶ä½ç½®iï¼Œå°†å¯¹è±¡Pushåˆ°freeList[i]</li><li>å½“é“¾è¡¨çš„é•¿åº¦è¿‡é•¿ï¼Œåˆ™å›æ”¶ä¸€éƒ¨åˆ†å†…å­˜å¯¹è±¡åˆ°central cache</li></ol><h2 id="å†…å­˜ç¢ç‰‡">å†…å­˜ç¢ç‰‡</h2><blockquote><p>å¤–ç¢ç‰‡é—®é¢˜å‰è¾¹å·²ç»è®²è¿‡ï¼Œè¿™é‡Œåªè¯´ä¸€ä¸‹å†…ç¢ç‰‡çš„é—®é¢˜ï¼Œå¦‚æœæˆ‘ä»¬å°†æ¯ç§å­—èŠ‚æ•°éƒ½ç”¨ä¸€ä¸ªè‡ªç”±é“¾è¡¨ç®¡ç†ï¼Œé‚£ä¹ˆ256kbå°±æ˜¯256* 1024ä¸ªè‡ªç”±é“¾è¡¨ï¼Œè¿™æ ·è‡ªç”±é“¾è¡¨çš„æ•°é‡ä¼šå¤ªå¤šï¼Œè¿™äº›å¤´æŒ‡é’ˆå°±ä¼šå æ®å¤§é‡å†…å­˜ã€‚æ‰€ä»¥å¯ä»¥é‡‡å–ç±»ä¼¼ä¸Šè¾¹æŠ½è±¡å›¾ã€‚8å­—èŠ‚å¯¹é½ï¼Œ16å­—èŠ‚â€¦</p></blockquote><p>æˆ‘ä»¬æ‰€ç”¨å¯¹è±¡çš„å¤§å°å¯èƒ½å¹¶ä¸æ˜¯å‡†ç¡®çš„8ã€16â€¦ï¼Œæœ‰å¯èƒ½æ˜¯1å­—èŠ‚ï¼Œ14å­—èŠ‚ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶ç»™å¯¹åº”çš„8å­—èŠ‚16å­—èŠ‚ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰éƒ¨åˆ†å†…å­˜æµªè´¹ï¼Œä¹Ÿå°±æ˜¯å†…ç¢ç‰‡é—®é¢˜</p><h1>å…·ä½“å®ç°</h1><h2 id="å¯¹é½è§„åˆ™">å¯¹é½è§„åˆ™</h2><blockquote><p>æˆ‘ä»¬thread cacheï¼Œåº•å±‚æ˜¯å“ˆå¸Œæ¡¶ï¼Œæˆ‘ä»¬å¸Œæœ›æ¡¶çš„æ•°é‡ä¸é‚£ä¹ˆå¤šï¼ŒåŒæ—¶å†…ç¢ç‰‡çš„æµªè´¹ç»¼åˆèµ·æ¥ä¹Ÿä¸é‚£ä¹ˆå¤šã€‚ç»¼åˆè€ƒé‡ï¼Œä½¿ä¸åŒèŒƒå›´å†…çš„å­—èŠ‚æ•°æŒ‰ç…§ä¸åŒçš„å¯¹é½æ•°å¯¹é½ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p></blockquote><table><thead><tr><th style="text-align:center">å­—èŠ‚æ•°</th><th style="text-align:center">å¯¹é½æ•°</th><th style="text-align:center">å“ˆå¸Œæ¡¶ä¸‹æ ‡</th></tr></thead><tbody><tr><td style="text-align:center">1 ~ 128</td><td style="text-align:center">8å­—èŠ‚å¯¹é½</td><td style="text-align:center">0 - 15</td></tr><tr><td style="text-align:center">128+1 ~ 1024</td><td style="text-align:center">16å­—èŠ‚å¯¹é½</td><td style="text-align:center">16 - 71</td></tr><tr><td style="text-align:center">1024+1 ~ 8*1024</td><td style="text-align:center">128å­—èŠ‚å¯¹é½</td><td style="text-align:center">72 - 127</td></tr><tr><td style="text-align:center">8*1024+1 ~ 64*1024</td><td style="text-align:center">1024å­—èŠ‚å¯¹é½</td><td style="text-align:center">128 - 183</td></tr><tr><td style="text-align:center">64*1024+1 ~ 256*1024</td><td style="text-align:center">8*1024å­—èŠ‚å¯¹é½</td><td style="text-align:center">184 - 207</td></tr></tbody></table><p>ä¸¾å‡ ä¸ªä¾‹å­ï¼š</p><ul><li>1~128å­—èŠ‚ï¼Œéƒ½æŒ‰8å­—èŠ‚å¯¹é½ï¼Œä¹Ÿå°±æ˜¯1å­—èŠ‚çš„è¯ï¼Œä¼šç»™ä½ 8å­—èŠ‚ï¼Œæµªè´¹7ä¸ªå­—èŠ‚</li><li>129~1024å­—èŠ‚ï¼ŒæŒ‰16å­—èŠ‚å¯¹é½ï¼Œç”³è¯·129ä¼šç»™129+16-1=144å­—èŠ‚ï¼Œä¼šæµªè´¹15å­—èŠ‚ï¼Œæ¯”é‡ä¸ºï¼š15/144</li><li>1025~8*1024å­—èŠ‚ï¼ŒæŒ‰128å­—èŠ‚å¯¹é½ï¼Œç”³è¯·1025ä¼šç»™1025+128-1=1152å­—èŠ‚ï¼Œæµªè´¹127å­—èŠ‚ï¼Œæ¯”é‡ä¸ºï¼š127/1152</li><li>â€¦</li></ul><blockquote><p>1~128å­—èŠ‚åŒºé—´æœ€å¤šæµªè´¹7ä¸ªå­—èŠ‚ï¼Œåé¢èŒƒå›´æµªè´¹å­—èŠ‚çš„æ¯”é‡å¤§æ¦‚éƒ½åœ¨10%å·¦å³ã€‚</p></blockquote><h2 id="åŠŸèƒ½å®ç°">åŠŸèƒ½å®ç°</h2><h3 id="ThreadCacheç±»">ThreadCacheç±»</h3><blockquote><p>æˆ‘ä»¬å…ˆå®šä¹‰è¿™ä¸ªthreadcacheç±»ï¼ŒåŠŸèƒ½æœ‰ç”³è¯·å†…å­˜ã€é‡Šæ”¾å†…å­˜å’Œä»ä¸­å¿ƒç¼“å­˜è·å–å¯¹è±¡</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadCache</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="comment">// ç”³è¯·å†…å­˜</span></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">Allocate</span><span class="params">(<span class="type">size_t</span> size)</span></span>;</span><br><span class="line"><span class="comment">// é‡Šæ”¾å†…å­˜</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Deallocate</span><span class="params">(<span class="type">void</span>* obj, <span class="type">size_t</span> size)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»ä¸­å¿ƒç¼“å­˜è·å–å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">FetchFromCentralCache</span><span class="params">(<span class="type">size_t</span> index, <span class="type">size_t</span> size)</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="comment">// ç®¡ç†å„ç§å†…å­˜å¤§å°çš„è‡ªç”±é“¾è¡¨çš„å“ˆå¸Œæ¡¶</span></span><br><span class="line">FreeList _freeLists[NFREELIST];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="è‡ªç”±é“¾è¡¨ç±»">è‡ªç”±é“¾è¡¨ç±»</h3><blockquote><p>æˆ‘ä»¬çš„æ˜¯ç®¡ç†è‡ªç”±é“¾è¡¨çš„å“ˆå¸Œæ¡¶ï¼Œè‡ªç”±é“¾è¡¨æœ‰å¤šä¸ªï¼Œå®šä¹‰ä¸€ä¸ªç±»å®ç°ï¼ŒåŠŸèƒ½å’Œå®ç°æˆ‘ä»¬ä¹‹å‰çš„å®šé•¿å†…å­˜æ± ä¸€æ ·ï¼Œæˆå‘˜å°±æ˜¯ä¸€ä¸ªvoid*çš„æŒ‡é’ˆï¼Œæä¾›pushã€popå’Œemptyæ¥å£ã€‚</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span>*&amp; <span class="title">NextObj</span><span class="params">(<span class="type">void</span>* obj)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> *(<span class="type">void</span>**)obj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç®¡ç†åˆ‡åˆ†å¥½çš„å°å¯¹è±¡çš„è‡ªç”±é“¾è¡¨</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FreeList</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Push</span><span class="params">(<span class="type">void</span>* obj)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">assert</span>(obj);</span><br><span class="line"><span class="comment">//å¤´æ’</span></span><br><span class="line"><span class="built_in">NextObj</span>(obj) = _freeList;</span><br><span class="line">_freeList = obj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">Pop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">assert</span>(_freeList); </span><br><span class="line"><span class="comment">//å¤´åˆ </span></span><br><span class="line"><span class="type">void</span>* obj = _freeList;</span><br><span class="line">_freeList = <span class="built_in">NextObj</span>(_freeList);</span><br><span class="line"><span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Empty</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> _freeList == <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="type">void</span>* _freeList = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="ThreadCacheç±»å®ç°">ThreadCacheç±»å®ç°</h3><blockquote><p>ç„¶åå°±æ˜¯ ThreadCacheç±»ä¸­æˆå‘˜å‡½æ•°çš„å…·ä½“å®ç°ï¼Œä¹Ÿå°±æ˜¯å¦‚ä½•ç”³è¯·é‡Šæ”¾å†…å­˜</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”³è¯·å†…å­˜</span></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">ThreadCache::Allocate</span><span class="params">(<span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">assert</span>(size &lt;= MAX_BYTES); </span><br><span class="line"><span class="comment">// å…ˆç®—sizeä¸ªå­—èŠ‚æ˜ å°„åˆ°å“ªä¸ªæ¡¶ï¼Œä½†æ˜¯ä¸åŒçš„å­—èŠ‚èŒƒå›´ï¼Œæ˜ å°„çš„è§„åˆ™ä¸åŒï¼Œç”¨ä¸€ä¸ªç±»ç®¡ç†</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é‡Šæ”¾å†…å­˜</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ThreadCache::Deallocate</span><span class="params">(<span class="type">void</span>* obj, <span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»ä¸­å¿ƒç¼“å­˜è·å–å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">ThreadCache::FetchFromCentralCache</span><span class="params">(<span class="type">size_t</span> index, <span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å¯¹é½-è®¡ç®—ä¸‹æ ‡">å¯¹é½+è®¡ç®—ä¸‹æ ‡</h3><blockquote><p>ä½†æ˜¯å¼€å§‹æˆ‘ä»¬å°±ä¼šé¢ä¸´ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ç”³è¯·å†…å­˜ï¼Œé¦–å…ˆæ˜¯è¦çœ‹å“ˆå¸Œæ¡¶çš„è‡ªç”±é“¾è¡¨ï¼Œæˆ‘ä»¬å°±è¦çŸ¥é“ç”³è¯·çš„å­—èŠ‚æ•°å¯¹åº”å“ªä¸ªå“ˆå¸Œæ¡¶çš„è‡ªç”±é“¾è¡¨ï¼Œè¿™é‡Œæ¶‰åŠåˆ°å¯¹é½å’Œè®¡ç®—å“ˆå¸Œæ¡¶ä¸‹æ ‡ï¼Œæˆ‘ä»¬è¿˜æ˜¯ç”¨ä¸€ä¸ªç±»ç®¡ç†</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¡ç®—å¯¹è±¡å¤§å°çš„å¯¹é½æ˜ å°„è§„åˆ™</span></span><br><span class="line"><span class="comment">// 1ã€éœ€è¦å°†å¯¹åº”çš„å­—èŠ‚æ•°å…ˆå‘ä¸Šå–æ•´</span></span><br><span class="line"><span class="comment">// 2ã€å–æ•´åçš„å­—èŠ‚æ•°è½¬æ¢åˆ°å“ˆå¸Œä¸‹æ ‡</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SizeClass</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="comment">// æ•´ä½“æ§åˆ¶åœ¨æœ€å¤š10%å·¦å³çš„å†…ç¢ç‰‡æµªè´¹</span></span><br><span class="line"><span class="comment">// [1,128]8byteå¯¹é½    freelist[0,16)</span></span><br><span class="line"><span class="comment">// [128+1,1024]16byteå¯¹é½    freelist[16,72)</span></span><br><span class="line"><span class="comment">// [1024+1,8*1024]128byteå¯¹é½    freelist[72,128)</span></span><br><span class="line"><span class="comment">// [8*1024+1,64*1024]1024byteå¯¹é½     freelist[128,184)</span></span><br><span class="line"><span class="comment">// [64*1024+1,256*1024]8*1024byteå¯¹é½   freelist[184,208)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¦å°†å¯¹åº”çš„å­—èŠ‚æ•°å…ˆå‘ä¸Šå–æ•´</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">size_t</span> <span class="title">RoundUp</span><span class="params">(<span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (size &lt;= <span class="number">128</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _RoundUp(size, <span class="number">8</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (size &lt;= <span class="number">1024</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _RoundUp(size, <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (size &lt;= <span class="number">8</span> * <span class="number">1024</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _RoundUp(size, <span class="number">128</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (size &lt;= <span class="number">64</span> * <span class="number">1024</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _RoundUp(size, <span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (size &lt;= <span class="number">256</span> * <span class="number">1024</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _RoundUp(size, <span class="number">8</span>*<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//è¯´æ˜å‡ºç°äº†ä¸æƒ³ç”³è¯·çš„å­—èŠ‚æ•°ï¼Œç›´æ¥æŠ¥é”™</span></span><br><span class="line"><span class="built_in">assert</span>(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è®¡ç®—æ˜ å°„çš„å“ªä¸€ä¸ªè‡ªç”±é“¾è¡¨æ¡¶</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">size_t</span> <span class="title">Index</span><span class="params">(<span class="type">size_t</span> bytes)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">assert</span>(bytes &lt;= MAX_BYTES);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¯ä¸ªåŒºé—´æœ‰å¤šå°‘ä¸ªé“¾</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> group_array[<span class="number">4</span>] = &#123; <span class="number">16</span>, <span class="number">56</span>, <span class="number">56</span>, <span class="number">56</span> &#125;;</span><br><span class="line"><span class="keyword">if</span> (bytes &lt;= <span class="number">128</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> _Index(bytes, <span class="number">3</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (bytes &lt;= <span class="number">1024</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> _Index(bytes - <span class="number">128</span>, <span class="number">4</span>) + group_array[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (bytes &lt;= <span class="number">8</span> * <span class="number">1024</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> _Index(bytes - <span class="number">1024</span>, <span class="number">7</span>) + group_array[<span class="number">1</span>] + group_array[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (bytes &lt;= <span class="number">64</span> * <span class="number">1024</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> _Index(bytes - <span class="number">8</span> * <span class="number">1024</span>, <span class="number">10</span>) + group_array[<span class="number">2</span>] + group_array[<span class="number">1</span>] + group_array[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (bytes &lt;= <span class="number">256</span> * <span class="number">1024</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> _Index(bytes - <span class="number">64</span> * <span class="number">1024</span>, <span class="number">13</span>) + group_array[<span class="number">3</span>] + group_array[<span class="number">2</span>] + group_array[<span class="number">1</span>] + group_array[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="built_in">assert</span>(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="å¯¹é½">å¯¹é½</h4><blockquote><p>æˆ‘ä»¬ç”¨ä¸€ä¸ªå­å‡½æ•°å®ç°è¿™ä¸ªåŠŸèƒ½</p></blockquote><p>å¸¸è§„å†™æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">size_t</span> _RoundUp(<span class="type">size_t</span> bytes, <span class="type">size_t</span> alignNum)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// å¸¸è§„å†™æ³•</span></span><br><span class="line"><span class="keyword">if</span> (bytes % alignNum == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> bytes;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// 9 å¯¹é½åˆ°16 | 9/8+1=2 2*8=16</span></span><br><span class="line"><span class="comment">// å°±æ˜¯çœ‹å½“å‰çš„sizeå å‡ ä¸ªå¯¹é½æ•°ï¼Œç„¶å+1 å†ä¹˜å¯¹é½æ•°</span></span><br><span class="line"><span class="built_in">return</span> (bytes / alignNum + <span class="number">1</span>) * alignNum;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç‰›æ¯”å†™æ³•ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">size_t</span> _RoundUp(<span class="type">size_t</span> bytes, <span class="type">size_t</span> alignNum)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> ((bytes + alignNum - <span class="number">1</span>) &amp; ~(alignNum - <span class="number">1</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…·ä½“ä¾‹å­è¯´æ˜ï¼š</p><p>å­—èŠ‚æ•°ä¸º1ï¼Œåº”è¯¥å¯¹é½åˆ°8<br>å‰åŠéƒ¨åˆ†ï¼š1+8-1=8    äºŒè¿›åˆ¶ï¼š0000 1000<br>ååŠéƒ¨åˆ†ï¼š8-1=7        äºŒè¿›åˆ¶ï¼š0000 0111</p><p>8 &amp;~ 7 = 8</p><p>å­—èŠ‚æ•°ä¸º10ï¼Œåº”è¯¥å¯¹é½åˆ°16<br>å‰åŠéƒ¨åˆ†ï¼š10+8-1=17  äºŒè¿›åˆ¶ï¼š0001 0001<br>ååŠéƒ¨åˆ†ï¼š 8-1=7         äºŒè¿›åˆ¶ï¼š0000 0111</p><p>10 &amp;~7 = 10000 = 16</p><p>8ï¼š1000<br>~7ï¼š1111 1000<br>åˆ«çš„æ•°å’Œ~7ç›¸ä¸ï¼Œå3ä½ä¼šå˜æˆ0<br>16ï¼š10000<br>~15ï¼š1111 0000<br>åˆ«çš„æ•°å’Œ~15ç›¸ä¸ï¼Œå4ä½ä¼šå˜æˆ0<br>â€¦</p><blockquote><p>å®ƒçš„åŸç†æ˜¯è®©å½“å‰çš„å­—èŠ‚æ•°+å¯¹é½æ•°-1ï¼Œè¿™æ ·å°±å¤§äºæˆ–ç­‰äºä¸€ä¸ªå‘ä¸Šå¯¹é½çš„å¤§å°ï¼Œç„¶åä¸åé¢ä¸€éƒ¨åˆ†ç›¸ä¸ï¼Œå»æ‰å¤šä½™çš„éƒ¨åˆ†</p></blockquote><h4 id="è®¡ç®—ä¸‹æ ‡">è®¡ç®—ä¸‹æ ‡</h4><p>1å­—èŠ‚ï¼Œåœ¨0å·æ¡¶<br>10å­—èŠ‚ï¼Œåœ¨1å·æ¡¶<br>â€¦<br>129å­—èŠ‚ï¼Œåœ¨16å·æ¡¶</p><p>Â·Â·Â·</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">size_t</span> _Index(<span class="type">size_t</span> bytes, <span class="type">size_t</span> align_shift)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> ((bytes + (<span class="number">1</span> &lt;&lt; align_shift) - <span class="number">1</span>) &gt;&gt; align_shift) - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å’Œä¸Šè¾¹ç®—å¯¹é½æ•°æœ‰ç‚¹åƒ</p></blockquote><p>æ¯”å¦‚ 1å­—èŠ‚ï¼š</p><ul><li>1+ï¼ˆ1&lt;&lt;3) -1 = 8  ï¼ˆéƒ¨åˆ†æ˜¯å½“å‰å­—èŠ‚æ•°åŠ äº†ä¸€ä¸ªå¯¹é½æ•°-1ï¼Œè¿™ä¸ªæ•°å¤§äºç­‰äºå½“å‰å­—èŠ‚æ‰€è¦å¯¹é½çš„é‚£ä¸ªå¯¹é½æ•°ï¼‰</li><li>8&gt;&gt;3=1 (ç›¸å½“äºé™¤ä»¥ä¸€ä¸ªå¯¹é½æ•°)</li><li>1-1=0</li></ul><p>æ¯”å¦‚10å­—èŠ‚ï¼š</p><ul><li>10+(1&lt;&lt;3)-1=17</li><li>17&gt;&gt;3=2</li><li>2-1=1</li></ul><h3 id="ThreadCacheç±»ç»§ç»­">ThreadCacheç±»ç»§ç»­</h3><blockquote><p>å®Œæˆä¸Šè¾¹çš„åŠŸèƒ½åï¼Œæˆ‘ä»¬å¯ä»¥å…·ä½“å†™ThreadCacheç±»çš„å®ç°äº†</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span>* <span class="title">ThreadCache::Allocate</span><span class="params">(<span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">assert</span>(size &lt;= MAX_BYTES); </span><br><span class="line"><span class="comment">// å…ˆç®—sizeä¸ªå­—èŠ‚æ˜ å°„åˆ°å“ªä¸ªæ¡¶ï¼Œä½†æ˜¯ä¸åŒçš„å­—èŠ‚èŒƒå›´ï¼Œæ˜ å°„çš„è§„åˆ™ä¸åŒï¼Œç”¨ä¸€ä¸ªç±»ç®¡ç†</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰¾åˆ°å½“å‰å­—èŠ‚æ•°çš„å¯¹é½æ•°ï¼Œä»¥åŠå¯¹åº”å“ˆå¸Œæ¡¶çš„ä¸‹æ ‡</span></span><br><span class="line"><span class="type">size_t</span> alignSize = SizeClass::<span class="built_in">RoundUp</span>(size);</span><br><span class="line"><span class="type">size_t</span> index = SizeClass::<span class="built_in">Index</span>(size);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœæ‰€åœ¨è‡ªç”±é“¾è¡¨ä¸ä¸ºç©ºï¼Œå¤´åˆ è¿”å›å¤´èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">if</span> (!_freeLists[index].<span class="built_in">Empty</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _freeLists[index].<span class="built_in">Pop</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//ä¸ºç©ºï¼Œåˆ™å»CentralCacheå±‚è·å–</span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">FetchFromCentralCache</span>(index, alignSize);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é‡Šæ”¾å†…å­˜</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ThreadCache::Deallocate</span><span class="params">(<span class="type">void</span>* obj, <span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">assert</span>(obj);</span><br><span class="line"><span class="built_in">assert</span>(size &lt;= MAX_BYTES);</span><br><span class="line"></span><br><span class="line"><span class="type">size_t</span> index = SizeClass::<span class="built_in">Index</span>(size);</span><br><span class="line">_freeLists[index].<span class="built_in">Push</span>(obj);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ThreadCacheæ— é”è®¿é—®">ThreadCacheæ— é”è®¿é—®</h3><blockquote><p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„thread cacheï¼Œå¦‚ä½•åˆ›å»ºè¿™ä¸ªthread cacheå‘¢ï¼Ÿå¦‚æœåˆ›å»ºä¸ºå…¨å±€ï¼Œé‚£ä¹ˆè‚¯å®šæ˜¯éœ€è¦é”æ¥æ§åˆ¶</p></blockquote><p>å¦‚æœå®ç°æ¯ä¸ªçº¿ç¨‹æ— é”çš„è®¿é—®thread cacheï¼Œå°±éœ€è¦ç”¨åˆ°çº¿ç¨‹å±€éƒ¨å­˜å‚¨TLS(Thread Local Storage)ï¼Œä½¿ç”¨è¯¥æ–¹å¼å­˜å‚¨çš„éå†åœ¨å®ƒæ‰€åœ¨çš„çº¿ç¨‹å…¨å±€æ˜¯å¯è®¿é—®çš„ï¼Œä½†æ˜¯ä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹è®¿é—®åˆ°ï¼Œå¯ä»¥ä¿è¯çº¿ç¨‹çš„ç‹¬ç«‹æ€§ã€‚</p><blockquote><p>æˆ‘ä»¬åœ¨ å£°æ˜ä¸‹è¾¹è¿™ä¸ªæŒ‡é’ˆã€</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TLS thread local storage</span></span><br><span class="line"><span class="type">static</span> _declspec(thread) ThreadCache* pTLSThreadCache = <span class="literal">nullptr</span>;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨æ•´ä¸ªè°ƒç”¨ä¸­å¯ä»¥ç”¨ä¸‹è¿°æ–¹å¼</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span>* <span class="title">ConcurrentAlloc</span><span class="params">(<span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (pTLSThreadCache == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">pTLSThreadCache = <span class="keyword">new</span> ThreadCache;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ‹è¯•ä»£ç ï¼Œè·å–è¿›ç¨‹çš„id</span></span><br><span class="line">cout &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot;:&quot;</span> &lt;&lt; pTLSThreadCache &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> pTLSThreadCache-&gt;<span class="built_in">Allocate</span>(size);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">ConcurrentDealloc</span><span class="params">(<span class="type">void</span>* ptr, <span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">assert</span>(pTLSThreadCache);</span><br><span class="line">pTLSThreadCache-&gt;<span class="built_in">Deallocate</span>(ptr, size);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›® </category>
          
          <category> é«˜å¹¶å‘å†…å­˜æ±  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo-butterflyä¸»é¢˜-giscusè¯„è®º</title>
      <link href="/posts/3307342311/"/>
      <url>/posts/3307342311/</url>
      
        <content type="html"><![CDATA[<h2 id="1ã€åˆ›å»ºæ–°ä»“åº“">1ã€åˆ›å»ºæ–°ä»“åº“</h2><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302051226551.png" alt="image.png"></p><h2 id="2ã€å®‰è£…giscus">2ã€å®‰è£…giscus</h2><p>ç‚¹å‡»è¿™ä¸ªé“¾æ¥å®‰è£…ï¼š<a href="https://github.com/apps/giscus">GitHub Apps - giscus</a></p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302051226562.png" alt="image.png"></p><p>é€‰æ‹©åˆšå»ºç«‹çš„ä»“åº“ï¼Œç‚¹å‡»install</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302051228750.png" alt="image.png"></p><h2 id="3ã€é…ç½®ä»“åº“discusséƒ¨åˆ†">3ã€é…ç½®ä»“åº“discusséƒ¨åˆ†</h2><p>é¦–å…ˆæ‰“å¼€ä»“åº“çš„settingï¼Œå°†Discussionséƒ¨åˆ†æ‰“ä¸Šå¯¹å·</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302051535566.png" alt="image.png"></p><p>ç„¶åå»ºç«‹ä¸€ä¸ªAnnouncementsçš„åˆ†ç±»</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302051537858.png" alt="image.png"></p><h2 id="4ã€è¿›å…¥giscusé…ç½®">4ã€è¿›å…¥giscusé…ç½®</h2><p>é“¾æ¥åœ¨è¿™ï¼š<a href="https://giscus.app/zh-CN">giscus</a></p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302051524708.png" alt="image.png"></p><p>é…ç½®å®Œä¸Šè¿°éƒ¨åˆ†åï¼Œå¯ä»¥åœ¨å¯åŠ¨giscusä¸‹è¾¹å¤åˆ¶å‡ ä¸ªä¸œè¥¿</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302051530141.png" alt="image.png"></p><p>å°†ä¸Šè¾¹å¤åˆ¶çš„ä¸œè¥¿å¡«åˆ°butterflyä¸»é¢˜é…ç½®æ–‡ä»¶çš„è¿™é‡Œå°±å¯ä»¥äº†</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302051531097.png" alt="image.png"></p><h2 id="5ã€å¤§åŠŸå‘Šæˆ">5ã€å¤§åŠŸå‘Šæˆ</h2><p>åšå®¢æ–‡ç« éƒ¨åˆ†å°±æœ‰äº†ä¸‹è¾¹çš„è¯„è®ºåŒº</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302051538865.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
          <category> åšå®¢ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>3ã€é«˜å¹¶å‘å†…å­˜æ± -æ¡†æ¶</title>
      <link href="/posts/1235732513/"/>
      <url>/posts/1235732513/</url>
      
        <content type="html"><![CDATA[<h1>é—®é¢˜è€ƒè™‘</h1><blockquote><p>ä¸»è¦æ˜¯åœ¨å¤šçº¿ç¨‹é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œæ€§èƒ½æ›´å¼ºï¼Œä¸»è¦è€ƒè™‘ä¸‹é¢å‡ ä¸ªé—®é¢˜</p></blockquote><ol><li>æ€§èƒ½é—®é¢˜</li><li>å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œé”ç«äº‰é—®é¢˜</li><li>å†…å­˜ç¢ç‰‡é—®é¢˜</li></ol><h1>ç»„æˆéƒ¨åˆ†</h1><blockquote><p>concurrent memory pool ä¸»è¦ç”±ä¸‰éƒ¨åˆ†æ„æˆï¼šthread cacheã€central cacheã€page cacheï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302031859699.png" alt="sdsdasd.drawio.png"></p><ol><li><strong>thread cache</strong> : çº¿ç¨‹ç¼“å­˜ï¼Œæ˜¯æ¯ä¸ªçº¿ç¨‹ç‹¬æœ‰çš„ï¼Œç”¨äºå°äº256kbå†…å­˜çš„åˆ†é…ï¼Œçº¿ç¨‹ä»è¿™é‡Œç”³è¯·å†…å­˜ä¸éœ€è¦åŠ é”ï¼Œæ¯ä¸ªçº¿ç¨‹ç‹¬äº«ä¸€ä¸ªcacheï¼Œè¿™ä¹Ÿæ˜¯å†…å­˜æ± é«˜æ•ˆçš„åŸå› </li><li><strong>central cache</strong> : ä¸­å¿ƒç¼“å­˜ï¼Œè¢«æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œthread cacheæ˜¯æŒ‰éœ€ä»central cache ä¸­è·å–çš„å¯¹è±¡ï¼Œcentral cacheåˆé€‚çš„æ—¶æœºå›æ”¶thread cacheçš„å¯¹è±¡ï¼Œé¿å…ä¸€ä¸ªçº¿ç¨‹å ç”¨è¿‡å¤šçš„å†…å­˜ï¼Œè€Œå…¶ä»–çº¿ç¨‹å†…å­˜ä¸è¶³ï¼Œä½¿å¾—å†…å­˜åˆ†é…åœ¨å¤šä¸ªçº¿ç¨‹ä¸­æ›´å‡è¡¡çš„æŒ‰éœ€è°ƒåº¦ï¼Œcnetral cacheæ˜¯å­˜åœ¨ç«äº‰çš„ï¼Œä»è¿™é‡Œè·å–å†…å­˜å¯¹è±¡éœ€è¦åŠ é”ï¼Œä½†æ˜¯è¿™é‡Œç”¨çš„æ˜¯<strong>æ¡¶é”</strong>ï¼Œè€Œä¸”åªæœ‰thread cacheæ²¡æœ‰å†…å­˜å¯¹è±¡æ—¶ï¼Œæ‰ä¼šæ‰¾central  cacheï¼Œæ‰€ä»¥è¿™é‡Œç«äº‰ä¸ä¼šå¾ˆæ¿€çƒˆã€‚</li><li><strong>page cache</strong> : é¡µç¼“å­˜ï¼Œæ˜¯åœ¨central cacheç¼“å­˜ä¸Šé¢çš„ä¸€å±‚ç¼“å­˜ï¼Œå­˜å‚¨çš„å†…å­˜æ˜¯ä»¥é¡µä¸ºå•ä½å­˜å‚¨åŠåˆ†é…çš„ï¼Œcentral cacheæ²¡æœ‰å†…å­˜å¯¹è±¡æ—¶ï¼Œä»page cacheåˆ†é…å‡ºä¸€å®šæ•°é‡çš„pageï¼Œå¹¶ä¸”åˆ‡å‰²æˆå®šé•¿å¤§å°çš„å°å—å†…å­˜ï¼Œåˆ†é…ç»™central cacheï¼Œå½“ä¸€ä¸ªspançš„å‡ ä¸ªè·¨åº¦é¡µçš„å¯¹è±¡éƒ½å›æ”¶ä»¥åï¼Œpage cacheä¼šå›æ”¶central cacheæ»¡è¶³æ¡ä»¶çš„spanå¯¹è±¡ï¼Œå¹¶ä¸”åˆå¹¶ç›¸é‚»çš„é¡µï¼Œç»„æˆæ›´å¤§çš„é¡µï¼Œç¼“è§£å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€‚</li></ol><h1>æ€»ç»“</h1><blockquote><p>é«˜å¹¶å‘å†…å­˜æ± çš„è¿™ä¸‰éƒ¨åˆ†éƒ½æŒºå¤æ‚ï¼Œåé¢ä¹Ÿä¼šå…·ä½“åˆ†ä¸ºä¸‰ä¸ªç« èŠ‚è°ˆè®ºè¿™ä¸‰ä¸ªéƒ¨åˆ†çš„åŸç†ä»¥åŠå®ç°ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›® </category>
          
          <category> é«˜å¹¶å‘å†…å­˜æ±  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2ã€é«˜å¹¶å‘å†…å­˜æ± -é¢„å¤‡</title>
      <link href="/posts/594127029/"/>
      <url>/posts/594127029/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ä¸ç§¯è·¬æ­¥ï¼Œæ— ä»¥è‡³åƒé‡Œï¼›ä¸ç§¯å°æµï¼Œæ— ä»¥æˆæ±Ÿæµ·ï¼Œåšé¡¹ç›®ä¹Ÿæ˜¯ä¸€æ ·ï¼Œå…ˆä»ç®€å•çš„éƒ¨åˆ†åšèµ·ï¼Œåœ¨æ­£å¼çš„é¡¹ç›®å¼€å§‹å‰ï¼Œå¯ä»¥å…ˆæ¥ä¸ªå¼€èƒƒèœï¼Œä¸€æ˜¯å¯ä»¥ç†Ÿæ‚‰ç®€å•çš„å†…å­˜æ± æ˜¯å¦‚ä½•æ§åˆ¶çš„ï¼ŒäºŒæ˜¯ä¼šä½œä¸ºä¹‹åå†…å­˜æ± çš„ä¸€ä¸ªåŸºæœ¬ç»„ä»¶ã€‚</p></blockquote><h1>mallocå’Œå®šé•¿å†…å­˜æ± å¯¹æ¯”</h1><blockquote><p>mallocåœºæ™¯å¦‚ä¸‹ï¼Œmallocæ˜¯ä¸€ä¸ªé€šç”¨çš„å†…å­˜æ± ï¼Œåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹éƒ½å¯ä»¥ä½¿ç”¨ï¼Œä½†è¿™ä¹Ÿæ„å‘³ç€mallocåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹éƒ½ä¸ä¼šæœ‰å¾ˆé«˜çš„æ€§èƒ½ï¼Œå› ä¸ºmallocå¹¶ä¸æ˜¯é’ˆå¯¹æŸç§åœºæ™¯ä¸“é—¨è®¾è®¡çš„ã€‚</p></blockquote><div class="mermaid-wrap"><pre class="mermaid-src" hidden>  flowchart TDA[åœºæ™¯A] --&gt; B(malloc)E[åœºæ™¯B] --&gt; B(malloc)C[åœºæ™¯C] --&gt; B(malloc)  </pre></div><blockquote><p>å®šé•¿å†…å­˜æ± å°±æ˜¯é’ˆå¯¹å›ºå®šå¤§å°å†…å­˜å—ç”³è¯·å’Œé‡Šæ”¾çš„å†…å­˜æ± ï¼Œç”±äºå®šé•¿å†…å­˜æ± åªéœ€è¦æ”¯æŒå›ºå®šå¤§å°å†…å­˜å—çš„ç”³è¯·å’Œé‡Šæ”¾ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†å…¶æ€§èƒ½åšåˆ°æè‡´ï¼Œå¹¶ä¸”åœ¨å®ç°å®šé•¿å†…å­˜æ± æ—¶ä¸éœ€è¦è€ƒè™‘å†…å­˜ç¢ç‰‡ç­‰é—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬ç”³è¯·/é‡Šæ”¾çš„éƒ½æ˜¯å›ºå®šå¤§å°çš„å†…å­˜å—ã€‚</p></blockquote><div class="mermaid-wrap"><pre class="mermaid-src" hidden>  flowchart BTA[å†…å­˜æ± A] --&gt; B1(åœºæ™¯A)E[å†…å­˜æ± B] --&gt; B2(åœºæ™¯B)C[å†…å­˜æ± C] --&gt; B3(åœºæ™¯C)  </pre></div><h1>å®šé•¿å†…å­˜æ± å®ç°</h1><h2 id="æ¡†æ¶è®¾è®¡">æ¡†æ¶è®¾è®¡</h2><blockquote><p>æˆ‘ä»¬çš„æ€è·¯æ˜¯å…ˆç”³è¯·å¤§å—å†…å­˜ï¼Œæ¯æ¬¡ç”³è¯·å°±åˆ‡sizeof(T)å¤§å°çš„å†…å­˜å—ï¼Œé‡Šæ”¾åï¼Œç”¨é“¾è¡¨ç»„ç»‡èµ·æ¥ï¼Œæ¯ä¸ªå†…å­˜å—å‰4/8ä¸ªå­—èŠ‚å­˜ä¸‹ä¸€ä¸ªå†…å­˜å—çš„åœ°å€ï¼Œå†æ¬¡ç”³è¯·å†…å­˜æ—¶ï¼Œå¦‚æœ_freeListä¸ä¸ºç©ºï¼Œå°±é‡å¤åˆ©ç”¨</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302012204835.png" alt="image.png"></p><h3 id="æ ¸å¿ƒæˆå‘˜">æ ¸å¿ƒæˆå‘˜</h3><ul><li>_ memoryï¼šæŒ‡å‘ç”³è¯·å¤§å—å†…å­˜çš„ç©ºé—´</li><li>_ freeListï¼šç»„ç»‡å½’è¿˜çš„å†…å­˜å—çš„é“¾è¡¨</li><li>_ remainBytesï¼šå¤§å—å†…å­˜å‰©ä½™å­—èŠ‚æ•°</li></ul><h3 id="å­˜åœ¨é—®é¢˜">å­˜åœ¨é—®é¢˜</h3><ul><li>å¤§å—å†…å­˜ï¼Œå‰©ä¸‹çš„å†…å­˜ä¸è¶³ä¸€ä¸ªTçš„å¤§å°å¦‚ä½•å¤„ç†ï¼Ÿ</li><li>Tçš„ç±»å‹å¤§å°è‹¥æ˜¯å°äºæŒ‡é’ˆçš„å¤§å°å¦‚ä½•å¤„ç†ï¼Ÿ</li><li>å†…å­˜å—çš„å‰æ®µå†…å­˜å­˜æŒ‡é’ˆï¼Œè¿™ä¸ªå¤§å°æ˜¯4ï¼Ÿè¿˜æ˜¯8ï¼Ÿèƒ½ä¸èƒ½è€ƒè™‘å¹³å°å…¼å®¹ï¼Ÿ</li><li>å¦‚ä½•å–ä¸€å—å†…å­˜çš„å‰4/8ä¸ªå­—èŠ‚ï¼Ÿ</li></ul><blockquote><p>è¿™äº›é—®é¢˜æ€ä¹ˆè§£å†³å‘¢ï¼Ÿæˆ‘ä»¬åœ¨ä¸‹é¢çš„å†…å®¹è¯¦ç»†è®²è§£</p></blockquote><h2 id="æˆå‘˜å‡½æ•°">æˆå‘˜å‡½æ•°</h2><h3 id="New">New</h3><blockquote><p>ç”³è¯·å†…å­˜ï¼Œè¿”å›å¯¹åº”ç±»å‹çš„æŒ‡é’ˆï¼Œæˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹æµç¨‹å›¾</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302021614783.png" alt="eeee.png"></p><blockquote><p>å¦‚æœæŒ‰ç…§ä¸Šè¿°æµç¨‹ï¼Œå…ˆç”³è¯·äº†å¤§å—å†…å­˜ä¹‹åï¼Œæ¯æ¬¡åˆ‡Tç±»å‹å¤§å°çš„å†…å­˜å—ï¼Œä½†æ˜¯æœ€åçš„æ—¶å€™å‰©ä½™çš„å†…å­˜å—ä¸å¤Ÿçš„è¯ï¼Œå°±ä¼šå‡ºç°è¶Šç•Œé—®é¢˜ï¼Œæ‰€æœ‰ï¼Œæˆ‘ä»¬æœ‰äº†remainBytesæˆå‘˜ï¼Œè¿™ä¸ªæ ‡è¯†å‰©ä½™çš„å®¹é‡ï¼Œå½“å‰©ä¸‹çš„å†…å­˜ä¸è¶³ä¸€ä¸ªTçš„å¤§å°ï¼Œæˆ‘ä»¬å°±ç›´æ¥ç”³è¯·å¤§å—å†…å­˜ï¼Œåˆå§‹çš„æ—¶å€™remainBytesä¸º0ï¼Œä¹Ÿæ˜¯å°äºTçš„å¤§å°ï¼ŒåŒæ ·è¿›è¡Œç”³è¯·ï¼Œè¿™å°±å›ç­”äº†ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œå’ŒremainBytesæˆå‘˜çš„ç”¨å¤„ã€‚</p></blockquote><p>ç„¶åæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å…·ä½“ç”³è¯·çš„ä¸¤ç§æ“ä½œï¼š</p><blockquote><p>1ã€åœ¨å¤§å—å†…å­˜ä¸Šåˆ‡å†…å­˜å—ï¼Œè¿”å›_memoryçš„åœ°å€ï¼Œç„¶åè®©_memoryå¾€åç§»åŠ¨sizeof(T)çš„è·ç¦»ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä¸ºä»€ä¹ˆå°†memoryæˆå‘˜è®¾ç½®ä¸ºchar * çš„åŸå› ï¼Œå› ä¸º+1æ“ä½œå°±æ˜¯å¾€åç§»åŠ¨ä¸€ä¸ªå­—èŠ‚ã€‚</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302021358722.png" alt="image.png"></p><blockquote><p>2ã€å¦‚è¿‡freeListä¸ä¸ºç©ºï¼Œå°±å¤´åˆ å–å¤´èŠ‚ç‚¹è¿”å›å³å¯</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302021455261.png" alt="image.png"></p><p>Newä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">T* <span class="title">New</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">T* obj = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="keyword">if</span> (_freeList) <span class="comment">//freeListä¸ä¸ºç©º</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// ç›´æ¥è¿›è¡Œå¤´åˆ </span></span><br><span class="line">obj = (T*)_freeList;</span><br><span class="line"><span class="comment">/* freeListæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘ä»¬é¦–å…ˆå¾—å–å‡ºæ¥freeListæŒ‡å‘å¾—å†…å­˜å—ä¸­å¾—å‰</span></span><br><span class="line"><span class="comment">æŒ‡é’ˆå¤§å°çš„å­—èŠ‚ï¼Œä½†æ˜¯32ä½å¹³å°ä¸‹ï¼ŒæŒ‡é’ˆçš„å¤§å°ä¸º4ï¼Œ64ä½å¹³å°æŒ‡é’ˆçš„å¤§å°ä¸º8ï¼Œå¦‚æœæ˜¯4çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†freeListå¼ºè½¬ä¸ºint* ç„¶åè§£å¼•ç”¨æ‹¿åˆ°äº†å‰4ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯åœ¨64ä½å¹³å°ä¸‹æŒ‡é’ˆçš„å¤§å°å 8ä¸ªå­—èŠ‚ï¼Œè¿™ä¸ªå°±ä¸è¡Œäº†ã€‚</span></span><br><span class="line"><span class="comment">æˆ‘ä»¬å¯ä»¥å°† freeListå¼ºè½¬ä¸ºäºŒçº§æŒ‡é’ˆï¼Œè§£å¼•ç”¨å°±æ˜¯ä¸€çº§æŒ‡é’ˆï¼Œè¿™æ ·å°±èƒ½æ‹¿åˆ°4æˆ–è€…8ä¸ªå­—èŠ‚äº†ã€‚è¿™å°±å›ç­”äº†åè¾¹ä¸¤ä¸ªé—®é¢˜</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">_freeList = *(<span class="type">void</span>**)_freeList;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//è¯´æ˜éœ€è¦å…ˆç”³è¯·å¤§å—å†…å­˜</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (_remainBytes &lt; <span class="built_in">sizeof</span>(T))</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//è¯´æ˜éœ€è¦å…ˆç”³è¯·å¤§å—å†…å­˜</span></span><br><span class="line">_remainBytes = <span class="number">128</span> * <span class="number">1024</span>;</span><br><span class="line">_memory = (<span class="type">char</span>*)<span class="built_in">malloc</span>(_remainBytes);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">size_t</span> objSize = <span class="built_in">sizeof</span>(T) &gt; <span class="built_in">sizeof</span>(<span class="type">void</span>*) ? <span class="built_in">sizeof</span>(T) : <span class="built_in">sizeof</span>(<span class="type">void</span>*);</span><br><span class="line">obj = (T*)_memory;</span><br><span class="line">_memory += objSize;</span><br><span class="line">_remainBytes -= objSize;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¯¹Tç±»å‹åˆå§‹åŒ–-ä½¿ç”¨å®šä½new</span></span><br><span class="line"><span class="keyword">new</span>(obj)T;</span><br><span class="line"><span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Delete">Delete</h3><blockquote><p>é‡Šæ”¾å†…å­˜ï¼ˆå½’è¿˜å†…å­˜ï¼‰, ç›´æ¥å¯¹freeListè¿›è¡Œå¤´æ’æ“ä½œå³å¯ï¼Œå…·ä½“ç»†èŠ‚æ”¾åˆ°ä»£ç æ³¨é‡Šéƒ¨åˆ†</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302021448061.png" alt="image.png"><br>Deleteä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Delete</span><span class="params">(T* obj)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (obj == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//å…ˆæ˜¾ç¤ºè°ƒç”¨ææ„</span></span><br><span class="line">obj-&gt;~<span class="built_in">T</span>();</span><br><span class="line"><span class="comment">//å¤´æ’ è¿›freeListé“¾è¡¨</span></span><br><span class="line">*(<span class="type">void</span>**)obj = _freeList;</span><br><span class="line">_freeList = (<span class="type">void</span>*)obj;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€§èƒ½æµ‹è¯•">æ€§èƒ½æµ‹è¯•</h2><blockquote><p>æ€§èƒ½æµ‹è¯•ä»£ç å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸æ–­çš„ç”³è¯·é‡Šæ”¾èŠ‚ç‚¹ï¼Œç”³è¯·çš„æŒ‡é’ˆç”¨vectorä¿å­˜ï¼Œç„¶åè®°å½•å›ºå®šæ¬¡æ•°çš„ç”³è¯·é‡Šæ”¾æ—¶é—´å°±å¯ä»¥äº†</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">TreeNode</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> _val;</span><br><span class="line">TreeNode* _left;</span><br><span class="line">TreeNode* _right;</span><br><span class="line"></span><br><span class="line"><span class="built_in">TreeNode</span>()</span><br><span class="line">:_val(<span class="number">0</span>)</span><br><span class="line">, _left(<span class="literal">nullptr</span>)</span><br><span class="line">, _right(<span class="literal">nullptr</span>)</span><br><span class="line">&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">TestObjectPool</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// ç”³è¯·é‡Šæ”¾çš„è½®æ¬¡</span></span><br><span class="line"><span class="type">const</span> <span class="type">size_t</span> Rounds = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¯è½®ç”³è¯·é‡Šæ”¾å¤šå°‘æ¬¡</span></span><br><span class="line"><span class="type">const</span> <span class="type">size_t</span> N = <span class="number">1000000</span>;</span><br><span class="line"></span><br><span class="line">std::vector&lt;TreeNode*&gt; v1;</span><br><span class="line">v1.<span class="built_in">reserve</span>(N);</span><br><span class="line"></span><br><span class="line"><span class="type">size_t</span> begin1 = <span class="built_in">clock</span>(); <span class="comment">//è®°å½•å¼€å§‹æ—¶é—´</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> j = <span class="number">0</span>; j &lt; Rounds; ++j)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i)</span><br><span class="line">&#123;</span><br><span class="line">v1.<span class="built_in">push_back</span>(<span class="keyword">new</span> TreeNode);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">delete</span> v1[i];</span><br><span class="line">&#125;</span><br><span class="line">v1.<span class="built_in">clear</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">size_t</span> end1 = <span class="built_in">clock</span>(); <span class="comment">// ç»“æŸæ—¶é—´</span></span><br><span class="line"></span><br><span class="line">std::vector&lt;TreeNode*&gt; v2;</span><br><span class="line">v2.<span class="built_in">reserve</span>(N);</span><br><span class="line"></span><br><span class="line">ObjectPool&lt;TreeNode&gt; TNPool;</span><br><span class="line"><span class="type">size_t</span> begin2 = <span class="built_in">clock</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> j = <span class="number">0</span>; j &lt; Rounds; ++j)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i)</span><br><span class="line">&#123;</span><br><span class="line">v2.<span class="built_in">push_back</span>(TNPool.<span class="built_in">New</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i)</span><br><span class="line">&#123;</span><br><span class="line">TNPool.<span class="built_in">Delete</span>(v2[i]);</span><br><span class="line">&#125;</span><br><span class="line">v2.<span class="built_in">clear</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">size_t</span> end2 = <span class="built_in">clock</span>();</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;newèŠ±è´¹æ—¶é—´:&quot;</span> &lt;&lt; end1 - begin1 &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;å®šé•¿å†…å­˜æ± èŠ±è´¹æ—¶é—´:&quot;</span> &lt;&lt; end2 - begin2 &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç»è¿‡æ€§èƒ½æµ‹è¯•ï¼Œå½“Næ˜¯1000000ï¼ŒReleaseæ¨¡å¼ä¸‹ï¼Œå®šé•¿å†…å­˜æ± é€Ÿåº¦å¤§æ¦‚ä¸ºnewçš„10å‡ å€</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302021531020.png" alt="image.png"></p><h2 id="æ•´ä½“ä»£ç ">æ•´ä½“ä»£ç </h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::cout;</span><br><span class="line"><span class="keyword">using</span> std::endl;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _WIN32</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// _WIN32</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ObjectPool</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function">T* <span class="title">New</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">T* obj = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="keyword">if</span> (_freeList)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// ç›´æ¥è¿›è¡Œå¤´åˆ </span></span><br><span class="line">obj = (T*)_freeList;</span><br><span class="line">_freeList = *(<span class="type">void</span>**)_freeList;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//è¯´æ˜éœ€è¦å…ˆç”³è¯·å¤§å—å†…å­˜</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (_remainBytes &lt; <span class="built_in">sizeof</span>(T))</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//è¯´æ˜éœ€è¦å…ˆç”³è¯·å¤§å—å†…å­˜</span></span><br><span class="line">_remainBytes = <span class="number">128</span> * <span class="number">1024</span>;</span><br><span class="line">_memory = (<span class="type">char</span>*)<span class="built_in">malloc</span>(_remainBytes);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">size_t</span> objSize = <span class="built_in">sizeof</span>(T) &gt; <span class="built_in">sizeof</span>(<span class="type">void</span>*) ? <span class="built_in">sizeof</span>(T) : <span class="built_in">sizeof</span>(<span class="type">void</span>*);</span><br><span class="line">obj = (T*)_memory;</span><br><span class="line">_memory += objSize;</span><br><span class="line">_remainBytes -= objSize;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯¹Tç±»å‹åˆå§‹åŒ–-ä½¿ç”¨å®šä½new</span></span><br><span class="line"><span class="keyword">new</span>(obj)T;</span><br><span class="line"><span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Delete</span><span class="params">(T* obj)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (obj == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//å…ˆæ˜¾ç¤ºè°ƒç”¨ææ„</span></span><br><span class="line">obj-&gt;~<span class="built_in">T</span>();</span><br><span class="line"><span class="comment">//å¤´æ’ è¿›freeListé“¾è¡¨</span></span><br><span class="line">*(<span class="type">void</span>**)obj = _freeList;</span><br><span class="line">_freeList = (<span class="type">void</span>*)obj;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="type">char</span>* _memory = <span class="literal">nullptr</span>; <span class="comment">// æŒ‡å‘å¤§å—å†…å­˜çš„æŒ‡é’ˆ</span></span><br><span class="line"><span class="type">size_t</span> _remainBytes = <span class="number">0</span>; <span class="comment">// å¤§å—å†…å­˜åœ¨åˆ‡åˆ†è¿‡ç¨‹ä¸­å‰©ä½™å­—èŠ‚æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span>* _freeList = <span class="literal">nullptr</span>; <span class="comment">// è¿˜å›æ¥è¿‡ç¨‹ä¸­é“¾æ¥çš„è‡ªç”±é“¾è¡¨çš„å¤´æŒ‡é’ˆ</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å†…å­˜ç”³è¯·ï¼ˆç³»ç»Ÿæ¥å£ï¼‰è¡¥å……">å†…å­˜ç”³è¯·ï¼ˆç³»ç»Ÿæ¥å£ï¼‰è¡¥å……</h2><blockquote><p>åœ¨Windowsä¸‹ï¼Œå¯ä»¥è°ƒç”¨VirtualAllocå‡½æ•°ï¼Œç”³è¯·å †å†…å­˜</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç›´æ¥å»å †ä¸ŠæŒ‰é¡µç”³è¯·ç©ºé—´</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">static</span> <span class="type">void</span>* <span class="title">SystemAlloc</span><span class="params">(<span class="type">size_t</span> kpage)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _WIN32</span></span><br><span class="line"><span class="type">void</span>* ptr = <span class="built_in">VirtualAlloc</span>(<span class="number">0</span>, kpage&lt;&lt;<span class="number">13</span>, MEM_COMMIT | MEM_RESERVE, PAGE_READWRITE);</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="comment">// linuxä¸‹brk mmapç­‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (ptr == <span class="literal">nullptr</span>)</span><br><span class="line"><span class="keyword">throw</span> std::<span class="built_in">bad_alloc</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ptr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>VirtualAllocæ˜¯Windows APIä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒåœ¨è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´å†…ä¿ç•™æˆ–æäº¤å†…å­˜é¡µã€‚</p></blockquote><p>ä¼ é€’ç»™VirtualAllocçš„å‚æ•°åŒ…æ‹¬ï¼š</p><ul><li>0ï¼šè¦åˆ†é…çš„åŒºåŸŸçš„èµ·å§‹åœ°å€ã€‚0è¡¨ç¤ºç³»ç»Ÿå°†é€‰æ‹©èµ·å§‹åœ°å€ã€‚</li><li>kpage&lt;&lt;13ï¼šè¦åˆ†é…çš„å†…å­˜åŒºåŸŸçš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚kpage&lt;&lt;13è¡¨ç¤ºâ€œkpageä¹˜ä»¥2çš„13æ¬¡æ–¹â€ã€‚</li><li>MEM_COMMIT | MEM_RESERVEï¼šåˆ†é…çš„ç±»å‹ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œåˆ†é…çš„æ˜¯æäº¤å†…å­˜å’Œä¿ç•™å†…å­˜ã€‚</li><li>PAGE_READWRITEï¼šåˆ†é…æ‰€éœ€çš„å†…å­˜ä¿æŠ¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæŒ‡å®šäº†è¯»å†™è®¿é—®ã€‚</li></ul><p>è¯¥å‡½æ•°è¿”å›æŒ‡å‘åˆ†é…å†…å­˜çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æŒ‡é’ˆï¼Œè¯¥å­—èŠ‚å­˜å‚¨åœ¨ptrå˜é‡ä¸­</p><blockquote><p>é‡‡ç”¨ç³»ç»Ÿè°ƒç”¨åï¼ŒNewçš„ç”³è¯·å†…å­˜å¯ä»¥æŒ‰ä¸‹æ–¹çš„å†™æ³•</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">T* <span class="title">New</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">T* obj = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="keyword">if</span> (_freeList)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// ç›´æ¥è¿›è¡Œå¤´åˆ </span></span><br><span class="line">obj = (T*)_freeList;</span><br><span class="line">_freeList = *(<span class="type">void</span>**)_freeList;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//è¯´æ˜éœ€è¦å…ˆç”³è¯·å¤§å—å†…å­˜</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (_remainBytes &lt; <span class="built_in">sizeof</span>(T))</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//è¯´æ˜éœ€è¦å…ˆç”³è¯·å¤§å—å†…å­˜</span></span><br><span class="line">_remainBytes = <span class="number">128</span> * <span class="number">1024</span>;</span><br><span class="line"><span class="comment">//_memory = (char*)malloc(_remainBytes);</span></span><br><span class="line">_memory = (<span class="type">char</span>*)<span class="built_in">SystemAlloc</span>(_remainBytes &gt;&gt; <span class="number">13</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">size_t</span> objSize = <span class="built_in">sizeof</span>(T) &gt; <span class="built_in">sizeof</span>(<span class="type">void</span>*) ? <span class="built_in">sizeof</span>(T) : <span class="built_in">sizeof</span>(<span class="type">void</span>*);</span><br><span class="line">obj = (T*)_memory;</span><br><span class="line">_memory += objSize;</span><br><span class="line">_remainBytes -= objSize;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯¹Tç±»å‹åˆå§‹åŒ–-ä½¿ç”¨å®šä½new</span></span><br><span class="line"><span class="keyword">new</span>(obj)T;</span><br><span class="line"><span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›® </category>
          
          <category> é«˜å¹¶å‘å†…å­˜æ±  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>éœ‡æƒŠï¼ï¼ï¼Cè¯­è¨€ä¹Ÿèƒ½å®ç°æ³›å‹ç¼–ç¨‹å—ï¼Ÿï¼Ÿ</title>
      <link href="/posts/2871490963/"/>
      <url>/posts/2871490963/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ä»Šå¤©çœ‹åˆ°ä¸€ä¸ªæœ‰æ„æ€çš„çŸ¥è¯†ç‚¹ï¼Œèµ¶ç´§è®°å½•ä¸€ä¸‹ï¼Œæ€»æ‰€å‘¨çŸ¥ï¼ŒCè¯­è¨€æ²¡æœ‰æ³›å‹ï¼Œä½†æ˜¯C11æ–°å¢äº†ä¸€ç§è¡¨è¾¾å¼ï¼Œå«åšæ³›å‹é€‰æ‹©è¡¨è¾¾å¼(_ Generic)ï¼Œè¿™ä¸ªæ˜¯å¹²å•¥çš„å‘¢ï¼Ÿå®ƒçš„ä½œç”¨æ˜¯æ ¹æ®è¡¨è¾¾å¼çš„ç±»å‹é€‰æ‹©ä¸€ä¸ªå€¼ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€çœ‹å®ƒå…·ä½“çš„è¯­æ³•</p></blockquote><h1>æ³›å‹é€‰æ‹©å¼•å…¥</h1><p>å…ˆçœ‹ä¸€æ®µä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="type">double</span> y = <span class="number">2.0</span>;</span><br><span class="line"><span class="type">char</span> z = <span class="string">&#x27;c&#x27;</span>;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="keyword">_Generic</span>(x, <span class="type">int</span>:<span class="number">0</span>, <span class="type">double</span> : <span class="number">1</span>, <span class="keyword">default</span>:<span class="number">3</span>));</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="keyword">_Generic</span>(y, <span class="type">int</span>:<span class="number">0</span>, <span class="type">double</span> : <span class="number">1</span>, <span class="keyword">default</span>:<span class="number">3</span>));</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="keyword">_Generic</span>(z, <span class="type">int</span>:<span class="number">0</span>, <span class="type">double</span> : <span class="number">1</span>, <span class="keyword">default</span>:<span class="number">3</span>));</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>_Genericæ˜¯C11å…³é”®å­—ï¼Œåé¢çš„åœ†æ‹¬å·ä¸­åŒ…å«æœ‰å¤šä¸ªç”¨é€—å·åˆ†éš”çš„é¡¹ï¼Œç¬¬ä¸€ä¸ªé¡¹æ˜¯è¡¨è¾¾å¼ï¼Œåé¢çš„æ¯ä¸€ä¸ªé¡¹éƒ½ç”±ä¸€ä¸ªç±»å‹ã€ä¸€ä¸ªå†’å·å’Œä¸€ä¸ªå€¼ç»„æˆï¼Œå¦‚double: 1ã€‚ç¬¬ä¸€ä¸ªé¡¹çš„ç±»å‹åŒ¹é…å“ªä¸€ä¸ªæ ‡ç­¾ï¼Œæ•´ä¸ªè¡¨è¾¾å¼çš„å€¼å°±æ˜¯è¯¥æ ‡ç­¾åé¢çš„å€¼</code></p><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302011644537.png" alt="image.png"></p><blockquote><p>å¯ä»¥çœ‹åˆ°ï¼Œæ ¹æ®ä¼ å…¥çš„å˜é‡çš„ç±»å‹ï¼Œæ‰“å°çš„ç»“æœä¹Ÿä¸åŒï¼Œç¬¬ä¸€ä¸ªprintfçš„ç¬¬ä¸€é¡¹xæ˜¯intï¼Œé‚£ä¹ˆæ•´ä¸ªè¡¨è¾¾å¼çš„ç»“æœä¸º0ï¼Œç¬¬äºŒä¸ªprintfçš„ç¬¬ä¸€é¡¹æ˜¯doubleï¼Œè¡¨è¾¾å¼çš„ç»“æœå°±æ˜¯1ï¼Œç¬¬ä¸‰ä¸ªprintfæ‰“å°ç»“æœä¸º3æ˜¯å› ä¸ºcharç±»å‹æ²¡æœ‰åŒ¹é…ï¼Œèµ°äº†é»˜è®¤çš„defaultï¼Œç»“æœä¸º3</p></blockquote><p><font color="#ff0000">å…¶å®ï¼Œè¿™ä¸ªä¸œè¥¿å¾ˆåƒswitchè¯­å¥ï¼Œåªæ˜¯Genericç”¨è¡¨è¾¾å¼ç±»å‹åŒ¹é…æ ‡ç­¾ï¼Œswitchç”¨è¡¨è¾¾å¼çš„å€¼åŒ¹é…æ ‡ç­¾</font></p><h1>ä¸å®å®šä¹‰ç»„åˆ</h1><blockquote><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å•Šï¼Œä¸Šè¾¹çš„ç”¨æ³•è¿˜æ˜¯æ¯”è¾ƒæ¶å¿ƒéº»çƒ¦çš„ï¼Œä½†æ˜¯å‘¢ï¼Œæˆ‘ä»¬å¯ä»¥ç»“åˆå®å®šä¹‰ç»„åˆå»ç©è¿™ä¸ªä¸œè¥¿ï¼Œè¿™æ ·å°±ä¼šéå¸¸çš„æ–¹ä¾¿</p></blockquote><p>ç›´æ¥çœ‹ä¾‹å­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> MYTYPE(X) _Generic((X),int:<span class="string">&quot;int&quot;</span>, double:<span class="string">&quot;double&quot;</span>, default:<span class="string">&quot;other&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> d = <span class="number">2</span>;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, MYTYPE(d));</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, MYTYPE(<span class="number">1.0</span>*d));</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, MYTYPE(<span class="string">&quot;string&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302011709745.png" alt="image.png"></p><blockquote><p>ä¸å®å®šä¹‰ç»“åˆæ˜¯ä¸æ˜¯æ„Ÿè§‰å¥½å¤šäº†ï¼Œç”šè‡³æœ‰ç‚¹C++æ³›å‹ç¼–ç¨‹çš„æ„Ÿè§‰äº†ï¼Œä½†æ˜¯å…¶å®è¿˜å·®ç‚¹ã€‚</p></blockquote><h1>è¿›é˜¶ç©æ³•</h1><blockquote><p>_ Genericæ ‡ç­¾å¯¹åº”çš„å€¼ï¼Œå¯ä»¥æ˜¯æ•´å½¢ï¼Œä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ˜¯å‡½æ•°æŒ‡é’ˆã€‚</p></blockquote><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸‹è¾¹çš„è¿™æ®µä»£ç ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">PrintInt</span><span class="params">(<span class="type">int</span> x)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">PrintDouble</span><span class="params">(<span class="type">double</span> x)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%lf\n&quot;</span>, x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">PrintSting</span><span class="params">(<span class="type">char</span>* x)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">PrintOther</span><span class="params">(<span class="type">void</span> x)</span></span><br><span class="line">&#123;</span><br><span class="line">print(<span class="string">&quot;ç±»å‹æœ‰ç‚¹é—®é¢˜\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PRINT(X) _Generic((X),\</span></span><br><span class="line"><span class="meta">int:PrintInt,\</span></span><br><span class="line"><span class="meta">double:PrintDouble,\</span></span><br><span class="line"><span class="meta">const char*:PrintSting,\</span></span><br><span class="line"><span class="meta">default:PrintOther)(X)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> y = <span class="number">2.0</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* str = <span class="string">&quot;hello _Generic&quot;</span>;</span><br><span class="line">PRINT(x);</span><br><span class="line">PRINT(y);</span><br><span class="line">PRINT(str);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š<br><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202302011719753.png" alt="image.png"></p><blockquote><p>è¿™æ ·æ˜¯ä¸æ˜¯å’ŒC++çš„æ³›å‹ç¼–ç¨‹å¾ˆåƒäº†å‘¢ï¼Œæ˜¯ä¸æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œå½“ç„¶è¿˜æ˜¯C++çš„æ³›å‹å¥½ç”¨ä¸€äº›ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹è¯­è¨€ </category>
          
          <category> C </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C11 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>1ã€é«˜å¹¶å‘å†…å­˜æ± -åºç« </title>
      <link href="/posts/4062989894/"/>
      <url>/posts/4062989894/</url>
      
        <content type="html"><![CDATA[<h1>é¡¹ç›®ä»‹ç»</h1><blockquote><p>è¿™æ˜¯ä¸€ä¸ªCPPå®ç°çš„é«˜å¹¶å‘å†…å­˜æ± ï¼ŒåŸå‹æ˜¯è°·æ­Œçš„tcmallocå¼€æºé¡¹ç›®ï¼ˆThread-Caching Mallocï¼‰ï¼Œæ—¢çº¿ç¨‹ç¼“å­˜çš„mallocï¼Œå®ç°äº†é«˜æ•ˆçš„å¤šçº¿ç¨‹å†…å­˜ç®¡ç†ï¼Œç”¨äºæ›¿ä»£ç³»ç»Ÿçš„å†…å­˜åˆ†é…ç›¸å…³å‡½æ•°ï¼ˆmallocã€freeï¼‰</p></blockquote><h1>å‰ç½®éœ€æ±‚</h1><ul><li>C/C++</li><li>æ•°æ®ç»“æ„ï¼ˆé“¾è¡¨ã€å“ˆå¸Œæ¡¶ï¼‰</li><li>æ“ä½œç³»ç»Ÿå†…å­˜ç®¡ç†</li><li>å•ä¾‹æ¨¡å¼</li><li>å¤šçº¿ç¨‹</li><li>äº’æ–¥é”</li><li>â€¦</li></ul><h1>å†…å­˜æ± ç®€ä»‹</h1><h2 id="1ã€æ± åŒ–æŠ€æœ¯">1ã€æ± åŒ–æŠ€æœ¯</h2><blockquote><p>æ± åŒ–æŠ€æœ¯å°±æ˜¯ç¨‹åºå…ˆå‘ç³»ç»Ÿç”³è¯·è¿‡é‡çš„èµ„æºï¼Œç„¶åè‡ªå·±ç®¡ç†ï¼Œèƒ½å¤§å¤§æå‡ç¨‹åºçš„è¿è¡Œæ•ˆç‡</p></blockquote><p>å¸¸è§çš„æ± åŒ–æŠ€æœ¯åœºæ™¯</p><ul><li>å†…å­˜æ± </li><li>çº¿ç¨‹æ± </li><li>å¯¹è±¡æ± </li><li>â€¦</li></ul><h2 id="2ã€å†…å­˜æ± ">2ã€å†…å­˜æ± </h2><blockquote><p>å†…å­˜æ± æ˜¯æŒ‡ç¨‹åºé¢„å…ˆä»æ“ä½œç³»ç»Ÿç”³è¯·ä¸€å—è¶³å¤Ÿå¤§å†…å­˜ï¼Œæ­¤åï¼Œå½“ç¨‹åºä¸­éœ€è¦ç”³è¯·å†…å­˜çš„æ—¶å€™ï¼Œä¸æ˜¯ç›´æ¥å‘æ“ä½œç³»ç»Ÿç”³è¯·ï¼Œè€Œæ˜¯ç›´æ¥ä»å†…å­˜æ± ä¸­è·å–ï¼›åŒç†ï¼Œå½“ç¨‹åºé‡Šæ”¾å†…å­˜çš„æ—¶å€™ï¼Œå¹¶ä¸çœŸæ­£å°†å†…å­˜è¿”å›ç»™æ“ä½œç³»ç»Ÿï¼Œè€Œæ˜¯è¿”å›å†…å­˜æ± ã€‚å½“ç¨‹åºé€€å‡º(æˆ–è€…ç‰¹å®šæ—¶é—´)æ—¶ï¼Œå†…å­˜æ± æ‰å°†ä¹‹å‰ç”³è¯·çš„å†…å­˜çœŸæ­£é‡Šæ”¾ã€‚</p></blockquote><h2 id="3ã€å†…å­˜æ± è§£å†³çš„é—®é¢˜">3ã€å†…å­˜æ± è§£å†³çš„é—®é¢˜</h2><h3 id="å†…å­˜ç¢ç‰‡é—®é¢˜">å†…å­˜ç¢ç‰‡é—®é¢˜</h3><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301292200227.png" alt="å†…å­˜ç¢ç‰‡.png"></p><h3 id="æ•ˆç‡é—®é¢˜">æ•ˆç‡é—®é¢˜</h3><blockquote><p>å‘æ“ä½œç³»ç»Ÿé¢‘ç¹ç”³è¯·å†…å­˜æ¶ˆè€—è¾ƒå¤§ï¼Œå†…å­˜æ± èƒ½å¤Ÿé¿å…è®©ç¨‹åºé¢‘ç¹çš„å‘ç³»ç»Ÿç”³è¯·å’Œé‡Šæ”¾å†…å­˜</p></blockquote><h2 id="4ã€malloc">4ã€malloc</h2><blockquote><p>C/C++ä¸­åŠ¨æ€ç”³è¯·å†…å­˜éƒ½æ˜¯é€šè¿‡mallocå»ç”³è¯·å†…å­˜ï¼Œmallocæœ¬è´¨ä¹Ÿæ˜¯ä¸€ä¸ªå†…å­˜æ± ï¼ŒåŸç†å¦‚ä¸‹ï¼š</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301292206748.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›® </category>
          
          <category> é«˜å¹¶å‘å†…å­˜æ±  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¯¾ç¨‹æ¨è-ç†è´¢ç¯‡</title>
      <link href="/posts/953025558/"/>
      <url>/posts/953025558/</url>
      
        <content type="html"><![CDATA[<h2 id="Pythonæ•°æ®åˆ†æå®æˆ˜ï¼šæ„å»ºè‚¡ç¥¨é‡åŒ–äº¤æ˜“ç³»ç»Ÿ">Pythonæ•°æ®åˆ†æå®æˆ˜ï¼šæ„å»ºè‚¡ç¥¨é‡åŒ–äº¤æ˜“ç³»ç»Ÿ</h2><ul><li>æ·±å…¥ç†è§£é‡åŒ–äº¤æ˜“çš„æœ¬è´¨ã€å‘å±•ã€ä¼˜åŠ¿ã€æ„ä¹‰å’Œè¿‡ç¨‹ï¼›</li><li>æŒæ¡PythonåŸºç¡€å·¥å…·çš„ä½¿ç”¨æ–¹æ³•ï¼Œå¦‚Pythonã€Pandasã€Numpyã€Matplotlibã€TA-Libã€Tushareã€statsmodelsã€pyechartsç­‰ï¼›</li><li>æŒæ¡Pythonæ•°æ®åˆ†æå’ŒæŒ–æ˜çš„è¿‡ç¨‹å’ŒæŠ€èƒ½ï¼›</li><li>æŒæ¡Pythonå®ç°ç»å…¸é‡‘èæŠ€æœ¯æŒ‡æ ‡çš„æ–¹æ³•ï¼Œå¦‚Kçº¿ã€å‡çº¿ã€æˆäº¤é‡ã€MACDã€KDJç­‰ã€‚</li><li>æŒæ¡ä½¿ç”¨Matplotlibã€pyechartså¯è§†åŒ–æ–¹æ³•ç»˜åˆ¶å‡ºè‚¡ç¥¨è¡Œæƒ…åˆ†æç•Œé¢ä»¥æ•æ‰ä¸ªè‚¡åŠ¨å‘ï¼Œä¸ºå¤§å®¶å‘ˆç°ä¸åŒçš„æ˜¾ç¤ºæ•ˆæœã€‚</li><li>æŒæ¡Pythonå®ç°åº”ç”¨æ•°å­¦ä¸­ç»å…¸ç®—æ³•ï¼Œå¦‚çº¿æ€§å›å½’ã€è’™ç‰¹å¡æ´›ã€éšæœºæ¼«æ­¥ã€å‡¯åˆ©å…¬å¼ç­‰ï¼›</li><li>æŒæ¡å¦‚ä½•ä»æ•°æ®ç‰¹å¾å€¼ä¸­å®ç°å¸¸ç”¨çš„é‡åŒ–äº¤æ˜“ç­–ç•¥ï¼Œå¦‚æ‹©æ—¶ã€é€‰è‚¡ã€é£é™©æ§åˆ¶ã€åº¦é‡ã€ä»“ä½ç®¡ç†ç­‰ã€‚é€šè¿‡å­¦ä¹ æˆ‘ä»¬å¯ä»¥åˆ¶å®šé‡åŒ–äº¤æ˜“ç­–ç•¥ä»¥åŠåº¦é‡ç­–ç•¥æ•ˆæœï¼Œåº”ç”¨äº¤æ˜“ç­–ç•¥æ¥è¾…åŠ©è‚¡ç¥¨äº¤æ˜“ã€‚</li></ul><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301281429616.jpg" alt="D90C09628F49A26EBEF4BB6308B6BE05.jpg"></p>]]></content>
      
      
      <categories>
          
          <category> æ¨è </category>
          
          <category> è¯¾ç¨‹ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>è¯¾ç¨‹æ¨è-åç«¯ç¯‡</title>
      <link href="/posts/3294300332/"/>
      <url>/posts/3294300332/</url>
      
        <content type="html"><![CDATA[<h2 id="è¯¾ç¨‹1-MySQL-æ€§èƒ½è°ƒä¼˜å¿…çŸ¥å¿…ä¼š">è¯¾ç¨‹1 - MySQL æ€§èƒ½è°ƒä¼˜å¿…çŸ¥å¿…ä¼š</h2><ul><li>æ•°æ®æ¶æ„æ–¹é¢ï¼šä¸»è¦è®²è¿° MySQL ä¸»ä»æ¶æ„ä¹‹é—´å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼Œä»¥åŠä¸»ä»æ¶æ„å¦‚ä½•æé«˜ç¨³å®šæ€§ã€‚</li><li>å­˜å‚¨å¼•æ“æ–¹é¢ï¼šä¸»è¦è®²è¿° MySQL æ•°æ®åº“ä¸­çš„ InnoDB å­˜å‚¨å¼•æ“çš„åº•å±‚è¿è¡ŒåŸç†ä»¥åŠ InnoDB å­˜å‚¨å¼•æ“çš„ä¼˜åŒ–ã€‚</li><li>SQL æ–¹é¢ï¼šä¸»è¦è®²è¿° SQL çš„å®ç°åŸç†ï¼Œä¾‹å¦‚ï¼Œorder byï¼ˆæ’åºï¼‰çš„å®ç°åŸç†åŠä¼˜åŒ–ã€joinï¼ˆè¿è¡¨ï¼‰çš„å®ç°åŸç†åŠä¼˜åŒ–ç­‰ï¼Œæ›´æœ‰ä¸€æ¡ SQL ä»æ‰§è¡Œçš„å¼€å§‹åˆ°ç»“æŸéƒ½ç»å†è¿‡å“ªäº›æ¨¡å—ï¼Œåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¼˜åŒ–çš„æœ€ä½³å®è·µç­‰ã€‚</li><li>MySQL æ•°æ®å®‰å…¨ï¼šä¸»è¦è®²è¿°åœ¨ MySQL æ•°æ®åº“ä¸­å¦‚ä½•é˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œä»¥åŠæ•°æ®åº“ä¸­å„ç§æ—¥å¿—çš„ä½œç”¨ã€‚</li></ul><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301281428630.jpg" alt="11E0A633507956E663577A8E64791E6D.jpg"></p><h2 id="è¯¾ç¨‹2-Python-å¼‚æ­¥ç½‘ç»œç¼–ç¨‹å®æˆ˜">è¯¾ç¨‹2 - Python å¼‚æ­¥ç½‘ç»œç¼–ç¨‹å®æˆ˜</h2><ul><li>ä»äº‹ Python Web å¼€å‘çš„æŠ€æœ¯äººå‘˜</li><li>å¯¹ Python æ„Ÿå…´è¶£ï¼Œæƒ³äº†è§£ Python å¼‚æ­¥å®ç°è¿‡ç¨‹</li><li>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæƒ³ä½¿ç”¨å¼‚æ­¥æ–¹å¼æå‡ Python æ€§èƒ½çš„å¼€å‘è€…</li></ul><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301281428056.jpg" alt="E6D29224C353AC28FC76ABD734A8C32C.jpg"></p><h2 id="è¯¾ç¨‹3-æ·±å…¥ç†è§£-TCP-åè®®ï¼šä»åŸç†åˆ°å®æˆ˜">è¯¾ç¨‹3 - æ·±å…¥ç†è§£ TCP åè®®ï¼šä»åŸç†åˆ°å®æˆ˜</h2><ul><li>å­¦ä¹  TCP åè®®å¤šæ¬¡ä»å…¥é—¨åˆ°æ”¾å¼ƒçš„åŒå­¦</li><li>æƒ³é€šè¿‡å®éªŒæ–¹æ³•å­¦ä¹  TCP åè®®çš„åŒå­¦</li><li>å¯¹äºå‰ç«¯å·¥ç¨‹å¸ˆï¼Œå­¦å®Œå¯ä»¥å¿«é€Ÿè¾¨è¯†å¼€å‘ä¸­é‡åˆ°çš„é—®é¢˜æ˜¯å‰ç«¯è¿˜æ˜¯åç«¯çš„é—®é¢˜ï¼Œå¯¹é¡µé¢æ€§èƒ½ä¼˜åŒ–æœ‰æ›´æ·±çš„ç†è§£</li><li>å¯¹äºåç«¯å·¥ç¨‹å¸ˆï¼ŒTCP åè®®å¯ä»¥è¯´æ˜¯å¿…é¡»è¦æŒæ¡çš„æŠ€èƒ½ï¼Œå­¦å®Œèƒ½ä»åè®®å’Œç½‘ç»œå±‚é¢å¿«é€Ÿåˆ†æåç«¯è¯¸å¤šåˆ†å¸ƒå¼ç»„ä»¶çš„é—®é¢˜ï¼Œå¯¹æå‡æ¥å£çš„æ€§èƒ½å’Œåˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯é æ€§ä¼šæ›´æœ‰æŠŠæ¡</li><li>å¯¹äºæµ‹è¯•å·¥ç¨‹å¸ˆï¼Œå¯¹ç½‘ç»œåè®®ç†è§£çš„è¶Šæ·±ï¼Œè¶Šèƒ½å‘ç°éšè—å¾ˆæ·±çš„ Bugï¼Œå¯¹æ€§èƒ½æµ‹è¯•ã€å‹åŠ›æµ‹è¯•ä¼šæœ‰æ›´æ·±çš„ç†è§£</li></ul><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301281428061.jpg" alt="0F0CD1421DF22FE9CFBA9E317E9E2B45.jpg"></p><h2 id="è¯¾ç¨‹4-å¼€å‘è€…å¿…å¤‡çš„-Docker-å®è·µæŒ‡å—">è¯¾ç¨‹4 - å¼€å‘è€…å¿…å¤‡çš„ Docker å®è·µæŒ‡å—</h2><ul><li>è™šæ‹ŸåŒ–æŠ€æœ¯ã€å®¹å™¨æŠ€æœ¯å’Œ Docker çš„èƒŒæ™¯</li><li>Docker è¿è¡Œç¯å¢ƒçš„æ­å»º</li><li>é•œåƒä¸å®¹å™¨çš„ç®¡ç†ä¸ä½¿ç”¨</li><li>è‡ªå®šä¹‰é•œåƒå’Œå…±äº«é•œåƒ</li><li>é€šè¿‡ Compose ç¼–æ’åº”ç”¨</li><li>å¤šä¸ªä½¿ç”¨ Docker æ­å»ºè¿è¡Œç¯å¢ƒçš„å®è·µ</li></ul><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301281429087.jpg" alt="35C46EF4C2C8A41F16DC9C43DE6CA8B6.jpg"></p>]]></content>
      
      
      <categories>
          
          <category> æ¨è </category>
          
          <category> è¯¾ç¨‹ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>è¯¾ç¨‹æ¨è-å·¥å…·ç¯‡</title>
      <link href="/posts/1556496795/"/>
      <url>/posts/1556496795/</url>
      
        <content type="html"><![CDATA[<h2 id="Git">Git</h2><blockquote><p>éšç€è¿™å‡ å¹´ GitHub çš„æµè¡Œï¼ŒGit å·²ç»æ˜¯ä¸€ä¸ªç¨‹åºå‘˜é€ƒä¸è¿‡çš„æŠ€æœ¯é¡¹ï¼Œä½†å¾ˆå¤šäººå´çº·çº·å€’åœ¨äº†å­¦ä¹ å®ƒçš„è·¯ä¸Šã€‚è€Œä¸”ï¼Œå‡ºäºå·¥ä½œåŸå› è€Œä¸å¾—ä¸ç”¨ Git çš„äººï¼Œæœ‰ä¸å°‘åœ¨å·¥ä½œä¸­å¯¹ Git ä¹Ÿæ˜¯èƒ½ä¸ç”¨å°±ä¸ç”¨ï¼Œç”Ÿæ€•å“ªä¸ªå‘½ä»¤ç”¨é”™å°±æŠŠå…¬å¸çš„ä»£ç åº“æ¯æ‰äº†ğŸ™ˆã€‚è€Œé‚£äº›å¯¹ Git æŒæ¡å¾—æ¯”è¾ƒå¥½çš„å°‘æ•°äººï¼Œå°±åƒå›¢é˜Ÿä¸­çš„ç¥ä¸€æ ·ï¼Œåœ¨åŒäº‹é‡åˆ° Git ç›¸å…³çš„é—®é¢˜çš„æ—¶å€™ç”¨å„ç§é£éªšæ“ä½œæ¥æ‹¯æ•‘é˜Ÿå‹äºæ°´ç«ã€‚</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301281415936.jpg" alt="E1AEE84870D5BE5C2DA57BDF00F1C3D8.jpg"></p><h2 id="Nvim">Nvim</h2><ul><li>é€‚åˆæœ‰ä¸€ç‚¹ VIM åŸºç¡€çš„ä½¿ç”¨è€…ï¼ˆè‡³å°‘çŸ¥é“æ€ä¹ˆç¼–è¾‘æ–‡ä»¶å’Œé€€å‡º VIM ğŸ˜ï¼‰ã€‚</li><li>æœ‰ç¨‹åºå¼€å‘åŸºç¡€ï¼Œæœ‰å¯ä»¥è®¿é—® Github çš„ç½‘ç»œç¯å¢ƒï¼Œæƒ³è¦æå‡å¼€å‘æ•ˆç‡ä¸å¼€å‘ä½“éªŒçš„ç¨‹åºå¼€å‘äººå‘˜ã€‚</li><li>æƒ³è¦ç³»ç»Ÿå­¦ä¹  Neovim é…ç½®ï¼Œå´è¢«ç½‘ä¸Šé›¶æ•£è¿‡æ—¶çš„ VIM é…ç½®æ•™ç¨‹å›°æ‰°çš„åŒå­¦ä»¬ã€‚</li></ul><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301281416032.jpg" alt="01893C4AF74549C45EEC1A4DC4D77019.jpg"></p>]]></content>
      
      
      <categories>
          
          <category> æ¨è </category>
          
          <category> è¯¾ç¨‹ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>è¿™é‡Œæœ‰ä¸ªå½©è›‹å“¦</title>
      <link href="/posts/3396067387/"/>
      <url>/posts/3396067387/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰, è¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹, è¯·å†è¯•è¯•." data-whm="æŠ±æ­‰, è¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«æ ¡éªŒ, ä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹.">  <script id="hbeData" type="hbeData" data-hmacdigest="bdcf00d57de64824eb8c2090af0b3a041ff223bd737c2570bea95d28baef4c82">30be79645dddaee9803da55d5222e25b3b8286b1b1b642cba5ff858bd643142d801475a84ef4fcddda705ade8184eaabecb154b558500d3d28a368d3cb64d1b923ee8ced777f1754eb52d3dfe352ea26bf0e18ea5ebe9158885c55566d98395a8536e8015ae1ca61e32428de6fafdf589580353eb27fd401cd2e3071a1b462d378979df0b133e952f82a5d9cde81f2866c3fae1d022292234d6c7e94322e5e5134e132e2a208e3b8554036facc4c5ee24d5f40534cd1244a808eb33d2a4acefb3cf023952a1574f83966da4367fd70d340e2a6366f4b336738bb241b33834814da91779c9ef5110b23d5774eb9591209191c498846ac99ab57510509c659fa9ed86883f042e7b2967d7f1d666bee11af150c9f8f57702038a883fbcbb1fa2a58b1019f23ade742ccbb2403007d212455d64263fd296c3d899af37b25d7bcc92bd2d51a6b000768e851a5fb951d6f383d7d9aa5db13c188641b087b7e7729b5940d3519fef01cdb83c998d122b70d615ffa29587f05c42ac735f744001d734b7bc44d92011c8e232a9e8b748b7f385aa9852f91e3516a68f2860d59ea8a64f0894d0ac43e5a770e3080e8706e4544c426abe27cb76b06c3dc85a1bcf85a8de5e0675a245576b6bdfe1ce42a27ce5a13a5252e7847bd683fb141f7b202e260a1ebd56c79dbf20a89bae4bcae246f23bcf42872ce749b9188190f2e24ca17fae818cbf59ee489aadfc7350fbbecb3f04e8ba323b00a738286e2bdc36f050e1c4b24b87c089937fbefe0dd6644bffae252ef13ab68e74cc0a0a3f50dffae023865559cc510bcc65b0697fe3f89529230c79a8e5ffb497bff94c25bdb6b0b9fba02f990daac672f647eede2167e00088cd1c0f9d0739f2928d2ba291f94c938b84f654a6958f13a27011cec14090d50eccef160a289eab140652a8f11f587f89627c35b93c6e3ac9b3a6b2869fa3af35664f7969617029eea6ae946ca13a116ad0478377a7fb32721afd3e4e822c7bf7e7737b4605a898ac0f2f350c250590f4dc1489dedb4200028d70432cfb96b16ee8268130c074a43ebc5ea4661a2fa4aae3bcf6425f82c2abb09007c6bd621870dcf8964d820898e6dbd7f4bb5ed8821d4d9a63ab0a797dffe1c707e051383436039b1da540da0d317f563323c9fac93c66ef9b5f7a1a3bdffdab3bd2cb111355e33d2b361db900961eab7b6da7c502d4b3506c551f4fb0a5f2029bcd885e597de54be3f0681486dd133ba0324c82bb972d60968d8863128da6ee46bc3b4fa88493550f9618f9f9118ebf33ce820a675dcbb59aa5dd58f83ff8f006d97fd00627a196c79add9c0d8cb4a46c082a75d3b3dd1bb2f0cccfef06604bbcda612116059c7efbdb81b65a7c258501cc9ed39376b3662c28a51e1b9a8768fd06a51b22669ad6c34aaa73851d851677e5423dfcd5166f893cb644ab51659b96667b75ba057fe069b739a6116e78cc9fa2c02b6f4cb3ea4901827d55e47667cf0e2b841daabe1938787a84c78d3c9ce982af690289cdbd7c43aeb026cb7c3fb7d75437152baa2e8b6d8ecc933ee5275ccda87a48e93ed3fac40afb52bdbb5cf0ae9ece1ff7898c0a910a41bb8622f79e379453c3322312e0951e4d95da800436954738d0efbd2007e2c966a3f6009899757d7cf6d350ad93e94233413fc3b2e38778d22a0854098bfb207e173d2c34a4b340e511730c5ed54a154c5e76e0f3a42304ff2a2de4b7f7fd5432570ecf759496ff5d6a8f350fd7f359a8a2db0f63713021f92a142d96522e4daf3071857c2d941c7ec49e4dff8117d97a01c44584e28cde21172b020c2b2d347ebf581f1b77fd37f8a0614b473538b95ebe76304907ddd98ae6044ab070629ab8c7a4857a14fde17e8140bb71c656f06f6b722732fc95da78aea669246e16766889bf1a922d051b011e250c72845f7fcb04ccb8b4f549e9663d7c033611b8d031878f2047a6918ccc5852794d755d0a54952241b85627614b3dce1d42f05eb77a9d7cc429d42b1151ebf8d419ae4ef14bf67dda558c049b34fc6a239eb31478127fcfcaa29013b305ffd199f5e76ae40d35cf066d6f3a1d9c2e8e0565c316ca811220e434fcde08eec9ee87de6cada9f10f70cbafa2460cdb360f4a5e76591f66eeccd120a9fb57b600119a9d1a7564bbb649e9dbfb326f4fb72618522d8dddbd1f35df73e7a876a5bc62967a1fea6dbfe2de23ca33b98457d6a09630549597ebd3aff0d7fb4b7b2ff4da26ced95ba32b9e0ef33fb9c6c16b310bed800725e27d2bbd19798f40fff3d758f6a88ef30ef42e12985aeb3413f816732e926909efc80afb186b8feb1311412eb06d97a5f635942e163ac6353879791d0dedac522d3c8be31c04dc7479738a976008f5f37e54a1e26673ee3c5109b8401c271bc29408d5656c16333deac92dd9931beedd37f92a93c97b969a8682d5d0992c7e1e089ad88b4dbcacf04cecf9bc2086f221198f8ce04004eaa0c4162c18c7725c03165d8f9851c28f4e40994bacf2eeb59597d1c71d39acff41e4b25ef029b8c02349b4de4a6865d08aaf9de1e85e48c55d4f41abe0a7421ce123e5d8a8d20eaf186c35a438af5c3a629e0cfe66dc1cbb256919107abc877d350420185f5d8e991974ffbc9cf219a40d583351f11a9f012fcce1b16f146597e450f14c02c5a328f1c00d43a6a35d99a68e9e10e22d0b4ee11f4a831a66aa2f55cfd276ffec6de1a2a4d0f0f999aeae9173e3f47c791b7da673c64fc498a62ea66aa92781f313a7ed3d8910e7ef5403fbba2246e5bb6a9d92b6e6a0b3a989284ba228530f1f66d4ea91edd052be20db783f43397af9931d4d4a2872b03169cfcbb366975f18051d133e87b03ef0d759c7f55c9533a115cb062107e111de3110c49cf37fe6db2f1</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">å¾®ä¿¡å…¬ä¼—å·â€œå­™èœèœâ€å›å¤å…³é”®è¯ã€å½©è›‹ã€‘è·å¾—å¯†ç .</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
          <category> å…¶ä»– </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•æœ€å¿«çš„æ‰“é€ ä¸€ä¸ªå¸…æ°”å¥½çœ‹å¯ä»¥è£…é€¼çš„githubä¸»é¡µå‘¢ï¼Ÿ</title>
      <link href="/posts/2286645816/"/>
      <url>/posts/2286645816/</url>
      
        <content type="html"><![CDATA[<p><strong>å…ˆè¯´ç»“è®ºï¼šæŠ„åˆ«äººå¥½çœ‹çš„ä¸»é¡µ</strong></p><blockquote><p>PSï¼šè‡ªå·±å»æå¾—è¯ï¼Œå¹¶ä¸ä¸€å®šå¥½å¼„ï¼Œè€Œä¸”ä¸å¦‚äººå®¶çš„å¥½çœ‹ï¼Œå½“ç„¶æˆ‘ä¹Ÿåœ¨åè¾¹æ”¾äº†å‡ ä¸ªå°ç½‘ç«™ï¼Œæƒ³è‡ªå·±ä¸°å¯Œçš„å¯ä»¥å»çœ‹çœ‹ã€‚</p></blockquote><h2 id="å¥½çœ‹ä¸»é¡µæ¨è">å¥½çœ‹ä¸»é¡µæ¨è</h2><blockquote><p>è¿™è¾¹æ¨èå››ä¸ªä¸»é¡µï¼Œåè¾¹ä¼šè¯´å¤åˆ¶ä¸»é¡µçš„æ–¹æ³•ï¼Œgithubçš„ä¸»é¡µæ˜¯éœ€è¦å»ºç«‹ä¸€ä¸ªä¸githubçš„IDåŒåçš„ä»“åº“çš„ï¼Œç„¶åé‡Œé¢æ”¾README.mdçš„æ–‡æ¡£ï¼Œè¿™ä¸ªæ–‡æ¡£å†…å®¹å°±ä¼šè¢«å±•ç¤ºåˆ°ä¸»é¡µã€‚</p></blockquote><p><a href="https://github.com/blinkfox">blinkfox (é—ªçƒä¹‹ç‹ (blinkfox)) (github.com)</a></p><p>æ¨èæŒ‡æ•°ï¼šâ­â­â­â­</p><p>å¥½çœ‹æŒ‡æ•°ï¼šâ­â­</p><p>å¤åˆ¶éš¾æ˜“ï¼šâ­â­</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301210027622.png" alt=""></p><p><a href="https://github.com/L1cardo">L1cardo (Licardo) (github.com)</a></p><p>æ¨èæŒ‡æ•°ï¼šâ­â­â­â­â­</p><p>å¥½çœ‹æŒ‡æ•°ï¼šâ­â­â­â­</p><p>å¤åˆ¶éš¾æ˜“ï¼šâ­â­â­â­</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301210034952.png" alt=""></p><p><a href="https://github.com/appotry">appotry (å¤œæ³•ä¹‹ä¹¦(appotry)) (github.com)</a></p><p>æ¨èæŒ‡æ•°ï¼šâ­â­</p><p>å¥½çœ‹æŒ‡æ•°ï¼šâ­â­â­</p><p>å¤åˆ¶éš¾æ˜“ï¼šâ­â­â­â­</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301210041636.png" alt=""></p><p><a href="https://github.com/atongrun">atongrun (å­™èœèœ) (github.com)</a></p><p>æ¨èæŒ‡æ•°ï¼šâ­â­â­</p><p>å¥½çœ‹æŒ‡æ•°ï¼šâ­â­</p><p>å¤åˆ¶éš¾æ˜“ï¼šâ­â­</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301210049534.png" alt=""></p><blockquote><p>å‰ä¸‰ä¸ªæ˜¯å¤§ä½¬çš„ï¼Œæœ€åä¸€ä¸ªæ˜¯æˆ‘çš„ï¼Œæˆ‘æ˜¯æŠ„çš„å¤§ä½¬çš„ï¼Œè¿™é‡Œå°±æ²¡å¿…è¦æ”¾å¤ªå¤šäº†ï¼Œå› ä¸ºå¤§å·®ä¸å·®ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±æ‰“å¼€githubä¸»é¡µä¸‹è½½æ–‡æ¡£ï¼Œå½“ç„¶æ–¹ä¾¿ç‚¹ä¹Ÿå¯ä»¥å…³æ³¨æˆ‘çš„å…¬ä¼—å·ã€å­™èœèœã€‘ï¼Œå›å¤ã€å¸…æ°”ä¸»é¡µã€‘ï¼Œè·å–æºæ–‡ä»¶ã€‚</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301210119032.png" alt=""></p><h2 id="å¦‚ä½•å¤åˆ¶">å¦‚ä½•å¤åˆ¶</h2><h3 id="æ­¥éª¤1ã€å»ºç«‹åŒåä»“åº“">æ­¥éª¤1ã€å»ºç«‹åŒåä»“åº“</h3><p>åœ¨githubä¸Šå»ºç«‹ä¸€ä¸ªåŒåçš„ä»“åº“ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´ï¼Œçœ‹ä¸»é¡µç¾åŒ–çš„å¤§å®¶åº”è¯¥éƒ½ä¼šçš„ï¼Œç„¶åå¯¹README.mdæ–‡æ¡£æ“ä½œå°±OKäº†</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301211357638.png" alt=""></p><h2 id="æ­¥éª¤2ã€Copyå¤§æ³•">æ­¥éª¤2ã€Copyå¤§æ³•</h2><blockquote><p>å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼Œè®°å¾—ä¸€å®šç”¨markdownç¼–è¾‘å™¨å¼„æœ€å¥½ï¼Œå®¹æ˜“æ˜¾ç¤ºå‡ºå®æ—¶çš„æ•ˆæœï¼Œå¯ä»¥æŒ‰ç…§è‡ªå·±çš„å–œæ¬¢é…Œæƒ…åˆ å‡å“¦ï¼Œæˆ–è€…å‡ ä¸ªæ–‡æ¡£æ··åˆcopy</p></blockquote><ul><li>æ‰“å¼€å››ä¸ªæ–‡ä»¶å¤¹çš„ä»»ä½•ä¸€ä¸ªï¼ˆä½ å–œæ¬¢çš„ï¼‰</li><li>å°†æ‰€æœ‰å†…å®¹æ”¾åˆ°ä½ æœ¬åœ°ä»“åº“</li><li>æ‰“å¼€README.mdæ–‡æ¡£ï¼Œå°†é‡Œé¢çš„githubç”¨æˆ·åæ¢æˆè‡ªå·±çš„</li><li>å°†å„ç§é“¾æ¥æ¢æˆè‡ªå·±çš„</li><li>git add -&gt; git commit -&gt; git push å¤§åŠŸå‘Šæˆ</li></ul><blockquote><p>å½“ç„¶ï¼Œå¦‚æœå¤§å®¶å«Œéº»çƒ¦æ€•æ”¹é“¾æ¥åé”™è¯¯å•¥çš„è¯ï¼ŒåŒæ ·å…³æ³¨ã€å­™èœèœã€‘å…¬ä¼—å·ï¼Œå›å¤ã€å¸…æ°”ä¸»é¡µã€‘ï¼Œè·å–æºæ–‡ä»¶ã€‚é‡Œé¢æˆ‘è¿˜æ”¾äº†ä¸ªè¯¦ç»†çš„è¯´æ˜ï¼Œä»¥æˆ‘çš„githubä¸»é¡µä¸ºä¾‹å­ï¼Œæ”¾åˆ°wordé‡Œé¢äº†ï¼Œå°†æ‰€æœ‰éœ€è¦ä¿®æ”¹çš„åœ°æ–¹éƒ½åŠ ä¸Šäº†é«˜äº®å’Œæ³¨é‡Šã€‚</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301211354492.png" alt=""></p><blockquote><p>æ¬¢è¿å…³æ³¨å“¦ã€‚</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301211358151.gif" alt=""></p><h2 id="ç½‘ç«™æ¨è">ç½‘ç«™æ¨è</h2><blockquote><p>å¦‚æœå¤§å®¶éå¾—è¯´ä¸å–œæ¬¢ç›´æ¥copyåˆ«äººçš„ï¼Œé‚£ä¹ˆä½ å°±å¯ä»¥çœ‹çœ‹ä¸‹é¢å‡ ä¸ªç½‘ç«™äº†ï¼Œè¿™ä¸‹è¾¹æ˜¯æˆ‘è§‰å¾—æœ€å¸¸è§çš„githubä¸»é¡µçš„å‡ ä¸ªéƒ¨ä»¶äº†ï¼Œå¦‚æœä½ è¦é…çš„æ¯”è¾ƒå¥½çœ‹çš„è¯ï¼Œå¯èƒ½è¿˜éœ€è¦æ‡‚ä¸€ç‚¹HTMLè¯­è¨€å“¦</p></blockquote><p><a href="https://www.webfx.com/tools/emoji-cheat-sheet/">å„ç§è¡¨æƒ…</a></p><blockquote><p>åœ¨è¿™é‡Œæœ‰è®¸å¤š emoji çš„ç¬¦å·ä»£ç ï¼Œä½ å¯ä»¥ç›´æ¥å°†å®ƒä»¬ç”¨åˆ° README ä¸­ã€‚</p></blockquote><p>å®ç”¨æŒ‡æ•°ï¼šâ­â­â­</p><p><a href="https://github.com/anuraghazra/github-readme-stats/blob/master/docs/readme_cn.md">ç»Ÿè®¡å¡ç‰‡</a></p><blockquote><p>è¿™ä¸ªå°±æ˜¯githubä¸»é¡µæœ€å¸¸è§çš„å°éƒ¨ä»¶äº†</p></blockquote><p>å®ç”¨æŒ‡æ•°ï¼šâ­â­â­â­</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301210105140.png" alt=""></p><p><a href="https://shields.io/">ä¸°å¯Œæ ‡ç­¾</a></p><blockquote><p>æ— è®ºæ˜¯é¡¹ç›®è¿˜æ˜¯githubä¸»é¡µå‡ºç°é¢‘ç‡è¶…é«˜çš„å°æ ‡ç­¾ï¼Œéå¸¸çš„å®ç”¨ã€‚</p></blockquote><p>å®ç”¨æŒ‡æ•°ï¼šâ­â­â­â­â­</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301210106308.png" alt=""></p><p><a href="https://github.com/ryo-ma/github-profile-trophy/blob/master/README.md">å„ç§å¥–æ¯</a></p><blockquote><p>è¿™ä¸ªä¹Ÿæ˜¯å’Œå¡ç‰‡å·®ä¸å¤šçš„ç»Ÿè®¡ç›¸å…³çš„å°éƒ¨ä»¶ï¼Œå‡ºç°é¢‘ç‡ä¹ŸæŒºé«˜</p></blockquote><p>å®ç”¨æŒ‡æ•°ï¼šâ­â­â­</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301211413651.png" alt=""></p><h2 id="æ€»ç»“">æ€»ç»“</h2><p>æœ‰ä¸€ä¸ªå¥½çœ‹çš„githubä¸»é¡µæŒºå¥½ç©ä¸»è¦çš„å¯ä»¥è£…é€¼ï¼Œå¸Œæœ›å¤§å®¶éƒ½èƒ½æä¸€ä¸ªä»¤è‡ªå·±æ»¡æ„çš„ä¸»é¡µã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
          <category> github </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç™½å«–é›¶èŠ±é’±</title>
      <link href="/posts/2137780596/"/>
      <url>/posts/2137780596/</url>
      
        <content type="html"><![CDATA[<h2 id="1ã€å¾®ä¿¡æ‰«ç ">1ã€å¾®ä¿¡æ‰«ç </h2><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301191345034.jpg" alt=""></p><h2 id="2ã€æœç´¢å…³é”®è¯">2ã€æœç´¢å…³é”®è¯</h2><p>è¿›å»æœç´¢ä»¥ä¸‹å…³é”®è¯ï¼Œé€‰æ‹©ä»·æ ¼æœ€é«˜åšå³å¯ï¼ŒåŸºæœ¬ä¸Š3åˆ†é’Ÿå·¦å³å°±Okäº†</p><blockquote><p>ä¸‹é¢éƒ½æ˜¯æˆ‘è‡ªå·±åšè¿‡çš„ã€‚</p><p>ä¸»è¦æ˜¯æ—¶é—´çŸ­ã€ä»·æ ¼é«˜ï¼Œå½“ç„¶è¿˜æœ‰å¾ˆå¤šï¼Œå¤§å®¶å¯ä»¥è‡ªå·±æ‰¾æ‰¾ã€‚</p><p>è¿«äºæ‡’çš„åŸå› ï¼Œæ²¡æ‰¾å¤šå°‘ï¼Œéƒ½æ˜¯æƒ³æ”¹å–„ä¸€ä¸‹è‡ªå·±çš„ç”Ÿæ´»çš„æ—¶å€™ï¼Œæ‰åšçš„</p></blockquote><table><thead><tr><th style="text-align:center">åºå·</th><th style="text-align:center">åç§°</th><th style="text-align:center">ä»·æ ¼</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">å‡¹éŸ³çŸ­è§†é¢‘</td><td style="text-align:center">7+</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">äº‘é—ªä»˜</td><td style="text-align:center">15+</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">å°æ‹›æ¨å®¢</td><td style="text-align:center">10+</td></tr><tr><td style="text-align:center">4</td><td style="text-align:center">å¿«æ­¥</td><td style="text-align:center">5+</td></tr><tr><td style="text-align:center">5</td><td style="text-align:center">äº‘ç¼´è´¹</td><td style="text-align:center">5+</td></tr><tr><td style="text-align:center">6</td><td style="text-align:center">æ˜Ÿäº‘è§†ç•Œ</td><td style="text-align:center">4+</td></tr><tr><td style="text-align:center">7</td><td style="text-align:center">é¦™è•‰ä¹ç©</td><td style="text-align:center">12+</td></tr><tr><td style="text-align:center">8</td><td style="text-align:center">æ¸¸æ˜“èµš</td><td style="text-align:center">10+</td></tr><tr><td style="text-align:center">9</td><td style="text-align:center">è±†è±†è¶£ç©</td><td style="text-align:center">7+</td></tr><tr><td style="text-align:center">10</td><td style="text-align:center">è¾…åŠ©æ³¨å†Œ</td><td style="text-align:center">8+</td></tr><tr><td style="text-align:center">11</td><td style="text-align:center">å“”å“©å“”å“©</td><td style="text-align:center">5+</td></tr><tr><td style="text-align:center">12</td><td style="text-align:center">btd</td><td style="text-align:center">11+</td></tr><tr><td style="text-align:center">13</td><td style="text-align:center">æ·˜å®ç‰¹ä»·ç‰ˆ</td><td style="text-align:center">7+</td></tr><tr><td style="text-align:center">14</td><td style="text-align:center">äº¬ä¸œç™½æ¡</td><td style="text-align:center">20+</td></tr><tr><td style="text-align:center">15</td><td style="text-align:center">å†²é¡¶é¸­</td><td style="text-align:center">10+</td></tr><tr><td style="text-align:center">16</td><td style="text-align:center">ä¸€æ·˜</td><td style="text-align:center">5+</td></tr><tr><td style="text-align:center">17</td><td style="text-align:center">æ¢¨æ¼©</td><td style="text-align:center">7+</td></tr><tr><td style="text-align:center">18</td><td style="text-align:center">äº¬ä¸œæé€Ÿç‰ˆ</td><td style="text-align:center">6+</td></tr><tr><td style="text-align:center">19</td><td style="text-align:center">èšè·‘</td><td style="text-align:center">6+</td></tr><tr><td style="text-align:center">20</td><td style="text-align:center">èŒçŠ¬ä¸–ç•Œ</td><td style="text-align:center">12+</td></tr><tr><td style="text-align:center">21</td><td style="text-align:center">AITD</td><td style="text-align:center">10+</td></tr><tr><td style="text-align:center">22</td><td style="text-align:center">å°èš‚èš</td><td style="text-align:center">7+</td></tr><tr><td style="text-align:center">23</td><td style="text-align:center">é™Œå—¨çŸ­è§†é¢‘</td><td style="text-align:center">8+</td></tr><tr><td style="text-align:center">24</td><td style="text-align:center">æœªå®Œ</td><td style="text-align:center">å¾…æ›´æ–°ã€‚ã€‚ã€‚</td></tr></tbody></table><p><strong>Psï¼šä¹Ÿå¯ä»¥çœ‹ç½‘é¡µç‰ˆçš„ï¼Œç‚¹å‡»é˜…è¯»åŸæ–‡å³å¯ï¼Œç½‘é¡µç‰ˆçš„æ›´æ–°å¿«ä¸€ç‚¹ã€‚åªåšç®€å•çš„ï¼Œå‹¿è¢«æ ‡é¢˜è¿·æƒ‘ï¼Œæäº¤æˆªå›¾è¶…è¿‡2ä¸ªçš„ï¼Œç›´æ¥æ”¾å¼ƒå³å¯ï¼Œå› ä¸ºå¤ªç¹çäº†</strong></p>]]></content>
      
      
      <categories>
          
          <category> æ¨è </category>
          
          <category> ä¸šä½™ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>C++çš„IOæµ</title>
      <link href="/posts/3964554901/"/>
      <url>/posts/3964554901/</url>
      
        <content type="html"><![CDATA[<h2 id="C-IOä½“ç³»">C++IOä½“ç³»</h2><blockquote><p>ostream/istream æ›´å¥½çš„æ”¯æŒè‡ªå®šä¹‰ç±»å‹å¯¹è±¡çš„æµæ’å…¥å’Œæµæå–ï¼Œè‡ªå®šä¹‰ç±»å‹ï¼Œå¯ä»¥è‡ªå·±é‡è½½ï¼Œæ§åˆ¶æµæå–å’Œæµæ’å…¥çš„æ–¹å¼</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301151704396.png" alt=""></p><h2 id="è¾“å…¥è¾“å‡º">è¾“å…¥è¾“å‡º</h2><h3 id="cè¾“å…¥">cè¾“å…¥</h3><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301151712088.png" alt=""></p><h3 id="c-è¾“å…¥">c++è¾“å…¥</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cin &gt;&gt; str;</span><br><span class="line"></span><br><span class="line">year = <span class="built_in">stoi</span>(str.<span class="built_in">substr</span>(<span class="number">0</span>, <span class="number">4</span>));</span><br><span class="line">mon = <span class="built_in">stoi</span>(str.<span class="built_in">substr</span>(<span class="number">4</span>, <span class="number">2</span>));</span><br><span class="line">day = <span class="built_in">stoi</span>(str.<span class="built_in">substr</span>(<span class="number">6</span>, <span class="number">2</span>));</span><br></pre></td></tr></table></figure><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301151724063.png" alt=""></p><p>ctrl+z+æ¢è¡Œç»“æŸè¾“å…¥</p><blockquote><p>ä¸ºä»€ä¹ˆå¯ä»¥ç”¨ä¸Šè¾¹å¾ªç¯çš„å†™æ³•å‘¢ï¼Ÿæ˜¯å› ä¸ºcinçš„å¯¹è±¡å¯ä»¥éšå¼ç±»å‹è½¬æ¢æˆboolï¼ˆè°ƒç”¨operator boolï¼‰ï¼Œåœ¨æµé‡Œé¢è¯»åˆ°é”™è¯¯æˆ–è€…ç»“æŸæ ‡å¿—çš„æ—¶å€™ï¼Œä¼šè¿”å›false</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301151732425.png" alt=""></p><p>ä¸¾ä¾‹è¯¦è§£ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">A</span>(<span class="type">int</span> a)  <span class="comment">//è¿™é‡Œå‰è¾¹åŠ ä¸Šexplictï¼Œä¸‹è¾¹ A aa1 = 1 ä»£ç å°±ç¼–ä¸è¿‡å»äº†</span></span><br><span class="line">:_a(a)</span><br><span class="line">&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">operator</span> <span class="title">int</span><span class="params">()</span> <span class="comment">//å¦‚æœè¿™ä¸ªå‰è¾¹åŠ explicté‚£ä¹ˆint i = aa1ä¹Ÿä¸è¡Œï¼Œä½†æ˜¯å¯ä»¥å¼ºè½¬</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> _a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="type">int</span> _a;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// å†…ç½®ç±»å‹ è½¬æ¢æˆè‡ªå®šä¹‰ç±»å‹</span></span><br><span class="line">A aa1 = <span class="number">1</span>; <span class="comment">// éšå¼ç±»å‹è½¬æ¢ ç”¨1æ„é€ Aä¸´æ—¶å¯¹è±¡ï¼Œå†æ‹·è´æ„é€ aa1ï¼Œä¼˜åŒ–åç›´æ¥1æ„é€ aa1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰ç±»å‹ è½¬æ¢æˆå†…ç½®ç±»å‹</span></span><br><span class="line"><span class="type">int</span> i = aa1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ–‡ä»¶IO">æ–‡ä»¶IO</h2><blockquote><p>C++æ ¹æ®æ–‡ä»¶å†…å®¹çš„æ•°æ®æ ¼å¼åˆ†ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶å’Œæ–‡æœ¬æ–‡ä»¶</p></blockquote><p>å®šä¹‰ä¸€ä¸ªæ–‡ä»¶æµå¯¹è±¡</p><ul><li>ifstream ifile(åªè¾“å…¥ç”¨)</li><li>ofstream ofile(åªè¾“å‡ºç”¨)</li><li>fstream iofile(æ—¢è¾“å…¥åˆè¾“å‡ºç”¨)</li></ul><p>çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">ifstream <span class="title">ifs</span><span class="params">(<span class="string">&quot;test.cpp&quot;</span>)</span></span>;</span><br><span class="line"><span class="type">char</span> ch = ifs.<span class="built_in">get</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (ifs)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; ch;</span><br><span class="line">ch = ifs.<span class="built_in">get</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>è¿™æ®µç¨‹åºå¯ä»¥è¯»å–å½“å‰æ–‡ä»¶çš„å†…å®¹</code></pre><p>C++ç‰¹æœ‰çš„ä¼˜ç‚¹ï¼š</p><p>å¯¹å†…ç½®çš„ç±»å‹</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301151927497.png" alt=""></p><p>å¯¹è‡ªå®šä¹‰çš„ç±»å‹ï¼š</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301151934569.png" alt=""></p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301151935531.png" alt=""></p><pre><code>å‰é¢˜æ˜¯è‡ªå®šä¹‰çš„ç±»å‹æ”¯æŒæµæå–ï¼Œè¿™æ ·å¯¹è‡ªå®šä¹‰ç±»å‹çš„è¯»å†™é€šè¿‡æµçš„æ–¹å¼å°±éå¸¸çš„æ–¹ä¾¿äº†ã€‚</code></pre><blockquote><p>ä¸¤ç§è¯»å†™æ–¹å¼å¯¹æ¯”</p></blockquote><ol><li>äºŒè¿›åˆ¶è¯»å†™ï¼šåœ¨å†…å­˜å¦‚ä½•å­˜å‚¨ï¼Œå°±å¦‚ä½•å†™åˆ°ç£ç›˜æ–‡ä»¶<br>ä¼˜ç‚¹ï¼šå¿«<br>ç¼ºç‚¹ï¼šå†™å‡ºå»å†…å®¹çœ‹ä¸è§</li><li>æ–‡æœ¬è¯»å†™ï¼šå¯¹è±¡æ•°æ®åºåˆ—åŒ–å­—ç¬¦ä¸²å†™å‡ºæ¥ï¼Œè¯»å›æ¥ä¹Ÿæ˜¯å­—ç¬¦ä¸²ï¼Œååºåˆ—åŒ–è½¬æˆå¯¹è±¡æ•°æ®<br>ä¼˜ç‚¹ï¼šå¯ä»¥çœ‹è§å†™å‡ºå»æ˜¯ä»€ä¹ˆ<br>ç¼ºç‚¹ï¼šå­˜åœ¨ä¸€ä¸ªè½¬æ¢è¿‡ç¨‹ï¼Œè¦æ…¢ä¸€äº›</li></ol><h3 id="äºŒè¿›åˆ¶è¯»å†™">äºŒè¿›åˆ¶è¯»å†™</h3><blockquote><p>ä¸€ä¸ªå…³äºäºŒè¿›åˆ¶è¯»å–stringç±»å‹çš„å‘</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ServerInfo</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//char _address[32];</span></span><br><span class="line">string _address; <span class="comment">// æ¢æˆstring ç±»å‹</span></span><br><span class="line"><span class="type">int</span> _port;  <span class="comment">// 100</span></span><br><span class="line"></span><br><span class="line">Date _date;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ConfigManager</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">ConfigManager</span>(<span class="type">const</span> <span class="type">char</span>* filename = <span class="string">&quot;server.config&quot;</span>)</span><br><span class="line">:_filename(filename)</span><br><span class="line">&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">WriteBin</span><span class="params">(<span class="type">const</span> ServerInfo&amp; info)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">ofstream <span class="title">ofs</span><span class="params">(_filename, ios_base::out | ios_base::binary)</span></span>;</span><br><span class="line">ofs.<span class="built_in">write</span>((<span class="type">char</span>*)&amp;info, <span class="built_in">sizeof</span>(info));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ReadBin</span><span class="params">(ServerInfo&amp; info)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">ifstream <span class="title">ifs</span><span class="params">(_filename, ios_base::in | ios_base::binary)</span></span>;</span><br><span class="line">ifs.<span class="built_in">read</span>((<span class="type">char</span>*)&amp;info, <span class="built_in">sizeof</span>(info));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">string _filename; <span class="comment">// é…ç½®æ–‡ä»¶</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// äºŒè¿›åˆ¶å†™å‡ºå»</span></span><br><span class="line"><span class="comment">//ServerInfo winfo = &#123; &quot;127.0.0.1&quot;, 888 &#125;;</span></span><br><span class="line"><span class="comment">//ServerInfo winfo = &#123; &quot;https://legacy.cplusplus.com/reference/istream/istream/read/&quot;, 888 &#125;;</span></span><br><span class="line"><span class="comment">//ConfigManager cm;</span></span><br><span class="line"><span class="comment">//cm.WriteBin(winfo);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// äºŒè¿›åˆ¶çš„è¯»</span></span><br><span class="line">ServerInfo rinfo;</span><br><span class="line">ConfigManager cm;</span><br><span class="line">cm.<span class="built_in">ReadBin</span>(rinfo);</span><br><span class="line">cout &lt;&lt; rinfo._address &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; rinfo._port &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æƒ…å†µ1ã€å†™å…¥å­—ç¬¦è¾ƒçŸ­æ—¶</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301152109265.png" alt=""></p><pre><code>ç»“æœè™½ç„¶è¯»å–æˆåŠŸï¼Œä½†æ˜¯ç¨‹åºå‡ºç°äº†é—®é¢˜ï¼Œé€€å‡ºç ä¸æ˜¯0</code></pre><blockquote><p>æƒ…å†µ2ã€å†™å…¥å­—ç¬¦ä¸²è¾ƒé•¿æ—¶</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301152111415.png" alt=""></p><pre><code>å¯ä»¥çœ‹åˆ°addressç›´æ¥è¯»å–æŠ¥é”™</code></pre><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301152116889.png" alt=""></p><p>åŸå› æ˜¯å½“addressæ¯”è¾ƒé•¿çš„æ—¶å€™ï¼Œstringå¯¹è±¡ï¼Œå­—ç¬¦ä¸²ä¼šå­˜åœ¨å †é‡Œé¢ï¼ŒptræŒ‡é’ˆæŒ‡å‘è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œä½†æ˜¯å†™åˆ°æ–‡ä»¶é‡Œé¢çš„æ—¶å€™ï¼Œå†™çš„ä¸æ˜¯å †çš„å†…å­˜ï¼Œè€Œæ˜¯ptrè¿™ä¸ªåœ°å€ã€‚</p><p>äºŒè¿›åˆ¶è¯»å†™ï¼Œä¸å¤§é€‚åˆæœ‰åœ¨å †ä¸Šç”³è¯·æ•°æ®ç±»å‹çš„</p><h3 id="æ–‡æœ¬è¯»å†™">æ–‡æœ¬è¯»å†™</h3><p>ä¸‹è¾¹æ˜¯æ–‡æœ¬è¯»å†™çš„æ–¹å¼ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*void WriteText(const ServerInfo&amp; info)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">ofstream ofs(_filename, ios_base::out);</span></span><br><span class="line"><span class="comment">ofs.write(info._address.c_str(), info._address.size());</span></span><br><span class="line"><span class="comment">ofs.put(&#x27;\n&#x27;);</span></span><br><span class="line"><span class="comment">const string str = to_string(info._port);</span></span><br><span class="line"><span class="comment">ofs.write(str.c_str(), str.size());</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">void ReadText(ServerInfo&amp; info)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">ifstream ifs(_filename, ios_base::in | ios_base::binary);</span></span><br><span class="line"><span class="comment">char buff[128];</span></span><br><span class="line"><span class="comment">ifs.getline(buff, 128);</span></span><br><span class="line"><span class="comment">info._address = buff;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">ifs.getline(buff, 128);</span></span><br><span class="line"><span class="comment">info._port = stoi(buff);</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">WriteText</span><span class="params">(<span class="type">const</span> ServerInfo&amp; info)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">ofstream <span class="title">ofs</span><span class="params">(_filename, ios_base::out)</span></span>;</span><br><span class="line">ofs &lt;&lt; info._address &lt;&lt; endl;</span><br><span class="line">ofs &lt;&lt; info._port &lt;&lt; endl;</span><br><span class="line">ofs &lt;&lt; info._date &lt;&lt; endl; <span class="comment">//è¿™é‡Œæ˜¯æ—¥æœŸç±»çš„å¯¹è±¡</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ReadText</span><span class="params">(ServerInfo&amp; info)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">ifstream <span class="title">ifs</span><span class="params">(_filename, ios_base::in | ios_base::binary)</span></span>;</span><br><span class="line">ifs &gt;&gt; info._address &gt;&gt; info._port &gt;&gt; info._date;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="stringstream">stringstream</h2><p>ä¸€ä¸ªä¾‹å­ï¼š</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301152147060.png" alt=""></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ChatInfo</span></span><br><span class="line">&#123;</span><br><span class="line">string _name; <span class="comment">// åå­—</span></span><br><span class="line"><span class="type">int</span> _id;      <span class="comment">// id</span></span><br><span class="line">Date _date;   <span class="comment">// æ—¶é—´</span></span><br><span class="line">string _msg;  <span class="comment">// èŠå¤©ä¿¡æ¯</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// åºåˆ—åŒ–</span></span><br><span class="line">ChatInfo winfo = &#123; <span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="number">135246</span>, &#123; <span class="number">2022</span>, <span class="number">4</span>, <span class="number">10</span> &#125;, <span class="string">&quot;æ™šä¸Šä¸€èµ·çœ‹ç”µå½±å§&quot;</span> &#125;;</span><br><span class="line"><span class="comment">//ostringstream oss;</span></span><br><span class="line">stringstream oss;</span><br><span class="line">oss &lt;&lt; winfo._name &lt;&lt; endl;</span><br><span class="line">oss &lt;&lt; winfo._id &lt;&lt; endl;</span><br><span class="line">oss &lt;&lt; winfo._date &lt;&lt; endl;</span><br><span class="line">oss &lt;&lt; winfo._msg &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">string str = oss.<span class="built_in">str</span>();</span><br><span class="line">cout &lt;&lt; str &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç½‘ç»œä¼ è¾“strï¼Œå¦ä¸€ç«¯æ¥æ”¶åˆ°äº†å­—ç¬¦ä¸²ä¸²ä¿¡æ¯æ•°æ®</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">ChatInfo rInfo;</span><br><span class="line"><span class="comment">//istringstream iss(str);</span></span><br><span class="line"><span class="function">stringstream <span class="title">iss</span><span class="params">(str)</span></span>;</span><br><span class="line">iss &gt;&gt; rInfo._name;</span><br><span class="line">iss &gt;&gt; rInfo._id;</span><br><span class="line">iss &gt;&gt; rInfo._date;</span><br><span class="line">iss &gt;&gt; rInfo._msg;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;----------------------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; rInfo._date &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; rInfo._name &lt;&lt; <span class="string">&quot;[&quot;</span> &lt;&lt; rInfo._id &lt;&lt; <span class="string">&quot;]:&gt;&quot;</span> &lt;&lt; rInfo._msg &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;----------------------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åˆ†å‰²å­—ç¬¦ä¸²ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">stringstream <span class="title">ss</span><span class="params">(<span class="string">&quot;sad ad fsd&quot;</span>)</span></span>;</span><br><span class="line">string s;</span><br><span class="line"><span class="keyword">while</span> (ss &gt;&gt; s)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; s &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹è¯­è¨€ </category>
          
          <category> CPP </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>C++ç±»å‹è½¬æ¢</title>
      <link href="/posts/3229432098/"/>
      <url>/posts/3229432098/</url>
      
        <content type="html"><![CDATA[<h1>Cè¯­è¨€ä¸­çš„ç±»å‹è½¬æ¢</h1><h2 id="éšå¼ç±»å‹è½¬æ¢">éšå¼ç±»å‹è½¬æ¢</h2><blockquote><p>éšå¼ç±»å‹è½¬æ¢ï¼ˆæ„ä¹‰ç›¸è¿‘çš„ç±»å‹ï¼‰</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> i = <span class="number">1</span>;</span><br><span class="line"><span class="comment">// éšå¼ç±»å‹è½¬æ¢(æ„ä¹‰ç›¸è¿‘çš„ç±»å‹)</span></span><br><span class="line"><span class="type">double</span> d = i;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d, %.2f\n&quot;</span>, i, d);</span><br></pre></td></tr></table></figure><h2 id="æ˜¾ç¤ºç±»å‹è½¬æ¢">æ˜¾ç¤ºç±»å‹è½¬æ¢</h2><blockquote><p>æ˜¾ç¤ºçš„å¼ºåˆ¶ç±»å‹è½¬æ¢(æ„ä¹‰ä¸ç›¸è¿‘çš„ç±»å‹ï¼Œå€¼è½¬æ¢åæœ‰æ„ä¹‰)</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span>* p = &amp;a;</span><br><span class="line"></span><br><span class="line"><span class="comment">//int address = p; //è¿™æ ·æ²¡æ³•éšå¼ç±»å‹è½¬æ¢ä¼šæŠ¥é”™</span></span><br><span class="line"><span class="type">int</span> address = (<span class="type">int</span>)p; <span class="comment">//å¼ºåˆ¶ç±»å‹è½¬æ¢æ²¡é—®é¢˜</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%x, %d\n&quot;</span>, p, address);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1>C++å¼ºåˆ¶ç±»å‹è½¬æ¢</h1><blockquote><p>c++ä¹Ÿæ”¯æŒcçš„ç±»å‹è½¬æ¢ï¼Œä½†æ˜¯c++ä¸ºäº†åŠ å¼ºç±»å‹è½¬æ¢çš„å¯è§†æ€§ï¼Œå¼•å…¥äº†å››ç§å‘½åçš„å¼ºåˆ¶ç±»å‹è½¬æ¢æ“ä½œç¬¦</p></blockquote><h2 id="static-cast">static_cast</h2><blockquote><p>è¿™ä¸ªå°±åƒcä¸­çš„éšå¼ç±»å‹è½¬æ¢ï¼Œåªä¸è¿‡æ˜¾ç¤ºçš„å†™äº†å‡ºæ¥ï¼Œstatic_castç”¨äºéå¤šæ€ç±»å‹çš„è½¬æ¢ï¼ˆé™æ€è½¬æ¢ï¼‰ï¼Œç¼–è¯‘å™¨éšå¼æ‰§è¡Œçš„ä»»ä½•ç±»å‹è½¬æ¢éƒ½å¯ç”¨static_castï¼Œä½†å®ƒä¸èƒ½ç”¨äºä¸¤ä¸ªä¸ç›¸å…³çš„ç±»å‹è¿›è¡Œè½¬æ¢</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">double</span> d = <span class="number">12.34</span>;</span><br><span class="line"><span class="type">int</span> a = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(d);</span><br><span class="line">cout &lt;&lt; a &lt;&lt; endl;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="reinterpret-cast">reinterpret_cast</h2><blockquote><p>ç±»ä¼¼äºcçš„æ˜¾ç¤ºå¼ºåˆ¶ç±»å‹çš„è½¬æ¢ï¼Œä¸€èˆ¬ç”¨äºå°†ä¸€ç§ç±»å‹è½¬æ¢ä¸ºå¦ä¸€ç§ä¸åŒçš„ç±»å‹</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="type">int</span>* p = <span class="built_in">reinterpret_cast</span>&lt;<span class="type">int</span>*&gt;(a);  <span class="comment">// æŠŠint å¼ºè½¬ä¸º int*</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="const-cast">const_cast</h2><blockquote><p>èƒ½å¤Ÿåˆ é™¤å˜é‡çš„constå±æ€§</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> a = <span class="number">2</span>;</span><br><span class="line"><span class="comment">//int* p = const_cast&lt;int*&gt;(&amp;a);</span></span><br><span class="line"><span class="type">int</span>* p = (<span class="type">int</span>*)&amp;a; <span class="comment">// cçš„é‚£ä¸€å¥—ä¹Ÿå¯ä»¥</span></span><br><span class="line">*p = <span class="number">3</span>;</span><br><span class="line">cout &lt;&lt; a &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; *p &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä¸Šè¾¹çš„ä»£ç ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è¿è¡Œç»“æœæ˜¾ç¤ºï¼Œaè¿˜æ˜¯2ï¼Œä¸è¿‡å½“æˆ‘ä»¬æ‰“å¼€ç›‘è§†çª—å£å¯ä»¥çœ‹åˆ°aå…¶å®å·²ç»è¢«æ”¹æˆ3äº†ï¼Œè¿™æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301131530309.png" alt=""></p><pre><code>aè¢«constä¿®é¥°ï¼Œç¼–è¯‘å™¨ä»¥ä¸ºä¸ä¼šè¢«ä¿®æ”¹ï¼Œæ‰€ä»¥åŠ è½½åˆ°å¯„å­˜å™¨ï¼Œè™½ç„¶å†…å­˜ä¸­å·²ç»è¢«æ”¹äº†ä½†æ˜¯å¯„å­˜å™¨é‡Œé¢çš„è¿˜æ˜¯2ï¼Œcoutçš„æ—¶å€™ç›´æ¥å»å¯„å­˜å™¨è¯»ï¼Œæ‰€ä»¥æ‰“å°å‡ºæ¥æ˜¯2</code></pre><p>æˆ‘ä»¬å¯ä»¥åœ¨å®šä¹‰aå˜é‡çš„æ—¶å€™åŠ ä¸Š volatileå…³é”®å­—ï¼Œè¿™æ ·ç¼–è¯‘å™¨å¤„ç†çš„æ—¶å€™å°±ä¼šå»å†…å­˜ä¸­è¯»å–æ•°æ®ï¼Œè¿™æ ·ï¼Œè¿è¡Œç»“æœå°±å˜æˆ3 3äº†ã€‚</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301131535214.png" alt=""></p><p>æ³¨ï¼š</p><ol><li>å…¼å®¹céšå¼ç±»å‹è½¬æ¢å’Œå¼ºåˆ¶ç±»å‹è½¬æ¢</li><li>æœŸæœ›ä¸è¦å†ç”¨äº†ï¼Œæœ€å¥½ç”¨è§„èŒƒçš„cppæ˜¾ç¤ºå¼ºåˆ¶ç±»å‹è½¬æ¢</li><li>static_castï¼ˆéšå¼ç±»å‹è½¬æ¢ï¼‰ã€reinterpret_castã€const_castï¼ˆå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼‰</li></ol><h2 id="dynamic-cast">dynamic_cast</h2><blockquote><p>ç”¨äºå°†ä¸€ä¸ªçˆ¶ç±»å¯¹è±¡çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨è½¬æ¢ä¸ºå­ç±»çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨ï¼ˆåŠ¨æ€è½¬æ¢ï¼‰</p></blockquote><p><strong>å‘ä¸Šè½¬å‹</strong>ï¼šå­ç±»å¯¹è±¡æŒ‡é’ˆ/å¼•ç”¨-&gt;çˆ¶ç±»æŒ‡é’ˆ/å¼•ç”¨  ï¼ˆä¸éœ€è¦è½¬æ¢ï¼Œèµ‹å€¼å…¼å®¹è§„åˆ™ï¼‰<br><strong>å‘ä¸‹è½¬å‹</strong>ï¼šçˆ¶ç±»å¯¹è±¡æŒ‡é’ˆ/å¼•ç”¨-&gt;å­ç±»æŒ‡é’ˆ/å¼•ç”¨  ï¼ˆç”¨dynamic_castè½¬å‹æ˜¯å®‰å…¨çš„ï¼‰</p><ol><li>dynamic_caståªèƒ½ç”¨äºçˆ¶ç±»å«æœ‰è™šå‡½æ•°çš„ç±»</li><li>dynamic_castä¼šå…ˆæ£€æŸ¥æ˜¯å¦èƒ½è½¬æ¢æˆåŠŸï¼Œèƒ½æˆåŠŸåˆ™è½¬æ¢ï¼Œä¸èƒ½åˆ™è¿”å›0</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">f</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="type">int</span> _a = <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> : <span class="keyword">public</span> A</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="type">int</span> _b = <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// A*æŒ‡é’ˆpaæœ‰å¯èƒ½æŒ‡å‘çˆ¶ç±»ï¼Œæœ‰å¯èƒ½æŒ‡å‘å­ç±»</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">(A* pa)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// å¦‚æœpaæ˜¯æŒ‡å‘å­ç±»ï¼Œé‚£ä¹ˆå¯ä»¥è½¬æ¢ï¼Œè½¬æ¢è¡¨è¾¾å¼è¿”å›æ­£ç¡®çš„åœ°å€</span></span><br><span class="line"><span class="comment">// å¦‚æœpaæ˜¯æŒ‡å‘çˆ¶ç±»ï¼Œé‚£ä¹ˆä¸èƒ½è½¬æ¢ï¼Œè½¬æ¢è¡¨è¾¾å¼è¿”å›nullptr</span></span><br><span class="line">B* pb = <span class="built_in">dynamic_cast</span>&lt;B*&gt;(pa); <span class="comment">// å®‰å…¨çš„</span></span><br><span class="line"><span class="comment">//B* pb = (B*)pa;             // ä¸å®‰å…¨</span></span><br><span class="line"><span class="keyword">if</span> (pb)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;è½¬æ¢æˆåŠŸ&quot;</span> &lt;&lt; endl;</span><br><span class="line">pb-&gt;_a++;</span><br><span class="line">pb-&gt;_b++;</span><br><span class="line">cout &lt;&lt; pb-&gt;_a &lt;&lt; <span class="string">&quot;:&quot;</span> &lt;&lt; pb-&gt;_b &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;è½¬æ¢å¤±è´¥&quot;</span> &lt;&lt; endl;</span><br><span class="line">pa-&gt;_a++;</span><br><span class="line">cout &lt;&lt; pa-&gt;_a &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">A aa;</span><br><span class="line"><span class="comment">// çˆ¶ç±»å¯¹è±¡æ— è®ºå¦‚ä½•éƒ½æ˜¯ä¸å…è®¸è½¬æ¢æˆå­ç±»å¯¹è±¡çš„</span></span><br><span class="line"><span class="comment">/*B bb = dynamic_cast&lt;B&gt;(aa);</span></span><br><span class="line"><span class="comment">B bb = (B)aa;*/</span></span><br><span class="line">B bb;</span><br><span class="line"></span><br><span class="line"><span class="built_in">fun</span>(&amp;aa);</span><br><span class="line"><span class="built_in">fun</span>(&amp;bb);</span><br><span class="line"><span class="comment">//fun(nullptr); è½¬æ¢å¤±è´¥å¹¶ä¸”æŠ¥é”™</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç»†èŠ‚éƒ¨åˆ†ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A1</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">f</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="type">int</span> _a1 = <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A2</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">f</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="type">int</span> _a2 = <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> : <span class="keyword">public</span> A1, <span class="keyword">public</span> A2</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="type">int</span> _b = <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">B bb; <span class="comment">//å®šä¹‰å­ç±»å¯¹è±¡</span></span><br><span class="line">A1* ptr1 = &amp;bb;</span><br><span class="line">A2* ptr2 = &amp;bb;</span><br><span class="line">cout &lt;&lt; ptr1 &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; ptr2 &lt;&lt; endl &lt;&lt; endl;  <span class="comment">//è¿™ä¸¤ä¸ªåœ°å€æ˜¯ä¸åŒçš„</span></span><br><span class="line"></span><br><span class="line">B* pb1 = (B*)ptr1;</span><br><span class="line">B* pb2 = (B*)ptr2;</span><br><span class="line">cout &lt;&lt; pb1 &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; pb2 &lt;&lt; endl &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">B* pb3 = <span class="built_in">dynamic_cast</span>&lt;B*&gt;(ptr1);</span><br><span class="line">B* pb4 = <span class="built_in">dynamic_cast</span>&lt;B*&gt;(ptr2);</span><br><span class="line">cout &lt;&lt; pb3 &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; pb4 &lt;&lt; endl &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301151637140.png" alt=""></p><pre><code>å¯ä»¥çœ‹åˆ°ï¼Œå¼ºè½¬æˆå­ç±»æŒ‡é’ˆï¼Œå’Œdynamic_castéƒ½å¯ä»¥å°†æŒ‡é’ˆä½ç½®åç§»åˆ°å¤´ä¸Š</code></pre><p>æ€»ç»“ï¼š</p><ul><li>å¦‚æœæœ‰ä¸ªå­ç±»çš„å¯¹è±¡ï¼Œå°†åœ°å€ä¼ ç»™ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°å½¢å‚æ˜¯çˆ¶ç±»çš„æŒ‡é’ˆï¼Œé‚£ä¹ˆå‡½æ•°å†…éƒ¨å¯ä»¥å°†è¿™ä¸ªæŒ‡é’ˆé‡æ–°å®‰å…¨çš„è½¬æˆå­ç±»çš„æŒ‡é’ˆã€‚</li><li>æ™®é€šçš„çˆ¶ç±»æŒ‡é’ˆå¼ºè½¬æˆå­ç±»å¯èƒ½æœ‰é£é™©ï¼Œå¦‚æœçˆ¶ç±»çš„æŒ‡é’ˆæœ¬æ¥æŒ‡å‘çš„å¯¹è±¡å°±æ˜¯çˆ¶ç±»çš„å¯¹è±¡ï¼Œé‚£ä¹ˆå°†è¿™ä¸ªæŒ‡é’ˆè½¬æ¢æˆå­ç±»ï¼Œä¼šæœ‰è¶Šç•Œçš„é£é™©ã€‚</li></ul><h1>RTTI</h1><blockquote><p>Run-time Type identification ï¼šè¿è¡Œæ—¶ç±»å‹è¯†åˆ«</p></blockquote><p>c++é€šè¿‡ä»¥ä¸‹æ–¹å¼æ”¯æŒRTTI</p><ol><li>typeidè¿ç®—ç¬¦   (è·å–å¯¹è±¡ç±»å‹çš„å­—ç¬¦ä¸²)</li><li>dynamic_castè¿ç®—ç¬¦ ï¼ˆè¯†åˆ«çˆ¶ç±»çš„æŒ‡é’ˆæ˜¯æŒ‡å‘çˆ¶ç±»å¯¹è±¡è¿˜æ˜¯å­ç±»å¯¹è±¡ï¼‰</li><li>decltype   ï¼ˆæ¨å¯¼ä¸€ä¸ªå¯¹è±¡ç±»å‹ï¼Œè¿™ä¸ªç±»å‹å¯ä»¥ç”¨æ¥å®šä¹‰å¦ä¸€ä¸ªå¯¹è±¡ï¼‰</li></ol>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹è¯­è¨€ </category>
          
          <category> CPP </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç»§æ‰¿</title>
      <link href="/posts/299414317/"/>
      <url>/posts/299414317/</url>
      
        <content type="html"><![CDATA[<h2 id="ç»§æ‰¿çš„æ¦‚å¿µåŠå®šä¹‰">ç»§æ‰¿çš„æ¦‚å¿µåŠå®šä¹‰</h2><h3 id="ç»§æ‰¿æ¦‚å¿µ">ç»§æ‰¿æ¦‚å¿µ</h3><p>ç»§æ‰¿(inheritance)æœºåˆ¶æ˜¯é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ä½¿ä»£ç å¯ä»¥å¤ç”¨çš„æœ€é‡è¦çš„æ‰‹æ®µï¼Œå®ƒå…è®¸ç¨‹åºå‘˜åœ¨ä¿ æŒåŸæœ‰ç±»ç‰¹æ€§çš„åŸºç¡€ä¸Šè¿›è¡Œæ‰©å±•ï¼Œå¢åŠ åŠŸèƒ½ï¼Œè¿™æ ·äº§ç”Ÿæ–°çš„ç±»ï¼Œç§°æ´¾ç”Ÿç±»ã€‚ç»§æ‰¿å‘ˆç°äº†é¢å‘å¯¹è±¡ ç¨‹åºè®¾è®¡çš„å±‚æ¬¡ç»“æ„ï¼Œä½“ç°äº†ç”±ç®€å•åˆ°å¤æ‚çš„è®¤çŸ¥è¿‡ç¨‹ã€‚ä»¥å‰æˆ‘ä»¬æ¥è§¦çš„å¤ç”¨éƒ½æ˜¯å‡½æ•°å¤ç”¨ï¼Œç»§æ‰¿æ˜¯ç±»è®¾è®¡å±‚æ¬¡çš„å¤ç”¨</p><h3 id="ç»§æ‰¿å®šä¹‰">ç»§æ‰¿å®šä¹‰</h3><h4 id="å®šä¹‰æ ¼å¼">å®šä¹‰æ ¼å¼</h4><p><img src="https://cdn.nlark.com/yuque/0/2022/png/29247941/1665842803037-eb12fae7-3e8c-4243-a915-09d684e626bd.png#averageHue=%23fbfbfb&amp;clientId=ucddb3e9e-e17a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=369&amp;id=ude023e28&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=554&amp;originWidth=920&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=25512&amp;status=done&amp;style=none&amp;taskId=ue258894c-c700-4c08-af2f-16f2fe31140&amp;title=&amp;width=613.3333333333334" alt="image.png"><br>ç»§æ‰¿åï¼Œçˆ¶ç±»çš„æˆå‘˜ï¼ŒåŒ…æ‹¬æˆå‘˜å‡½æ•°å’Œæˆå‘˜å˜é‡ï¼Œéƒ½ä¼šå˜æˆå­ç±»çš„ä¸€éƒ¨åˆ†ã€‚</p><h4 id="é»˜è®¤ç»§æ‰¿æ–¹å¼">é»˜è®¤ç»§æ‰¿æ–¹å¼</h4><p>åœ¨ä½¿ç”¨ç»§æ‰¿æ—¶ï¼Œå¯ä»¥ä¸æŒ‡å®šç»§æ‰¿æ–¹å¼ï¼Œä½¿ç”¨å…³é”®å­—classæ—¶é»˜è®¤çš„ç»§æ‰¿æ–¹å¼æ˜¯privateï¼Œä½¿ç”¨structæ—¶ï¼Œé»˜è®¤çš„ç»§æ‰¿æ–¹å¼æ˜¯public</p><h4 id="ç»§æ‰¿å…³ç³»å’Œè®¿é—®é™å®šç¬¦">ç»§æ‰¿å…³ç³»å’Œè®¿é—®é™å®šç¬¦</h4><p>è®¿é—®é™å®šç¬¦ï¼š</p><ul><li>public</li><li>protected</li><li>private</li></ul><p>ç»§æ‰¿å…³ç³»</p><ul><li>public</li><li>protected</li><li>private</li></ul><p>ç§æœ‰æˆå‘˜çš„æ„ä¹‰ï¼šä¸æƒ³è¢«å­ç±»ç»§æ‰¿çš„æˆå‘˜ï¼Œå¯ä»¥è®¾è®¡æˆç§æœ‰<br>åŸºç±»ä¸­æƒ³ç»™å­ç±»å¤ç”¨ï¼Œä½†æ˜¯åˆä¸æƒ³æš´éœ²ç›´æ¥è®¿é—®çš„æˆå‘˜ï¼Œå°±åº”è¯¥å®šä¹‰æˆä¿æŠ¤</p><h4 id="ç»§æ‰¿åŸºç±»æˆå‘˜è®¿é—®æ–¹å¼çš„å˜åŒ–">ç»§æ‰¿åŸºç±»æˆå‘˜è®¿é—®æ–¹å¼çš„å˜åŒ–</h4><table><thead><tr><th>ç±»æˆå‘˜/ç»§æ‰¿æ–¹å¼</th><th>publicç»§æ‰¿</th><th>protectedç»§æ‰¿</th><th>privateç»§æ‰¿</th></tr></thead><tbody><tr><td>åŸºç±»çš„publicæˆå‘˜</td><td>æ´¾ç”Ÿç±»çš„publicæˆå‘˜</td><td>æ´¾ç”Ÿç±»çš„protectedæˆå‘˜</td><td>æ´¾ç”Ÿç±»çš„privateæˆå‘˜</td></tr><tr><td>åŸºç±»çš„protectedæˆå‘˜</td><td>æ´¾ç”Ÿç±»çš„protectedæˆå‘˜</td><td>æ´¾ç”Ÿç±»çš„protectedæˆå‘˜</td><td>æ´¾ç”Ÿç±»çš„privateæˆå‘˜</td></tr><tr><td>åŸºç±»çš„privateæˆå‘˜</td><td>åœ¨æ´¾ç”Ÿç±»ä¸å¯è§</td><td>åœ¨æ´¾ç”Ÿç±»ä¸å¯è§</td><td>åœ¨æ´¾ç”Ÿç±»ä¸å¯è§</td></tr></tbody></table><p>:::info<br>å–æˆå‘˜é™å®šç¬¦å’Œç»§æ‰¿æ–¹å¼çš„è¾ƒå°<br>:::</p><blockquote><p>protected/private  ç±»å¤–è¾¹ä¸èƒ½è®¿é—® ç±»é‡Œé¢å¯ä»¥è®¿é—®<br>ä¸å¯è§                         éšèº«ï¼Œç±»é‡Œé¢å¤–é¢éƒ½æ— æ³•è®¿é—®</p></blockquote><h4 id="æ€»ç»“">æ€»ç»“</h4><ul><li>åŸºç±»privateæˆå‘˜åœ¨æ´¾ç”Ÿç±»ä¸­æ— è®ºä»¥ä»€ä¹ˆæ–¹å¼ç»§æ‰¿éƒ½æ˜¯ä¸å¯è§çš„ã€‚è¿™é‡Œçš„ä¸å¯è§æ˜¯æŒ‡åŸºç±»çš„ç§<br>æœ‰æˆå‘˜è¿˜æ˜¯è¢«ç»§æ‰¿åˆ°äº†æ´¾ç”Ÿç±»å¯¹è±¡ä¸­ï¼Œä½†æ˜¯è¯­æ³•ä¸Šé™åˆ¶æ´¾ç”Ÿç±»å¯¹è±¡ä¸ç®¡åœ¨ç±»é‡Œé¢è¿˜æ˜¯ç±»å¤–é¢<br>éƒ½ä¸èƒ½å»è®¿é—®å®ƒã€‚</li><li>åŸºç±»privateæˆå‘˜åœ¨æ´¾ç”Ÿç±»ä¸­æ˜¯ä¸èƒ½è¢«è®¿é—®ï¼Œå¦‚æœåŸºç±»æˆå‘˜ä¸æƒ³åœ¨ç±»å¤–ç›´æ¥è¢«è®¿é—®ï¼Œä½†éœ€è¦åœ¨<br>æ´¾ç”Ÿç±»ä¸­èƒ½è®¿é—®ï¼Œå°±å®šä¹‰ä¸ºprotectedã€‚å¯ä»¥çœ‹å‡ºä¿æŠ¤æˆå‘˜é™å®šç¬¦æ˜¯å› ç»§æ‰¿æ‰å‡ºç°çš„ã€‚</li><li>å®é™…ä¸Šé¢çš„è¡¨æ ¼æˆ‘ä»¬è¿›è¡Œä¸€ä¸‹æ€»ç»“ä¼šå‘ç°ï¼ŒåŸºç±»çš„ç§æœ‰æˆå‘˜åœ¨å­ç±»éƒ½æ˜¯ä¸å¯è§ã€‚åŸºç±»çš„å…¶ä»–<br>æˆå‘˜åœ¨å­ç±»çš„è®¿é—®æ–¹å¼ == Min(æˆå‘˜åœ¨åŸºç±»çš„è®¿é—®é™å®šç¬¦ï¼Œç»§æ‰¿æ–¹å¼)ï¼Œpublic &gt; protected&gt;privateã€‚</li><li>ä½¿ç”¨å…³é”®å­—classæ—¶é»˜è®¤çš„ç»§æ‰¿æ–¹å¼æ˜¯privateï¼Œä½¿ç”¨structæ—¶é»˜è®¤çš„ç»§æ‰¿æ–¹å¼æ˜¯publicï¼Œä¸è¿‡<br>æœ€å¥½æ˜¾ç¤ºçš„å†™å‡ºç»§æ‰¿æ–¹å¼ã€‚</li><li>åœ¨å®é™…è¿ç”¨ä¸­ä¸€èˆ¬ä½¿ç”¨éƒ½æ˜¯publicç»§æ‰¿ï¼Œå‡ ä¹å¾ˆå°‘ä½¿ç”¨protetced/privateç»§æ‰¿ï¼Œä¹Ÿä¸æå€¡<br>ä½¿ç”¨protetced/privateç»§æ‰¿ï¼Œå› ä¸ºprotetced/privateç»§æ‰¿ä¸‹æ¥çš„æˆå‘˜éƒ½åªèƒ½åœ¨æ´¾ç”Ÿç±»çš„ç±»é‡Œ<br>é¢ä½¿ç”¨ï¼Œå®é™…ä¸­æ‰©å±•ç»´æŠ¤æ€§ä¸å¼º</li></ul><h2 id="åŸºå’Œæ´¾ç”Ÿç±»å¯¹è±¡èµ‹å€¼è½¬æ¢">åŸºå’Œæ´¾ç”Ÿç±»å¯¹è±¡èµ‹å€¼è½¬æ¢</h2><ul><li>æ´¾ç”Ÿç±»å¯¹è±¡ å¯ä»¥èµ‹å€¼ç»™ åŸºç±»çš„å¯¹è±¡ / åŸºç±»çš„æŒ‡é’ˆ / åŸºç±»çš„å¼•ç”¨ã€‚è¿™é‡Œæœ‰ä¸ªå½¢è±¡çš„è¯´æ³•å«åˆ‡ç‰‡<br>æˆ–è€…åˆ‡å‰²ã€‚å¯“æ„æŠŠæ´¾ç”Ÿç±»ä¸­çˆ¶ç±»é‚£éƒ¨åˆ†åˆ‡æ¥èµ‹å€¼è¿‡å»ã€‚</li><li>åŸºç±»å¯¹è±¡ä¸èƒ½èµ‹å€¼ç»™æ´¾ç”Ÿç±»å¯¹è±¡ã€‚</li><li>åŸºç±»çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨å¯ä»¥é€šè¿‡å¼ºåˆ¶ç±»å‹è½¬æ¢èµ‹å€¼ç»™æ´¾ç”Ÿç±»çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨ã€‚ä½†æ˜¯å¿…é¡»æ˜¯åŸºç±»<br>çš„æŒ‡é’ˆæ˜¯æŒ‡å‘æ´¾ç”Ÿç±»å¯¹è±¡æ—¶æ‰æ˜¯å®‰å…¨çš„ã€‚è¿™é‡ŒåŸºç±»å¦‚æœæ˜¯å¤šæ€ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨RTTI(RunTime Type Information)çš„dynamic_cast æ¥è¿›è¡Œè¯†åˆ«åè¿›è¡Œå®‰å…¨è½¬æ¢ã€‚</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2022/png/29247941/1665911527698-30aebb38-ac6a-4bc6-9963-62f385ae1e2d.png#averageHue=%23fdf7eb&amp;clientId=uda2bf642-89db-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=524&amp;id=uedf0ce47&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=786&amp;originWidth=554&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=43417&amp;status=done&amp;style=none&amp;taskId=u10f1346e-edeb-46c9-ad83-93a2d7d8c24&amp;title=&amp;width=369.3333333333333" alt="image.png"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">string _name; <span class="comment">// å§“å</span></span><br><span class="line">string _sex;  <span class="comment">// æ€§åˆ«</span></span><br><span class="line"><span class="type">int</span>_age; <span class="comment">// å¹´é¾„</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> : <span class="keyword">public</span> Person</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="type">int</span> _No; <span class="comment">// å­¦å·</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Student sobj;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.å­ç±»å¯¹è±¡å¯ä»¥èµ‹å€¼ç»™çˆ¶ç±»å¯¹è±¡/æŒ‡é’ˆ/å¼•ç”¨</span></span><br><span class="line"><span class="comment">// è¿™é‡Œè™½ç„¶æ˜¯ä¸åŒç±»å‹ï¼Œä½†æ˜¯ä¸æ˜¯éšå¼ç±»å‹è½¬æ¢</span></span><br><span class="line"><span class="comment">// è¿™é‡Œç®—æ˜¯ä¸€ä¸ªç‰¹æ®Šæ”¯æŒï¼Œè¯­æ³•å¤©ç„¶æ”¯æŒçš„</span></span><br><span class="line">Person pobj = sobj;</span><br><span class="line">Person* pp = &amp;sobj;</span><br><span class="line">Person&amp; rp = sobj;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span>&amp; d = i;</span><br><span class="line"></span><br><span class="line"><span class="comment">//sobj = (Student)pobj;   //å¼ºè½¬æˆæ´¾ç”Ÿç±»</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šåŸºç±»çš„å¯¹è±¡ä¸èƒ½èµ‹å€¼ç»™æ´¾ç”Ÿç±»å¯¹è±¡ï¼ŒåŸºç±»çš„æŒ‡é’ˆå¯ä»¥é€šè¿‡å¼ºåˆ¶ç±»å‹è½¬æ¢èµ‹å€¼ç»™æ´¾ç”Ÿç±»çš„æŒ‡é’ˆï¼Œä½†æ˜¯æ­¤æ—¶åŸºç±»çš„æŒ‡é’ˆå¿…é¡»æ˜¯æŒ‡å‘æ´¾ç”Ÿç±»çš„å¯¹è±¡æ‰æ˜¯å®‰å…¨çš„ã€‚</p><h2 id="ç»§æ‰¿ä¸­çš„ä½œç”¨åŸŸ">ç»§æ‰¿ä¸­çš„ä½œç”¨åŸŸ</h2><ul><li>åœ¨ç»§æ‰¿ä½“ç³»ä¸­ï¼ŒåŸºç±»å’Œæ´¾ç”Ÿç±»éƒ½æœ‰ç‹¬ç«‹çš„ä½œç”¨åŸŸ</li><li>å­ç±»å’Œçˆ¶ç±»ä¸­æœ‰åŒåæˆå‘˜ï¼Œå­ç±»æˆå‘˜å°†å±è”½çˆ¶ç±»å¯¹åŒåæˆå‘˜çš„ç›´æ¥è®¿é—®ï¼Œè¿™ç§æƒ…å†µå«éšè—ï¼Œä¹Ÿå«é‡å®šä¹‰ã€‚ï¼ˆåœ¨å­ç±»æˆå‘˜å‡½æ•°ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ åŸºç±»::åŸºç±»æˆå‘˜ æ˜¾ç¤ºè®¿é—®ï¼‰</li><li>æ³¨æ„åœ¨å®é™…ä¸­åœ¨ç»§æ‰¿ä½“ç³»é‡Œæœ€å¥½ä¸è¦å®šä¹‰åŒåçš„æˆå‘˜</li><li>éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœæ˜¯æˆå‘˜å‡½æ•°çš„éšè—ï¼Œåªéœ€è¦å‡½æ•°åç›¸åŒå°±æ„æˆéšè—</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">string _name; <span class="comment">// å§“å</span></span><br><span class="line"><span class="type">int</span> _num;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;parent&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> : <span class="keyword">public</span> Person</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="type">int</span> _num;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;child&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Student s;</span><br><span class="line">s._num = <span class="number">1</span>;</span><br><span class="line">cout &lt;&lt; s._num &lt;&lt; endl;</span><br><span class="line">s.Person::_num = <span class="number">2</span>;</span><br><span class="line">cout &lt;&lt; s.Person::_num &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">s.<span class="built_in">fun</span>();</span><br><span class="line">s.Person::<span class="built_in">fun</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ´¾ç”Ÿç±»çš„é»˜è®¤æˆå‘˜å‡½æ•°">æ´¾ç”Ÿç±»çš„é»˜è®¤æˆå‘˜å‡½æ•°</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/29247941/1665924224019-25167b1f-d0d9-41fb-8a1e-3036a3938fc3.png#averageHue=%23d6e81f&amp;clientId=u9a15f95a-cdec-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=170&amp;id=ue92dcd90&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=255&amp;originWidth=913&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=69980&amp;status=done&amp;style=none&amp;taskId=u3248b978-23c3-41d1-b69d-a99b288c1ca&amp;title=&amp;width=608.6666666666666" alt="image.png"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="comment">//Person(const char* name = &quot;peter&quot;)</span></span><br><span class="line"><span class="built_in">Person</span>(<span class="type">const</span> <span class="type">char</span>* name)</span><br><span class="line">: _name(name)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Person()&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Person</span>(<span class="type">const</span> Person&amp; p)</span><br><span class="line">: _name(p._name)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Person(const Person&amp; p)&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Person&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Person&amp; p)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Person operator=(const Person&amp; p)&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span> != &amp;p)</span><br><span class="line">_name = p._name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">~<span class="built_in">Person</span>()</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;~Person()&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">string _name; <span class="comment">// å§“å</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> : <span class="keyword">public</span> Person</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">Student</span>(<span class="type">const</span> <span class="type">char</span>* name, <span class="type">int</span> num)</span><br><span class="line">:<span class="built_in">Person</span>(name)   <span class="comment">//çˆ¶ç±»æ²¡æœ‰é»˜è®¤æ„é€ ï¼Œåˆå§‹åŒ–åˆ—è¡¨è§„å®šè¿™ä¹ˆå†™ï¼Œå°±åƒåŒ¿åå¯¹è±¡é‚£æ ·</span></span><br><span class="line">, _num(num)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Student()&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Student</span>(<span class="type">const</span> Student&amp; s)</span><br><span class="line">:<span class="built_in">Person</span>(s) <span class="comment">//åˆ‡ç‰‡  </span></span><br><span class="line">, _num(s._num)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Student(const Student&amp; s)&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Student&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Student&amp; s)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span> != &amp;s)</span><br><span class="line">&#123;</span><br><span class="line">Person::<span class="keyword">operator</span>=(s);</span><br><span class="line"></span><br><span class="line">_num = s._num;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Student&amp; operator=(const Student&amp; s)&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­ç±»çš„ææ„çš„å‡½æ•°è·Ÿçˆ¶ç±»ææ„å‡½æ•°æ„æˆéšè—ã€‚</span></span><br><span class="line"><span class="comment">// ç”±äºåé¢å¤šæ€çš„éœ€è¦ï¼Œææ„å‡½æ•°åå­—ä¼šç»Ÿä¸€å¤„ç†æˆdestructor()</span></span><br><span class="line">~<span class="built_in">Student</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// ä¸éœ€è¦æ˜¾ç¤ºè°ƒç”¨çˆ¶ç±»ææ„å‡½æ•°</span></span><br><span class="line"><span class="comment">// æ¯ä¸ªå­ç±»ææ„å‡½æ•°åé¢ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨çˆ¶ç±»ææ„å‡½æ•°ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯å…ˆææ„å­ç±»ï¼Œå†ææ„çˆ¶ç±»</span></span><br><span class="line"><span class="comment">//Person::~Person();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...å¤„ç†å­ç±»è‡ªå·±çš„</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;~Student()&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Student* operator&amp;()</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//return this;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"><span class="type">int</span> _num;</span><br><span class="line"></span><br><span class="line"><span class="comment">// int* _ptr;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">Student <span class="title">s1</span><span class="params">(<span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="number">1</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Student s2(s1);</span></span><br><span class="line">Student s2 = s1;</span><br><span class="line"></span><br><span class="line"><span class="function">Student <span class="title">s3</span><span class="params">(<span class="string">&quot;æå››&quot;</span>, <span class="number">2</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">s1 = s3;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; &amp;s1 &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2022/png/29247941/1665923523186-23fc5042-b349-4418-abc2-3f816c892f7f.png#averageHue=%23272625&amp;clientId=u9a15f95a-cdec-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=277&amp;id=ua98444aa&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=415&amp;originWidth=633&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=31156&amp;status=done&amp;style=none&amp;taskId=ucc19a40c-5c37-435c-b800-e4ef171ef8d&amp;title=&amp;width=422" alt="image.png"></p><blockquote><p>æ„é€ æ—¶ï¼Œå…ˆè°ƒç”¨çˆ¶ç±»çš„æ„é€ ï¼Œå†è°ƒç”¨å­ç±»çš„ï¼Œææ„æ—¶å…ˆææ„å­ï¼Œå†ææ„çˆ¶ç±»</p></blockquote><h3 id="å­ç±»é»˜è®¤ç”Ÿæˆçš„æ„é€ å‡½æ•°">å­ç±»é»˜è®¤ç”Ÿæˆçš„æ„é€ å‡½æ•°</h3><ul><li>è‡ªå·±çš„æˆå‘˜ï¼Œè·Ÿç±»å’Œå¯¹è±¡ä¸€æ ·ï¼Œå†…ç½®ç±»å‹ä¸å¤„ç†ï¼Œè‡ªå®šä¹‰ç±»å‹è°ƒç”¨ä»–çš„é»˜è®¤æ„é€ </li><li>ç»§æ‰¿çˆ¶ç±»æˆå‘˜å¿…é¡»è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°åˆå§‹åŒ–</li></ul><h3 id="ç¼–è¯‘å™¨é»˜è®¤ç”Ÿæˆçš„ææ„å‡½æ•°">ç¼–è¯‘å™¨é»˜è®¤ç”Ÿæˆçš„ææ„å‡½æ•°</h3><ul><li>è‡ªå·±çš„æˆå‘˜ï¼Œ å†…ç½®ç±»å‹ä¸å¤„ç†ï¼Œè‡ªå®šä¹‰ç±»å‹è°ƒç”¨å®ƒçš„ææ„</li><li>ç»§æ‰¿çš„æˆå‘˜ï¼Œè°ƒç”¨çˆ¶ç±»ææ„å‡½æ•°å¤„ç†</li></ul><hr><h3 id="ç¼–è¯‘ç”Ÿæˆçš„é»˜è®¤æ‹·è´æ„é€ ">ç¼–è¯‘ç”Ÿæˆçš„é»˜è®¤æ‹·è´æ„é€ </h3><ul><li>è‡ªå·±æˆå‘˜ï¼Œè·Ÿç±»å’Œå¯¹è±¡ä¸€æ ·ï¼ˆå†…ç½®ç±»å‹ï¼Œå€¼æ‹·è´ï¼Œè‡ªå®šä¹‰ç±»å‹è°ƒç”¨å®ƒçš„æ‹·è´æ„é€ ï¼‰</li><li>ç»§æ‰¿çš„çˆ¶ç±»æˆå‘˜ï¼Œå¿…é¡»è°ƒç”¨çˆ¶ç±»æ‹·è´æ„é€ åˆå§‹åŒ–</li></ul><h3 id="ç¼–è¯‘å™¨é»˜è®¤ç”Ÿæˆçš„operator">ç¼–è¯‘å™¨é»˜è®¤ç”Ÿæˆçš„operator=</h3><p>åŒä¸Š</p><hr><h3 id="æ€»ç»“-2">æ€»ç»“</h3><ul><li>æ´¾ç”Ÿç±»çš„æ„é€ å‡½æ•°è°ƒç”¨æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨åŸºç±»çš„æ„é€ å‡½æ•°åˆå§‹åŒ–åŸºç±»çš„ä¸€éƒ¨åˆ†æˆå‘˜ï¼Œå¦‚æœåŸºç±»ä¸­æ²¡æœ‰é»˜è®¤æ„é€ å‡½æ•°åˆ™å¿…é¡»åœ¨æ´¾ç”Ÿç±»æ„é€ å‡½æ•°çš„åˆå§‹åŒ–åˆ—è¡¨ä¸­æ˜¾ç¤ºè°ƒç”¨åŸºç±»çš„æ„é€ å‡½æ•°</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2022/png/29247941/1665924438484-50f4e250-c115-464a-ab08-7aa2536ecf3e.png#averageHue=%23fdfaf9&amp;clientId=u9a15f95a-cdec-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=161&amp;id=sgyNG&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=241&amp;originWidth=650&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=25919&amp;status=done&amp;style=none&amp;taskId=uac21a5c0-4078-4e18-90a7-bc711541814&amp;title=&amp;width=433.3333333333333" alt="image.png"></p><ul><li>æ´¾ç”Ÿç±»çš„æ‹·è´æ„é€ å‡½æ•°å¿…é¡»è°ƒç”¨åŸºç±»çš„æ„é€ å‡½æ•°å®ŒæˆåŸºç±»æˆå‘˜çš„æ‹·è´æ„é€ </li></ul><p><img src="https://cdn.nlark.com/yuque/0/2022/png/29247941/1665924541930-3bcafcf9-c9a3-4fb7-9d91-74cea67322fd.png#averageHue=%23fdfbfa&amp;clientId=u9a15f95a-cdec-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=185&amp;id=ud658102a&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=277&amp;originWidth=850&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=31291&amp;status=done&amp;style=none&amp;taskId=u2622b831-0296-418f-81e4-0668e6475a3&amp;title=&amp;width=566.6666666666666" alt="image.png"></p><ul><li>æ´¾ç”Ÿç±»çš„èµ‹å€¼è¿ç®—ç¬¦é‡è½½å‡½æ•°å¿…é¡»è°ƒç”¨åŸºç±»çš„èµ‹å€¼è¿ç®—ç¬¦é‡è½½å‡½æ•°å®ŒæˆåŸºç±»æˆå‘˜çš„èµ‹å€¼</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2022/png/29247941/1665924642477-58801ec0-cd39-4c14-800d-68029738993d.png#averageHue=%23fefcfc&amp;clientId=u9a15f95a-cdec-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=349&amp;id=ubd1d7b31&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=524&amp;originWidth=1076&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=52453&amp;status=done&amp;style=none&amp;taskId=u1e8b2984-42cd-4bfe-ab36-30167408283&amp;title=&amp;width=717.3333333333334" alt="image.png"></p><ul><li>æ´¾ç”Ÿç±»çš„ææ„å‡½æ•°ä¼šä¼šåœ¨è¢«è°ƒç”¨å®Œæˆåè‡ªåŠ¨è°ƒç”¨åŸºç±»çš„ææ„å‡½æ•°æ¸…ç†åŸºç±»æˆå‘˜</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2022/png/29247941/1665924714654-705f1273-b934-4799-a0fc-b63b87e4d831.png#averageHue=%23fefdfd&amp;clientId=u9a15f95a-cdec-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=243&amp;id=u278f7ef6&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=364&amp;originWidth=1434&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=76014&amp;status=done&amp;style=none&amp;taskId=ua2ce9e09-5343-4181-86f3-e761020ab72&amp;title=&amp;width=956" alt="image.png"></p><ul><li>æ´¾ç”Ÿå¯¹è±¡åˆå§‹åŒ–æ—¶ï¼Œä¼šå…ˆè°ƒç”¨åŸºç±»çš„æ„é€ å‡½æ•°ï¼Œå†è°ƒç”¨æ´¾ç”Ÿç±»çš„æ„é€ å‡½æ•°</li></ul><blockquote><p>å¦å¤–å‡ ç‚¹æ³¨æ„</p></blockquote><ol><li>æ´¾ç”Ÿç±»å’ŒåŸºç±»çš„èµ‹å€¼è¿ç®—ç¬¦é‡è½½å‡½æ•°å› ä¸ºå‡½æ•°åç›¸åŒæ„é€ éšè—ï¼Œå› æ­¤åœ¨æ´¾ç”Ÿç±»å½“ä¸­ï¼Œè°ƒç”¨åŸºç±»çš„èµ‹å€¼è¿ç®—ç¬¦é‡è½½å‡½æ•°æ—¶ï¼Œéœ€è¦ä½¿ç”¨ä½œç”¨åŸŸé™å®šç¬¦æŒ‡å®šè°ƒç”¨</li><li>ç”±äºå¤šæ€çš„æŸäº›åŸå› ï¼Œä»»ä½•ç±»çš„ææ„å‡½æ•°åéƒ½è¢«ç»Ÿä¸€å¤„ç†ä¸ºdestructor()ï¼Œå› æ­¤ï¼Œæ´¾ç”Ÿç±»å’ŒåŸºç±»çš„ææ„å‡½æ•°å°±ä¼šå› ä¸ºå‡½æ•°åç›¸åŒæ„æˆéšè—ï¼Œå¦‚è‹¥æˆ‘ä»¬éœ€è¦åœ¨æŸå¤„æ˜¾ç¤ºè°ƒç”¨åŸºç±»çš„ææ„å‡½æ•°ï¼Œé‚£ä¹ˆå°±è¦ä½¿ç”¨ä½œç”¨åŸŸé™å®šç¬¦æŒ‡å®šè°ƒç”¨</li><li>åœ¨æ´¾ç”Ÿç±»çš„æ‹·è´æ„é€ å‡½æ•°å’Œoperator=å½“ä¸­è°ƒç”¨åŸºç±»çš„æ‹·è´æ„é€ å‡½æ•°ï¼Œä¼ å‚æ–¹å¼éƒ½æ˜¯åˆ‡ç‰‡è¡Œä¸ºï¼Œéƒ½æ˜¯å°†æ´¾ç”Ÿç±»å¯¹è±¡ç›´æ¥èµ‹å€¼ç»™åŸºç±»çš„å¼•ç”¨</li><li>åŸºç±»çš„æ„é€ ã€æ‹·è´æ„é€ ã€èµ‹å€¼æˆ‘ä»¬éƒ½å¯ä»¥åœ¨æ´¾ç”Ÿç±»ä¸­è‡ªè¡Œè°ƒç”¨ï¼Œä½†æ˜¯åŸºç±»ææ„æ˜¯å½“æ´¾ç”Ÿç±»ææ„å‡½æ•°è°ƒç”¨åç”±ç¼–è¯‘å™¨è‡ªåŠ¨è°ƒç”¨çš„ï¼Œå¦‚æœæˆ‘ä»¬æ˜¾ç¤ºè°ƒç”¨åŸºç±»ææ„å‡½æ•°ï¼Œä¼šå¯¼è‡´åŸºç±»è¢«ææ„å¤šæ¬¡</li><li>åˆ›å»ºæ´¾ç”Ÿç±»å¯¹è±¡æ—¶æ˜¯å…ˆåˆ›å»ºåŸºç±»æˆå‘˜å†åˆ›å»ºæ´¾ç”Ÿç±»æˆå‘˜ï¼Œç¼–è¯‘å™¨ä¸ºäº†ä¿è¯å…ˆå®šä¹‰çš„åææ„ï¼Œæ‰€ä»¥è‡ªåŠ¨è°ƒç”¨åŸºç±»çš„ææ„å‡½æ•°</li></ol><h2 id="ç»§æ‰¿ä¸å‹å…ƒ">ç»§æ‰¿ä¸å‹å…ƒ</h2><p>å‹å…ƒå…³ç³»ä¸èƒ½ç»§æ‰¿ï¼ŒåŸºç±»çš„å‹å…ƒå‡½æ•°ï¼Œä¸èƒ½è®¿é—®æ´¾ç”Ÿç±»çš„ç§æœ‰å’Œä¿æŠ¤</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="keyword">friend</span> <span class="type">void</span> <span class="title">Display</span><span class="params">(<span class="type">const</span> Person&amp; p, <span class="type">const</span> Student&amp; s)</span></span>;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">string _name; <span class="comment">// å§“å</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> : <span class="keyword">public</span> Person</span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="keyword">friend</span> <span class="type">void</span> <span class="title">Display</span><span class="params">(<span class="type">const</span> Person&amp; p, <span class="type">const</span> Student&amp; s)</span></span>; <span class="comment">//è¿™é‡Œä¸åŠ ä¼šæŠ¥é”™</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"><span class="type">int</span> _stuNum; <span class="comment">// å­¦å·</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Display</span><span class="params">(<span class="type">const</span> Person&amp; p, <span class="type">const</span> Student&amp; s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; p._name &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; s._stuNum &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Person p;</span><br><span class="line">Student s;</span><br><span class="line"><span class="built_in">Display</span>(p, s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»§æ‰¿ä¸é™æ€æˆå‘˜">ç»§æ‰¿ä¸é™æ€æˆå‘˜</h2><p>è‹¥åŸºç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªstaticé™æ€æˆå‘˜å˜é‡ï¼Œé‚£ä¹ˆåœ¨æ•´ä¸ªç»§æ‰¿ä½“ç³»ä¸­åªæœ‰ä¸€ä¸ªè¯¥é™æ€æˆå‘˜ï¼Œæ— è®ºæ´¾ç”Ÿå‡ºå¤šå°‘ä¸ªå­ç±»ï¼Œéƒ½åªæœ‰ä¸€ä¸ªstaticæˆå‘˜å®ä¾‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">Person</span>() &#123; ++_count; &#125;</span><br><span class="line"><span class="comment">//protected:</span></span><br><span class="line">string _name; <span class="comment">// å§“å</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="type">static</span> <span class="type">int</span> _count; <span class="comment">// ç»Ÿè®¡äººçš„ä¸ªæ•°ã€‚</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> Person::_count = <span class="number">0</span>;   <span class="comment">//é™æ€æˆå‘˜å˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> : <span class="keyword">public</span> Person</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"><span class="type">int</span> _stuNum; <span class="comment">// å­¦å·</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Person p;</span><br><span class="line">Student s;</span><br><span class="line"></span><br><span class="line">p._name = <span class="string">&quot;å¼ ä¸‰&quot;</span>;</span><br><span class="line">cout &lt;&lt; s._name &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; Student::_count &lt;&lt; endl;</span><br><span class="line">++Person::_count;</span><br><span class="line">cout &lt;&lt; Student::_count &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; &amp;Person::_count &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; &amp;Student::_count &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç è¯´æ˜ï¼š</p><ul><li>å­ç±» count++  çˆ¶ç±» ä¹Ÿä¼š++</li><li>ä¸¤ä¸ªcount åœ°å€ç›¸åŒ</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2022/png/29247941/1665926120982-afd1f668-5895-4c23-b042-5891253899d1.png#averageHue=%23434140&amp;clientId=u9a15f95a-cdec-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=117&amp;id=u275c88b4&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=176&amp;originWidth=350&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=7607&amp;status=done&amp;style=none&amp;taskId=u0b735a34-b8a5-4c78-9dc3-bae9a28d15b&amp;title=&amp;width=233.33333333333334" alt="image.png"></p><h2 id="å¤æ‚çš„è±å½¢ç»§æ‰¿åŠè±å½¢è™šæ‹Ÿç»§æ‰¿">å¤æ‚çš„è±å½¢ç»§æ‰¿åŠè±å½¢è™šæ‹Ÿç»§æ‰¿</h2><h3 id="å¦‚ä½•å®šä¹‰ä¸€ä¸ªä¸èƒ½è¢«ç»§æ‰¿çš„ç±»">å¦‚ä½•å®šä¹‰ä¸€ä¸ªä¸èƒ½è¢«ç»§æ‰¿çš„ç±»</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> <span class="keyword">final</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="built_in">A</span>()</span><br><span class="line">&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"><span class="type">int</span> _a;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> : <span class="keyword">public</span> A</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// C++98</span></span><br><span class="line"><span class="comment">// 1ã€çˆ¶ç±»æ„é€ å‡½æ•°ç§æœ‰-- å­ç±»æ˜¯ä¸å¯è§</span></span><br><span class="line"><span class="comment">// 2ã€å­ç±»å¯¹è±¡å®ä¾‹åŒ–ï¼Œæ— æ³•è°ƒç”¨æ„é€ å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// C++11</span></span><br><span class="line"><span class="comment">// final</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//B bb;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2022/png/29247941/1665926275604-95484c9a-7dfe-4e5a-ac44-6069a199abba.png#averageHue=%236babdf&amp;clientId=u9a15f95a-cdec-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=49&amp;id=ue4cf0d64&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=74&amp;originWidth=1462&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=14903&amp;status=done&amp;style=none&amp;taskId=ubf9c4de1-9e31-4ece-aefc-d9ce21309b6&amp;title=&amp;width=974.6666666666666" alt="image.png"></p><h3 id="ç»§æ‰¿æ–¹å¼">ç»§æ‰¿æ–¹å¼</h3><blockquote><p>å•ç»§æ‰¿ï¼šä¸€ä¸ªå­ç±»åªæœ‰ä¸€ä¸ªç›´æ¥çˆ¶ç±»</p></blockquote><p><img src="https://cdn.nlark.com/yuque/0/2022/png/29247941/1665926407861-410505cc-54ef-4f2c-b258-fa75dcae5bbf.png#averageHue=%23f6f6f6&amp;clientId=u9a15f95a-cdec-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=440&amp;id=u3930072f&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=660&amp;originWidth=1050&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=4930&amp;status=done&amp;style=none&amp;taskId=u22cdf83d-7d24-445d-b7a4-60c1bb39e82&amp;title=&amp;width=700" alt="image.png"></p><blockquote><p>å¤šç»§æ‰¿ï¼šä¸€ä¸ªå­ç±»æœ‰ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šç›´æ¥çˆ¶ç±»</p></blockquote><p><img src="https://cdn.nlark.com/yuque/0/2022/png/29247941/1665926491715-d1faab7e-ac2e-462b-9b8a-bcb641e79382.png#averageHue=%23f7f7f7&amp;clientId=u9a15f95a-cdec-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=341&amp;id=u186177c4&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=511&amp;originWidth=974&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=4295&amp;status=done&amp;style=none&amp;taskId=uddca721d-77c1-467c-9cec-0ca4dc91358&amp;title=&amp;width=649.3333333333334" alt="image.png"></p><blockquote><p>è±å½¢ç»§æ‰¿ï¼šå¤šç»§æ‰¿çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µ</p></blockquote><p><img src="https://cdn.nlark.com/yuque/0/2022/png/29247941/1665926639901-30398b6a-75ad-4a1c-a4e4-6acbe0258f5e.png#averageHue=%23f8f8f8&amp;clientId=u9a15f95a-cdec-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=527&amp;id=uc7e73fba&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=791&amp;originWidth=955&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=6898&amp;status=done&amp;style=none&amp;taskId=ue910af18-9434-4c87-b8e7-42cbf793754&amp;title=&amp;width=636.6666666666666" alt="image.png"><br>è±å½¢ç»§æ‰¿çš„æ–¹å¼å­˜åœ¨æ•°æ®å†—ä½™å’ŒäºŒä¹‰æ€§çš„é—®é¢˜</p><h3 id="ä¸€ä¸ªé¢˜">ä¸€ä¸ªé¢˜</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base1</span> &#123; <span class="keyword">public</span>:  <span class="type">int</span> _b1; &#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Base2</span> &#123; <span class="keyword">public</span>:  <span class="type">int</span> _b2; &#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derive</span> : <span class="keyword">public</span> Base1, <span class="keyword">public</span> Base2 &#123; <span class="keyword">public</span>: <span class="type">int</span> _d; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Derive d;</span><br><span class="line">Base1* p1 = &amp;d;</span><br><span class="line">Base2* p2 = &amp;d;</span><br><span class="line">Derive* p3 = &amp;d;</span><br><span class="line"></span><br><span class="line">d._b1 = <span class="number">1</span>;</span><br><span class="line">d._b2 = <span class="number">2</span>;</span><br><span class="line">d._d = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; p1 &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; p2 &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; p3 &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>P1 P2 P3çš„å…³ç³»ï¼š â€œå…ˆä½¿ç”¨äº†ä½åœ°å€â€<br>p1==p3&lt;p2</p><p><strong>è§£é‡Šï¼š</strong><br><img src="https://cdn.nlark.com/yuque/0/2022/png/29247941/1665927761574-109c0daa-a64d-4ec2-bbe9-45e38bb19a86.png#averageHue=%23f6f6f6&amp;clientId=u9a15f95a-cdec-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=213&amp;id=u4533b4cf&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=319&amp;originWidth=1360&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=13067&amp;status=done&amp;style=none&amp;taskId=u4141fed7-a89e-4356-a6ed-b01929f0ef3&amp;title=&amp;width=906.6666666666666" alt="image.png"><br><strong>è¯¥ç±»å¯¹è±¡æ¨¡å‹ï¼š</strong><br><img src="https://cdn.nlark.com/yuque/0/2022/png/29247941/1665927183117-40ca8bae-cd49-4b91-996f-06263871b07a.png#averageHue=%23fefefe&amp;clientId=u9a15f95a-cdec-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=500&amp;id=u3aa93300&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=750&amp;originWidth=822&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=15161&amp;status=done&amp;style=none&amp;taskId=u545af6a6-487d-4e0d-8c91-d2cb5c94944&amp;title=&amp;width=548" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/29247941/1665927302508-4e02ebc3-cecc-410a-9e73-a5addf5a7c05.png#averageHue=%23f0c782&amp;clientId=u9a15f95a-cdec-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=147&amp;id=u927f6c7f&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=220&amp;originWidth=492&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=13295&amp;status=done&amp;style=none&amp;taskId=ua3c395ac-74f6-4cbc-91c0-47180a97f08&amp;title=&amp;width=328" alt="image.png"></p><p>&amp;d çœ‹åˆ°å†…å­˜ä¿¡æ¯ï¼Œ01åœ°å€æœ€ä½ï¼Œä¹Ÿå°±æ˜¯_b1çš„åœ°å€æœ€ä½ï¼Œbase1æ˜¯å…ˆç»§æ‰¿çš„ï¼Œæ‰€ä»¥åœ°å€æœ€ä½ï¼Œæˆ‘ä»¬ä¼ ç»Ÿçš„æƒ³æ³•æ˜¯æ ˆæ˜¯å‘ä¸‹å¢é•¿ï¼Œå…ˆä½¿ç”¨é«˜åœ°å€å†ä½¿ç”¨ä½åœ°å€ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªå¯¹è±¡é‡Œæˆå‘˜å°±åƒå€’ç€å­˜ä¸€æ ·</p><h3 id="è±å½¢ç»§æ‰¿çš„é—®é¢˜">è±å½¢ç»§æ‰¿çš„é—®é¢˜</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">string _name; <span class="comment">// å§“å</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// int _age;</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> : <span class="keyword">public</span> Person</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"><span class="type">int</span> _num; <span class="comment">//å­¦å·</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Teacher</span> : <span class="keyword">public</span> Person</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"><span class="type">int</span> _id; <span class="comment">// èŒå·¥ç¼–å·</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Assistant</span> : <span class="keyword">public</span> Student, <span class="keyword">public</span> Teacher</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">string _majorCourse; <span class="comment">// ä¸»ä¿®è¯¾ç¨‹</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Assistant at;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è±å½¢ç»§æ‰¿çš„äºŒä¹‰æ€§é—®é¢˜</span></span><br><span class="line"><span class="comment">// æ•°æ®å†—ä½™</span></span><br><span class="line"><span class="comment">//at._name = &quot;å¼ ä¸‰&quot;;</span></span><br><span class="line">at.Student::_name = <span class="string">&quot;å¼ ä¸‰&quot;</span>;</span><br><span class="line">at.Teacher::_name = <span class="string">&quot;æå››&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äºŒä¹‰æ€§å¯ä»¥é€šè¿‡æŒ‡å®šç±»åŸŸè§£å†³ï¼Œä½†æ˜¯æ•°æ®å†—ä½™çš„é—®é¢˜è¿˜æ˜¯æ— æ³•è§£å†³ï¼ŒAssistantè¿™ä¸ªç±»ä¸­æœ‰ä¸¤ä»½çš„_name.<br><img src="https://cdn.nlark.com/yuque/0/2022/png/29247941/1665928284321-c1616231-08cd-4c01-9c15-460c7727b0ce.png#averageHue=%23f9f8f6&amp;clientId=u9a15f95a-cdec-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=193&amp;id=u4fe948a1&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=290&amp;originWidth=869&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=26788&amp;status=done&amp;style=none&amp;taskId=u42b53a14-4f5b-4850-8c9c-3001e700fd0&amp;title=&amp;width=579.3333333333334" alt="image.png"></p><blockquote><p>è¿™æ—¶å€™éœ€è¦ç”¨è±å½¢è™šæ‹Ÿç»§æ‰¿ï¼Œç”¨æ³•å°±æ˜¯åœ¨ç»§æ‰¿æ–¹å¼å‰è¾¹åŠ ä¸€ä¸ªvirtualï¼Œåœ¨è±å½¢ç»§æ‰¿çš„è…°éƒ¨åŠ virtual</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">string _name; <span class="comment">// å§“å</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// int _age;</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> : <span class="keyword">virtual</span> <span class="keyword">public</span> Person</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"><span class="type">int</span> _num; <span class="comment">//å­¦å·</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Teacher</span> : <span class="keyword">virtual</span> <span class="keyword">public</span> Person</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"><span class="type">int</span> _id; <span class="comment">// èŒå·¥ç¼–å·</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Assistant</span> : <span class="keyword">public</span> Student, <span class="keyword">public</span> Teacher</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">string _majorCourse; <span class="comment">// ä¸»ä¿®è¯¾ç¨‹</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Assistant at;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è±å½¢è™šæ‹Ÿç»§æ‰¿è§£å†³äº†äºŒä¹‰æ€§å’Œæ•°æ®å†—ä½™</span></span><br><span class="line">at._name = <span class="string">&quot;å°å¼ &quot;</span>;</span><br><span class="line">at.Student::_name = <span class="string">&quot;å¼ ä¸‰&quot;</span>;</span><br><span class="line">at.Teacher::_name = <span class="string">&quot;æå››&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2022/png/29247941/1665928541044-58906662-6534-4929-a125-f71ed144504f.png#averageHue=%23fcfaf9&amp;clientId=u9a15f95a-cdec-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=451&amp;id=u505afb34&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=677&amp;originWidth=2084&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=166970&amp;status=done&amp;style=none&amp;taskId=u0a404cfc-23d6-4b61-a3ee-974587803bc&amp;title=&amp;width=1389.3333333333333" alt="image.png"></p><p><img src="https://cdn.nlark.com/yuque/0/2022/png/29247941/1665928728293-6786235e-8f54-4ebf-b745-42eee72ca4f8.png#averageHue=%23fcfaf8&amp;clientId=u9a15f95a-cdec-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=369&amp;id=u06883c63&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=553&amp;originWidth=2083&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=142280&amp;status=done&amp;style=none&amp;taskId=u9d3c0d5f-83fd-45c0-aff8-ab9ca53cf71&amp;title=&amp;width=1388.6666666666667" alt="image.png"></p><p>è¿™é‡Œè§£å†³äº†æ•°æ®å†—ä½™çš„é—®é¢˜ï¼Œå› ä¸º_nameéƒ½æ˜¯ä¸€ä¸ª</p><h3 id="è™šæ‹Ÿç»§æ‰¿çš„å¯¹è±¡æ¨¡å‹">è™šæ‹Ÿç»§æ‰¿çš„å¯¹è±¡æ¨¡å‹</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="type">int</span> _a;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//class B : public A</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> : <span class="keyword">virtual</span> <span class="keyword">public</span> A</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="type">int</span> _b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//class C : public A</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span> : <span class="keyword">virtual</span> <span class="keyword">public</span> A</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="type">int</span> _c;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">D</span> : <span class="keyword">public</span> B, <span class="keyword">public</span> C</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="type">int</span> _d;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">D d;</span><br><span class="line">d.B::_a = <span class="number">1</span>;</span><br><span class="line">d.C::_a = <span class="number">2</span>;</span><br><span class="line">d._a = <span class="number">0</span>;</span><br><span class="line">d._b = <span class="number">3</span>;</span><br><span class="line">d._c = <span class="number">4</span>;</span><br><span class="line">d._d = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">B b = d;</span><br><span class="line">B* pb = &amp;d;</span><br><span class="line"></span><br><span class="line">C c = d;</span><br><span class="line">C* pc = &amp;d;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æœ‰è™šæ‹Ÿç»§æ‰¿</strong><br><img src="https://cdn.nlark.com/yuque/0/2022/png/29247941/1665929216002-77d2109f-1280-486a-96e7-f30915b7517d.png#averageHue=%23e1be87&amp;clientId=u9a15f95a-cdec-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=737&amp;id=ua5ea4805&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1105&amp;originWidth=2077&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=258149&amp;status=done&amp;style=none&amp;taskId=ud8ef7aeb-9160-48cc-be1e-0e2c6c56464&amp;title=&amp;width=1384.6666666666667" alt="image.png"><br>æˆ‘ä»¬æ¥çœ‹å†…å­˜çš„å…·ä½“ä¿¡æ¯<br><img src="https://cdn.nlark.com/yuque/0/2022/png/29247941/1665930343351-8fa3f176-7e43-4803-87a5-f421bc79d7e9.png#averageHue=%23fcfaf7&amp;clientId=u9a15f95a-cdec-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=467&amp;id=uae4d76fa&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=700&amp;originWidth=1957&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=97769&amp;status=done&amp;style=none&amp;taskId=u0761c169-fa35-4371-b9f6-72127f42028&amp;title=&amp;width=1304.6666666666667" alt="image.png"></p><p>è™šæ‹Ÿç»§æ‰¿åç±»å¯¹è±¡æ¨¡å‹å˜æˆäº†å¦‚ä¸‹<br><img src="https://cdn.nlark.com/yuque/0/2022/png/29247941/1665930553735-f608a98b-8117-440e-aa4b-242da677bd08.png#averageHue=%23fefdfd&amp;clientId=u9a15f95a-cdec-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=507&amp;id=u8e90a8c2&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=761&amp;originWidth=903&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=10332&amp;status=done&amp;style=none&amp;taskId=ub30041f5-98e6-4109-9076-6fc6db9a7db&amp;title=&amp;width=602" alt="image.png"><br>å¯¹è±¡é‡Œé¢æœ‰äº†ä¸¤ä¸ªæŒ‡é’ˆï¼Œå«åšè™šåŸºè¡¨æŒ‡é’ˆï¼Œä»–ä»¬åˆ†åˆ«æŒ‡å‘ä¸€ä¸ªè™šåŸºè¡¨ï¼Œè™šåŸºè¡¨ä¸­åŒ…å«ä¸¤ä¸ªæ•°æ®ï¼Œç¬¬ä¸€ä¸ªæ˜¯ä¸ºå¤šæ€çš„è™šè¡¨é¢„ç•™çš„å­˜åç§»é‡çš„ä½ç½®ï¼Œç¬¬äºŒä¸ªæ•°æ®å°±æ˜¯å½“å‰ç±»å¯¹è±¡ä½ç½®è·ç¦»å…¬å…±è™šåŸºç±»çš„åç§»é‡</p><p><strong>å¦‚æœæ²¡æœ‰è™šæ‹Ÿç»§æ‰¿</strong><br><img src="https://cdn.nlark.com/yuque/0/2022/png/29247941/1665930786365-d351fcb7-1648-4c4b-b52c-7baf6d006387.png#averageHue=%23fcfcfb&amp;clientId=u9a15f95a-cdec-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=274&amp;id=u82e87a07&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=411&amp;originWidth=1246&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=35325&amp;status=done&amp;style=none&amp;taskId=ue79b9a48-1be0-434b-a73c-d38be29be6b&amp;title=&amp;width=830.6666666666666" alt="image.png"></p><p><img src="https://cdn.nlark.com/yuque/0/2022/png/29247941/1665930848594-a73182f0-67fa-44d2-bbd0-67e7249ae9c0.png#averageHue=%23fefdfd&amp;clientId=u9a15f95a-cdec-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=485&amp;id=ud37b8164&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=727&amp;originWidth=723&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=9686&amp;status=done&amp;style=none&amp;taskId=u67aee36b-3cdf-4e57-8ff9-f334d68402e&amp;title=&amp;width=482" alt="image.png"><br>è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œå¥½åƒä½¿ç”¨è™šæ‹Ÿç»§æ‰¿å’Œä¸ç”¨è™šæ‹Ÿç»§æ‰¿ç©ºé—´æ˜¯æ¶ˆè€—äº†ç›¸åŒçš„ï¼Œä½†æ˜¯ï¼Œå¦‚æœAçš„_aæ˜¯ä¸ªå¤§å¯¹è±¡ï¼Œå°±ä¼šçœç©ºé—´ã€‚<br>æ³¨ï¼šå¦‚æœï¼Œå°†Dç±»å¯¹è±¡ï¼Œèµ‹å€¼ç»™Bç±»å¯¹è±¡ï¼Œåœ¨è¿™ä¸ªåˆ‡ç‰‡è¿‡ç¨‹ä¸­ï¼Œå°±éœ€è¦é€šè¿‡è™šåŸºè¡¨ä¸­çš„ç¬¬äºŒä¸ªæ•°æ®æ‰¾åˆ°å…¬å…±è™šåŸºç±»Açš„æˆå‘˜ï¼Œå¾—åˆ°åˆ‡ç‰‡åï¼Œè¯¥Bç±»å¯¹è±¡åœ¨å†…å­˜ä¸­ä»ç„¶ä¿æŒè¿™ç§åˆ†å¸ƒã€‚<br><img src="https://cdn.nlark.com/yuque/0/2022/png/29247941/1665931305427-e4136cd3-ae7a-44c6-bc95-c2608d9ad85f.png#averageHue=%23fdfdfd&amp;clientId=u9a15f95a-cdec-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=218&amp;id=u6318824f&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=327&amp;originWidth=439&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=17436&amp;status=done&amp;style=none&amp;taskId=u29ac3bc0-c7a4-46c6-b52d-d4374cf633b&amp;title=&amp;width=292.6666666666667" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/29247941/1665931293362-77525e34-b172-4107-8d56-fcc8b432e9cb.png#averageHue=%23f3e8d8&amp;clientId=u9a15f95a-cdec-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=128&amp;id=u93c161c3&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=192&amp;originWidth=372&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=11212&amp;status=done&amp;style=none&amp;taskId=u55bee722-0a8f-4764-9058-9478555dc00&amp;title=&amp;width=248" alt="image.png"></p><h2 id="ç»§æ‰¿çš„æ€»ç»“å’Œåæ€">ç»§æ‰¿çš„æ€»ç»“å’Œåæ€</h2><p>æ‰€ä»¥ä¸€èˆ¬ä¸å»ºè®®è®¾è®¡å‡ºå¤šç»§æ‰¿ï¼Œä¸€å®šä¸è¦è®¾è®¡å‡ºè±å½¢ç»§æ‰¿ã€‚å¦åˆ™åœ¨å¤æ‚åº¦åŠæ€§èƒ½ä¸Šéƒ½æœ‰é—®é¢˜ã€‚å¤šç»§æ‰¿å¯ä»¥è®¤ä¸ºæ˜¯C++çš„ç¼ºé™·ä¹‹ä¸€ï¼Œå¾ˆå¤šåæ¥çš„OOè¯­è¨€éƒ½æ²¡æœ‰å¤šç»§æ‰¿ï¼Œå¦‚Javaã€‚</p><h3 id="ç»§æ‰¿å’Œç»„åˆ">ç»§æ‰¿å’Œç»„åˆ</h3><ul><li>publicç»§æ‰¿æ˜¯ä¸€ç§is-açš„å…³ç³»ã€‚ä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªæ´¾ç”Ÿç±»å¯¹è±¡éƒ½æ˜¯ä¸€ä¸ªåŸºç±»å¯¹è±¡ã€‚</li><li>ç»„åˆæ˜¯ä¸€ç§has-açš„å…³ç³»ã€‚å‡è®¾Bç»„åˆäº†Aï¼Œæ¯ä¸ªBå¯¹è±¡ä¸­éƒ½æœ‰ä¸€ä¸ªAå¯¹è±¡ã€‚</li></ul><p>ç»§æ‰¿å…è®¸ä½ æ ¹æ®åŸºç±»çš„å®ç°æ¥å®šä¹‰æ´¾ç”Ÿç±»çš„å®ç°ã€‚è¿™ç§é€šè¿‡ç”Ÿæˆæ´¾ç”Ÿç±»çš„å¤ç”¨é€šå¸¸è¢«ç§°<br>ä¸ºç™½ç®±å¤ç”¨(white-box reuse)ã€‚æœ¯è¯­â€œç™½ç®±â€æ˜¯ç›¸å¯¹å¯è§†æ€§è€Œè¨€ï¼šåœ¨ç»§æ‰¿æ–¹å¼ä¸­ï¼ŒåŸºç±»çš„<br>å†…éƒ¨ç»†èŠ‚å¯¹å­ç±»å¯è§ ã€‚ç»§æ‰¿ä¸€å®šç¨‹åº¦ç ´åäº†åŸºç±»çš„å°è£…ï¼ŒåŸºç±»çš„æ”¹å˜ï¼Œå¯¹æ´¾ç”Ÿç±»æœ‰å¾ˆ<br>å¤§çš„å½±å“ã€‚æ´¾ç”Ÿç±»å’ŒåŸºç±»é—´çš„ä¾èµ–å…³ç³»å¾ˆå¼ºï¼Œè€¦åˆåº¦é«˜ã€‚</p><p>å¯¹è±¡ç»„åˆæ˜¯ç±»ç»§æ‰¿ä¹‹å¤–çš„å¦ä¸€ç§å¤ç”¨é€‰æ‹©ã€‚æ–°çš„æ›´å¤æ‚çš„åŠŸèƒ½å¯ä»¥é€šè¿‡ç»„è£…æˆ–ç»„åˆå¯¹è±¡<br>æ¥è·å¾—ã€‚å¯¹è±¡ç»„åˆè¦æ±‚è¢«ç»„åˆçš„å¯¹è±¡å…·æœ‰è‰¯å¥½å®šä¹‰çš„æ¥å£ã€‚è¿™ç§å¤ç”¨é£æ ¼è¢«ç§°ä¸ºé»‘ç®±å¤<br>ç”¨(black-box reuse)ï¼Œå› ä¸ºå¯¹è±¡çš„å†…éƒ¨ç»†èŠ‚æ˜¯ä¸å¯è§çš„ã€‚å¯¹è±¡åªä»¥â€œé»‘ç®±â€çš„å½¢å¼å‡ºç°ã€‚<br>ç»„åˆç±»ä¹‹é—´æ²¡æœ‰å¾ˆå¼ºçš„ä¾èµ–å…³ç³»ï¼Œè€¦åˆåº¦ä½ã€‚ä¼˜å…ˆä½¿ç”¨å¯¹è±¡ç»„åˆæœ‰åŠ©äºä½ ä¿æŒæ¯ä¸ªç±»è¢«<br>å°è£…ã€‚</p><p>å®é™…å°½é‡å¤šå»ç”¨ç»„åˆã€‚ç»„åˆçš„è€¦åˆåº¦ä½ï¼Œä»£ç ç»´æŠ¤æ€§å¥½ã€‚ä¸è¿‡ç»§æ‰¿ä¹Ÿæœ‰ç”¨æ­¦ä¹‹åœ°çš„ï¼Œæœ‰<br>äº›å…³ç³»å°±é€‚åˆç»§æ‰¿é‚£å°±ç”¨ç»§æ‰¿ï¼Œå¦å¤–è¦å®ç°å¤šæ€ï¼Œä¹Ÿå¿…é¡»è¦ç»§æ‰¿ã€‚ç±»ä¹‹é—´çš„å…³ç³»å¯ä»¥ç”¨<br>ç»§æ‰¿ï¼Œå¯ä»¥ç”¨ç»„åˆï¼Œå°±ç”¨ç»„åˆ</p><p><img src="https://cdn.nlark.com/yuque/0/2022/png/29247941/1665932203320-44346fb6-7516-4f7c-98c6-c400b8a66dff.png#averageHue=%23fcfcfc&amp;clientId=uf24a1cd6-4779-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=368&amp;id=ub1ac8a38&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=552&amp;originWidth=1114&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=47650&amp;status=done&amp;style=none&amp;taskId=ua8df4665-72a3-45e4-a680-44f1d967f22&amp;title=&amp;width=742.6666666666666" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹è¯­è¨€ </category>
          
          <category> CPP </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>markdownè¯­æ³•</title>
      <link href="/posts/4046760165/"/>
      <url>/posts/4046760165/</url>
      
        <content type="html"><![CDATA[<h1>å­—ä½“</h1><h2 id="æ–œä½“">æ–œä½“</h2><blockquote><p>ä¸¤ä¸ªä¸‹åˆ’çº¿ï¼Œæˆ–è€…ä¸¤ä¸ªæ˜Ÿå·</p></blockquote><p><em>æ–œä½“</em><br><em>æ–œä½“</em></p><h2 id="ç²—ä½“">ç²—ä½“</h2><blockquote><p>ä¸¤ä¸ªä¸‹åˆ’çº¿æˆ–è€…ä¸¤ä¸ªæ˜Ÿå·</p></blockquote><p><strong>ç²—ä½“</strong><br><strong>ç²—ä½“</strong></p><h2 id="ç»„åˆ">ç»„åˆ</h2><blockquote><p>ä¸‰ä¸ªæ˜Ÿå·ï¼Œæˆ–è€…ä¸‰ä¸ªä¸‹åˆ’çº¿ï¼Œç²—æ–œä½“</p></blockquote><p><em><strong>ç²—æ–œä½“</strong></em></p><h2 id="åˆ é™¤çº¿">åˆ é™¤çº¿</h2><blockquote><p>å‰åä¸¤ä¸ª~~</p></blockquote><p><s>åˆ é™¤çº¿</s></p><h2 id="ä¸‹åˆ’çº¿">ä¸‹åˆ’çº¿</h2><blockquote><p><u> </u></p></blockquote><p><u> ä¸‹åˆ’çº¿</u></p><h1>åŒºå—</h1><blockquote><p>ä¸€ä¸ª&gt;ä¸¤ä¸ª&gt;&gt;ä¸‰ä¸ª&gt;&gt;&gt;</p></blockquote><blockquote><p>1</p><blockquote><p>2</p><blockquote><p>3</p></blockquote></blockquote></blockquote><h1>è¡¨æ ¼</h1><blockquote><p>åŠ  : å¯ä»¥å®ç°å·¦å¯¹é½ï¼Œå³å¯¹é½ï¼Œå±…ä¸­ï¼Œä¸åŠ é»˜è®¤å·¦å¯¹é½</p></blockquote><table><thead><tr><th style="text-align:left">è¡¨å¤´</th><th style="text-align:left">è¡¨å¤´</th><th style="text-align:left">è¡¨å¤´</th></tr></thead><tbody><tr><td style="text-align:left">å•å…ƒæ ¼</td><td style="text-align:left">å•å…ƒæ ¼</td><td style="text-align:left">å•å…ƒæ ¼</td></tr><tr><td style="text-align:left">å•å…ƒæ ¼</td><td style="text-align:left">å•å…ƒæ ¼</td><td style="text-align:left">å•å…ƒæ ¼</td></tr></tbody></table><h1>mermaid</h1><h2 id="æµç¨‹å›¾">æµç¨‹å›¾</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">flowchart LR</span><br><span class="line">A[Hard] --&gt;|Text| B(Round)</span><br><span class="line">B --&gt; C&#123;Decision&#125;</span><br><span class="line">C --&gt;|One| D[Result 1]</span><br><span class="line">C --&gt;|Two| E[Result 2]</span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:center">TD</th><th style="text-align:center">TB</th><th style="text-align:center">BT</th><th style="text-align:center">RL</th><th style="text-align:center">LR</th></tr></thead><tbody><tr><td style="text-align:center">ä¸Šåˆ°ä¸‹</td><td style="text-align:center">ä¸Šåˆ°ä¸‹</td><td style="text-align:center">ä¸‹åˆ°ä¸Š</td><td style="text-align:center">å³åˆ°å·¦</td><td style="text-align:center">å·¦åˆ°å³</td></tr></tbody></table><h2 id="é¥¼å›¾">é¥¼å›¾</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pie</span><br><span class="line">    title ä¸ºä»€ä¹ˆæ€»æ˜¯å®…åœ¨å®¶é‡Œï¼Ÿ</span><br><span class="line">    &quot;å–œæ¬¢å®…&quot; : 45</span><br><span class="line">    &quot;å¤©æ°”å¤ªçƒ­&quot; : 70</span><br><span class="line">    &quot;ç©·&quot; : 500</span><br><span class="line">&quot;å…³ä½ å±äº‹&quot; : 95</span><br></pre></td></tr></table></figure><h2 id="ç±»å›¾">ç±»å›¾</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">    Animal &lt;|-- Duck</span><br><span class="line">    Animal &lt;|-- Fish</span><br><span class="line">    Animal &lt;|-- Zebra</span><br><span class="line">    Animal : +int age</span><br><span class="line">    Animal : +String gender</span><br><span class="line">    Animal: +isMammal()</span><br><span class="line">    Animal: +mate()</span><br><span class="line">    class Duck&#123;</span><br><span class="line">      +String beakColor</span><br><span class="line">      +swim()</span><br><span class="line">      +quack()</span><br><span class="line">    &#125;</span><br><span class="line">    class Fish&#123;</span><br><span class="line">      -int sizeInFeet</span><br><span class="line">      -canEat()</span><br><span class="line">    &#125;</span><br><span class="line">    class Zebra&#123;</span><br><span class="line">      +bool is_wild</span><br><span class="line">      +run()</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ing</p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
          <category> markdown </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç‰¹æ®Šç±»è®¾è®¡</title>
      <link href="/posts/540862120/"/>
      <url>/posts/540862120/</url>
      
        <content type="html"><![CDATA[<h1>è®¾è®¡ä¸èƒ½è¢«æ‹·è´çš„ç±»</h1><blockquote><p>c++11æ˜¯ä¸‹è¾¹çš„ç”¨æ³•ï¼Œc++98å°±æ˜¯å°†æ‹·è´æ„é€ å˜æˆç§æœ‰ï¼Œå¹¶ä¸”åªå£°æ˜å¹¶ä¸å®ç°</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">A</span>(<span class="type">int</span> val):_val(val)&#123;&#125;</span><br><span class="line"><span class="built_in">A</span>(<span class="type">const</span> A&amp; a) = <span class="keyword">delete</span>;</span><br><span class="line">A&amp; <span class="keyword">operator</span>=(<span class="type">const</span> A&amp; a) = <span class="keyword">delete</span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="type">int</span> _val;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1>è®¾è®¡åªèƒ½åœ¨å †ä¸Šåˆ›å»ºçš„ç±»</h1><blockquote><p>æ–¹æ¡ˆ1ã€å°†ææ„å‡½æ•°ç§æœ‰åŒ–</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">HeapOnly</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">destroy</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">~<span class="built_in">HeapOnly</span>()&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">HeapOnly* hp = <span class="keyword">new</span> HeapOnly;</span><br><span class="line">hp-&gt;<span class="built_in">destroy</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ–¹æ¡ˆ2ã€æ„é€ å‡½æ•°ç§æœ‰</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">HeapOnly</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">static</span> HeapOnly* <span class="title">CreatObj</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> HeapOnly;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é˜²æ­¢æ‹·è´</span></span><br><span class="line"><span class="built_in">HeapOnly</span>(<span class="type">const</span> HeapOnly&amp; hp) = <span class="keyword">delete</span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="built_in">HeapOnly</span>()&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">HeapOnly* hp = HeapOnly::<span class="built_in">CreatObj</span>();</span><br><span class="line"><span class="keyword">delete</span> hp;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>æ³¨æ„ï¼šä¹Ÿè¦æŠŠæ‹·è´æ„é€ ç»™åˆ é™¤æ‰</code></pre><h1>è®¾è®¡åªèƒ½åœ¨æ ˆä¸Šåˆ›å»ºçš„ç±»</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StackOnly</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">static</span> StackOnly <span class="title">CreatObj</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">StackOnly</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="built_in">StackOnly</span>() &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">StackOnly sk = StackOnly::<span class="built_in">CreatObj</span>();</span><br><span class="line"><span class="comment">// é¿å…ä¸äº†ä¸‹è¾¹çš„æƒ…å†µ</span></span><br><span class="line"><span class="function"><span class="type">static</span> StackOnly <span class="title">copy</span><span class="params">(sk)</span></span>;</span><br><span class="line">StackOnly* copy2 = <span class="keyword">new</span> <span class="built_in">StackOnly</span>(sk);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§£å†³new</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StackOnly</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">static</span> StackOnly <span class="title">CreatObj</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">StackOnly</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="keyword">operator</span> <span class="title">new</span><span class="params">(<span class="type">size_t</span> n)</span> </span>= <span class="keyword">delete</span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="built_in">StackOnly</span>() &#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯é™æ€åŒºçš„æ‹·è´æ„é€ è¿˜æ˜¯ä¸èƒ½è¢«ç¦æ­¢ã€‚</p><h1>è®¾è®¡ä¸èƒ½è¢«ç»§æ‰¿çš„ç±»</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++98ä¸­æ„é€ å‡½æ•°ç§æœ‰åŒ–ï¼Œæ´¾ç”Ÿç±»ä¸­è°ƒä¸åˆ°åŸºç±»çš„æ„é€ å‡½æ•°ã€‚åˆ™æ— æ³•ç»§æ‰¿  </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NonInherit</span>  </span><br><span class="line">&#123;  </span><br><span class="line"><span class="keyword">public</span>:  </span><br><span class="line"><span class="function"><span class="type">static</span> NonInherit <span class="title">GetInstance</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line"><span class="keyword">return</span> <span class="built_in">NonInherit</span>();  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">private</span>:  </span><br><span class="line"><span class="built_in">NonInherit</span>()&#123;&#125;  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨C++11ä¸­æœ‰äº†finalå…³é”®å­—ï¼Œä¿®é¥°ç±»å°±è¯´æ˜è¯¥ç±»ä¸èƒ½è¢«ç»§æ‰¿ã€‚</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> <span class="keyword">final</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// ....  </span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1>è®¾è®¡åªèƒ½åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„ç±»ï¼ˆå•ä¾‹ï¼‰</h1><h2 id="é¥¿æ±‰æ¨¡å¼">é¥¿æ±‰æ¨¡å¼</h2><blockquote><p>æ„é€ å‡½æ•°ç§æœ‰ï¼Œåœ¨é™æ€åŒºåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œ</p></blockquote><ul><li>ç®€å•ï¼Œæ²¡æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜</li><li>ä¸€ä¸ªç¨‹åºä¸­ï¼Œå¤šä¸ªå•ä¾‹ï¼Œå¹¶ä¸”æœ‰å…ˆååˆ›å»ºåˆå§‹åŒ–çš„é¡ºåºè¦æ±‚æ—¶ï¼Œé¥¿æ±‰æ— æ³•æ§åˆ¶ï¼Œæ¯”å¦‚å¤šä¸ªæ–‡ä»¶ï¼Œå°±æ— æ³•æ§åˆ¶é¡ºåº</li><li>é¥¿æ±‰çš„å•ä¾‹ç±»ï¼Œåˆå§‹åŒ–æ—¶ä»»åŠ¡å¤šï¼Œä¼šå½±å“ç¨‹åºçš„å¯åŠ¨é€Ÿåº¦ã€‚</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">static</span> A* <span class="title">getInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> _a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;è°ƒç”¨fun()\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="built_in">A</span>()&#123;&#125;</span><br><span class="line"><span class="type">static</span> A* _a;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">A* A::_a = <span class="keyword">new</span> A;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">A* p = A::<span class="built_in">getInstance</span>();</span><br><span class="line">p-&gt;<span class="built_in">fun</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ‡’æ±‰æ¨¡å¼">æ‡’æ±‰æ¨¡å¼</h2><blockquote><p>ç¬¬ä¸€æ¬¡ä½¿ç”¨å¯¹è±¡å†åˆ›å»ºå®ä¾‹å¯¹è±¡</p></blockquote><ul><li>å¯ä»¥æ§åˆ¶åˆ›å»ºçš„é¡ºåº</li><li>ä¸å½±å“å¯åŠ¨é€Ÿåº¦</li><li>ç›¸å¯¹å¤æ‚ï¼Œæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">static</span> A* <span class="title">getInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(_a == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">_a = <span class="keyword">new</span> A;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> _a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;è°ƒç”¨fun()\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ç°ä¸€ä¸ªå†…åµŒåƒåœ¾å›æ”¶ç±»    </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CGarbo</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">~<span class="built_in">CGarbo</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (_a)</span><br><span class="line"><span class="keyword">delete</span> _a;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="built_in">A</span>()&#123;&#125;</span><br><span class="line"><span class="type">static</span> A* _a;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">A* A::_a = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="comment">// å›æ”¶å¯¹è±¡ï¼Œmainå‡½æ•°ç»“æŸåï¼Œä»–ä¼šè°ƒç”¨ææ„å‡½æ•°ï¼Œå°±ä¼šé‡Šæ”¾å•ä¾‹å¯¹è±¡</span></span><br><span class="line"><span class="type">static</span> A::CGarbo gc;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">A* p = A::<span class="built_in">getInstance</span>();</span><br><span class="line">p-&gt;<span class="built_in">fun</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å•ä¾‹å¯¹è±¡é‡Šæ”¾">å•ä¾‹å¯¹è±¡é‡Šæ”¾</h2><ul><li>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå•ä¾‹å¯¹è±¡ä¸éœ€è¦é‡Šæ”¾ï¼Œå› ä¸ºä¸€èˆ¬æ•´ä¸ªç¨‹åºè¿è¡ŒæœŸé—´éƒ½å¯èƒ½ç”¨å®ƒ</li><li>å•ä¾‹å¯¹è±¡åœ¨è¿›ç¨‹æ­£å¸¸ç»“æŸåï¼Œä¹Ÿä¼šèµ„æºé‡Šæ”¾</li><li>æœ‰äº›ç‰¹æ®Šåœºæ™¯éœ€è¦é‡Šæ”¾ï¼Œæ¯”å¦‚å•ä¾‹å¯¹è±¡ææ„æ—¶ï¼Œè¦è¿›è¡Œä¸€äº›æŒä¹…åŒ–æ“ä½œï¼ˆå¾€æ–‡ä»¶æ•°æ®åº“å†™ï¼‰æ“ä½œ</li><li>é‡Šæ”¾æ—¶ï¼Œå¯ä»¥åšä¸ªå†…éƒ¨ç±»ï¼Œå¦‚ä¸Šè¾¹ä»£ç </li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹è¯­è¨€ </category>
          
          <category> CPP </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ™ºèƒ½æŒ‡é’ˆ</title>
      <link href="/posts/950606023/"/>
      <url>/posts/950606023/</url>
      
        <content type="html"><![CDATA[<h1>RAII</h1><blockquote><p>åœ¨äº†è§£æ™ºèƒ½æŒ‡é’ˆä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè¦äº†è§£RAIIï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯RAIIå‘¢ï¼ŸRAIIæ˜¯ä¸€ç§åˆ©ç”¨å¯¹è±¡ç”Ÿå‘½å‘¨æœŸæ¥æ§åˆ¶ç¨‹åºèµ„æºï¼ˆå¦‚å†…å­˜ã€æ–‡ä»¶å¥æŸ„ã€ç½‘ç»œé“¾æ¥ã€äº’æ–¥é‡ç­‰ï¼‰çš„ç®€å•æŠ€æœ¯</p></blockquote><p>å…·ä½“æ¥è¯´ï¼Œæ˜¯åœ¨å¯¹è±¡æ„é€ æ—¶è·å–èµ„æºï¼Œå¯¹èµ„æºçš„æ§åˆ¶ç®¡ç†åœ¨æ•´ä¸ªå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå†…éƒ½ä¿æŒæœ‰æ•ˆï¼Œå¹¶åœ¨å¯¹è±¡ææ„æ—¶é‡Šæ”¾èµ„æºï¼Œä¹Ÿå°±æ˜¯å°†èµ„æºçš„ç®¡ç†æ‰˜ç®¡ç»™ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™æœ‰ç€ä¸€äº›å¥½å¤„ï¼š</p><ul><li>ä¸ç”¨æ˜¾ç¤ºé‡Šæ”¾èµ„æº</li><li>å¯¹è±¡æ‰€éœ€çš„èµ„æºåœ¨å…¶æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…å§‹ç»ˆä¿æŒæœ‰æ•ˆ</li></ul><h2 id="RAII-å¼•å…¥">RAII-å¼•å…¥</h2><blockquote><p>ä¸‹è¾¹æ˜¯ä¸€æ®µå¼‚å¸¸ç›¸å…³çš„ä»£ç ï¼Œmainå‡½æ•°è°ƒç”¨funï¼Œfunå‡½æ•°å…ˆnewäº†å—ç©ºé—´ï¼Œç„¶åè°ƒç”¨divå‡½æ•°ï¼Œä½†æ˜¯divå‡½æ•°å¦‚æœå‡ºç°é™¤0é”™è¯¯ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œç›´æ¥è¢«mainå‡½æ•°æ•è·ï¼Œé‚£ä¹ˆfunä¸­çš„deleteå°±è¢«è·³è¿‡äº†ã€‚è¿™æ ·å¯¼è‡´äº†å†…å­˜æ³„æ¼é—®é¢˜ã€‚</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">div</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> a, b;</span><br><span class="line">cin &gt;&gt; a &gt;&gt; b;</span><br><span class="line"><span class="keyword">if</span> (b == <span class="number">0</span>)</span><br><span class="line"><span class="keyword">throw</span> <span class="string">&quot;é™¤0é”™è¯¯&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> a / b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span>* p = <span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">1</span>);</span><br><span class="line">cout &lt;&lt; <span class="built_in">div</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">fun</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">catch</span> (<span class="type">const</span> <span class="type">char</span>* str)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; str &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é’ˆå¯¹ä¸Šè¾¹ä»£ç ï¼Œæ˜¯æœ‰ä¸€äº›æ–¹æ³•è¿›è¡Œå¤„ç†çš„ï¼Œä½†æ˜¯è¿™é‡Œå¯ä»¥ç”¨RAIIçš„æŠ€æœ¯è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå…·ä½“çœ‹ä¸‹æ–¹ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SmartPtr</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">SmartPtr</span>(T* ptr)</span><br><span class="line">:_ptr(ptr)</span><br><span class="line">&#123;&#125;</span><br><span class="line"></span><br><span class="line">~<span class="built_in">SmartPtr</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(_ptr)</span><br><span class="line"><span class="keyword">delete</span> _ptr;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;SmartPtrï¼šç”³è¯·çš„èµ„æºå·²ç»é‡Šæ”¾&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">T* _ptr;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">div</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> a, b;</span><br><span class="line">cin &gt;&gt; a &gt;&gt; b;</span><br><span class="line"><span class="keyword">if</span> (b == <span class="number">0</span>)</span><br><span class="line"><span class="keyword">throw</span> <span class="string">&quot;é™¤0é”™è¯¯&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> a / b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">SmartPtr&lt;<span class="type">int</span>&gt;sp = <span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">1</span>);</span><br><span class="line">cout &lt;&lt; <span class="built_in">div</span>() &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é’ˆå¯¹ä¸Šè¾¹åœºæ™¯æˆ‘ä»¬å¯ä»¥è®¾è®¡ä¸€ä¸ªSmartPtrç±»ï¼Œè¿™ä¸ªç±»æ„é€ å‡½æ•°æ¥æ”¶ä¸€ä¸ªèµ„æºçš„ç®¡ç†æƒï¼Œææ„å‡½æ•°é‡Šæ”¾è¿™ä»½èµ„æºï¼Œé‚£ä¹ˆå½“åˆ›å»ºçš„å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç»“æŸåï¼Œå°±è‡ªåŠ¨è°ƒç”¨ææ„å‡½æ•°å¹¶é‡Šæ”¾èµ„æºã€‚</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301102206518.png" alt=""></p><h1>æ™ºèƒ½æŒ‡é’ˆ</h1><blockquote><p>ä¸Šè¾¹çš„SmartPtrç±»ï¼Œå°±æ˜¯RAIIï¼Œä½†æ˜¯åªæœ‰ç®¡ç†èµ„æºé‡Šæ”¾çš„åŠŸèƒ½ï¼Œå¹¶æ²¡æœ‰æŒ‡é’ˆè§£å¼•ç”¨å’Œ-&gt;çš„æ“ä½œï¼Œä¸èƒ½å¯¹ç®¡ç†çš„èµ„æºè¿›è¡Œæ§åˆ¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è®©SmartPtræ”¯æŒåƒæŒ‡é’ˆä¸€æ ·çš„è¡Œä¸ºå‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬å°†å¼•å…¥æ™ºèƒ½æŒ‡é’ˆçš„æ¦‚å¿µï¼Œå¹¶ä¸”ç®€è¦çš„æ¨¡æ‹Ÿå››ç§åº“çš„æ™ºèƒ½æŒ‡é’ˆï¼Œç†è§£åŸç†</p></blockquote><p>æ™ºèƒ½æŒ‡é’ˆçš„åŸç†å¦‚ä¸‹ï¼š</p><ol><li>RAIIç‰¹æ€§</li><li>é‡è½½operator * å’Œopertaor-&gt;ï¼Œå…·æœ‰åƒæŒ‡é’ˆä¸€æ ·çš„è¡Œä¸ºã€‚</li></ol><blockquote><p>æˆ‘ä»¬ä¹‹å‰å®ç°çš„SmartPtrå…¶å®è¿˜å­˜åœ¨ç€å…¶ä»–çš„é—®é¢˜ï¼šå°±æ˜¯ä¸èƒ½è¿›è¡Œæ‹·è´ï¼Œå¦‚æœè¿›è¡Œæ‹·è´ï¼Œä¼šå‡ºç°èµ„æºé‡å¤é‡Šæ”¾çš„é—®é¢˜ã€‚</p></blockquote><p>æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="type">int</span> _a = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> _b = <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">SmartPtr&lt;A&gt;<span class="built_in">ap1</span>(<span class="keyword">new</span> A);</span><br><span class="line"></span><br><span class="line">SmartPtr&lt;A&gt;<span class="built_in">ap2</span>(ap1);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœä¹Ÿä¸å‡ºæ„å¤–çš„æŠ¥é”™äº†ã€‚</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301102243974.png" alt=""></p><h2 id="auto-ptr">auto_ptr</h2><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301102219593.png" alt=""></p><blockquote><p>é’ˆå¯¹ä¸Šè¾¹æ‹·è´çš„é—®é¢˜ï¼Œauto_ptræä¾›äº†å®ƒçš„æ–¹æ¡ˆï¼Œauto_ptrçš„å®ç°åŸç†ï¼š<strong>ç®¡ç†æƒè½¬ç§»çš„æ€æƒ³</strong>ï¼Œä½†æ˜¯è¿™ç§åšæ³•å¹¶ä¸å¤ªå¥½ï¼Œä½ ä¸€æ—¦æ‹·è´æ„é€ ï¼Œè¢«æ‹·è´çš„å¯¹è±¡å°±æ— æ³•ä½¿ç”¨äº†ï¼Œå®¹æ˜“å‡ºé”™ã€‚</p></blockquote><p>çœ‹ä¸€ä¸‹åº“çš„auto_ptrï¼Œå¦‚æœå¯¹è¿›è¡Œæ‹·è´æ„é€ ï¼Œå…¶å®æ˜¯è¿›è¡Œèµ„æºçš„è½¬ç§»</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301102236948.png" alt=""></p><p>æˆ‘ä»¬å¯¹auto_ptrè¿›è¡Œæ¨¡æ‹Ÿå®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">auto_ptr</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">auto_ptr</span>(T* ptr)</span><br><span class="line">:_ptr(ptr)</span><br><span class="line">&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‹·è´æ„é€ è¦è¿›è¡Œç®¡ç†æƒçš„è½¬ç§»</span></span><br><span class="line"><span class="built_in">auto_ptr</span>(auto_ptr&lt;T&gt;&amp; ap)</span><br><span class="line">&#123;</span><br><span class="line">_ptr = ap._ptr;</span><br><span class="line">ap._ptr = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">auto_ptr&lt;T&gt;&amp; <span class="keyword">operator</span>=(auto_ptr&lt;T&gt;&amp; ap)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span> != &amp;ap)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (_ptr) <span class="comment">// åˆ¤æ–­_ptræ˜¯å¦ä¸ºç©º</span></span><br><span class="line"><span class="keyword">delete</span> _ptr;</span><br><span class="line"></span><br><span class="line">_ptr = ap._ptr;</span><br><span class="line">ap._ptr = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">~<span class="built_in">auto_ptr</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (_ptr)</span><br><span class="line"><span class="keyword">delete</span> ptr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">T&amp; <span class="keyword">operator</span>*()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> *_ptr;</span><br><span class="line">&#125;</span><br><span class="line">T* <span class="keyword">operator</span>-&gt;()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _ptr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">T* _ptr;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="unique-ptr">unique_ptr</h2><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301102347615.png" alt=""></p><blockquote><p>unique_ptrçš„å®ç°åŸç†ï¼šç®€å•ç²—æš´çš„é˜²æ‹·è´</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">unique_ptr</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">unique_ptr</span>(T* ptr)</span><br><span class="line">:_ptr(ptr)</span><br><span class="line">&#123;&#125;</span><br><span class="line"><span class="built_in">unique_ptr</span>(<span class="type">const</span> unique_ptr&lt;T&gt;&amp; up) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">unique_ptr&lt;T&gt;&amp; <span class="keyword">operator</span>=(<span class="type">const</span> unique_ptr&lt;T&gt;&amp; up) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">~<span class="built_in">unique_ptr</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (_ptr)</span><br><span class="line"><span class="keyword">delete</span> ptr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">T&amp; <span class="keyword">operator</span>*()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> *_ptr;</span><br><span class="line">&#125;</span><br><span class="line">T* <span class="keyword">operator</span>-&gt;()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _ptr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">T* _ptr;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="shared-ptr">shared_ptr</h2><pre><code>ä¸‹è¾¹ä»£ç æœ‰ä¸€äº›å¼€å§‹å†™æˆäº†share_ptrï¼Œå°‘äº†ä¸ªdï¼Œåè¡¥ä¸Šäº†ï¼Œå¯¼è‡´æœ‰ä¸€äº›æˆªå›¾å’Œä»£ç å°‘ä¸€ä¸ªd</code></pre><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301110001271.png" alt=""></p><blockquote><p>auto_ptrå’Œunique_ptréƒ½é’ˆå¯¹æ™ºèƒ½æŒ‡é’ˆçš„æ‹·è´é—®é¢˜ä¸Šæœ‰å„è‡ªçš„å¤„ç†æ–¹å¼ï¼Œä½†æ˜¯éƒ½æ¯”è¾ƒå‘†ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬æ˜¯æœ‰æ‹·è´æŒ‡é’ˆçš„éœ€æ±‚çš„ï¼Œé‚£ä¹ˆè¿™æ—¶å€™share_ptrå°±ç™»åœºäº†ã€‚</p></blockquote><p>shared_ptrçš„åŸç†ï¼šæ˜¯é€šè¿‡å¼•ç”¨è®¡æ•°çš„æ–¹å¼æ¥å®ç°å¤šä¸ªshared_ptrå¯¹è±¡ä¹‹é—´å…±äº«èµ„æºã€‚</p><ol><li>shared_ptråœ¨å…¶å†…éƒ¨ï¼Œç»™æ¯ä¸ªèµ„æºéƒ½ç»´æŠ¤äº†ç€ä¸€ä»½è®¡æ•°ï¼Œç”¨æ¥è®°å½•è¯¥ä»½èµ„æºè¢«å‡ ä¸ªå¯¹è±¡å…±äº«</li><li>åœ¨å¯¹è±¡è¢«é”€æ¯æ—¶(ä¹Ÿå°±æ˜¯ææ„å‡½æ•°è°ƒç”¨)ï¼Œå°±è¯´æ˜è‡ªå·±ä¸ä½¿ç”¨è¯¥èµ„æºäº†ï¼Œå¯¹è±¡çš„å¼•ç”¨è®¡æ•°å‡ä¸€</li><li>å¦‚æœå¼•ç”¨è®¡æ•°æ˜¯0ï¼Œå°±è¯´æ˜è‡ªå·±æ˜¯æœ€åä¸€ä¸ªä½¿ç”¨è¯¥èµ„æºçš„å¯¹è±¡ï¼Œå¿…é¡»é‡Šæ”¾è¯¥èµ„æº</li><li>å¦‚æœä¸æ˜¯0ï¼Œå°±è¯´æ˜é™¤äº†è‡ªå·±è¿˜æœ‰å…¶ä»–å¯¹è±¡åœ¨ä½¿ç”¨è¯¥ä»½èµ„æºï¼Œä¸èƒ½é‡Šæ”¾è¯¥èµ„æºï¼Œå¦åˆ™å…¶ä»–å¯¹è±¡å°±æˆé‡æŒ‡é’ˆäº†ã€‚</li></ol><p>å¦‚ä½•æ ¹æ®shared_ptrçš„åŸç†ï¼Œè¿›è¡Œå¼•ç”¨è®¡æ•°åŠŸèƒ½çš„å®ç°å‘¢ï¼Ÿ</p><p><strong>æ–¹æ¡ˆ1ã€é™æ€æˆå‘˜å˜é‡ countè®¡æ•°</strong></p><p>è¿™é‡Œæ˜¯å¦å¯è¡Œå‘¢ï¼Ÿæˆ‘ä»¬è¯•ç€å®ç°ä¸€ä¸‹ï¼Œå¹¶æµ‹è¯•æ•ˆæœï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">shared_ptr</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">shared_ptr</span>(T* ptr = <span class="literal">nullptr</span>)</span><br><span class="line">:_ptr(ptr)</span><br><span class="line">&#123;</span><br><span class="line">_count++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">shared_ptr</span>(shared_ptr&lt;T&gt;&amp; sp)</span><br><span class="line">:_ptr(sp._ptr)</span><br><span class="line">&#123;</span><br><span class="line">_count++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">T&amp; <span class="keyword">operator</span>*()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> *_ptr;</span><br><span class="line">&#125;</span><br><span class="line">T* <span class="keyword">operator</span>-&gt;()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _ptr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">~<span class="built_in">shared_ptr</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (--_count == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">delete</span> _ptr;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">T* _ptr;</span><br><span class="line"><span class="type">static</span> <span class="type">int</span> _count;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">int</span> shared_ptr&lt;T&gt;::_count = <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p>è¿è¡Œæµ‹è¯•ï¼š</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301111412860.png" alt=""></p><p>ä½¿ç”¨é™æ€æˆå‘˜å˜é‡ç¡®å®å¯ä»¥è§£å†³æ‹·è´æ„é€ å¯¼è‡´çš„é‡å¤é‡Šæ”¾èµ„æºçš„é—®é¢˜ï¼Œä½†æ˜¯ï¼Œè¿™ä¹Ÿä¼šå¼•å‘æ–°çš„é—®é¢˜ã€‚å› ä¸ºé™æ€æˆå‘˜å˜é‡ä¸å±äºæŸä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒå±äºæ•´ä¸ªç±»ã€‚å¦‚æœæˆ‘ä»¬å†åˆ›å»ºä¸€ä¸ªå¯¹è±¡å°±ä¼šå¼•å‘èµ„æºæ³„æ¼çš„é—®é¢˜ã€‚</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301111417078.png" alt=""></p><pre><code>è¿™é‡Œåˆ›å»ºäº†ä¸ªsp3ï¼ŒæŒ‰ç†è¯´æœ‰äº†ä¸¤ä»½èµ„æºï¼Œä½†æ˜¯åªææ„äº†ä¸€æ¬¡ï¼ŒåŸå› å¦‚ä¸‹ã€‚</code></pre><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301111424168.png" alt=""></p><p>æˆ‘ä»¬å…¶å®æœŸæœ›çš„æ˜¯å¯¹ä¸€ä»½èµ„æºçš„ç®¡ç†ï¼Œè¿™ä¸€ä»½èµ„æºè¦æœ‰ç‹¬ç«‹çš„å¼•ç”¨è®¡æ•°ï¼Œä½†æ˜¯ç”¨é™æ€æˆå‘˜å˜é‡åšä¸åˆ°è¿™ä¸€ç‚¹ï¼Œæ— è®ºå¤šå°‘ä»½çš„èµ„æºï¼Œå®ƒä»¬ä¼šå…±äº«ä¸€ä»½å¼•ç”¨è®¡æ•°ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´èµ„æºæ³„æ¼é—®é¢˜ã€‚</p><p>æ‰€ä»¥ï¼Œé™æ€æˆå‘˜å˜é‡è¿™ç§æ–¹æ¡ˆæ˜¯ä¸è¡Œçš„ï¼Œé‚£ä¹ˆåº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿæˆ‘ä»¬å¼•å…¥ç¬¬äºŒç§çš„æ–¹æ¡ˆã€‚</p><p><strong>æ–¹æ¡ˆ2ã€åœ¨å †ä¸Šç”³è¯·ä¸€å—ç©ºé—´åšè®¡æ•°</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">shared_ptr</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">shared_ptr</span>(T* ptr = <span class="literal">nullptr</span>)</span><br><span class="line">:_ptr(ptr)</span><br><span class="line">,_pcount(<span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">1</span>))</span><br><span class="line">&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">shared_ptr</span>(shared_ptr&lt;T&gt;&amp; sp)</span><br><span class="line">:_ptr(sp._ptr)</span><br><span class="line">,_pcount(sp._pcount)</span><br><span class="line">&#123;</span><br><span class="line">(*_pcount)++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">shared_ptr&lt;T&gt;&amp; <span class="keyword">operator</span>=(shared_ptr&lt;T&gt;&amp; sp)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// share_ptr&lt;A&gt;sp1(new A)</span></span><br><span class="line"><span class="comment">// share_ptr&lt;A&gt;sp2(sp1)</span></span><br><span class="line"><span class="comment">// sp1 = sp2</span></span><br><span class="line"><span class="comment">// ä¸ºäº†é˜²æ­¢ä¸Šè¾¹åœºæ™¯ï¼Œç”¨_ptråˆ¤æ–­æ›´å¥½</span></span><br><span class="line"><span class="keyword">if</span> (_ptr == sp._ptr) </span><br><span class="line"><span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --è¢«èµ‹å€¼å¯¹è±¡çš„è®¡æ•°ï¼Œå¦‚æœæ˜¯æœ€åä¸€ä¸ªå¯¹è±¡è¦é‡Šæ”¾èµ„æº</span></span><br><span class="line"><span class="keyword">if</span> (--(*_pcount) == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">delete</span> _ptr;</span><br><span class="line"><span class="keyword">delete</span> _pcount;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…±ç®¡æ–°èµ„æºï¼Œ++è®¡æ•°</span></span><br><span class="line">_ptr = sp._ptr;</span><br><span class="line">_pcount = sp._pcount;</span><br><span class="line"></span><br><span class="line">(*_pcount)++;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">T&amp; <span class="keyword">operator</span>*()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> *_ptr;</span><br><span class="line">&#125;</span><br><span class="line">T* <span class="keyword">operator</span>-&gt;()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _ptr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">~<span class="built_in">shared_ptr</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (--(*_pcount) == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">delete</span> _ptr;</span><br><span class="line"><span class="keyword">delete</span> _pcount;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">T* _ptr;</span><br><span class="line"><span class="type">int</span>* _pcount;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼šå¯ä»¥çœ‹åˆ°è§£å†³äº†ä¸Šè¾¹çš„é—®é¢˜ã€‚</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301111508572.png" alt=""></p><h2 id="weak-ptr">weak_ptr</h2><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301111514694.png" alt=""></p><blockquote><p>æˆ‘ä»¬çš„shared_ptrçœ‹èµ·æ¥å·²ç»å¾ˆå‰å®³äº†ï¼Œé‚£è¿™ä¸ªweak_ptråˆæœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿè¿™é‡Œå°±è¦çœ‹shared_ptræ½œåœ¨çš„ä¸€ä¸ªé—®é¢˜äº†ã€‚</p></blockquote><h3 id="å¾ªç¯å¼•ç”¨">å¾ªç¯å¼•ç”¨</h3><blockquote><p>é—®é¢˜çš„å¼•å…¥ï¼šæˆ‘ä»¬æœ‰ä¸ªèŠ‚ç‚¹ç±»ï¼Œç”¨shared_pträ¼šå‘ç”Ÿä»€ä¹ˆæ ·çš„é—®é¢˜ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸‹é¢</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301111622216.png" alt=""></p><pre><code>ä¸Šè¾¹è¯´share_ptrçš„å¯¹è±¡ä¸èƒ½ç»™Node*ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ”¹ä¸€ä¸ªNodeç±»ï¼Œå°†å‰åæŒ‡é’ˆæ”¹æˆæ™ºèƒ½æŒ‡é’ˆã€‚</code></pre><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301111624432.png" alt=""></p><pre><code>ç»è¿‡æ›´æ”¹åå‘ç°æ²¡æœ‰ä»»ä½•çš„é—®é¢˜ï¼Œshared_ptrå¥½åƒå®Œç¾çš„èƒœä»»äº†èŠ‚ç‚¹çš„æŒ‡é’ˆè¿™ä¸ªè§’è‰²</code></pre><p>æˆ‘ä»¬ç»§ç»­çœ‹ä¸€ä¸ªåœºæ™¯ï¼š</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301111626436.png" alt=""></p><pre><code>å½“æˆ‘ä»¬åŠ ä¸Šsp2-&gt;_pre=sp1æ—¶ï¼Œå°±å‡ºç°é—®é¢˜äº†ï¼Œè¿è¡Œç»“æœæ˜¯ä¸¤ä¸ªèŠ‚ç‚¹éƒ½æ²¡æœ‰é‡Šæ”¾ï¼Œè¿™æ˜¯ä¸ºå•¥å‘¢ï¼Œéå¸¸å¥‡æ€ªçš„é—®é¢˜ã€‚</code></pre><blockquote><p>è¿™é‡Œæˆ‘ä»¬å°±è¦å¼•å‡ºï¼Œå¾ªç¯å¼•ç”¨çš„æ¦‚å¿µäº†ã€‚</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301111651493.png" alt=""></p><p>è¿™æ—¶å€™å°±å‡ºç°äº†å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œå¯¼è‡´äº†ä¸¤è¾¹çš„èµ„æºéƒ½æ²¡æœ‰æ²¡é‡Šæ”¾ï¼Œè¿™æ—¶å€™å°±å¼•å…¥äº†weak_ptræ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><blockquote><p>è§£å†³æ–¹æ¡ˆï¼šåœ¨å¼•ç”¨è®¡æ•°çš„åœºæ™¯ä¸‹ï¼ŒæŠŠèŠ‚ç‚¹ä¸­çš„_prevå’Œ_nextæ”¹æˆweak_ptrå°±å¯ä»¥äº†</p></blockquote><p>sp1-&gt; _ next = sp2ï¼›sp2-&gt;_ pre = sp1ï¼›æ—¶weak_ptrçš„_nextå’Œ_ prevä¸ä¼šå¢åŠ sp1å’Œsp2çš„å¼•ç”¨è®¡æ•°ã€‚</p><p>æˆ‘ä»¬å†çœ‹ä¸€ä¸‹è¿è¡Œç»“æœï¼Œå‘ç°é—®é¢˜å·²ç»è¢«è§£å†³ã€‚</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301111706127.png" alt=""></p><h3 id="weak-ptræ¨¡æ‹Ÿ">weak_ptræ¨¡æ‹Ÿ</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">weak_ptr</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">weak_ptr</span>()</span><br><span class="line">:_ptr(<span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">weak_ptr</span>(<span class="type">const</span> shared_ptr&lt;T&gt;&amp; sp)</span><br><span class="line">:_ptr(sp.<span class="built_in">get</span>())</span><br><span class="line">&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">weak_ptr</span>(<span class="type">const</span> weak_ptr&lt;T&gt;&amp; wp)</span><br><span class="line">:_ptr(wp._ptr)</span><br><span class="line">&#123;&#125;</span><br><span class="line"></span><br><span class="line">weak_ptr&lt;T&gt;&amp; <span class="keyword">operator</span>=(<span class="type">const</span> shared_ptr&lt;T&gt;&amp; sp)</span><br><span class="line">&#123;</span><br><span class="line">_ptr = sp.<span class="built_in">get</span>();</span><br><span class="line"><span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">T&amp; <span class="keyword">operator</span>*()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> *_ptr;</span><br><span class="line">&#125;</span><br><span class="line">T* <span class="keyword">operator</span>-&gt;()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _ptr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">T* _ptr;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åˆ‡æ¢æˆstçš„å‘½åç©ºé—´ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301112019787.png" alt=""></p><p>ä¹Ÿå®ç°äº†åº“ä¸­weak_ptrçš„æ•ˆæœï¼Œè§£å†³äº†å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚</p><h1>å®šåˆ¶åˆ é™¤å™¨</h1><blockquote><p>å®šåˆ¶åˆ é™¤å™¨æ˜¯é’ˆå¯¹æ™ºèƒ½æŒ‡é’ˆç®¡ç†çš„ç±»å‹å®šåˆ¶ä¸“ç”¨çš„åˆ é™¤å™¨ï¼Œå¦‚æœæ²¡æœ‰åˆ¶åˆ é™¤å™¨å¯èƒ½ä¼šå‡ºç°ä¸€äº›é”™è¯¯ã€‚</p></blockquote><p>æ¯”å¦‚ä¸‹è¾¹ä»£ç ï¼Œç”¨äº†åº“é‡Œé¢çš„shared_ptr</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">std::shared_ptr&lt;<span class="type">int</span>&gt;<span class="built_in">s1</span>(<span class="keyword">new</span> <span class="type">int</span>[<span class="number">5</span>]);</span><br><span class="line">std::shared_ptr&lt;Node&gt;<span class="built_in">sp2</span>(<span class="keyword">new</span> Node[<span class="number">5</span>]);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301112050260.png" alt=""></p><pre><code>å¯ä»¥çœ‹åˆ°ç¨‹åºç›´æ¥å´©æºƒäº†ï¼Œå…¶å®ç¬¬ä¸€ä¸ªè¿˜æ²¡æœ‰å´©ï¼Œç¬¬äºŒä¸ªNode[5]é‚£é‡Œæ‰å´©æºƒæ‰</code></pre><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301112104024.png" alt=""></p><p>ç”±äºé‡Šæ”¾çš„ä½ç½®ä¸å¯¹å¯¼è‡´ç¨‹åºå´©æºƒæ‰ã€‚</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301112105450.png" alt=""></p><p>å¯ä»¥é€šè¿‡å®šåˆ¶åˆ é™¤å™¨è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¹Ÿå°±æ˜¯ä¼ ä¸ªå‡½æ•°å¯¹è±¡ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">DeleteArray</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">operator</span><span class="params">()</span><span class="params">(T* ptr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;delete[]&quot;</span> &lt;&lt; ptr &lt;&lt; endl;</span><br><span class="line"><span class="keyword">delete</span>[] ptr;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Free</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">operator</span><span class="params">()</span><span class="params">(T* ptr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;free&quot;</span> &lt;&lt; ptr &lt;&lt; endl;</span><br><span class="line"><span class="built_in">free</span>(ptr);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test_del</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// ä»¿å‡½æ•°å¯¹è±¡</span></span><br><span class="line"><span class="function">std::shared_ptr&lt;Node&gt; <span class="title">n1</span><span class="params">(<span class="keyword">new</span> Node[<span class="number">5</span>], DeleteArray&lt;Node&gt;())</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">std::shared_ptr&lt;Node&gt; <span class="title">n2</span><span class="params">(<span class="keyword">new</span> Node)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">std::shared_ptr&lt;<span class="type">int</span>&gt; <span class="title">n3</span><span class="params">(<span class="keyword">new</span> <span class="type">int</span>[<span class="number">5</span>], DeleteArray&lt;<span class="type">int</span>&gt;())</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">std::shared_ptr&lt;<span class="type">int</span>&gt; <span class="title">n4</span><span class="params">((<span class="type">int</span>*)malloc(<span class="keyword">sizeof</span>(<span class="number">12</span>)), Free&lt;<span class="type">int</span>&gt;())</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// lambda</span></span><br><span class="line"><span class="function">std::shared_ptr&lt;Node&gt; <span class="title">m1</span><span class="params">(<span class="keyword">new</span> Node[<span class="number">5</span>], [](Node* ptr)&#123;<span class="keyword">delete</span>[] ptr; &#125;)</span></span>;</span><br><span class="line"><span class="function">std::shared_ptr&lt;Node&gt; <span class="title">m2</span><span class="params">(<span class="keyword">new</span> Node)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">std::shared_ptr&lt;<span class="type">int</span>&gt; <span class="title">m3</span><span class="params">(<span class="keyword">new</span> <span class="type">int</span>[<span class="number">5</span>], [](<span class="type">int</span>* ptr)&#123;<span class="keyword">delete</span>[] ptr; &#125;)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">std::shared_ptr&lt;<span class="type">int</span>&gt; <span class="title">m4</span><span class="params">((<span class="type">int</span>*)malloc(<span class="keyword">sizeof</span>(<span class="number">12</span>)), [](<span class="type">int</span>* ptr)&#123;free(ptr); &#125;)</span></span>;</span><br><span class="line"><span class="function">std::shared_ptr&lt;FILE&gt; <span class="title">m5</span><span class="params">(fopen(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;w&quot;</span>), [](FILE* ptr)&#123;fclose(ptr); &#125;)</span></span>;</span><br><span class="line"></span><br><span class="line">ä¸»è¦uniqueæ˜¯åœ¨æ¨¡æ¿å‚æ•°è¿™é‡Œ</span><br><span class="line"><span class="comment">//std::unique_ptr&lt;Node, DeleteArray&lt;Node&gt;&gt; up(new Node[5]);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æ¨¡æ‹Ÿå®Œå–„shared-ptr">æ¨¡æ‹Ÿå®Œå–„shared_ptr</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">D</span> = Delete&lt;T&gt;&gt;</span><br><span class="line"><span class="keyword">class</span> shared_ptr</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">shared_ptr</span>(T* ptr = <span class="literal">nullptr</span>)</span><br><span class="line">: _ptr(ptr)</span><br><span class="line">, _pCount(<span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">1</span>))</span><br><span class="line">&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="built_in">Release</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (--(*_pCount) == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">D</span>()(_ptr);</span><br><span class="line"><span class="keyword">delete</span> _pCount;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">~<span class="built_in">shared_ptr</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">Release</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">shared_ptr</span>(<span class="type">const</span> shared_ptr&lt;T&gt;&amp; sp)</span><br><span class="line">: _ptr(sp._ptr)</span><br><span class="line">, _pCount(sp._pCount)</span><br><span class="line">&#123;</span><br><span class="line">(*_pCount)++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">shared_ptr&lt;T&gt;&amp; <span class="keyword">operator</span>=(<span class="type">const</span> shared_ptr&lt;T&gt;&amp; sp)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//if (this == &amp;sp)</span></span><br><span class="line"><span class="keyword">if</span> (_ptr == sp._ptr)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Release</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…±ç®¡æ–°èµ„æºï¼Œ++è®¡æ•°</span></span><br><span class="line">_ptr = sp._ptr;</span><br><span class="line">_pCount = sp._pCount;</span><br><span class="line"></span><br><span class="line">(*_pCount)++;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">T&amp; <span class="keyword">operator</span>*()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> *_ptr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">T* <span class="keyword">operator</span>-&gt;()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _ptr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">use_count</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> *_pCount;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">T* <span class="title">get</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> _ptr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">T* _ptr;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼•ç”¨è®¡æ•°</span></span><br><span class="line"><span class="type">int</span>* _pCount;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„æ¨¡æ‹Ÿå®šåˆ¶åˆ é™¤å™¨çš„åŠŸèƒ½ï¼Œæ˜¯ç®€å•ç‰ˆçš„é€šè¿‡æ¨¡æ¿å‚æ•°æ§åˆ¶</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301112131999.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹è¯­è¨€ </category>
          
          <category> CPP </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>C++å¼‚å¸¸</title>
      <link href="/posts/4208010459/"/>
      <url>/posts/4208010459/</url>
      
        <content type="html"><![CDATA[<blockquote><p>åœ¨æˆ‘ä»¬å†™ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œå‡ºç°é”™è¯¯æ˜¯éå¸¸å¸¸è§çš„äº‹æƒ…ï¼Œå¦‚ä½•å¯¹ä¸€äº›å¼‚å¸¸è¿›è¡Œåˆç†æ–¹å¼çš„å¤„ç†æ˜¯éå¸¸é‡è¦çš„é—®é¢˜ï¼Œcè¯­è¨€æœ‰cè¯­è¨€çš„æ–¹æ³•ï¼Œå½“ç„¶ï¼Œcppä½œä¸ºoopçš„è¯­è¨€å½“ç„¶ä¹Ÿæœ‰å®ƒçš„ä¸€å¥—ä½“ç³»ã€‚</p></blockquote><h1>Cè¯­è¨€å¤„ç†é”™è¯¯çš„æ–¹å¼</h1><h2 id="cé”™è¯¯å¤„ç†æ–¹å¼">cé”™è¯¯å¤„ç†æ–¹å¼</h2><ol><li><p><strong>ç»ˆæ­¢ç¨‹åº</strong>ï¼šæ¯”å¦‚assertï¼Œç¼ºç‚¹ï¼šæœ‰äº›é—®é¢˜ä¼šç›´æ¥é€€å‡ºä¼šè®©ç”¨æˆ·éå¸¸éš¾å—ï¼Œæ¯”å¦‚å‡ºç°ç½‘ç»œé”™è¯¯ï¼Œæˆ‘ä»¬é€šå¸¸å¸Œæœ›çš„æ˜¯å‘Šè­¦ï¼Œè€Œä¸æ˜¯è¿›ç¨‹é€€å‡ºã€‚</p></li><li><p><strong>è¿”å›é”™è¯¯ç </strong>ï¼šè¿”å›é”™è¯¯ç çš„æ–¹å¼å¹¶ä¸ç›´è§‚ï¼Œæ¯”å¦‚è¿”å›ä¸€ä¸ª5ï¼Œå¹¶ä¸èƒ½ç›´æ¥çŸ¥é“å‡ºäº†ä»€ä¹ˆé”™è¯¯ï¼Œå¿…é¡»è¦æŸ¥å¯¹åº”çš„çš„é”™è¯¯ã€‚</p><p>å¤§éƒ¨åˆ†æƒ…å†µcè¿˜æ˜¯é‡‡ç”¨è¿”å›é”™è¯¯ç çš„æ–¹å¼å¤„ç†é”™è¯¯ï¼Œéƒ¨åˆ†æƒ…å†µä½¿ç”¨ç»ˆæ­¢è¿›ç¨‹å¤„ç†ç‰¹åˆ«ä¸¥é‡çš„é”™è¯¯ã€‚</p></li></ol><h1>C++å¼‚å¸¸æ¦‚å¿µ</h1><blockquote><p>å¼‚å¸¸æ˜¯ä»€ä¹ˆï¼Ÿå…¶å®æ˜¯ä¸€ç§å¤„ç†é”™è¯¯çš„æ–¹å¼ï¼Œå½“ä¸€ä¸ªå‡½æ•°é‡åˆ°æ— æ³•å¤„ç†çš„é”™è¯¯æ—¶ï¼Œå°±å¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼Œè®©å‡½æ•°å¯ä»¥ç›´æ¥æˆ–è€…é—´æ¥çš„è°ƒç”¨è€…å»å¤„ç†è¿™ä¸ªé”™è¯¯ã€‚</p></blockquote><p>å¤§æ¦‚å½¢å¼å¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>  </span><br><span class="line">&#123;  </span><br><span class="line"><span class="comment">// ä¿æŠ¤çš„æ ‡è¯†ä»£ç   </span></span><br><span class="line">&#125;<span class="built_in">catch</span>( ExceptionName e1 )  </span><br><span class="line">&#123;  </span><br><span class="line"><span class="comment">// catch å—  </span></span><br><span class="line">&#125;<span class="built_in">catch</span>( ExceptionName e2 )  </span><br><span class="line">&#123;  </span><br><span class="line"><span class="comment">// catch å—  </span></span><br><span class="line">&#125;<span class="built_in">catch</span>( ExceptionName eN )  </span><br><span class="line">&#123;  </span><br><span class="line"><span class="comment">// catch å—  </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>å¼‚å¸¸çš„ä½¿ç”¨</h1><h2 id="å…³é”®å­—">å…³é”®å­—</h2><blockquote><p>ä½¿ç”¨å¼‚å¸¸å‰ï¼Œå…ˆè®¤è¯†ä¸€ä¸‹å¼‚å¸¸çš„å…³é”®å­—</p></blockquote><ul><li><strong>throw</strong>ï¼šæŠ›å‡ºå¼‚å¸¸å…³é”®å­—ï¼Œå¯ä»¥æŠ›å‡ºä»»æ„çš„ä¸œè¥¿ï¼ˆå­—ç¬¦ä¸²ã€æ•´æ•°â€¦ï¼‰</li><li><strong>try</strong>ï¼šæ‹¬å·å†…çš„ä»£ç å°±æ˜¯å¯èƒ½ä¼šå‡ºç°å¼‚å¸¸çš„åœ°æ–¹ã€‚</li><li><strong>catch</strong>ï¼šèƒ½æ•æ‰æŠ›å‡ºçš„å¼‚å¸¸ï¼Œå½“ç„¶è¦ç±»å‹å¯¹åº”ã€‚</li></ul><h2 id="å¼‚å¸¸è§„åˆ™">å¼‚å¸¸è§„åˆ™</h2><h3 id="å¼‚å¸¸çš„æŠ›å‡ºå’Œæ•è·">å¼‚å¸¸çš„æŠ›å‡ºå’Œæ•è·</h3><ul><li>æŠ›å‡ºå¯¹è±¡çš„ç±»å‹ä¸¥æ ¼åŒ¹é…catchç±»å‹</li><li>æŠ›å‡ºå¯¹è±¡åŒ¹é…æœ€è¿‘çš„catch</li><li>æŠ›å‡ºçš„æ˜¯å¯¹è±¡çš„æ‹·è´</li><li>catch(â€¦) å¯ä»¥æ•æ‰ä»»æ„ç±»å‹çš„å¼‚å¸¸ï¼Œç”¨æ¥å…œåº•</li><li>å¯ä»¥æŠ›æ´¾ç”Ÿç±»å¯¹è±¡ï¼Œç”¨çˆ¶ç±»è¿›è¡Œæ•è·</li></ul><h4 id="ç±»å‹åŒ¹é…ä¾‹å­ï¼š">ç±»å‹åŒ¹é…ä¾‹å­ï¼š</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> a, b;</span><br><span class="line">cin &gt;&gt; a &gt;&gt; b;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ‹è¯•æ‰”å‡ºä¸‰ç§ç±»å‹ï¼ŒåŒ¹é…å¯¹åº”çš„catch</span></span><br><span class="line"><span class="keyword">if</span> (b == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//throw 0;</span></span><br><span class="line"><span class="comment">//throw string(&quot;é™¤0é”™è¯¯&quot;);</span></span><br><span class="line"><span class="keyword">throw</span> <span class="string">&#x27;e&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;a/b=&quot;</span> &lt;&lt; a / b &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">fun</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">catch</span> (<span class="type">int</span> errid)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;erridï¼š&quot;</span> &lt;&lt; errid &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">catch</span> (<span class="type">char</span> errch)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;errchï¼š&quot;</span> &lt;&lt; errch &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">catch</span> (<span class="type">const</span> string&amp; errstr)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;errstrï¼š&quot;</span> &lt;&lt; errstr &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼ŒåŒ¹é…å¯¹åº”çš„catch</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301082345139.png" alt=""></p><h4 id="å­ç±»å¼‚å¸¸åŸºç±»æ•è·">å­ç±»å¼‚å¸¸åŸºç±»æ•è·</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŸºç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Exception</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">Exception</span>(<span class="type">const</span> string&amp; errmsg, <span class="type">int</span> id)</span><br><span class="line">:_errmsg(errmsg)</span><br><span class="line">, _id(id)</span><br><span class="line">&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> string <span class="title">what</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> _errmsg;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getid</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> _id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">string _errmsg;   <span class="comment">// é”™è¯¯ä¿¡æ¯</span></span><br><span class="line"><span class="type">int</span> _id;          <span class="comment">// é”™è¯¯ç </span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ErrorA</span> : <span class="keyword">public</span> Exception</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">ErrorA</span>(<span class="type">const</span> string&amp; errmsg, <span class="type">int</span> id, <span class="type">const</span> string&amp; errorA)</span><br><span class="line">:<span class="built_in">Exception</span>(errmsg,id)</span><br><span class="line">,_errA(errorA)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é‡å†™è™šå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> string <span class="title">what</span><span class="params">()</span><span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">string str = _errmsg + <span class="string">&quot; &quot;</span> + _errA;</span><br><span class="line"><span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">string _errA;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">srand</span>(<span class="built_in">time</span>(<span class="literal">nullptr</span>));</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">rand</span>() % <span class="number">5</span> == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="built_in">ErrorA</span>(<span class="string">&quot;é”™è¯¯ï¼š&quot;</span>, <span class="number">100</span>, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">Sleep</span>(<span class="number">1000</span>);</span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">fun</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">catch</span> (<span class="type">const</span> Exception&amp; e)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">catch</span> (...)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;æœªçŸ¥é”™è¯¯&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301090028259.png" alt=""></p><h3 id="åœ¨å‡½æ•°è°ƒç”¨é“¾ä¸­å¼‚å¸¸å±•å¼€åŒ¹é…è§„åˆ™">åœ¨å‡½æ•°è°ƒç”¨é“¾ä¸­å¼‚å¸¸å±•å¼€åŒ¹é…è§„åˆ™</h3><ul><li>ç°åœ¨å½“å‰æ ˆå¸§ä¸­çœ‹</li><li>æ²¡æœ‰å»ä¸Šä¸€å±‚æ ˆå¸§</li><li>å¦‚æœåˆ°äº†mainæ ˆå¸§è¿˜æœªåŒ¹é…ï¼Œç»ˆæ­¢ç¨‹åº</li><li>catchå¤„ç†åï¼Œä¼šç»§ç»­æ‰§è¡Œä¹‹åçš„è¯­å¥</li></ul><h4 id="å‡½æ•°è°ƒç”¨ä¾‹å­">å‡½æ•°è°ƒç”¨ä¾‹å­</h4><blockquote><p>ä»£ç å¤§è‡´å¦‚ä¸Šæ–¹ä»£ç ï¼Œä½†æ˜¯funå‡½æ•°é‡Œé¢è°ƒç”¨äº†divå‡½æ•°ï¼Œå¹¶åœ¨funå‡½æ•°é‡Œé¢è¿›è¡Œå¼‚å¸¸æ•è·ï¼ŒåŒæ ·çš„åœ¨mainå‡½æ•°ä¸­ï¼Œä¹Ÿå¯¹funè¿›è¡Œå¼‚å¸¸çš„æ•è·</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">div</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> a, b;</span><br><span class="line">cin &gt;&gt; a &gt;&gt; b;</span><br><span class="line"><span class="keyword">if</span> (b == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//throw 0;</span></span><br><span class="line"><span class="keyword">throw</span> <span class="built_in">string</span>(<span class="string">&quot;é™¤0é”™è¯¯&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;a/b=&quot;</span> &lt;&lt; a / b &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">div</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">catch</span> (<span class="type">int</span> errid)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;funä¸­catchï¼š&quot;</span> &lt;&lt; errid &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">è¿è¡Œç»“æœï¼š</span><br><span class="line"></span><br><span class="line">![](https:<span class="comment">//tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301082359524.png)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### å¼‚å¸¸æ ˆå¸§å±•å¼€</span><br><span class="line"></span><br><span class="line">![](https:<span class="comment">//tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301090003458.png)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## å¼‚å¸¸å®‰å…¨</span><br><span class="line"></span><br><span class="line">+ æœ€å¥½ä¸è¦åœ¨æ„é€ å‡½æ•°ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œå¯èƒ½å¯¼è‡´æ„é€ å¯¹è±¡ä¸å®Œæ•´</span><br><span class="line">+ æœ€å¥½ä¸è¦åœ¨ææ„å‡½æ•°ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œå¯èƒ½ä¼šå¯¼è‡´èµ„æºæ³„éœ²</span><br><span class="line">+ C++ä¸­å¼‚å¸¸ç»å¸¸ä¼šå¯¼è‡´èµ„æºæ³„æ¼çš„é—®é¢˜ï¼Œæ¯”å¦‚åœ¨<span class="keyword">new</span>å’Œ<span class="keyword">delete</span>ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ï¼Œåœ¨lockå’Œunlockä¹‹é—´æŠ›å‡ºäº†å¼‚å¸¸å¯¼è‡´æ­»é”</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æ¯”å¦‚ä¸‹é¢çš„åœºæ™¯ï¼š</span><br><span class="line">&gt; å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œå°±ä¸ä¼šæ‰§è¡Œ<span class="keyword">delete</span>ï¼Œè¿™æ ·å¯¼è‡´äº†èµ„æºæ³„æ¼ï¼Œå½“ç„¶å¯ä»¥åœ¨Funcä¸­çš„<span class="keyword">catch</span>ä¸­å†å¢åŠ <span class="keyword">delete</span>ï¼Œä½†æ˜¯è¿˜æœ‰éšè—çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼Œarray1æˆåŠŸï¼Œarray2å¤±è´¥ï¼Œarr2æŠ›å¼‚å¸¸ï¼Œä¼šæŠ›åˆ°mainå‡½æ•°æ ˆå¸§ä¸­ã€‚ä¼šå¯¼è‡´array1å¾—ä¸åˆ°é‡Šæ”¾ã€‚</span><br><span class="line"></span><br><span class="line">```cpp</span><br><span class="line"><span class="type">void</span> <span class="built_in">Func</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// è¿™é‡Œå¯ä»¥çœ‹åˆ°å¦‚æœå‘ç”Ÿé™¤0é”™è¯¯æŠ›å‡ºå¼‚å¸¸ï¼Œå¦å¤–ä¸‹é¢çš„arrayæ²¡æœ‰å¾—åˆ°é‡Šæ”¾ã€‚</span></span><br><span class="line"><span class="comment">// æ‰€ä»¥è¿™é‡Œæ•è·å¼‚å¸¸åå¹¶ä¸å¤„ç†å¼‚å¸¸ï¼Œå¼‚å¸¸è¿˜æ˜¯äº¤ç»™å¤–é¢å¤„ç†ï¼Œè¿™é‡Œæ•è·äº†å†</span></span><br><span class="line"><span class="comment">// é‡æ–°æŠ›å‡ºå»ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// éšæ‚£ï¼Œç¬¬ä¸€ä¸ªæˆåŠŸï¼Œç¬¬äºŒä¸ªå¤±è´¥</span></span><br><span class="line">    <span class="comment">// å¯ä»¥è§£å†³ï¼Œä½†æ˜¯å¾ˆéº»çƒ¦ï¼Œè¿™æ ·çš„é—®é¢˜ä¸€èˆ¬æ˜¯ç”¨æ™ºèƒ½æŒ‡é’ˆè§£å†³</span></span><br><span class="line"><span class="type">int</span>* array1 = <span class="keyword">new</span> <span class="type">int</span>[<span class="number">10</span>];</span><br><span class="line"><span class="type">int</span>* array2 = <span class="keyword">new</span> <span class="type">int</span>[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> len, time;</span><br><span class="line">cin &gt;&gt; len &gt;&gt; time;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="built_in">Division</span>(len, time) &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">catch</span> (...)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// è‹¥ç¬¬ä¸€ä¸ªnewæˆåŠŸï¼Œç¬¬äºŒä¸ªå¤±è´¥ï¼Œè¿™é‡Œè¿˜è¦delete arr2</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;delete []&quot;</span> &lt;&lt; array1 &lt;&lt; endl;</span><br><span class="line"><span class="keyword">delete</span>[] array1;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;delete []&quot;</span> &lt;&lt; array1 &lt;&lt; endl;</span><br><span class="line"><span class="keyword">delete</span>[] array2; </span><br><span class="line"></span><br><span class="line"><span class="keyword">throw</span>; <span class="comment">// æ•è·ä»€ä¹ˆæŠ›å‡ºä»€ä¹ˆ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;delete []&quot;</span> &lt;&lt; array1 &lt;&lt; endl;</span><br><span class="line"><span class="keyword">delete</span>[] array1;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;delete []&quot;</span> &lt;&lt; array2 &lt;&lt; endl;</span><br><span class="line"><span class="keyword">delete</span>[] array2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="built_in">main</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">Func</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">catch</span> (<span class="type">const</span> <span class="type">char</span>* errmsg)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; errmsg &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å¼‚å¸¸è§„èŒƒ">å¼‚å¸¸è§„èŒƒ</h2><ol><li>å¼‚å¸¸è§„æ ¼è¯´æ˜çš„ç›®çš„æ˜¯ä¸ºäº†è®©å‡½æ•°ä½¿ç”¨è€…çŸ¥é“è¯¥å‡½æ•°å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸æœ‰å“ªäº›ã€‚ å¯ä»¥åœ¨å‡½æ•°çš„åé¢æ¥throw(ç±»å‹)ï¼Œåˆ—å‡ºè¿™ä¸ªå‡½æ•°å¯èƒ½æŠ›æ·çš„æ‰€æœ‰å¼‚å¸¸ç±»å‹ã€‚</li><li>å‡½æ•°çš„åé¢æ¥throw()ï¼Œè¡¨ç¤ºå‡½æ•°ä¸æŠ›å¼‚å¸¸ã€‚</li><li>è‹¥æ— å¼‚å¸¸æ¥å£å£°æ˜ï¼Œåˆ™æ­¤å‡½æ•°å¯ä»¥æŠ›æ·ä»»ä½•ç±»å‹çš„å¼‚å¸¸</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™é‡Œè¡¨ç¤ºè¿™ä¸ªå‡½æ•°ä¼šæŠ›å‡ºA/B/C/Dä¸­çš„æŸç§ç±»å‹çš„å¼‚å¸¸  </span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">()</span> <span class="title">throw</span><span class="params">(Aï¼ŒBï¼ŒCï¼ŒD)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™é‡Œè¡¨ç¤ºè¿™ä¸ªå‡½æ•°åªä¼šæŠ›å‡ºbad_allocçš„å¼‚å¸¸  </span></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="keyword">operator</span> <span class="title">new</span> <span class="params">(std::<span class="type">size_t</span> size)</span> <span class="title">throw</span> <span class="params">(std::bad_alloc)</span></span>;  </span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™é‡Œè¡¨ç¤ºè¿™ä¸ªå‡½æ•°ä¸ä¼šæŠ›å‡ºå¼‚å¸¸  </span></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="keyword">operator</span> <span class="title">delete</span> <span class="params">(std::<span class="type">size_t</span> size, <span class="type">void</span>* ptr)</span> <span class="title">throw</span><span class="params">()</span></span>;  </span><br><span class="line"></span><br><span class="line"><span class="comment">// C++11 ä¸­æ–°å¢çš„noexceptï¼Œè¡¨ç¤ºä¸ä¼šæŠ›å¼‚å¸¸  </span></span><br><span class="line"><span class="built_in">thread</span>() <span class="keyword">noexcept</span>;  </span><br><span class="line"><span class="built_in">thread</span> (thread&amp;&amp; x) <span class="keyword">noexcept</span>;</span><br></pre></td></tr></table></figure><h1>å¼‚å¸¸çš„ä¼˜ç¼ºç‚¹</h1><h2 id="C-å¼‚å¸¸ä¼˜ç‚¹">C++å¼‚å¸¸ä¼˜ç‚¹</h2><ol><li>å¼‚å¸¸å¯¹è±¡å®šä¹‰å¥½ä¹‹åï¼Œç›¸æ¯”é”™è¯¯ç çš„æ–¹å¼æ›´èƒ½æ¸…æ™°å‡†ç¡®çš„å±•ç¤ºå‡ºé”™è¯¯çš„å„ç§ä¿¡æ¯ï¼Œç”šè‡³å¯ä»¥åŒ…å«è°ƒç”¨å †æ ˆçš„ä¿¡æ¯ï¼Œå¯ä»¥æ›´å®¹æ˜“å®šä½ç¨‹åºbug</li><li>å¯ä»¥ç›´æ¥è·³å‡ºåˆ°catchæ•æ‰çš„åœ°æ–¹ï¼Œè€Œä¸ç”¨åƒé”™è¯¯ç ä¸€æ ·å±‚å±‚è¿”å›ã€‚</li><li>å¾ˆå¤šç¬¬ä¸‰æ–¹åº“åŒ…å«å¼‚å¸¸</li><li>éƒ¨åˆ†å‡½æ•°ä½¿ç”¨å¼‚å¸¸æ›´å¥½å¤„ç†ï¼Œæ¯”å¦‚æ„é€ å‡½æ•°æ²¡æœ‰è¿”å›å€¼ï¼Œä¸æ–¹ä¾¿ä½¿ç”¨é”™è¯¯ç æ–¹å¼å¤„ç†ï¼Œæ–¹æ‹¬å·çš„é‡è½½ï¼Œposè¶Šç•Œé”™è¯¯ï¼Œåªèƒ½é€šè¿‡å¼‚å¸¸æˆ–è€…ç»ˆæ­¢ç¨‹åºã€‚</li></ol><h2 id="C-å¼‚å¸¸ç¼ºç‚¹">C++å¼‚å¸¸ç¼ºç‚¹</h2><ol><li>æ‰§è¡Œæµå¯èƒ½ä¼šä¹±è·³ï¼Œè¿è¡Œæ—¶æŠ›å‡ºï¼Œä¼šæ¯”è¾ƒçš„æ··ä¹±</li><li>æœ‰æ€§èƒ½å¼€é”€</li><li>å®¹æ˜“å¯¼è‡´å†…å­˜æ³„æ¼ã€æ­»é”å®‰å…¨é—®é¢˜</li><li>C++æ ‡å‡†ä½“ç³»å®šä¹‰ä¸å¥½ï¼Œå¯¼è‡´å¤§å®¶è‡ªå®šä¹‰å„è‡ªçš„å¼‚å¸¸ä½“ç³»ï¼Œååˆ†æ··ä¹±</li></ol><h2 id="æ€»ç»“">æ€»ç»“</h2><p>å¼‚å¸¸å°½é‡è§„èŒƒä½¿ç”¨ï¼Œä¸è¦éšä¾¿æŠ›å¼‚å¸¸ï¼Œéµå®ˆå¦‚ä¸‹ï¼š</p><ul><li>æ‰€æœ‰å¼‚å¸¸ç±»å‹éƒ½ç»§æ‰¿äºä¸€ä¸ªåŸºç±»</li><li>å‡½æ•°æ˜¯å¦æŠ›å¼‚å¸¸ï¼ŒæŠ›ä»€ä¹ˆå¼‚å¸¸ï¼Œéƒ½ä½¿ç”¨ fun() throw(); çš„æ–¹å¼è§„èŒƒåŒ–ã€‚</li></ul><p>å¼‚å¸¸æ€»ä½“æ¥è¯´ï¼Œåˆ©å¤§äºå¼Šã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹è¯­è¨€ </category>
          
          <category> CPP </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>C++11ï¼ˆä¸‹ç¯‡ï¼‰</title>
      <link href="/posts/3042503810/"/>
      <url>/posts/3042503810/</url>
      
        <content type="html"><![CDATA[<h1>ç±»çš„æ–°åŠŸèƒ½</h1><h2 id="é»˜è®¤æˆå‘˜å‡½æ•°">é»˜è®¤æˆå‘˜å‡½æ•°</h2><p>åœ¨ä»¥å‰çš„C++ç±»ä¸­ï¼Œæœ‰6ä¸ªé»˜è®¤æˆå‘˜å‡½æ•°ï¼š</p><ol><li>æ„é€ å‡½æ•°</li><li>ææ„å‡½æ•°</li><li>æ‹·è´æ„é€ å‡½æ•°</li><li>æ‹·è´èµ‹å€¼é‡è½½</li><li>å–åœ°å€é‡è½½</li><li>const å–åœ°å€é‡è½½</li></ol><p>æ¯”è¾ƒé‡è¦çš„æ˜¯å‰4ä¸ªï¼Œåä¸¤ä¸ªçš„ç”¨å¤„å¹¶ä¸å¤§ï¼Œé»˜è®¤çš„æˆå‘˜å‡½æ•°å°±æ˜¯æˆ‘ä»¬ä¸å†™ç¼–è¯‘å™¨ä¼šç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„ã€‚</p><blockquote><p>åœ¨C++11ä¸­ï¼Œæ–°å¢äº†ä¸¤ä¸ªé»˜è®¤æˆå‘˜å‡½æ•°</p></blockquote><ol><li>ç§»åŠ¨æ„é€ å‡½æ•°</li><li>ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦é‡è½½</li></ol><p>é’ˆå¯¹è¿™ä¸¤ä¸ªæ–°çš„é»˜è®¤æˆå‘˜å‡½æ•°ï¼Œæœ‰äº†æ–°çš„æ³¨æ„äº‹é¡¹ï¼š</p><p>1ã€å¦‚æœ<strong>æ²¡æœ‰è‡ªå·±å®ç°ç§»åŠ¨æ„é€ </strong>ï¼Œ<strong>ä¸”æ²¡æœ‰å®ç°ææ„å‡½æ•°ã€æ‹·è´æ„é€ ã€æ‹·è´èµ‹å€¼é‡è½½ä¸­çš„ä»»ä½•ä¸€ä¸ª</strong>ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª<strong>é»˜è®¤ç§»åŠ¨æ„é€ </strong>ã€‚</p><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸ªä¾‹å­ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">Person</span>(<span class="type">const</span> <span class="type">char</span>* name = <span class="string">&quot;&quot;</span>, <span class="type">int</span> age = <span class="number">0</span>)</span><br><span class="line">:_name(name)</span><br><span class="line">, _age(age)</span><br><span class="line">&#123;&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">st::string _name;</span><br><span class="line"><span class="type">int</span> _age;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">Person <span class="title">s1</span><span class="params">(<span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="number">7</span>)</span></span>;</span><br><span class="line">Person s2 = std::<span class="built_in">move</span>(s1); <span class="comment">// ç§»åŠ¨æ„é€  ï¼ˆæ²¡æœ‰ç§»åŠ¨æ„é€ ï¼Œå†è°ƒç”¨æ‹·è´æ„é€ ï¼‰</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¿™ä¸ªPersonç±»ï¼Œåªè‡ªå·±å®ç°äº†ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œææ„ã€æ‹·è´æ„é€ ã€æ‹·è´èµ‹å€¼é‡è½½éƒ½æœªæ‰‹åŠ¨å®ç°ï¼ŒPersonçš„_nameæˆå‘˜ç”¨çš„è‡ªå·±æ¨¡æ‹Ÿå®ç°çš„stringç±»ã€‚</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301021417868.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè°ƒç”¨äº†stringçš„ç§»åŠ¨æ„é€ ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬åœ¨Personç±»ä¸­åŠ ä¸ªææ„ç»“æœæ˜¯ä»€ä¹ˆæ ·å‘¢ï¼Ÿ</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301021418203.png" alt=""></p><p>è¿™é‡Œå°±è°ƒç”¨äº†æ‹·è´æ„é€ ï¼ŒåŸå› æ˜¯æœ‰äº†ææ„ï¼Œå°±ä¸å†ç”Ÿæˆé»˜è®¤çš„ç§»åŠ¨æ„é€ å‡½æ•°ã€‚</p><p>2ã€é»˜è®¤ç”Ÿæˆçš„ç§»åŠ¨æ„é€ </p><ul><li>å¯¹äº<strong>å†…ç½®ç±»å‹ä¼šé€å­—èŠ‚æ‹·è´</strong></li><li>å¯¹äº<strong>è‡ªå®šä¹‰ç±»å‹</strong>ï¼Œåˆ™éœ€è¦çœ‹è¿™ä¸ªæˆå‘˜æ˜¯å¦å®ç°äº†ç§»åŠ¨æ„é€ ï¼Œå¦‚æœ<strong>å®ç°äº†å°±è°ƒç”¨ç§»åŠ¨æ„é€ ï¼Œæ²¡æœ‰å®ç°å°±è°ƒç”¨æ‹·è´æ„é€ </strong>ã€‚ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰</li></ul><blockquote><p>å½“åˆ é™¤äº†stringç±»çš„ç§»åŠ¨æ„é€ å</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301021436581.png" alt=""></p><p>3ã€é»˜è®¤ç”Ÿæˆçš„ç§»åŠ¨èµ‹å€¼å’Œé»˜è®¤ç”Ÿæˆçš„ç§»åŠ¨æ„é€ å®Œå…¨ç±»ä¼¼ã€‚</p><p>4ã€å¦‚æœæä¾›äº†ç§»åŠ¨æ„é€ æˆ–è€…ç§»åŠ¨èµ‹å€¼ï¼Œç¼–è¯‘å™¨ä¸ä¼šè‡ªåŠ¨æä¾›æ‹·è´æ„é€ å’Œæ‹·è´èµ‹å€¼ã€‚</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301021427141.png" alt=""></p><h2 id="defaultå’Œdelete">defaultå’Œdelete</h2><h3 id="default">default</h3><blockquote><p>å¼ºåˆ¶ç”Ÿæˆé»˜è®¤å‡½æ•°</p></blockquote><p>æˆ‘ä»¬çŸ¥é“å¯¹äºç±»æ¥è¯´æœ‰æ—¶å€™ä¼šéœ€è¦ç”Ÿæˆé»˜è®¤æˆå‘˜å‡½æ•°ï¼Œæ¯”å¦‚æˆ‘ä»¬å®ç°äº†æœ‰å‚çš„æ„é€ ï¼Œæ— å‚æ„é€ å°±ä¸ä¼šé»˜è®¤ç”Ÿæˆï¼Œæˆ–è€…å®ç°äº†æ‹·è´æ„é€ ï¼Œé»˜è®¤ç”Ÿæˆçš„ç§»åŠ¨æ„é€ å°±ä¸ä¼šç”Ÿæˆã€‚</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301021450459.png" alt=""></p><p>ä¸Šå›¾åœºæ™¯æ˜¯æˆ‘ä»¬å®ç°äº†æ‹·è´æ„é€ ï¼Œé‚£ä¹ˆé»˜è®¤çš„ç§»åŠ¨æ„é€ å°±ä¸ä¼šç”Ÿæˆï¼Œæˆ‘ä»¬å¼ºåˆ¶ç”Ÿæˆä¹‹åå®ç°äº†æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœã€‚</p><h3 id="delete">delete</h3><blockquote><p>ç¦æ­¢ç”Ÿæˆé»˜è®¤å‡½æ•°çš„å…³é”®å­—</p></blockquote><p>æ¯”å¦‚è¦æ±‚deleteå…³é”®å­—å®ç°ï¼Œä¸€ä¸ªç±»ï¼Œåªèƒ½åœ¨å †ä¸Šåˆ›å»ºå¯¹è±¡ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">HeapOnly</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">HeapOnly</span>()</span><br><span class="line">&#123;</span><br><span class="line">_str = <span class="keyword">new</span> <span class="type">char</span>[<span class="number">10</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">~<span class="built_in">HeapOnly</span>() = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Destroy</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">delete</span>[] _str;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">operator</span> <span class="title">delete</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="type">char</span>* _str;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åªéœ€è¦ï¼š<strong>~HeapOnly() = delete</strong>;</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301021502973.png" alt=""></p><p>è¿™æ ·åœ¨æ ˆå’Œé™æ€åŒºéƒ½ä¸èƒ½åˆ›å»ºå¯¹è±¡ã€‚å¦‚æœè¦åˆ›å»ºå¯¹è±¡åªèƒ½åœ¨å †ä¸Šåˆ›å»ºã€‚</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301021520043.png" alt=""></p><pre><code>æ³¨æ„ï¼Œdestroy() å‡½æ•°ï¼Œç¬¬ä¸€æ˜¯é‡Šæ”¾ char* çš„é‚£ä¸ªç©ºé—´ï¼Œç¬¬äºŒä¸ªæ˜¯è¦é‡Šæ”¾ptræŒ‡å‘çš„é‚£æ®µç©ºé—´ã€‚é‡Šæ”¾ptræŒ‡å‘çš„ç©ºé—´è¦ç”¨ operator delete()ï¼Œå› ä¸º deleteä¼šè°ƒç”¨ææ„</code></pre><h1>å¯å˜å‚æ•°æ¨¡æ¿</h1><blockquote><p>C++11çš„æ–°ç‰¹æ€§å¯å˜å‚æ•°æ¨¡æ¿èƒ½å¤Ÿåˆ›å»ºå¯ä»¥æ¥å—å¯å˜å‚æ•°çš„å‡½æ•°æ¨¡æ¿å’Œç±»æ¨¡æ¿</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301021533875.png" alt=""></p><pre><code>æˆ‘ä»¬æŠŠå¸¦çœç•¥å·çš„å‚æ•°ç§°ä¸ºâ€œå‚æ•°åŒ…â€ï¼Œå®ƒé‡Œé¢åŒ…å«äº†0åˆ°Nï¼ˆN&gt;=0ï¼‰ä¸ªæ¨¡ç‰ˆå‚æ•°ï¼Œæ¯”å¦‚argsé‡Œé¢æœ‰ä¸‰ä¸ªå‚æ•°åŒ…ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ï¼Œå‚æ•°åŒ…é‡Œé¢çš„å†…å®¹ä¸èƒ½ç›´æ¥å–å‡ºæ¥ã€‚ä¹Ÿä¸èƒ½ç”¨æ–¹æ‹¬å·ç›´æ¥è®¿é—®</code></pre><p>å¯ä»¥ç”¨<strong>sizeofâ€¦(args)</strong> è®¡ç®—å‚æ•°åŒ…æœ‰å‡ ä¸ªå‚æ•°ã€‚</p><h2 id="é€’å½’å‡½æ•°æ–¹å¼å±•å¼€å‚æ•°åŒ…">é€’å½’å‡½æ•°æ–¹å¼å±•å¼€å‚æ•°åŒ…</h2><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301021547497.png" alt=""></p><h2 id="é€—å·è¡¨è¾¾å¼å±•å¼€å‚æ•°åŒ…">é€—å·è¡¨è¾¾å¼å±•å¼€å‚æ•°åŒ…</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PrintArg</span><span class="params">(<span class="type">const</span> T&amp; x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ...Args&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ShowList</span><span class="params">(Args... args)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> arr[] = &#123; (<span class="built_in">PrintArg</span>(args), <span class="number">0</span>)... &#125;;</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">ShowList</span>(<span class="number">1</span>, <span class="string">&#x27;A&#x27;</span>, <span class="number">3.14</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>C++11çš„å¦å¤–ä¸€ä¸ªç‰¹æ€§â€”â€”åˆå§‹åŒ–åˆ—è¡¨ï¼Œé€šè¿‡åˆå§‹åŒ–åˆ—è¡¨æ¥åˆå§‹åŒ–ä¸€ä¸ªå˜é•¿æ•°ç»„, &#123;(printarg(args), 0)...&#125;å°†ä¼šå±•å¼€æˆ((printarg(arg1),0),  (printarg(arg2),0), (printarg(arg3),0), etc... )ï¼Œæœ€ç»ˆä¼šåˆ›å»ºä¸€ä¸ªå…ƒç´ å€¼éƒ½ä¸º0çš„æ•°ç»„int arr[sizeof...(args)],ä¹Ÿå°±æ˜¯è¯´åœ¨æ„é€ intæ•°ç»„çš„è¿‡ç¨‹ä¸­å°±å°†å‚æ•°åŒ…å±•å¼€äº†ï¼Œè¿™ä¸ªæ•°ç»„çš„ç›®çš„çº¯ç²¹æ˜¯ä¸ºäº†åœ¨æ•°ç»„æ„é€ çš„è¿‡ç¨‹å±•å¼€å‚æ•°åŒ…</code></pre><p>ä¹Ÿå¯ä»¥è¿™æ ·ï¼š</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/20230102160429.png" alt=""></p><h2 id="STLå®¹å™¨ä¸­çš„empalceç›¸å…³æ¥å£å‡½æ•°">STLå®¹å™¨ä¸­çš„empalceç›¸å…³æ¥å£å‡½æ•°</h2><h2 id="push-back">push_back</h2><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301021616978.png" alt=""></p><p>ä¸‹è¾¹è¿™ç§åœºæ™¯ï¼Œæ˜¯ä¸€ä¸ªæ„é€ åŠ æ‹·è´æ„é€ ï¼Œæˆ–è€…æ„é€ åŠ ç§»åŠ¨æ„é€ </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;pair&lt;bit::string, <span class="type">int</span>&gt;&gt; v;</span><br><span class="line">v.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(<span class="string">&quot;sort&quot;</span>, <span class="number">1</span>));</span><br></pre></td></tr></table></figure><h2 id="emplace-back">emplace_back</h2><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301021617720.png" alt=""></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">v.<span class="built_in">emplace_back</span>(<span class="built_in">make_pair</span>(<span class="string">&quot;sort&quot;</span>, <span class="number">1</span>));</span><br><span class="line">v.<span class="built_in">emplace_back</span>(<span class="string">&quot;sort&quot;</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure><h2 id="å¯¹æ¯”">å¯¹æ¯”</h2><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301021613445.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°vectorï¼Œæµ‹è¯•ä¸¤ç§æ–¹å¼æ²¡æœ‰åŒºåˆ«ï¼Œä½†æ˜¯listæµ‹è¯•ï¼Œemplace_backæ›´é«˜æ•ˆï¼Œå› ä¸ºåªæœ‰ä¸€æ¬¡æ„é€ ï¼Œå‚æ•°ä¼ é€’çš„å‚æ•°åŒ…ç›´æ¥æ„é€ åˆ°Listçš„èŠ‚ç‚¹ä¸Šã€‚</p><h2 id="æ€»ç»“">æ€»ç»“</h2><p>å¯¹äºå†…ç½®ç±»å‹æ¥è¯´ï¼Œä¸¤ç§å¹¶æ— åŒºåˆ«ï¼Œå¯¹è‡ªå®šä¹‰ç±»å‹æ¥è¯´ï¼Œä¸€äº›å®¹å™¨ï¼Œæ¯”å¦‚listå¯ä»¥ç›´æ¥å°†å‚æ•°åŒ…æ„é€ åˆ°å®¹å™¨çš„å¯¹è±¡ä¸Šé¢ã€‚æ›´é«˜æ•ˆä¸€äº›ã€‚</p><h1>lambdaè¡¨è¾¾å¼</h1><blockquote><p>åƒå‡½æ•°ä½¿ç”¨çš„å¯¹è±¡/ç±»å‹</p></blockquote><ol><li>å‡½æ•°æŒ‡é’ˆ</li><li>ä»¿å‡½æ•°/å‡½æ•°å¯¹è±¡</li><li>lambda</li></ol><h2 id="lambdaè¯­æ³•">lambdaè¯­æ³•</h2><blockquote><p>æ ¼å¼ï¼š [æ•æ‰åˆ—è¡¨] (å‚æ•°åˆ—è¡¨) mutable -&gt; è¿”å›å€¼ç±»å‹ {å‡½æ•°ä½“}</p></blockquote><p>æ¥ä¸ªä¾‹å­ï¼š</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301021646421.png" alt=""></p><p>çœ‹ä¸€ä¸‹fçš„ç±»å‹ï¼š</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301021651018.png" alt=""></p><p>å…·ä½“è¯´æ˜ï¼š</p><ul><li><strong>æ•æ‰åˆ—è¡¨</strong>ï¼šè¯‘å™¨æ ¹æ® [] æ¥åˆ¤æ–­æ¥ä¸‹æ¥çš„ä»£ç æ˜¯å¦ä¸ºlambdaå‡½æ•°ï¼Œæ•æ‰åˆ—è¡¨èƒ½å¤Ÿæ•æ‰ä¸Šä¸‹æ–‡ä¸­çš„å˜é‡ä¾›lambdaå‡½æ•°ä½¿ç”¨ã€‚</li><li><strong>å‚æ•°åˆ—è¡¨</strong>ï¼šå’Œæ™®é€šå‡½æ•°åˆ—è¡¨ä¸€è‡´ï¼Œå¦‚æœä¸éœ€è¦å‚æ•°ä¼ é€’å¯ä»¥çœç•¥()ã€‚</li><li><strong>mutable</strong> ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œlambdaå‡½æ•°æ€»æ˜¯ä¸€ä¸ªconstå‡½æ•°ï¼Œmutableå¯ä»¥å–æ¶ˆå¸¸é‡æ€§ï¼Œä½¿ç”¨è¯¥ä¿®é¥°ç¬¦æ—¶ï¼Œä¸èƒ½çœç•¥()</li><li><strong>è¿”å›å€¼ç±»å‹</strong>ï¼šä¸å¸¸è§„å‡½æ•°ä¸€æ ·ï¼Œå¯ä»¥çœç•¥</li><li><strong>å‡½æ•°ä½“</strong>ï¼šé™¤äº†ä½¿ç”¨å‚æ•°å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨æ•æ‰çš„å˜é‡ã€‚</li></ul><p>æ³¨æ„ï¼š</p><p>åœ¨lambdaå‡½æ•°å®šä¹‰ä¸­ï¼Œ<strong>å‚æ•°åˆ—è¡¨å’Œè¿”å›å€¼ç±»å‹éƒ½æ˜¯å¯é€‰éƒ¨åˆ†ï¼Œè€Œæ•æ‰åˆ—è¡¨å’Œå‡½æ•°ä½“å¯ä»¥ä¸ºç©º</strong>ï¼ŒC++11ä¸­ï¼Œæœ€ç®€å•çš„lambdaå‡½æ•°ä¸ºï¼š[] () ï¼›è¯¥å‡½æ•°ä¸èƒ½åšä»»ä½•äº‹æƒ…ï¼Œåªæ˜¯ç¬¦åˆè¯­æ³•ã€‚</p><blockquote><p>çœ‹ä¸€ä¸ªmutableçš„ä½¿ç”¨</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301021717343.png" alt=""></p><p>è¿™é‡Œå€¼æ•è·xå’Œyï¼Œä½†æ˜¯è¿™ä¸ªlambdaé»˜è®¤æ˜¯constçš„å‡½æ•°ã€‚ä¿®æ”¹äº†xå’Œyæ‰€ä»¥ä¼šæŠ¥é”™ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> swap3 = [x, y]()<span class="keyword">mutable</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> tmp = x;</span><br><span class="line">x = y;</span><br><span class="line">y = tmp;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åŠ ä¸Šmutableå°±å¯ä»¥ï¼Œä¸è¿‡ä¹Ÿæ²¡æœ‰èµ·åˆ°äº¤æ¢çš„ä½œç”¨ï¼Œå› ä¸ºæ˜¯å€¼æ•æ‰ã€‚</p><h2 id="æ•æ‰åˆ—è¡¨">æ•æ‰åˆ—è¡¨</h2><ul><li>[var]ï¼šè¡¨ç¤ºå€¼ä¼ é€’æ–¹å¼æ•æ‰å˜é‡var</li><li>[=]ï¼šè¡¨ç¤ºå€¼ä¼ é€’æ–¹å¼æ•è·æ‰€æœ‰çˆ¶ä½œç”¨åŸŸä¸­çš„å˜é‡(åŒ…æ‹¬this)</li><li>[&amp;var]ï¼šè¡¨ç¤ºå¼•ç”¨ä¼ é€’æ•æ‰å˜é‡var</li><li>[&amp;]ï¼šè¡¨ç¤ºå¼•ç”¨ä¼ é€’æ•æ‰æ‰€æœ‰çˆ¶ä½œç”¨åŸŸä¸­çš„å˜é‡(åŒ…æ‹¬this)</li><li>[this]ï¼šè¡¨ç¤ºå€¼ä¼ é€’æ–¹å¼æ•æ‰å½“å‰çš„thisæŒ‡é’ˆ</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> swap3 = [&amp;x, &amp;y]</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> tmp = x;</span><br><span class="line">x = y;</span><br><span class="line">y = tmp;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä¸€äº›å¸¸è§ç”¨æ³•çœ‹ä¸‹è¾¹ä¾‹å­ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1ã€ç”Ÿå‘½å‘¨æœŸï¼ˆå­˜å‚¨åŒºåŸŸï¼‰</span></span><br><span class="line"><span class="comment">//2ã€ä½œç”¨åŸŸï¼ˆç¼–è¯‘å™¨ç¼–è¯‘ï¼Œç”¨çš„åœ°æ–¹èƒ½å¦æ‰¾åˆ°ï¼‰</span></span><br><span class="line"><span class="type">int</span> f = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">func</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">static</span> <span class="type">int</span> x = <span class="number">0</span>;</span><br><span class="line">cout &lt;&lt; x &lt;&lt; endl;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> a, b, c;</span><br><span class="line">a = b = c = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¨éƒ¨ä¼ å€¼æ•æ‰</span></span><br><span class="line"><span class="keyword">auto</span> f1 = [=]() &#123;</span><br><span class="line">cout &lt;&lt; a &lt;&lt; b &lt;&lt; c &lt;&lt; endl;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">f1</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ··åˆæ•æ‰</span></span><br><span class="line"><span class="keyword">auto</span> f2 = [=, &amp;a]() &#123;</span><br><span class="line">a++;</span><br><span class="line">cout &lt;&lt; a &lt;&lt; b &lt;&lt; c &lt;&lt; endl;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">f2</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> f4 = [&amp;]()</span><br><span class="line">&#123;</span><br><span class="line">f++; <span class="comment">//æ²¡é—®é¢˜ï¼Œå¯ä»¥æ•æ‰å…¨å±€å˜é‡</span></span><br><span class="line">x++; <span class="comment">//é”™è¯¯ï¼Œxæ˜¯é™æ€å˜é‡ï¼Œä½†æ˜¯å®ƒçš„ä½œç”¨åŸŸæ˜¯fun</span></span><br><span class="line">cout &lt;&lt; f &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; x &lt;&lt; endl;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">f4</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="lambdaåº•å±‚ç»†èŠ‚">lambdaåº•å±‚ç»†èŠ‚</h2><p>çœ‹ä¸€æ®µä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Rate</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">Rate</span>(<span class="type">double</span> rate) : _rate(rate)</span><br><span class="line">&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">double</span> money, <span class="type">int</span> year)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> money * _rate * year;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="type">double</span> _rate;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">double</span> rate = <span class="number">0.49</span>;</span><br><span class="line"><span class="function">Rate <span class="title">r1</span><span class="params">(rate)</span></span>;</span><br><span class="line"><span class="built_in">r1</span>(<span class="number">10000</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> r2 = [=](<span class="type">double</span> monty, <span class="type">int</span> year)-&gt;<span class="type">double</span>&#123;<span class="keyword">return</span> monty*rate*year; &#125;;</span><br><span class="line"><span class="built_in">r2</span>(<span class="number">10000</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç r1æ˜¯ä¸ªå‡½æ•°å¯¹è±¡ï¼Œr2æ˜¯lambdaï¼Œè½¬åˆ°åæ±‡ç¼–çœ‹çœ‹ï¼Œè¿™ä¸¤ä¸ªçš„åŒºåˆ«ã€‚</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301032135781.png" alt=""></p><p>ç”±ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œr1å’Œr2éƒ½æ˜¯è°ƒç”¨äº†é‡è½½çš„æ–¹æ‹¬å·ï¼Œå®é™…åœ¨åº•å±‚ç¼–è¯‘å™¨å¯¹äºlambdaè¡¨è¾¾å¼çš„å¤„ç†æ–¹å¼ï¼Œå®Œå…¨å°±æ˜¯æŒ‰ç…§å‡½æ•°å¯¹è±¡çš„æ–¹å¼å¤„ç†çš„ï¼Œå³ï¼š<strong>å¦‚æœå®šä¹‰äº†ä¸€ä¸ªlambdaè¡¨è¾¾å¼ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªç±»ï¼Œåœ¨è¯¥ç±»ä¸­é‡è½½äº†operator()</strong></p><p>ç¼–è¯‘å™¨ç”Ÿæˆäº†ä¸ªç±»ä¼¼ä¸‹è¾¹çš„ä¸œè¥¿ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// lambda_uuid</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">lambda_xxxx</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1>åŒ…è£…å™¨</h1><h2 id="functionåŒ…è£…å™¨å¼•å…¥">functionåŒ…è£…å™¨å¼•å…¥</h2><blockquote><p>functionåŒ…è£…å™¨ ä¹Ÿå«ä½œé€‚é…å™¨ã€‚C++ä¸­çš„functionæœ¬è´¨æ˜¯ä¸€ä¸ªç±»æ¨¡æ¿ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªåŒ…è£…å™¨ã€‚ä¸ºä»€ä¹ˆéœ€è¦functionå‘¢ï¼Ÿå¯ä»¥çœ‹ä¸€ä¸ªåœºæ™¯</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ret = <span class="built_in">func</span>(x);</span><br></pre></td></tr></table></figure><p>funcå¯èƒ½æ˜¯å‡½æ•°åã€å‡½æ•°æŒ‡é’ˆã€å‡½æ•°å¯¹è±¡(ä»¿å‡½æ•°å¯¹è±¡)ã€ä¹Ÿæœ‰å¯èƒ½<br>æ˜¯lamberè¡¨è¾¾å¼å¯¹è±¡ï¼Œè¿™äº›éƒ½æœ‰å¯èƒ½ã€‚</p><p>çœ‹ä¸ªdemo</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> F, <span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function">T <span class="title">useF</span><span class="params">(F f, T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">static</span> <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;count:&quot;</span> &lt;&lt; ++count &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;count:&quot;</span> &lt;&lt; &amp;count &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">f</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">f</span><span class="params">(<span class="type">double</span> i)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> i / <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Functor</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">double</span> d)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> d / <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line">cout &lt;&lt; <span class="built_in">useF</span>(f, <span class="number">11.11</span>) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°å¯¹è±¡</span></span><br><span class="line">cout &lt;&lt; <span class="built_in">useF</span>(<span class="built_in">Functor</span>(), <span class="number">11.11</span>) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="comment">// lamberè¡¨è¾¾å¼å¯¹è±¡</span></span><br><span class="line">cout &lt;&lt; <span class="built_in">useF</span>([](<span class="type">double</span> d)-&gt;<span class="type">double</span>&#123; <span class="keyword">return</span> d / <span class="number">4</span>; &#125;, <span class="number">11.11</span>) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>useFæ˜¯ä¸ªå‡½æ•°æ¨¡æ¿ï¼Œä¾æ¬¡å°†å‡½æ•°æŒ‡é’ˆï¼Œå‡½æ•°å¯¹è±¡ï¼Œlambdaä¼ å…¥ï¼Œè¿è¡Œçœ‹ä¸€ä¸‹</code></pre><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301032203951.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°é™æ€å˜é‡countä¸‰æ¬¡çš„åœ°å€éƒ½ä¸ä¸€æ ·ï¼Œè¯´æ˜è¿™ä¸ªå‡½æ•°æ¨¡æ¿å®ä¾‹åŒ–å‡ºæ¥ä¸‰ä»½ä»£ç ã€‚</p><p>æˆ‘ä»¬ä¸ŠåŒ…è£…å™¨ï¼š</p><h2 id="functionåŒ…è£…å™¨ç”¨æ³•">functionåŒ…è£…å™¨ç”¨æ³•</h2><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301032213439.png" alt=""></p><blockquote><p>functionåœ¨åœ¨å¤´æ–‡ä»¶ &lt; functional &gt;</p></blockquote><p>æ¨¡æ¿å‚æ•°è¯´æ˜ï¼š</p><ul><li>Ret: è¢«è°ƒç”¨å‡½æ•°çš„è¿”å›ç±»å‹</li><li>Argsâ€¦ï¼šè¢«è°ƒç”¨å‡½æ•°çš„å½¢å‚</li></ul><p>æˆ‘ä»¬æ”¹é€ ä¸Šé¢çš„ç¨‹åºï¼Œç”¨åŒ…è£…å™¨åŒ…è£…èµ·æ¥ã€‚æ³¨æ„æ¨¡æ¿å‚æ•°é‚£é‡Œçš„å†™æ³•ï¼Œ<strong>å…ˆæ˜¯è¿”å›å€¼ç±»å‹ç„¶åå°æ‹¬å·é‡Œé¢çš„å‚æ•°åˆ—è¡¨çš„ç±»å‹</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line">function&lt;<span class="type">double</span>(<span class="type">double</span>)&gt; f1 = f;</span><br><span class="line">cout &lt;&lt; <span class="built_in">useF</span>(f1, <span class="number">11.11</span>) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°å¯¹è±¡</span></span><br><span class="line">function&lt;<span class="type">double</span>(<span class="type">double</span>)&gt; f2 = <span class="built_in">Functor</span>();</span><br><span class="line">cout &lt;&lt; <span class="built_in">useF</span>(f2, <span class="number">11.11</span>) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="comment">// lamberè¡¨è¾¾å¼å¯¹è±¡</span></span><br><span class="line">function&lt;<span class="type">double</span>(<span class="type">double</span>)&gt; f3 = [](<span class="type">double</span> d)-&gt;<span class="type">double</span> &#123; <span class="keyword">return</span> d / <span class="number">4</span>; &#125;;</span><br><span class="line">cout &lt;&lt; <span class="built_in">useF</span>(f3, <span class="number">11.11</span>) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹ä¸‹è¿è¡Œç»“æœ</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301032216604.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°countçš„ä¸‰ä¸ªåœ°å€ç›¸åŒï¼Œè¯´æ˜åªå®ä¾‹åŒ–å‡ºäº†ä¸€ä»½ä»£ç ã€‚ä¸€å®šç¨‹åº¦çš„è§£å†³æ¨¡æ¿æ•ˆç‡ä½ä¸‹ï¼Œå®ä¾‹åŒ–å¤šä»½çš„é—®é¢˜ã€‚</p><blockquote><p>ç”¨æ³•æ³¨æ„ï¼šå¯¹äºç±»çš„é™æ€æˆå‘˜å‡½æ•°å’Œæ™®é€šæˆå‘˜å‡½æ•°ç”¨æ³•çš„åŒºåˆ«ã€‚</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Plus</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">plusi</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">plusd</span><span class="params">(<span class="type">double</span> a, <span class="type">double</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">function&lt;<span class="type">int</span>(<span class="type">int</span>, <span class="type">int</span>)&gt; f1 = Plus::plusi;</span><br><span class="line"><span class="built_in">f1</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">function&lt;<span class="type">double</span>(Plus, <span class="type">double</span>, <span class="type">double</span>)&gt; f2 = &amp;Plus::plusd;</span><br><span class="line"><span class="built_in">f2</span>(<span class="built_in">Plus</span>(), <span class="number">1.1</span>, <span class="number">2.2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>é™æ€æˆå‘˜å‡½æ•°åªéœ€è¦åŠ åŸŸé™å®šç¬¦å³å¯ï¼Œä½†æ˜¯ç±»çš„æˆå‘˜å‡½æ•°ï¼Œä¸ä»…ä»…éœ€è¦åŸŸé™å®šç¬¦ï¼Œè°ƒç”¨æˆå‘˜å‡½æ•°ï¼Œå‰é¢è¿˜éœ€è¦åŠ å–åœ°å€çš„ç¬¦å·ï¼Œå‚æ•°åˆ—è¡¨è¦å¢åŠ ç±»åã€‚</code></pre><p>æ™®é€šçš„ç±»æˆå‘˜å‡½æ•°åŒ…è£…åˆæœ‰äº†æ–°çš„é—®é¢˜ï¼ŒåŒæ ·ä»¥ä¸Šæ–¹ä»£ç ä¸ºä¾‹ï¼Œä¸¤ä¸ªåŠŸèƒ½ç±»ä¼¼çš„å‡½æ•°ï¼ŒåŒ…è£…å™¨ç¡®ä¸ä¸€æ ·ï¼Œè¿™ä¸ªå¯ä»¥è§£å†³å—ï¼Ÿè¿™æ—¶å€™å°±å¼•å…¥äº†æˆ‘ä»¬çš„bind</p><h2 id="bind">bind</h2><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301032247071.png" alt=""></p><blockquote><p>std::bindæ˜¯ä¸€ä¸ªå‡½æ•°æ¨¡æ¿ï¼Œå®ƒå°±åƒä¸€ä¸ªå‡½æ•°åŒ…è£…å™¨(é€‚é…å™¨)ï¼Œæ¥å—ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„å¯è°ƒç”¨å¯¹è±¡æ¥â€œé€‚åº”â€åŸå¯¹è±¡çš„å‚æ•°åˆ—è¡¨ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œæˆ‘ä»¬ç”¨å®ƒå¯ä»¥æŠŠä¸€ä¸ªåŸæœ¬æ¥æ”¶Nä¸ªå‚æ•°çš„å‡½æ•°fnï¼Œé€šè¿‡ç»‘å®šä¸€äº›å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªæ¥æ”¶Mä¸ªï¼ˆMå¯ä»¥å¤§äºNï¼Œä½†è¿™ä¹ˆåšæ²¡ä»€ä¹ˆæ„ä¹‰ï¼‰å‚æ•°çš„æ–°å‡½æ•°ã€‚åŒæ—¶ï¼Œä½¿ç”¨std::bindå‡½æ•°è¿˜å¯ä»¥å®ç°å‚æ•°é¡ºåºè°ƒæ•´ç­‰æ“ä½œ</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301032248465.png" alt=""></p><pre><code> _1 _2.... å®šä¹‰åœ¨placeholderså‘½åç©ºé—´ä¸­ï¼Œä»£è¡¨ç»‘å®šå‡½æ•°å¯¹è±¡çš„å½¢å‚ï¼Œ _1ï¼Œ_2...åˆ†åˆ«ä»£è¡¨ç¬¬ä¸€ä¸ªå½¢å‚ã€ç¬¬äºŒä¸ªå½¢å‚...</code></pre><p>çœ‹ä¸ªå…·ä½“ç”¨æ³•ï¼š</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301032256943.png" alt=""></p><p>ç»‘å®šåï¼Œå½¢å‚çš„é¡ºåºå¾—ä»¥æ”¹å˜ï¼ˆç”¨å¤„ä¸æ˜¯å¾ˆå¤§ï¼‰</p><p>æ›´å®ç”¨çš„ç”¨æ³•ï¼šè°ƒæ•´ä¸ªæ•°ï¼Œç»‘å®šæ­»å›ºå®šå‚æ•°</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">Div</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a / b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Plus</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Mul</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">double</span> rate)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a * b * rate;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Sub</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sub</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a - b;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> placeholders;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">function&lt;<span class="type">int</span>(<span class="type">int</span>, <span class="type">int</span>)&gt; funcPlus = Plus;</span><br><span class="line"><span class="comment">//function&lt;int(Sub, int, int)&gt; funcSub = &amp;Sub::sub;</span></span><br><span class="line"><span class="comment">// æ³¨æ„</span></span><br><span class="line">function&lt;<span class="type">int</span>(<span class="type">int</span>, <span class="type">int</span>)&gt; funcSub = <span class="built_in">bind</span>(&amp;Sub::sub, <span class="built_in">Sub</span>(), _1, _2);</span><br><span class="line"><span class="comment">// æ³¨æ„</span></span><br><span class="line">function&lt;<span class="type">int</span>(<span class="type">int</span>, <span class="type">int</span>)&gt; funcMul = <span class="built_in">bind</span>(Mul, _1, _2, <span class="number">1.5</span>);</span><br><span class="line">map&lt;string, function&lt;<span class="type">int</span>(<span class="type">int</span>, <span class="type">int</span>)&gt;&gt; opFuncMap =</span><br><span class="line">&#123;</span><br><span class="line">&#123; <span class="string">&quot;+&quot;</span>, Plus&#125;,</span><br><span class="line">&#123; <span class="string">&quot;-&quot;</span>, <span class="built_in">bind</span>(&amp;Sub::sub, <span class="built_in">Sub</span>(), _1, _2)&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt;<span class="string">&quot;funcPlus(1, 2)=&quot;</span> &lt;&lt; <span class="built_in">funcPlus</span>(<span class="number">1</span>, <span class="number">2</span>) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;funcSub(1, 2)=&quot;</span> &lt;&lt; <span class="built_in">funcSub</span>(<span class="number">1</span>, <span class="number">2</span>) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt;<span class="string">&quot;funcMul(2, 2)=&quot;</span>&lt;&lt; <span class="built_in">funcMul</span>(<span class="number">2</span>, <span class="number">2</span>) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt;<span class="string">&quot;opFuncMap[\&quot; + \&quot;](1, 2)=&quot;</span> &lt;&lt; opFuncMap[<span class="string">&quot;+&quot;</span>](<span class="number">1</span>, <span class="number">2</span>) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;opFuncMap[\&quot; - \&quot;](1, 2)=&quot;</span> &lt;&lt; opFuncMap[<span class="string">&quot;-&quot;</span>](<span class="number">1</span>, <span class="number">2</span>) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> x = <span class="number">2</span>, y = <span class="number">10</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Div(2,10)=&quot;</span> &lt;&lt; <span class="built_in">Div</span>(x, y) &lt;&lt; endl;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202301032307091.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹è¯­è¨€ </category>
          
          <category> CPP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++11 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++11ï¼ˆå³å€¼ï¼‰</title>
      <link href="/posts/2681483246/"/>
      <url>/posts/2681483246/</url>
      
        <content type="html"><![CDATA[<h1>å³å€¼å¼•ç”¨å’Œç§»åŠ¨è¯­ä¹‰</h1><blockquote><p>ä¼ ç»Ÿçš„C++è¯­æ³•ä¸­å°±æœ‰å¼•ç”¨çš„è¯­æ³•ï¼Œè€ŒC++11ä¸­æ–°å¢äº†çš„å³å€¼å¼•ç”¨è¯­æ³•ç‰¹æ€§ï¼Œæ‰€ä»¥ä»ç°åœ¨å¼€å§‹æˆ‘ä»¬ä¹‹å‰å­¦ä¹ çš„å¼•ç”¨å°±å«åšå·¦å€¼å¼•ç”¨ã€‚æ— è®ºå·¦å€¼å¼•ç”¨è¿˜æ˜¯å³å€¼å¼•ç”¨ï¼Œéƒ½æ˜¯ç»™å¯¹è±¡å–åˆ«åã€‚</p></blockquote><h2 id="å³å€¼å¼•å…¥">å³å€¼å¼•å…¥</h2><blockquote><p>åœ¨ä»¥å‰æˆ‘ä»¬çŸ¥é“æœ‰å¼•ç”¨çš„è¯­æ³•ï¼Œæˆ‘ä»¬é€šå¸¸å«åšå·¦å€¼å¼•ç”¨ï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯å·¦å€¼å‘¢ï¼Ÿå¯ä»¥çœ‹ä¸‹è¾¹çš„å‡ ä¸ªä¾‹å­</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// å·¦å€¼ï¼šå¯ä»¥å–å®ƒçš„åœ°å€</span></span><br><span class="line"><span class="comment">/*int a = 10;</span></span><br><span class="line"><span class="comment">const int b = 20;</span></span><br><span class="line"><span class="comment">int* p = &amp;a;</span></span><br><span class="line"><span class="comment">*p = 100;*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»¥ä¸‹çš„pã€bã€cã€*péƒ½æ˜¯å·¦å€¼</span></span><br><span class="line"><span class="type">int</span>* p = <span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">0</span>);</span><br><span class="line"><span class="type">int</span> b = <span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> c = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»¥ä¸‹å‡ ä¸ªæ˜¯å¯¹ä¸Šé¢å·¦å€¼çš„å·¦å€¼å¼•ç”¨</span></span><br><span class="line"><span class="type">int</span>*&amp; rp = p;</span><br><span class="line"><span class="type">int</span>&amp; rb = b;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span>&amp; rc = c;</span><br><span class="line"><span class="type">int</span>&amp; pvalue = *p;</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> x = <span class="number">1.1</span>, y = <span class="number">2.2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå·¦å€¼ï¼Œ<strong>å¯ä»¥è·å–å®ƒçš„åœ°å€+å¯ä»¥å¯¹å®ƒèµ‹å€¼</strong>ã€‚å½“ç„¶å®šä¹‰æ—¶ç”¨constä¿®é¥°çš„å·¦å€¼ï¼Œä¹Ÿä¸èƒ½å¯¹ä»–èµ‹å€¼ï¼Œä½†æ˜¯å¯ä»¥<strong>å–åœ°å€</strong>ã€‚å·¦å€¼å¼•ç”¨å‘¢ï¼Œå°±æ˜¯ç»™å·¦å€¼çš„å¼•ç”¨ã€‚</p><blockquote><p>çŸ¥é“å·¦å€¼åï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯å³å€¼å‘¢ï¼Ÿå³å€¼çš„å½¢å¼æ˜¯ä»€ä¹ˆï¼Ÿå³å€¼æœ‰ä»€ä¹ˆå®é™…ä»·å€¼ï¼Ÿçœ‹å‡ ä¸ªä¾‹å­</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// å³å€¼:ä¸èƒ½å–åœ°å€</span></span><br><span class="line"><span class="number">10</span>; </span><br><span class="line">x + y;</span><br><span class="line"><span class="built_in">fmin</span>(x, y);</span><br><span class="line"><span class="comment">//cout &lt;&lt; &amp;10 &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">//cout &lt;&lt; &amp;(x + y) &lt;&lt; endl;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»¥ä¸‹å‡ ä¸ªéƒ½æ˜¯å¯¹å³å€¼çš„å³å€¼å¼•ç”¨</span></span><br><span class="line"><span class="type">int</span>&amp;&amp; rr1 = <span class="number">10</span>;</span><br><span class="line"><span class="type">double</span>&amp;&amp; rr2 = x + y;</span><br><span class="line"><span class="type">double</span>&amp;&amp; rr3 = <span class="built_in">fmin</span>(x, y);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™é‡Œç¼–è¯‘ä¼šæŠ¥é”™</span></span><br><span class="line"><span class="number">10</span> = <span class="number">1</span>;</span><br><span class="line">x + y = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">fmin</span>(x, y) = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå‡ ä¸ªä¾‹å­éƒ½æ˜¯å³å€¼ï¼Œå³å€¼ä¹Ÿæ˜¯ä¸€ä¸ªè¡¨è¾¾æ•°æ®çš„è¡¨è¾¾å¼ï¼Œå¦‚å­—é¢å¸¸é‡ã€è¡¨è¾¾å¼è¿”å›å€¼ï¼Œå‡½æ•°è¿”å›å€¼ï¼ˆè¿™ä¸ªä¸èƒ½æ˜¯å·¦å€¼å¼•ç”¨è¿”å›ï¼‰ç­‰ç­‰ï¼Œ<strong>å³å€¼å¯ä»¥å‡ºç°åœ¨èµ‹å€¼ç¬¦å·å³è¾¹ï¼Œä½†æ˜¯ä¸èƒ½å‡ºç°åœ¨èµ‹å€¼ç¬¦å·çš„å·¦è¾¹ï¼Œå³å€¼ä¸èƒ½å–åœ°å€</strong>ã€‚</p><blockquote><p>å³å€¼å¼•ç”¨å°±æ˜¯å¯¹å³å€¼çš„å¼•ç”¨ï¼Œç»™å³å€¼å–åˆ«å</p></blockquote><h2 id="å·¦å€¼å³å€¼">å·¦å€¼å³å€¼</h2><blockquote><p>å·¦å€¼å¼•ç”¨å¯ä»¥å¼•ç”¨å³å€¼å—ï¼Ÿå³å€¼å¼•ç”¨å¯ä»¥å¼•ç”¨å³å€¼å—ï¼Ÿ</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœ‰æ¡ä»¶çš„æ”¯æŒ</span></span><br><span class="line"><span class="comment">// å·¦å€¼å¼•ç”¨å¯ä»¥å¼•ç”¨å³å€¼å—ï¼Ÿ constçš„å·¦å€¼å¼•ç”¨å¯ä»¥</span></span><br><span class="line"><span class="comment">//double&amp; r1 = x + y;</span></span><br><span class="line"><span class="type">const</span> <span class="type">double</span>&amp; r1 = x + y;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å³å€¼å¼•ç”¨å¯ä»¥å¼•ç”¨å·¦å€¼å—ï¼Ÿå¯ä»¥å¼•ç”¨moveä»¥åçš„å·¦å€¼</span></span><br><span class="line"><span class="comment">//int&amp;&amp; rr5 = b;</span></span><br><span class="line"><span class="type">int</span>&amp;&amp; rr5 = <span class="built_in">move</span>(b);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ³¨æ„ï¼š</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212281629905.png" alt=""></p><p>11æ˜¯å­—é¢å¸¸é‡ï¼ŒFuncå‡½æ•°å‚æ•°åˆ—è¡¨æ˜¯ä¸ªå·¦å€¼å¼•ç”¨ï¼Œæ‰€ä»¥ä¼šæŠ¥é”™ï¼Œä¸¤ç§ä¿®æ”¹æ–¹æ³•ï¼š</p><ul><li>Func(const T&amp; x)</li><li>Func(T&amp;&amp; x)</li></ul><p>ç¬¬ä¸€ç§æ–¹æ³•ï¼š<strong>constçš„å·¦å€¼å¼•ç”¨å¯ä»¥æ¥æ”¶å³å€¼</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// xæ—¢èƒ½æ¥æ”¶å·¦å€¼ï¼Œä¹Ÿèƒ½æ¥æ”¶å³å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Func</span><span class="params">(<span class="type">const</span> T&amp; x)</span></span></span><br><span class="line"><span class="function"></span>&#123;&#125;</span><br></pre></td></tr></table></figure><h2 id="å·¦å³å€¼æ€»ç»“">å·¦å³å€¼æ€»ç»“</h2><h3 id="å·¦å€¼å¼•ç”¨æ€»ç»“">å·¦å€¼å¼•ç”¨æ€»ç»“</h3><ol><li>å·¦å€¼å¼•ç”¨åªèƒ½å¼•ç”¨å·¦å€¼ã€‚</li><li>ä½†æ˜¯constå·¦å€¼å¼•ç”¨æ—¢å¯å¼•ç”¨å·¦å€¼ï¼Œä¹Ÿå¯å¼•ç”¨å³å€¼ã€‚</li></ol><h3 id="å³å€¼å¼•ç”¨æ€»ç»“">å³å€¼å¼•ç”¨æ€»ç»“</h3><ol><li>å³å€¼å¼•ç”¨åªèƒ½å¼•ç”¨å³å€¼ï¼Œä¸èƒ½å¼•ç”¨å·¦å€¼</li><li>å³å€¼å¼•ç”¨å¯ä»¥å¼•ç”¨moveä¹‹åçš„å·¦å€¼</li></ol><h3 id="æ³¨æ„">æ³¨æ„</h3><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212301753811.png" alt=""></p><p>rr1å’Œrr2å¯ä»¥å–åœ°å€äº†ï¼Œå®ƒä»¬æ˜¯å·¦å€¼äº†ã€‚</p><h2 id="å·¦å€¼çš„ä¸è¶³">å·¦å€¼çš„ä¸è¶³</h2><blockquote><p>å¼•ç”¨çš„ä»·å€¼ï¼šå‡å°‘æ‹·è´</p></blockquote><p>å·¦å€¼å¼•ç”¨è§£å†³å“ªäº›é—®é¢˜ï¼Ÿ</p><ol><li>åšå‚æ•°ã€‚aã€å‡å°‘æ‹·è´ï¼Œæé«˜æ•ˆç‡  bã€åšè¾“å‡ºå‹å‚æ•°</li><li>åšè¿”å›å€¼ã€‚ aã€å‡å°‘æ‹·è´ï¼Œæé«˜æ•ˆç‡  bã€å¼•ç”¨è¿”å›ï¼Œå¯ä»¥ä¿®æ”¹è¿”å›å¯¹è±¡ï¼ˆæ¯”å¦‚ï¼šoperator[]ï¼‰</li></ol><p>ä½†æ˜¯ï¼ŒC++98çš„å·¦å€¼å¼•ç”¨é¢å‘ä¸‹è¾¹çš„åœºæ™¯å¾ˆéš¾è¿›è¡Œå¤„ç†ï¼š</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212301937870.png" alt=""></p><p>å³è¾¹çš„å†™æ³•è™½ç„¶è§£å†³äº†é—®é¢˜ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯å¤ªç¬¦åˆä½¿ç”¨ä¹ æƒ¯</p><h3 id="å…·ä½“ä¾‹å­">å…·ä½“ä¾‹å­</h3><p>ä¸åŠ ç§»åŠ¨æ„é€ çš„string</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212302010806.png" alt=""></p><p>åŠ ç§»åŠ¨æ„é€ çš„stringç±»</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212302045284.png" alt=""></p><p>ä¸åŠ ç§»åŠ¨æ„é€ ç§»åŠ¨èµ‹å€¼çš„string</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212302216855.png" alt=""></p><p>åŠ ç§»åŠ¨æ„é€ ç§»åŠ¨èµ‹å€¼çš„stringç±»</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212302216109.png" alt=""></p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>ç§»åŠ¨æ„é€ å’Œç§»åŠ¨èµ‹å€¼è§£å†³äº†ä¼ å€¼è¿”å›è¿™äº›ç±»å‹å¯¹è±¡çš„é—®é¢˜ï¼ŒSTLçš„å„ä¸ªå®¹å™¨åœ¨C++11å¢åŠ ç§»åŠ¨æ„é€ å’Œç§»åŠ¨èµ‹å€¼ã€‚ç§»åŠ¨æ„é€ æœ¬è´¨æ˜¯å°†å‚æ•°å³å€¼çš„èµ„æºçªƒå–è¿‡æ¥ï¼Œå ä½å·²æœ‰ï¼Œé‚£ä¹ˆå°±ä¸ç”¨åšæ·±æ‹·è´äº†ï¼Œæ‰€ä»¥å®ƒå«åšç§»åŠ¨æ„é€ ï¼Œå°±æ˜¯çªƒå–åˆ«äººçš„èµ„æºæ¥æ„é€ è‡ªå·±ã€‚</p><h1>å®Œç¾è½¬å‘</h1><h2 id="æ¨¡æ¿ä¸­-ä¸‡èƒ½å¼•ç”¨">æ¨¡æ¿ä¸­&amp;&amp;ä¸‡èƒ½å¼•ç”¨</h2><blockquote><p>åœ¨æ¨¡æ¿ä¸­ï¼Œ&amp;&amp;ä¸ä»£è¡¨å³å€¼å¼•ç”¨ï¼Œè€Œæ˜¯ä¸‡èƒ½å¼•ç”¨ï¼Œå…¶æ—¢èƒ½æ¥æ”¶å·¦å€¼åˆèƒ½æ¥æ”¶å³å€¼ï¼Œä½†æ˜¯å¼•ç”¨ç±»å‹çš„å”¯ä¸€ä½œç”¨å°±æ˜¯é™åˆ¶äº†æ¥æ”¶çš„ç±»å‹ï¼Œåç»­ä½¿ç”¨ä¸­éƒ½é€€åŒ–æˆäº†å·¦å€¼ã€‚</p></blockquote><p>å…ˆçœ‹ä¸ªä¾‹å­ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Fun</span><span class="params">(<span class="type">int</span>&amp; x)</span> </span>&#123; cout &lt;&lt; <span class="string">&quot;å·¦å€¼å¼•ç”¨&quot;</span> &lt;&lt; endl; &#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Fun</span><span class="params">(<span class="type">const</span> <span class="type">int</span>&amp; x)</span> </span>&#123; cout &lt;&lt; <span class="string">&quot;const å·¦å€¼å¼•ç”¨&quot;</span> &lt;&lt; endl; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Fun</span><span class="params">(<span class="type">int</span>&amp;&amp; x)</span> </span>&#123; cout &lt;&lt; <span class="string">&quot;å³å€¼å¼•ç”¨&quot;</span> &lt;&lt; endl; &#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Fun</span><span class="params">(<span class="type">const</span> <span class="type">int</span>&amp;&amp; x)</span> </span>&#123; cout &lt;&lt; <span class="string">&quot;const å³å€¼å¼•ç”¨&quot;</span> &lt;&lt; endl; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PerfectForward</span><span class="params">(T&amp;&amp; t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">Fun</span>(t);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">PerfectForward</span>(<span class="number">10</span>);           <span class="comment">// å³å€¼</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a;</span><br><span class="line"><span class="built_in">PerfectForward</span>(a);            <span class="comment">// å·¦å€¼</span></span><br><span class="line"><span class="built_in">PerfectForward</span>(std::<span class="built_in">move</span>(a)); <span class="comment">// å³å€¼</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> b = <span class="number">8</span>;</span><br><span class="line"><span class="built_in">PerfectForward</span>(b);      <span class="comment">// const å·¦å€¼</span></span><br><span class="line"><span class="built_in">PerfectForward</span>(std::<span class="built_in">move</span>(b)); <span class="comment">// const å³å€¼</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æˆ‘ä»¬çš„é¢„æœŸä¸­ï¼ŒFuncå‡½æ•°åº”è¯¥æ˜¯ï¼Œå·¦å€¼æ‰“å°å·¦å€¼ï¼Œå³å€¼æ‰“å°å³å€¼ï¼Œä½†æ˜¯è¿è¡Œç»“æœç¡®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212302231604.png" alt=""></p><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œæ‰€æœ‰çš„éƒ½æˆäº†å·¦å€¼å¼•ç”¨ï¼Œæ ¹æœ¬æ²¡æœ‰è°ƒç”¨å³å€¼å¼•ç”¨çš„ç‰ˆæœ¬ï¼Œè¿™ä¸ªå°±æ˜¯<strong>å¼•ç”¨æŠ˜å </strong>çš„é—®é¢˜ã€‚</p><h2 id="std-forward">std::forward</h2><blockquote><p>æˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿåœ¨ä¼ é€’è¿‡ç¨‹ä¸­ä¿æŒå®ƒçš„å·¦å€¼æˆ–è€…å³å€¼çš„å±æ€§, å°±éœ€è¦ç”¨å®Œç¾è½¬å‘ã€‚</p></blockquote><p>é’ˆå¯¹ä¸Šè¾¹çš„ä»£ç åªéœ€è¦å°†ï¼ŒTç±»å‹çš„å‚æ•°tå®Œç¾è½¬å‘ä¸€ä¸‹å°±å¯ä»¥äº†ï¼Œ<strong>std::forward å®Œç¾è½¬å‘åœ¨ä¼ å‚çš„è¿‡ç¨‹ä¸­ä¿ç•™å¯¹è±¡åŸç”Ÿç±»å‹å±æ€§</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PerfectForward</span><span class="params">(T&amp;&amp; t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">Fun</span>(std::forward&lt;T&gt;(t));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212302243796.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°å®Œç¾è½¬å‘çš„æ•ˆæœï¼Œå·¦å€¼è°ƒç”¨å·¦å€¼ï¼Œå³å€¼è°ƒç”¨å³å€¼ã€‚</p><h2 id="å®é™…åº”ç”¨ä¾‹å­">å®é™…åº”ç”¨ä¾‹å­</h2><p>åœ¨æˆ‘ä»¬æ¨¡æ‹Ÿå®ç°çš„listä¸­æµ‹è¯•ï¼Œç§»åŠ¨æ„é€ </p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212302252471.png" alt=""></p><p>listæ’å…¥&quot;world&quot;ï¼ˆå³å€¼ï¼‰ï¼Œä»£ç è°ƒç”¨å±‚çº§å¦‚ä¸‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">push_back</span><span class="params">(T&amp;&amp; x)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">insert</span>(<span class="built_in">end</span>(), std::forward&lt;T&gt;(x)); <span class="comment">//å®Œç¾è½¬å‘ä¿ç•™å³å€¼å±æ€§</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨insertï¼Œè¿™é‡Œä¹Ÿæ˜¯ä¸‡èƒ½å¼•ç”¨æ¥æ”¶</span></span><br><span class="line"></span><br><span class="line"><span class="function">iterator <span class="title">insert</span><span class="params">(iterator pos, T&amp;&amp; x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Node* cur = pos._node;</span><br><span class="line">Node* prev = cur-&gt;_prev;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿™é‡Œè°ƒç”¨èŠ‚ç‚¹çš„æ„é€ å‡½æ•°ï¼Œä¹ŸåŒæ ·è¦å®Œç¾è½¬å‘ï¼Œä¿ç•™å³å€¼å±æ€§</span></span><br><span class="line">Node* newnode = <span class="keyword">new</span> <span class="built_in">Node</span>(std::forward&lt;T&gt;(x)); </span><br><span class="line"></span><br><span class="line"><span class="comment">// prev newnode cur</span></span><br><span class="line">prev-&gt;_next = newnode;</span><br><span class="line">newnode-&gt;_prev = prev;</span><br><span class="line">newnode-&gt;_next = cur;</span><br><span class="line">cur-&gt;_prev = newnode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">iterator</span>(newnode);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// insertè°ƒç”¨äº†é“¾è¡¨èŠ‚ç‚¹çš„æ„é€ ï¼ŒåŒæ ·ç”¨ä¸‡èƒ½å¼•ç”¨æ¥æ”¶</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">list_node</span>(T&amp;&amp; x)</span><br><span class="line">:_data(std::forward&lt;T&gt;(x))  <span class="comment">//å®Œç¾è½¬å‘</span></span><br><span class="line">, _next(<span class="literal">nullptr</span>)</span><br><span class="line">, _prev(<span class="literal">nullptr</span>)</span><br><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure><p>æœ€åçš„èŠ‚ç‚¹çš„æ„é€ ï¼Œä¼šè°ƒç”¨stringç±»çš„æ„é€ ï¼Œæ‰€ä»¥é‚£é‡ŒåŒæ ·éœ€è¦å®Œç¾è½¬å‘ï¼Œè°ƒç”¨äº†stringç±»çš„å³å€¼æ„é€ </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span>(string&amp;&amp; s)</span><br><span class="line">:_str(<span class="literal">nullptr</span>)</span><br><span class="line">, _size(<span class="number">0</span>)</span><br><span class="line">, _capacity(<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;string(string&amp;&amp; s) -- èµ„æºè½¬ç§»&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="built_in">swap</span>(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹è¯­è¨€ </category>
          
          <category> CPP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++11 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++11åŸºç¡€</title>
      <link href="/posts/1163824125/"/>
      <url>/posts/1163824125/</url>
      
        <content type="html"><![CDATA[<h1>åˆ—è¡¨åˆå§‹åŒ–</h1><h2 id="åˆå§‹åŒ–">{} åˆå§‹åŒ–</h2><blockquote><p>åœ¨C++98ä¸­ï¼Œæ ‡å‡†å…è®¸ä½¿ç”¨èŠ±æ‹¬å·{}å¯¹æ•°ç»„æˆ–è€…ç»“æ„ä½“å…ƒç´ è¿›è¡Œç»Ÿä¸€çš„åˆ—è¡¨åˆå§‹å€¼è®¾å®šã€‚</p></blockquote><p>æ¯”å¦‚ä¸‹æ–¹ç¤ºä¾‹ï¼š</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212272140842.png" alt=""></p><blockquote><p>C++11æ‰©å¤§äº†ç”¨å¤§æ‹¬å·æ‹¬èµ·çš„åˆ—è¡¨(åˆå§‹åŒ–åˆ—è¡¨)çš„ä½¿ç”¨èŒƒå›´ï¼Œä½¿å…¶å¯ç”¨äºæ‰€æœ‰çš„å†…ç½®ç±»å‹å’Œç”¨æˆ·è‡ªå®šä¹‰çš„ç±»å‹ï¼Œä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨æ—¶ï¼Œå¯æ·»åŠ ç­‰å·(=)ï¼Œä¹Ÿå¯ä¸æ·»åŠ </p></blockquote><h3 id="å†…ç½®ç±»å‹">å†…ç½®ç±»å‹</h3><p>ä»¥ä¸‹ä¸‰ç§å†™æ³•ä¸€æ ·</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212272145021.png" alt=""></p><h3 id="è‡ªå®šä¹‰ç±»å‹">è‡ªå®šä¹‰ç±»å‹</h3><p>å¯¹äºè‡ªå®šä¹‰ç±»å‹åŒæ ·é€‚ç”¨</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Date</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">Date</span>(<span class="type">int</span> year, <span class="type">int</span> month, <span class="type">int</span> day)</span><br><span class="line">:_year(year)</span><br><span class="line">, _month(month)</span><br><span class="line">, _day(day)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Date(int year, int month, int day)&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="type">int</span> _year;</span><br><span class="line"><span class="type">int</span> _month;</span><br><span class="line"><span class="type">int</span> _day;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// éƒ½æ˜¯åœ¨è°ƒç”¨æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="function">Date <span class="title">d1</span><span class="params">(<span class="number">2022</span>, <span class="number">11</span>, <span class="number">22</span>)</span></span>;</span><br><span class="line"><span class="comment">// C++11 è¦èƒ½çœ‹æ‡‚ï¼Œä½†æ˜¯ä¸å»ºè®®ä½¿ç”¨</span></span><br><span class="line">Date d2 = &#123;<span class="number">2022</span>, <span class="number">11</span>, <span class="number">11</span>&#125;; <span class="comment">// -&gt;è°ƒç”¨æ„é€ å‡½æ•°</span></span><br><span class="line">Date d3&#123; <span class="number">2022</span>, <span class="number">11</span>, <span class="number">11</span> &#125;;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="STLå®¹å™¨">STLå®¹å™¨</h3><p>stlå®¹å™¨åŒæ ·æ”¯æŒå¦‚ä¸Šæ“ä½œï¼Œå¹¶ä¸”æ›´åŠ æ–¹ä¾¿</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// è°ƒç”¨æ”¯æŒlist (initializer_list&lt;value_type&gt; ilï¼‰ç±»ä¼¼è¿™æ ·çš„æ„é€ å‡½æ•°</span></span><br><span class="line">vector&lt;<span class="type">int</span>&gt; v1 = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span> &#125;;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; v2 &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span> &#125;;</span><br><span class="line"></span><br><span class="line">list&lt;<span class="type">int</span>&gt; lt1 = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span> &#125;;</span><br><span class="line">list&lt;<span class="type">int</span>&gt; lt2&#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span> &#125;;</span><br><span class="line"></span><br><span class="line">vector&lt;Date&gt; v3 = &#123;d1, d2, d3&#125;;</span><br><span class="line">vector&lt;Date&gt; v4 = &#123; &#123; <span class="number">2022</span>, <span class="number">1</span>, <span class="number">1</span> &#125;, &#123;<span class="number">2022</span>, <span class="number">11</span>, <span class="number">11</span>&#125; &#125;;</span><br><span class="line"></span><br><span class="line">string s1 = <span class="string">&quot;11111&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„é€ </span></span><br><span class="line">map&lt;string, string&gt; dict = &#123; &#123; <span class="string">&quot;sort&quot;</span>, <span class="string">&quot;æ’åº&quot;</span> &#125;, &#123; <span class="string">&quot;insert&quot;</span>, <span class="string">&quot;æ’å…¥&quot;</span> &#125; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// èµ‹å€¼é‡è½½ --- kvilè¦å…ˆæ˜ç¡®ï¼Œæ³¨æ„é‚£ä¸ªconst</span></span><br><span class="line">initializer_list&lt;pair&lt;<span class="type">const</span> string, string&gt;&gt; kvil = &#123; &#123; <span class="string">&quot;left&quot;</span>, <span class="string">&quot;å·¦è¾¹&quot;</span> &#125;, &#123; <span class="string">&quot;left&quot;</span>, <span class="string">&quot;å·¦è¾¹&quot;</span> &#125; &#125;;</span><br><span class="line">dict = kvil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="std-initializer-list">std::initializer_list</h2><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212272134335.png" alt=""></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">auto</span> li = &#123; <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span> &#125;;</span><br><span class="line">cout &lt;&lt; <span class="built_in">typeid</span>(li).<span class="built_in">name</span>() &lt;&lt; endl;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212272138565.png" alt=""></p><p>å®¹å™¨åº•å±‚å®ç°ï¼Œå¦‚vectorå¢åŠ initializer_listå‚æ•°çš„æ„é€ ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="built_in">vector</span>(initializer_list&lt;T&gt; li)</span><br><span class="line">: _start(<span class="literal">nullptr</span>), _finish(<span class="literal">nullptr</span>), _end_of_storage(<span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">reserve</span>(li.<span class="built_in">size</span>())</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span>&amp; e : li)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">push_back</span>(e);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“">æ€»ç»“</h2><p>C++11ä»¥åï¼Œä¸€åˆ‡å¯¹è±¡éƒ½å¯ä»¥ä½¿ç”¨åˆ—è¡¨åˆå§‹åŒ–ï¼Œä½†æ˜¯å»ºè®®æ™®é€šå¯¹è±¡è¿˜æ˜¯ç”¨ä»¥å‰çš„æ–¹å¼åˆå§‹åŒ–ï¼Œå®¹å™¨å¦‚æœæœ‰éœ€æ±‚å¯ä»¥ç”¨åˆ—è¡¨åˆå§‹åŒ–</p><h1>å˜é‡ç±»å‹æ¨å¯¼</h1><h2 id="decltype">decltype</h2><blockquote><p>å…³é”®å­—decltypeå°†å˜é‡çš„ç±»å‹å£°æ˜ä¸ºè¡¨è¾¾å¼æŒ‡å®šçš„ç±»å‹</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212272258871.png" alt=""></p><h1>æ–°å¢åŠ å®¹å™¨</h1><h2 id="array">array</h2><ul><li>cè¯­è¨€æ•°ç»„è¶Šç•Œè¯»åŸºæœ¬æ£€æŸ¥ä¸å‡ºæ¥ï¼Œè¶Šç•Œå†™æ˜¯æŠ½æŸ¥</li><li>arrayå¯ä»¥æ£€æŸ¥å‡ºæ¥è¶Šç•Œ</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">const</span> <span class="type">size_t</span> N = <span class="number">100</span>;</span><br><span class="line"><span class="type">int</span> a1[N];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Cè¯­è¨€æ•°ç»„è¶Šç•Œæ£€æŸ¥ï¼Œè¶Šç•Œè¯»åŸºæœ¬æ£€æŸ¥ä¸å‡ºæ¥ï¼Œè¶Šç•Œå†™æ˜¯æŠ½æŸ¥</span></span><br><span class="line">a1[N];</span><br><span class="line"><span class="comment">//a1[N] = 1;</span></span><br><span class="line">a1[N + <span class="number">5</span>] = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¶Šç•Œè¯»å†™éƒ½å¯ä»¥è¢«æ£€æŸ¥å‡ºæ¥</span></span><br><span class="line"><span class="comment">// å®é™…æƒ…å†µï¼šarrayç”¨å¾—å¾ˆå°‘ï¼Œä¸€æ–¹é¢å¤§å®¶ç”¨cæ•°ç»„ç”¨æƒ¯äº†</span></span><br><span class="line"><span class="comment">// ç”¨arrayä¸å¦‚ç”¨vector + resizeå»æ›¿ä»£cæ•°ç»„</span></span><br><span class="line"></span><br><span class="line">array&lt;<span class="type">int</span>, N&gt; a2;</span><br><span class="line">a2[N];</span><br><span class="line">a2[N] = <span class="number">1</span>;</span><br><span class="line">a2[N + <span class="number">5</span>] = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="forward-list">forward_list</h2><p>å•é“¾è¡¨</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹è¯­è¨€ </category>
          
          <category> CPP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++11 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¢ç¨‹å¼ç”µåŠ¨æ±½è½¦CD/CSæ§åˆ¶ç­–ç•¥</title>
      <link href="/posts/552158714/"/>
      <url>/posts/552158714/</url>
      
        <content type="html"><![CDATA[<p><a name="vrhgN"></a></p><h2 id="ä¸€ã€ç®€ä»‹">ä¸€ã€ç®€ä»‹</h2><blockquote><p>CD/CSç­–ç•¥æ˜¯æœ€ç®€å•çš„EMSæ§åˆ¶ç­–ç•¥ï¼Œè¿™æ˜¯åŸºäºè§„åˆ™çš„ï¼Œæœ€ç®€å•çš„æ§åˆ¶ç­–ç•¥ï¼Œå®¹æ˜“åœ¨å®è½¦ä¸Šå®ç°ï¼Œé€šå¸¸åœ¨ç§‘ç ”ä¸­ç”¨äºä¸å…¶ä»–ç­–ç•¥è¿›è¡Œæ¯”è¾ƒæ¥ä½“ç°å…¶æ§åˆ¶ç­–ç•¥çš„ä¼˜åŠ¿ã€‚</p></blockquote><p><a name="ZfCCK"></a></p><h2 id="äºŒã€ä¼˜ç¼ºç‚¹">äºŒã€ä¼˜ç¼ºç‚¹</h2><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li><strong>å®ç°ç®€å•</strong></li><li><strong>å®æ—¶</strong></li><li><strong>å‘åŠ¨æœºå¯å·¥ä½œåœ¨é«˜æ•ˆåŒº</strong></li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li><strong>é€‚åº”åŠ›å·®</strong></li><li><strong>ç”µæ± é¢‘ç¹å†²æ”¾ç”µ</strong><br><a name="YXWMg"></a></li></ul><h2 id="ä¸‰ã€æµç¨‹å›¾">ä¸‰ã€æµç¨‹å›¾</h2><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212291635560.jpg" alt=""></p><p><a name="dQBv3"></a></p><h2 id="å››ã€åŸç†">å››ã€åŸç†</h2><p><a name="rhqIk"></a></p><h3 id="1ã€CDæ¨¡å¼">1ã€CDæ¨¡å¼</h3><p>éœ€æ±‚åŠŸç‡åªç”±ç”µæ± æä¾›ï¼Œå…ˆæ¨å¯¼çŠ¶æ€å˜é‡SOCï¼Œ</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>S</mi><mover accent="true"><mi>O</mi><mo>Ë™</mo></mover><mi>C</mi><mo>=</mo><mfrac><mrow><mi>d</mi><mi>S</mi><mi>O</mi><mi>C</mi></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mfrac><mrow><mo>âˆ’</mo><msub><mi>I</mi><mrow><mi>e</mi><mi>s</mi><mi>s</mi></mrow></msub></mrow><msub><mi>C</mi><mrow><mi>e</mi><mi>s</mi><mi>s</mi></mrow></msub></mfrac><mo>=</mo><mfrac><mrow><msqrt><mrow><msubsup><mi>U</mi><mrow><mi>O</mi><mi>C</mi><mi>V</mi></mrow><mn>2</mn></msubsup><mo>âˆ’</mo><mn>4</mn><msub><mi>P</mi><mrow><mi>e</mi><mi>s</mi><mi>s</mi></mrow></msub><msub><mi>R</mi><mrow><mi>e</mi><mi>s</mi><mi>s</mi></mrow></msub></mrow></msqrt><mo>âˆ’</mo><msub><mi>U</mi><mrow><mi>O</mi><mi>C</mi><mi>V</mi></mrow></msub></mrow><mrow><mn>2</mn><msub><mi>R</mi><mrow><mi>e</mi><mi>s</mi><mi>s</mi></mrow></msub><msub><mi>C</mi><mrow><mi>e</mi><mi>s</mi><mi>s</mi></mrow></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex"> S\dot OC=\frac{dSOC}{dt}=\frac{-I_{ess}}{C_{ess}}=\frac{\sqrt{U^2_{OCV}-4P_{ess}R_{ess}}-U_{OCV}}{2R_{ess}C_{ess}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9202em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9202em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.0556em;"><span class="mord">Ë™</span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.07153em;">SOC</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1963em;vertical-align:-0.836em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ess</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">âˆ’</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ess</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.466em;vertical-align:-0.836em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.63em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ess</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ess</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.6938em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9362em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959em;"><span style="top:-2.4065em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">OC</span><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span></span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2935em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">4</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ess</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ess</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.8962em;"><span class="pstrut" style="height:3.2em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.28em' viewBox='0 0 400000 1296' preserveAspectRatio='xMinYMin slice'><path d='M263,681c0.7,0,18,39.7,52,119c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120c340,-704.7,510.7,-1060.3,512,-1067l0 -0c4.7,-7.3,11,-11,19,-11H40000v40H1012.3s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60zM1001 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3038em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">OC</span><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>S</mi><mi>O</mi><msub><mi>C</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub><mo>â‰¤</mo><mi>S</mi><mi>O</mi><mi>C</mi><msub><mo>â‰¤</mo><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">SOC_{min} \leq SOC\leq_{max}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">SO</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">min</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">SOC</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel">â‰¤</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ma</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><blockquote><p>æ¨å¯¼SOCçš„å¯¼æ•°ï¼ˆå®‰æ—¶è®¡é‡æ³•ï¼‰</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>O</mi><msub><mi>C</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mi>S</mi><mi>O</mi><msub><mi>C</mi><mi>k</mi></msub><mo>âˆ’</mo><msubsup><mo>âˆ«</mo><msub><mi>t</mi><mi>k</mi></msub><msub><mi>t</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub></msubsup><mfrac><mrow><mi>Î·</mi><mi>I</mi><mi mathvariant="normal">d</mi><mi>t</mi></mrow><msub><mi>C</mi><mi>e</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">SOC_{k+1}=SOC_k-\int_{t_k}^{t_{k+1}}{\frac{\eta I{\rm d}t}{C_e}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">SO</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">SO</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.4501em;vertical-align:-0.4617em;"></span><span class="mop"><span class="mop op-symbol small-op" style="margin-right:0.19445em;position:relative;top:-0.0006em;">âˆ«</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9885em;"><span style="top:-2.3442em;margin-left:-0.1945em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.2579em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2107em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4617em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:-0.0715em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">e</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">Î·</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">d</span></span></span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4451em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>åè¾¹  <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>U</mi><mrow><mi>O</mi><mi>C</mi><mi>V</mi></mrow></msub><msub><mi>I</mi><mrow><mi>e</mi><mi>s</mi><mi>s</mi></mrow></msub><mo>âˆ’</mo><msubsup><mi>I</mi><mrow><mi>e</mi><mi>s</mi><mi>s</mi></mrow><mn>2</mn></msubsup><msub><mi>R</mi><mrow><mi>e</mi><mi>s</mi><mi>s</mi></mrow></msub><mo>=</mo><msub><mi>P</mi><mrow><mi>e</mi><mi>s</mi><mi>s</mi></mrow></msub></mrow><annotation encoding="application/x-tex">U_{OCV}I_{ess}-I_{ess}^2R_{ess}=P_{ess}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">OC</span><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ess</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0611em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.453em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ess</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ess</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ess</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><br>æ±‚æ ¹å…¬å¼</p></blockquote><p>P_essä¸ºåŠ¨åŠ›ç”µæ± åŠŸç‡ï¼ŒI_essä¸ºåŠ¨åŠ›ç”µæ± ç”µæµï¼ŒC_essä¸ºåŠ¨åŠ›ç”µæ± é¢å¤–å®¹é‡ï¼ŒR_essä¸ºåŠ¨åŠ›ç”µæ± å†…é˜»ï¼ŒU_ocvä¸ºåŠ¨åŠ›ç”µæ± å¼€è·¯ç”µå‹<br><a name="yZYju"></a></p><h3 id="2ã€CSæ¨¡å¼">2ã€CSæ¨¡å¼</h3><p>CSæ¨¡å¼æ˜¯ç”µé‡ä¿æŒï¼Œæ¨¡å¼ï¼Œå¢ç¨‹å™¨æ§åˆ¶é‡‡ç”¨å®šç‚¹æ§åˆ¶ç­–ç•¥ï¼Œå‘åŠ¨æœºåœ¨å›ºå®šå·¥ä½œç‚¹å·¥ä½œã€‚</p><ul><li>éœ€æ±‚åŠŸç‡ç”±å¢ç¨‹å™¨æä¾›ï¼Œå¤šä½™åŠŸç‡ç»™ç”µæ± å……ç”µ<br><a name="x2Wvn"></a></li></ul><h3 id="3ã€åˆ¶åŠ¨èƒ½é‡å›æ”¶">3ã€åˆ¶åŠ¨èƒ½é‡å›æ”¶</h3><ul><li>20%å›æ”¶<br><a name="C3CLe"></a></li></ul><h2 id="äº”ã€ä»£ç å®ç°">äº”ã€ä»£ç å®ç°</h2><p><a name="E67Lu"></a></p><h3 id="1ã€æµç¨‹é€»è¾‘">1ã€æµç¨‹é€»è¾‘</h3><ul><li>å¯¼å…¥å·¥å†µæ•°æ®</li><li>è½¦è¾†å‚æ•°åˆå§‹åŒ–</li><li>è®¡ç®—å·¥å†µåŠŸç‡éœ€æ±‚</li><li>å·¥å†µå¾ªç¯<br><a name="lqg0c"></a></li></ul><h3 id="2ã€æç¤º">2ã€æç¤º</h3><ul><li>æœªè€ƒè™‘æ•ˆç‡é—®é¢˜</li><li>åˆ¶åŠ¨èƒ½é‡å›æ”¶20%</li><li>CDæ¨¡å¼ç²¾åº¦å¯ä»¥ï¼Œå¯ä¸powertrainçš„EVä¸€ä¸ªNEDCæ¯”è¾ƒã€‚<br><a name="tsf3A"></a></li></ul><h3 id="3ã€å®ç°ç¯å¢ƒ">3ã€å®ç°ç¯å¢ƒ</h3><p>1ï¸âƒ£** matlab **</p><ul><li>æ— è„‘å»ºè®®2021b+ï¼Œå› ä¸ºæœ‰ä»£ç æç¤ºå’Œè¡¥å…¨ğŸ˜</li></ul><p>2ï¸âƒ£** python**</p><ul><li><strong>3.7</strong></li><li><strong>numpy</strong></li><li><strong>math</strong></li><li><strong>scipy</strong></li><li><strong>matplotlib</strong></li></ul><br /><a name="JLaWD"></a>## äº”ã€ä»¿çœŸç»“æœ<a name="Ze8Ya"></a>### 1ã€matlab<p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212291636129.png" alt=""></p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212291636841.png" alt=""></p><h3 id="2ã€python">2ã€python</h3><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212291636438.png" alt=""></p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212291636851.png" alt=""></p><p><a name="pYpqN"></a></p><h2 id="å…­ã€githubé“¾æ¥">å…­ã€githubé“¾æ¥</h2><p><a href="https://github.com/suntong-1221/EMS_OS.git">https://github.com/suntong-1221/EMS_OS.git</a></p>]]></content>
      
      
      <categories>
          
          <category> æ–°èƒ½æºæ±½è½¦ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> EMS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å“ˆå¸Œåº”ç”¨</title>
      <link href="/posts/1804708753/"/>
      <url>/posts/1804708753/</url>
      
        <content type="html"><![CDATA[<h1>ä½å›¾</h1><blockquote><p>ç»™40äº¿ä¸ªä¸é‡å¤çš„æ— ç¬¦å·æ•´æ•°ï¼Œæ²¡æ’è¿‡åºã€‚ç»™ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°ï¼Œå¦‚ä½•å¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦åœ¨è¿™40äº¿ä¸ªæ•°ä¸­ï¼Ÿ</p></blockquote><ol><li>éå†ï¼Œæ—¶é—´å¤æ‚åº¦O(N)</li><li>æ’åº(O(NlogN))ï¼Œåˆ©ç”¨äºŒåˆ†æŸ¥æ‰¾: logN</li><li>ä½å›¾è§£å†³</li></ol><h2 id="ä½å›¾æ¦‚å¿µ">ä½å›¾æ¦‚å¿µ</h2><p>æ‰€è°“ä½å›¾ï¼Œå°±æ˜¯ç”¨æ¯ä¸€ä¸ªæ¯”ç‰¹ä½æ¥å­˜æ”¾æŸç§çŠ¶æ€ï¼Œé€‚ç”¨äºæµ·é‡æ•°æ®ï¼Œæ•°æ®æ— é‡å¤çš„åœºæ™¯ã€‚é€šå¸¸æ˜¯ç”¨æ¥åˆ¤æ–­æŸä¸ªæ•°æ®å­˜ä¸å­˜åœ¨çš„</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212262144541.png" alt=""></p><h2 id="ä½å›¾å®ç°">ä½å›¾å®ç°</h2><p>è¿™é‡Œåº•å±‚ç”¨äº†vectorï¼Œå­˜charç±»å‹ï¼Œä¸€ä¸ªcharå 8ä¸ªæ¯”ç‰¹ä½ã€‚ç„¶åæä¾›setæ¥å£ï¼Œè¯´æ˜å¦‚ä¸‹ï¼š</p><ul><li>å…ˆæ‰¾è¦æ˜ å°„çš„æ•°æ®åœ¨ç¬¬å‡ ä¸ªcharï¼š<strong>x/8</strong></li><li>å†çœ‹æ˜¯åœ¨charçš„ç¬¬å‡ ä¸ªä½ï¼š<strong>x%8</strong></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="type">size_t</span> N&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">bitset</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">bitset</span>()</span><br><span class="line">&#123;</span><br><span class="line">_bits.<span class="built_in">resize</span>(N / <span class="number">8</span> + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">set</span><span class="params">(<span class="type">size_t</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">size_t</span> i = x / <span class="number">8</span>; <span class="comment">//æ‰¾ç¬¬å‡ ä¸ªchar</span></span><br><span class="line"><span class="type">size_t</span> j = x % <span class="number">8</span>; <span class="comment">//ç¬¬å‡ ä¸ªcharçš„ç¬¬å‡ ä¸ªä½</span></span><br><span class="line">_bits[i] |= (<span class="number">1</span> &lt;&lt; j);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">reset</span><span class="params">(<span class="type">size_t</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">size_t</span> i = x / <span class="number">8</span>;</span><br><span class="line"><span class="type">size_t</span> j = x % <span class="number">8</span>;</span><br><span class="line">_bits[i] &amp;= ~(<span class="number">1</span> &lt;&lt; j);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">test</span><span class="params">(<span class="type">size_t</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">size_t</span> i = x / <span class="number">8</span>;</span><br><span class="line"><span class="type">size_t</span> j = x % <span class="number">8</span>;</span><br><span class="line"><span class="keyword">return</span> _bits[i] &amp; (<span class="number">1</span> &lt;&lt; j);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">vector&lt;<span class="type">char</span>&gt; _bits;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="ä½å›¾åº”ç”¨">ä½å›¾åº”ç”¨</h2><ol><li>å¿«é€ŸæŸ¥æ‰¾æŸä¸ªæ•°æ®æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­</li><li>æ’åº + å»é‡</li><li>æ±‚ä¸¤ä¸ªé›†åˆçš„äº¤é›†ã€å¹¶é›†ç­‰</li><li>æ“ä½œç³»ç»Ÿä¸­ç£ç›˜å—æ ‡è®°</li></ol><h3 id="å‡ ä¸ªä¾‹å­ï¼š">å‡ ä¸ªä¾‹å­ï¼š</h3><blockquote><p>ç»™å®š100äº¿ä¸ªæ•´æ•°ï¼Œè®¾è®¡ç®—æ³•æ‰¾åˆ°åªå‡ºç°ä¸€æ¬¡çš„æ•´æ•°ï¼Ÿ</p></blockquote><p>å¯ä»¥ç”¨ä¸¤ä¸ªä½å›¾ï¼Œå»ºç«‹kvæ¨¡å‹ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><p>kvçš„ç»Ÿè®¡æ¬¡æ•°æœç´¢æ¨¡å‹</p><ul><li>0æ¬¡ï¼š00</li><li>1æ¬¡ï¼š01</li><li>2æ¬¡åŠä»¥ä¸Šï¼š10</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="type">size_t</span> N&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">twobitset</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">set</span><span class="params">(<span class="type">size_t</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">bool</span> inset1 = _bs1.<span class="built_in">test</span>(x);</span><br><span class="line"><span class="type">bool</span> inset2 = _bs2.<span class="built_in">test</span>(x);</span><br><span class="line"></span><br><span class="line"><span class="comment">//00</span></span><br><span class="line"><span class="keyword">if</span> (inset1 == <span class="literal">false</span> &amp;&amp; inset2 == <span class="literal">false</span>)</span><br><span class="line">&#123;</span><br><span class="line">_bs2.<span class="built_in">set</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (inset1 == <span class="literal">false</span> &amp;&amp; inset2 == <span class="literal">true</span>) <span class="comment">//01</span></span><br><span class="line">&#123;</span><br><span class="line">_bs1.<span class="built_in">set</span>(x);</span><br><span class="line">_bs2.<span class="built_in">reset</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (inset1 == <span class="literal">true</span> &amp;&amp; inset2 == <span class="literal">false</span>) <span class="comment">//10</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//11</span></span><br><span class="line">_bs1.<span class="built_in">set</span>(x);</span><br><span class="line">_bs2.<span class="built_in">set</span>(x);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print_once_num</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; N; ++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//01</span></span><br><span class="line"><span class="keyword">if</span> (_bs1.<span class="built_in">test</span>(i) == <span class="literal">false</span> &amp;&amp; _bs2.<span class="built_in">test</span>(i) == <span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; i &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">bitset&lt;N&gt;_bs1;</span><br><span class="line">bitset&lt;N&gt;_bs2;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>ç»™ä¸¤ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«æœ‰100äº¿ä¸ªæ•´æ•°ï¼Œæˆ‘ä»¬åªæœ‰1Gå†…å­˜ï¼Œå¦‚ä½•æ‰¾åˆ°ä¸¤ä¸ªæ–‡ä»¶çš„äº¤é›†ï¼Ÿ<br>ä¸¤ä¸ªä½å›¾</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1G=1024Mb</span><br><span class="line">1024MB=1024*1024KB</span><br><span class="line">1024*1024KB=1024*1024*1024Byte</span><br><span class="line">2^30ï¼Œ çº¦ç­‰äº10äº¿Byte</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆ100äº¿æ•´æ•°ï¼Œå°±æ˜¯400äº¿å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯40Gçš„ç©ºé—´ï¼Œä½†æ˜¯æ•´æ•°çš„èŒƒå›´å°±42äº¿å¤šï¼Œé‚£ä¹ˆå‡è®¾43äº¿ä¸ªæ•´æ•°ï¼Œä¹Ÿå°±éœ€è¦43äº¿ä¸ªæ¯”ç‰¹ä½ï¼Œä¹Ÿå°±æ˜¯43äº¿/8ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯5äº¿å¤šå­—èŠ‚ï¼Œå¤§æ¦‚åœ¨0.5Gå¤šï¼Œå¯ä»¥å…ˆä¾æ¬¡è¯»å–ç¬¬ä¸€ä¸ªæ–‡ä»¶ä¸­çš„æ‰€æœ‰æ•´æ•°ï¼Œå°†å…¶æ˜ å°„åˆ°ä¸€ä¸ªä½å›¾ã€‚å†è¯»å–å¦ä¸€ä¸ªæ–‡ä»¶ä¸­çš„æ‰€æœ‰æ•´æ•°ï¼Œåˆ¤æ–­åœ¨ä¸åœ¨ä½å›¾ä¸­ï¼Œåœ¨å°±æ˜¯äº¤é›†ï¼Œä¸åœ¨å°±ä¸æ˜¯äº¤é›†ã€‚</p><blockquote><p>ä½å›¾åº”ç”¨å˜å½¢ï¼šä¸€ä¸ªæ–‡ä»¶æœ‰100äº¿ä¸ªintï¼Œ1Gå†…å­˜ï¼Œè®¾è®¡ç®—æ³•æ‰¾åˆ°æ¬¡æ•°ä¸è¶…è¿‡ä¸¤æ¬¡çš„æ‰€ä»¥æ•´æ•°</p></blockquote><ul><li>0æ¬¡ï¼š00</li><li>1æ¬¡ï¼š01</li><li>2æ¬¡ï¼š10</li><li>3æ¬¡åŠä»¥ä¸Šï¼š11</li></ul><h2 id="ä½å›¾ç‰¹ç‚¹ï¼š">ä½å›¾ç‰¹ç‚¹ï¼š</h2><ul><li>å¿«ã€èŠ‚çœç©ºé—´ï¼Œç›´æ¥å®šå€æ³•ï¼Œä¸å­˜åœ¨å†²çª</li><li>ç›¸å¯¹å±€é™ï¼Œåªèƒ½æ˜ å°„æ•´å½¢</li></ul><h1>å¸ƒéš†è¿‡æ»¤å™¨</h1><h2 id="æ¦‚å¿µ">æ¦‚å¿µ</h2><blockquote><p>å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ç”±å¸ƒéš†ï¼ˆBurton Howard Bloomï¼‰åœ¨1970å¹´æå‡ºçš„ ä¸€ç§ç´§å‡‘å‹çš„ã€æ¯”è¾ƒå·§å¦™çš„æ¦‚ç‡å‹æ•°æ®ç»“æ„ï¼Œç‰¹ç‚¹æ˜¯é«˜æ•ˆåœ°æ’å…¥å’ŒæŸ¥è¯¢ï¼Œå¯ä»¥ç”¨æ¥å‘Šè¯‰ä½  â€œæŸæ ·ä¸œè¥¿ä¸€å®šä¸å­˜åœ¨æˆ–è€…å¯èƒ½å­˜ åœ¨â€ï¼Œå®ƒæ˜¯ç”¨å¤šä¸ªå“ˆå¸Œå‡½æ•°ï¼Œå°†ä¸€ä¸ªæ•°æ®æ˜ å°„åˆ°ä½å›¾ç»“æ„ä¸­ã€‚æ­¤ç§æ–¹å¼ä¸ä»…å¯ä»¥æå‡æŸ¥è¯¢æ•ˆç‡ï¼Œä¹Ÿå¯ä»¥èŠ‚çœå¤§é‡çš„å†…å­˜ç©ºé—´</p></blockquote><h2 id="ç”¨å¤„">ç”¨å¤„</h2><p>1ã€å¯ä»¥åšé»‘åå•æŸ¥è¯¢ï¼Œä¸åœ¨é»‘åå•çš„äººä¸€å®šå å¤§å¤šæ•°ï¼Œå¦‚æœä¸åœ¨ç›´æ¥è¿”å›ï¼Œå¦‚æœåœ¨ï¼Œè¿™ä¸ªç»“æœå¯èƒ½å°±ä¸å‡†ï¼Œç»§ç»­åœ¨ä»æ•°æ®åº“ä¸­æŸ¥è¯¢ã€‚</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212271506798.png" alt=""></p><p>2ã€æ³¨å†Œæ˜µç§°çš„åœºæ™¯ï¼Œå¦‚æœè¦æ³¨å†Œçš„æ˜µç§°ä¸å­˜åœ¨ï¼Œç›´æ¥æ³¨å†Œï¼Œå¦‚æœå­˜åœ¨ï¼Œç›´æ¥æç¤ºï¼ˆå¯èƒ½æœ‰è¯¯åˆ¤ï¼‰</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212271508884.png" alt=""></p><h2 id="å¸ƒéš†è¿‡æ»¤å™¨å®ç°">å¸ƒéš†è¿‡æ»¤å™¨å®ç°</h2><p>å­—ç¬¦ä¸²å“ˆå¸Œç®—æ³•è½¬æˆæ•´å½¢å»æ˜ å°„ä¸€ä¸ªæˆ–è€…å¤šä¸ªä½ç½®è¿›è¡Œæ ‡è®°</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212262302892.png" alt=""></p><p>ä¸‹è¾¹ä¸ºå¸ƒéš†è¿‡æ»¤å™¨ä»£ç ï¼Œé¦–å…ˆç¡®å®šmçš„ä¸ªæ•°ï¼Œä¸‹è¾¹m=5å€çš„n</p><blockquote><p>kä¸ºå“ˆå¸Œå‡½æ•°çš„ä¸ªæ•°ï¼Œmä¸ºå¸ƒéš†è¿‡æ»¤å™¨é•¿åº¦ï¼Œnä¸ºæ’å…¥å…ƒç´ çš„ä¸ªæ•°ï¼Œpä¸ºè¯¯æŠ¥ç‡</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212271500685.png" alt=""></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">HashBKDR</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// BKDR</span></span><br><span class="line"><span class="function"><span class="type">size_t</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> string&amp; key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">size_t</span> val = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> ch : key)</span><br><span class="line">&#123;</span><br><span class="line">val *= <span class="number">131</span>;</span><br><span class="line">val += ch;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> val;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HashAP</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// BKDR</span></span><br><span class="line"><span class="function"><span class="type">size_t</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> string&amp; key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">size_t</span> hash = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; key.<span class="built_in">size</span>(); i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> ((i &amp; <span class="number">1</span>) == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">hash ^= ((hash &lt;&lt; <span class="number">7</span>) ^ key[i] ^ (hash &gt;&gt; <span class="number">3</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">hash ^= (~((hash &lt;&lt; <span class="number">11</span>) ^ key[i] ^ (hash &gt;&gt; <span class="number">5</span>)));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> hash;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HashDJB</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// BKDR</span></span><br><span class="line"><span class="function"><span class="type">size_t</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> string&amp; key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">size_t</span> hash = <span class="number">5381</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> ch : key)</span><br><span class="line">&#123;</span><br><span class="line">hash += (hash &lt;&lt; <span class="number">5</span>) + ch;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> hash;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Nè¡¨ç¤ºå‡†å¤‡è¦æ˜ å°„Nä¸ªå€¼</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="type">size_t</span> N, <span class="keyword">class</span> <span class="title class_">K</span> = string, <span class="keyword">class</span> Hash1 = HashBKDR, <span class="keyword">class</span> Hash2=HashAP, <span class="keyword">class</span> Hash3=HashDJB&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> BloomFilter</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="type">void</span> <span class="built_in">Set</span>(<span class="type">const</span> K&amp; key)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">size_t</span> hash1 = <span class="built_in">Hash1</span>()(key) % (_ratio * N);</span><br><span class="line">_bits-&gt;<span class="built_in">set</span>(hash1);</span><br><span class="line"></span><br><span class="line"><span class="type">size_t</span> hash2 = <span class="built_in">Hash2</span>()(key) % (_ratio * N);</span><br><span class="line">_bits-&gt;<span class="built_in">set</span>(hash2);</span><br><span class="line"></span><br><span class="line"><span class="type">size_t</span> hash3 = <span class="built_in">Hash3</span>()(key) % (_ratio * N);</span><br><span class="line">_bits-&gt;<span class="built_in">set</span>(hash3);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Test</span><span class="params">(<span class="type">const</span> K&amp; key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">size_t</span> hash1 = <span class="built_in">Hash1</span>()(key) % (_ratio * N);</span><br><span class="line"><span class="keyword">if</span> (_bits-&gt;<span class="built_in">test</span>(hash1) == <span class="literal">false</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">size_t</span> hash2 = <span class="built_in">Hash2</span>()(key) % (_ratio * N);</span><br><span class="line"><span class="keyword">if</span> (_bits-&gt;<span class="built_in">test</span>(hash2) == <span class="literal">false</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">size_t</span> hash3 = <span class="built_in">Hash3</span>()(key) % (_ratio * N);</span><br><span class="line"><span class="keyword">if</span> (_bits-&gt;<span class="built_in">test</span>(hash3) == <span class="literal">false</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="type">const</span> <span class="type">static</span> <span class="type">size_t</span> _ratio = <span class="number">5</span>;</span><br><span class="line">std::bitset&lt;_ratio* N&gt;* _bits = <span class="keyword">new</span> std::bitset&lt;_ratio* N&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å‡ ä¸ªä¾‹å­">å‡ ä¸ªä¾‹å­</h2><blockquote><p>1ã€ç»™ä¸¤ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«æœ‰100äº¿ä¸ªqueryï¼Œæˆ‘ä»¬åªæœ‰1Gå†…å­˜ï¼Œå¦‚ä½•æ‰¾åˆ°ä¸¤ä¸ªæ–‡ä»¶çš„äº¤é›†ï¼Ÿï¼ˆè¿‘ä¼¼ç®—æ³•ï¼‰</p></blockquote><ul><li>å…ˆè¯»å–å…¶ä¸­ä¸€ä¸ªæ–‡ä»¶å½“ä¸­çš„queryï¼Œå°†å…¶å…¨éƒ¨æ˜ å°„åˆ°ä¸€ä¸ªå¸ƒéš†è¿‡æ»¤å™¨å½“ä¸­ã€‚</li><li>ç„¶åè¯»å–å¦ä¸€ä¸ªæ–‡ä»¶å½“ä¸­çš„queryï¼Œä¾æ¬¡åˆ¤æ–­æ¯ä¸ªqueryæ˜¯å¦åœ¨å¸ƒéš†è¿‡æ»¤å™¨å½“ä¸­ï¼Œå¦‚æœåœ¨åˆ™æ˜¯äº¤é›†ï¼Œä¸åœ¨åˆ™ä¸æ˜¯äº¤é›†ã€‚ï¼ˆè¿™é‡Œçš„åœ¨å¯èƒ½ä¼šè¯¯åˆ¤ï¼‰</li></ul><blockquote><p>2ã€å¦‚ä½•æ‰©å±•BloomFilterä½¿å¾—å®ƒæ”¯æŒåˆ é™¤æ“ä½œ</p></blockquote><p>ä¸€èˆ¬å¸ƒéš†è¿‡æ»¤å™¨åˆ é™¤å¯èƒ½ä¼šå½±å“å…¶ä»–çš„å…ƒç´ ï¼Œå› ä¸ºå“ˆå¸Œå‡½æ•°å¯èƒ½ä¼šæ˜ å°„åˆ°ç›¸åŒçš„ä½ï¼Œå¦‚æœè¦æ”¯æŒåˆ é™¤æ“ä½œï¼Œåœ¨åº•å±‚ç»§ç»­å¢åŠ ä½å›¾ï¼Œåšå¼•ç”¨è®¡æ•°çš„åŠŸèƒ½ï¼Œä½†æ˜¯ä¼šæµªè´¹å¾ˆå¤šç©ºé—´ï¼Œæ‰€ä»¥å¸ƒéš†è¿‡æ»¤å™¨ä¸€èˆ¬ä¸æ”¯æŒåˆ é™¤æ“ä½œã€‚</p><h2 id="å“ˆå¸Œåˆ‡å‰²">å“ˆå¸Œåˆ‡å‰²</h2><blockquote><p>1ã€ç»™ä¸¤ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«æœ‰100äº¿ä¸ªqueryï¼Œæˆ‘ä»¬åªæœ‰1Gå†…å­˜ï¼Œå¦‚ä½•æ‰¾åˆ°ä¸¤ä¸ªæ–‡ä»¶çš„äº¤é›†ï¼Ÿï¼ˆç²¾ç¡®ç®—æ³•ï¼‰</p></blockquote><ul><li>é¦–å…ˆéœ€è¦ä¼°ç®—ä¸€ä¸‹è¿™é‡Œä¸€ä¸ªæ–‡ä»¶çš„å¤§å°ï¼Œä¾¿äºç¡®å®šå°†ä¸€ä¸ªæ–‡ä»¶åˆ‡åˆ†ä¸ºå¤šå°‘ä¸ªå°æ–‡ä»¶ã€‚</li><li>å‡è®¾å¹³å‡æ¯ä¸ªqueryä¸º20å­—èŠ‚ï¼Œé‚£ä¹ˆ100äº¿ä¸ªqueryå°±æ˜¯200Gï¼Œç”±äºæˆ‘ä»¬åªæœ‰1Gå†…å­˜ï¼Œè¿™é‡Œå¯ä»¥è€ƒè™‘å°†ä¸€ä¸ªæ–‡ä»¶åˆ‡åˆ†æˆ400ä¸ªå°æ–‡ä»¶ã€‚</li><li>è¿™é‡Œæˆ‘ä»¬å°†è¿™ä¸¤ä¸ªæ–‡ä»¶åˆ†åˆ«å«åšAæ–‡ä»¶å’ŒBæ–‡ä»¶ï¼Œæ­¤æ—¶æˆ‘ä»¬å°†Aæ–‡ä»¶åˆ‡åˆ†æˆäº†A0~A399å…±400ä¸ªå°æ–‡ä»¶ï¼Œå°†Bæ–‡ä»¶åˆ‡åˆ†æˆäº†B0~B399å…±400ä¸ªå°æ–‡ä»¶ã€‚</li></ul><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212271516166.png" alt=""></p><p>ä¾æ¬¡è¯»å–æ–‡ä»¶Aä¸­queryï¼Œi=Hash(query)%400ï¼Œè¿™ä¸ªqueryè¿›å…¥Aiå·å°æ–‡ä»¶ï¼Œç›¸åŒçš„queryä¸€å®šè¿›å…¥ç¼–å·ç›¸åŒçš„å°æ–‡ä»¶</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212271600564.png" alt=""></p><ul><li>ç»è¿‡åˆ‡åˆ†åç†è®ºä¸Šæ¯ä¸ªå°æ–‡ä»¶çš„å¹³å‡å¤§å°æ˜¯512Mï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†å…¶ä¸­ä¸€ä¸ªå°æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ï¼Œå¹¶æ”¾åˆ°ä¸€ä¸ªsetå®¹å™¨ä¸­ï¼Œå†éå†å¦ä¸€ä¸ªå°æ–‡ä»¶å½“ä¸­çš„queryï¼Œä¾æ¬¡åˆ¤æ–­æ¯ä¸ªqueryæ˜¯å¦åœ¨setå®¹å™¨ä¸­ï¼Œå¦‚æœåœ¨åˆ™æ˜¯äº¤é›†ï¼Œä¸åœ¨åˆ™ä¸æ˜¯äº¤é›†ã€‚</li><li>å½“å“ˆå¸Œåˆ‡åˆ†å¹¶ä¸æ˜¯å¹³å‡åˆ‡åˆ†ï¼Œæœ‰å¯èƒ½åˆ‡å‡ºæ¥çš„å°æ–‡ä»¶ä¸­æœ‰ä¸€äº›å°æ–‡ä»¶çš„å¤§å°ä»ç„¶å¤§äº1Gï¼Œæ­¤æ—¶å¦‚æœä¸ä¹‹å¯¹åº”çš„å¦ä¸€ä¸ªå°æ–‡ä»¶å¯ä»¥åŠ è½½åˆ°å†…å­˜ï¼Œåˆ™å¯ä»¥é€‰æ‹©å°†å¦ä¸€ä¸ªå°æ–‡ä»¶ä¸­çš„queryåŠ è½½åˆ°å†…å­˜ï¼Œå› ä¸ºæˆ‘ä»¬åªéœ€è¦å°†ä¸¤ä¸ªå°æ–‡ä»¶ä¸­çš„ä¸€ä¸ªåŠ è½½åˆ°å†…å­˜ä¸­å°±è¡Œäº†ã€‚</li><li>ä½†å¦‚æœä¸¤ä¸ªå°æ–‡ä»¶çš„å¤§å°éƒ½å¤§äº1Gï¼Œé‚£æˆ‘ä»¬å¯ä»¥è€ƒè™‘å°†è¿™ä¸¤ä¸ªå°æ–‡ä»¶å†è¿›è¡Œä¸€æ¬¡åˆ‡åˆ†ï¼Œå°†å…¶åˆ‡æˆæ›´å°çš„æ–‡ä»¶ï¼Œæ–¹æ³•ä¸ä¹‹å‰åˆ‡åˆ†Aæ–‡ä»¶å’ŒBæ–‡ä»¶çš„æ–¹æ³•ç±»ä¼¼ã€‚</li></ul><blockquote><p>2ã€ç»™ä¸€ä¸ªè¶…è¿‡100Gå¤§å°çš„log fileï¼Œlogä¸­å­˜ç€IPåœ°å€ï¼Œè®¾è®¡ç®—æ³•æ‰¾åˆ°å‡ºç°æ¬¡æ•°æœ€å¤šçš„IPåœ°å€ï¼Ÿä¸ä¸Šé¢˜æ¡ä»¶ç›¸åŒï¼Œå¦‚ä½•æ‰¾åˆ°top Kçš„IP</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212271603992.png" alt=""></p><p>ç›¸åŒçš„IPä¸€å®šè¿›å…¥åŒä¸€ä¸ªå°æ–‡ä»¶ï¼Œç„¶åä¾æ¬¡ä½¿ç”¨map&lt;string,int&gt;å¯¹æ¯ä¸ªå°æ–‡ä»¶ç»Ÿè®¡æ¬¡æ•°</p><p>TopKï¼Œå»ºç«‹ä¸€ä¸ªKå€¼ä¸º&lt;ip, count&gt;çš„å°å †ã€‚ä¾æ¬¡åŠ è½½æ¯ä¸ªæ–‡ä»¶ï¼Œå¦‚æœæŸä¸ªIPåœ°å€å‡ºç°çš„æ¬¡æ•°å¤§äºå †é¡¶IPåœ°å€å‡ºç°çš„æ¬¡æ•°ï¼Œåˆ™å°†è¯¥IPåœ°å€ä¸å †é¡¶çš„IPåœ°å€è¿›è¡Œäº¤æ¢ï¼Œç„¶åå†è¿›è¡Œä¸€æ¬¡å‘ä¸‹è°ƒæ•´ï¼Œä½¿å…¶ä»ä¸ºå°å †ï¼Œæœ€ç»ˆæ¯”å¯¹å®Œæ‰€æœ‰å°æ–‡ä»¶ä¸­çš„IPåœ°å€åï¼Œè¿™ä¸ªå°å †å½“ä¸­çš„Kä¸ªIPåœ°å€å°±æ˜¯å‡ºç°æ¬¡æ•°top Kçš„IPåœ°å€ã€‚</p><h2 id="å¸ƒéš†è¿‡æ»¤å™¨ç‰¹ç‚¹">å¸ƒéš†è¿‡æ»¤å™¨ç‰¹ç‚¹</h2><p>å­˜åœ¨è¯¯åˆ¤ï¼š<br>åœ¨ï¼šä¸å‡†ç¡®çš„ï¼Œå­˜åœ¨è¯¯åˆ¤<br>ä¸åœ¨ï¼šå‡†ç¡®çš„ï¼Œä¸å­˜åœ¨è¯¯åˆ¤</p><p>ç†è®ºè€Œè¨€ï¼šä¸€ä¸ªå€¼æ˜ å°„çš„ä½è¶Šå¤šï¼Œè¯¯åˆ¤æ¦‚ç‡è¶Šä½ï¼Œä½†æ˜¯ä¹Ÿä¸æ•¢æ˜ å°„å¤ªå¤šï¼Œé‚£ä¹ˆç©ºé—´æ¶ˆè€—å°±è¶Šå¤š</p>]]></content>
      
      
      <categories>
          
          <category> é«˜é˜¶æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å“ˆå¸Œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å“ˆå¸Œ</title>
      <link href="/posts/775623030/"/>
      <url>/posts/775623030/</url>
      
        <content type="html"><![CDATA[<h1>unorderedç³»åˆ—å…³è”å¼å®¹å™¨</h1><blockquote><p>å†…éƒ¨æ˜¯æ— åºçš„ï¼ŒæŸ¥è¯¢å¾ˆå¿«</p></blockquote><p>å‡ ä¸ªå‡½æ•°è¯´æ˜ï¼š</p><table><thead><tr><th>å‡½æ•°å£°æ˜</th><th>åŠŸèƒ½ä»‹ç»</th></tr></thead><tbody><tr><td>operator[]</td><td>è¿”å›ä¸keyå¯¹åº”çš„valueå€¼</td></tr><tr><td>bucket_count()</td><td>è¿”å›æ¡¶çš„ä¸ªæ•°</td></tr><tr><td>size_t bucket_size(size_t n)const</td><td>è¿”å›nå·æ¡¶æœ‰æ•ˆå…ƒç´ çš„ä¸ªæ•°</td></tr><tr><td>size_t bucket(const K&amp; key)</td><td>è¿”å›å…ƒç´ keyå¯¹åº”çš„æ¡¶å·</td></tr></tbody></table><h1>åº•å±‚ç»“æ„</h1><blockquote><p>unorderedç³»åˆ—çš„å…³è”å¼å®¹å™¨ä¹‹æ‰€ä»¥æ•ˆç‡æ¯”è¾ƒé«˜ï¼Œæ˜¯å› ä¸ºå…¶åº•å±‚ä½¿ç”¨äº†å“ˆå¸Œç»“æ„ã€‚</p></blockquote><h2 id="æ¦‚å¿µ">æ¦‚å¿µ</h2><p>é€šè¿‡æŸç§å‡½æ•°(hashFunc)ä½¿å…ƒç´ çš„å­˜å‚¨ä½ç½®ä¸å®ƒçš„å…³é”®ç ä¹‹é—´èƒ½å¤Ÿå»ºç«‹  ä¸€ä¸€æ˜ å°„çš„å…³ç³»ï¼Œé‚£ä¹ˆåœ¨æŸ¥æ‰¾æ—¶é€šè¿‡è¯¥å‡½æ•°å¯ä»¥å¾ˆå¿«æ‰¾åˆ°è¯¥å…ƒç´ ã€‚</p><p>ä¾‹å¦‚ï¼šæ•°æ®é›†åˆ{1ï¼Œ7ï¼Œ6ï¼Œ4ï¼Œ5ï¼Œ9}<br>å“ˆå¸Œå‡½æ•°è®¾ç½®ä¸ºï¼š<strong>hash(key) = key % capacity</strong>; <strong>capacity</strong>ä¸ºå­˜å‚¨å…ƒç´ åº•å±‚ç©ºé—´æ€»çš„å¤§å°</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212231541251.png" alt=""></p><h2 id="å“ˆå¸Œå†²çª">å“ˆå¸Œå†²çª</h2><blockquote><p>ä¸åŒå…³é”®å­—é€šè¿‡ç›¸åŒå“ˆå¸Œå“ˆæ•°è®¡ç®—å‡ºç›¸åŒçš„å“ˆå¸Œåœ°å€ï¼Œè¯¥ç§ç°è±¡ç§°ä¸ºå“ˆå¸Œå†²çªæˆ–å“ˆå¸Œç¢°æ’ã€‚</p></blockquote><h2 id="å“ˆå¸Œå‡½æ•°">å“ˆå¸Œå‡½æ•°</h2><p>å¼•èµ·å“ˆå¸Œå†²çªçš„ä¸€ä¸ªåŸå› å¯èƒ½æ˜¯ï¼šå“ˆå¸Œå‡½æ•°è®¾è®¡ä¸å¤Ÿåˆç†ã€‚</p><p><strong>å“ˆå¸Œå‡½æ•°è®¾è®¡åŸåˆ™ï¼š</strong></p><ul><li>å“ˆå¸Œå‡½æ•°çš„å®šä¹‰åŸŸå¿…é¡»åŒ…æ‹¬éœ€è¦å­˜å‚¨çš„å…¨éƒ¨å…³é”®ç ï¼Œè€Œå¦‚æœæ•£åˆ—è¡¨å…è®¸æœ‰mä¸ªåœ°å€æ—¶ï¼Œå…¶å€¼<br>åŸŸå¿…é¡»åœ¨0åˆ°m-1ä¹‹é—´</li><li>å“ˆå¸Œå‡½æ•°è®¡ç®—å‡ºæ¥çš„åœ°å€èƒ½å‡åŒ€åˆ†å¸ƒåœ¨æ•´ä¸ªç©ºé—´ä¸­</li><li>å“ˆå¸Œå‡½æ•°åº”è¯¥æ¯”è¾ƒç®€å•</li></ul><h3 id="é™¤ç•™ä½™æ•°æ³•">é™¤ç•™ä½™æ•°æ³•</h3><p>è®¾æ•£åˆ—è¡¨ä¸­å…è®¸çš„åœ°å€æ•°ä¸ºmï¼Œå–ä¸€ä¸ªä¸å¤§äºmï¼Œä½†æœ€æ¥è¿‘æˆ–è€…ç­‰äºmçš„è´¨æ•°pä½œä¸ºé™¤æ•°ï¼Œ<br>æŒ‰ç…§å“ˆå¸Œå‡½æ•°ï¼š<strong>Hash(key) = key% p(p&lt;=m)</strong>,å°†å…³é”®ç è½¬æ¢æˆå“ˆå¸Œåœ°å€</p><h3 id="å­—ç¬¦ä¸²å“ˆå¸Œç®—æ³•">å­—ç¬¦ä¸²å“ˆå¸Œç®—æ³•</h3><p><a href="https://www.cnblogs.com/-clq/archive/2012/05/31/2528153.html">å­—ç¬¦ä¸²å“ˆå¸Œç®—æ³•</a></p><h2 id="è§£å†³å“ˆå¸Œå†²çª">è§£å†³å“ˆå¸Œå†²çª</h2><h3 id="é—­æ•£åˆ—">é—­æ•£åˆ—</h3><p>é—­æ•£åˆ—ï¼šä¹Ÿå«å¼€æ”¾å®šå€æ³•ï¼Œå½“å‘ç”Ÿå“ˆå¸Œå†²çªæ—¶ï¼Œå¦‚æœå“ˆå¸Œè¡¨æœªè¢«è£…æ»¡ï¼Œè¯´æ˜åœ¨å“ˆå¸Œè¡¨ä¸­å¿…ç„¶è¿˜æœ‰ç©ºä½ç½®ï¼Œé‚£ä¹ˆå¯ä»¥æŠŠkeyå­˜æ”¾åˆ°å†²çªä½ç½®ä¸­çš„â€œä¸‹ä¸€ä¸ªâ€ ç©ºä½ç½®ä¸­å»ã€‚é‚£å¦‚ä½•å¯»æ‰¾ä¸‹ä¸€ä¸ªç©ºä½ç½®</p><h4 id="çº¿æ€§æ¢æµ‹">çº¿æ€§æ¢æµ‹</h4><blockquote><p>ä»å‘ç”Ÿå†²çªçš„ä½ç½®å¼€å§‹ï¼Œä¾æ¬¡å‘åæ¢æµ‹ï¼Œç›´åˆ°å¯»æ‰¾åˆ°ä¸‹ä¸€ä¸ªç©ºä½ç½®ä¸ºæ­¢</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212231551253.png" alt=""></p><p>çº¿æ€§æ¢æµ‹ç¼ºç‚¹ï¼šä¸€æ—¦å‘ç”Ÿå“ˆå¸Œå†²çªï¼Œæ‰€æœ‰çš„å†²çªè¿åœ¨ä¸€èµ·ï¼Œå®¹æ˜“äº§ç”Ÿæ•°æ®â€œå †ç§¯â€ï¼Œå³ï¼šä¸åŒ<br>å…³é”®ç å æ®äº†å¯åˆ©ç”¨çš„ç©ºä½ç½®ï¼Œä½¿å¾—å¯»æ‰¾æŸå…³é”®ç çš„ä½ç½®éœ€è¦è®¸å¤šæ¬¡æ¯”è¾ƒï¼Œå¯¼è‡´æœç´¢æ•ˆç‡é™<br>ä½</p><h4 id="äºŒæ¬¡æ¢æµ‹">äºŒæ¬¡æ¢æµ‹</h4><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212231600891.png" alt=""></p><p>æ¯æ¬¡å¹³æ–¹çš„æ¢æµ‹ï¼š<strong>hash+i^2 (i&gt;=0)</strong></p><h4 id="è´Ÿè½½å› å­">è´Ÿè½½å› å­</h4><p>è´Ÿè½½å› å­ï¼šå¡«å…¥è¡¨ä¸­å…ƒç´ ä¸ªæ•° / æ•£åˆ—è¡¨çš„é•¿åº¦</p><p>è´Ÿè½½å› å­è¶Šå°è¶Šä¸å®¹æ˜“å†²çªï¼Œä½†æ˜¯ç©ºé—´åˆ©ç”¨ç‡æ¯”è¾ƒä½ï¼Œä¸€èˆ¬è®¾ç½®0.7å·¦å³</p><h4 id="ä»£ç ">ä»£ç </h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> CloseHash</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">State</span></span><br><span class="line">    &#123;</span><br><span class="line">        EXIST,</span><br><span class="line">        DELETE,</span><br><span class="line">        EMPTY</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">HashData</span></span><br><span class="line">    &#123;</span><br><span class="line">        std::pair&lt;K, V&gt; _kv;</span><br><span class="line">        State _state = EMPTY;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">K</span>&gt;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">HashFunc</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="type">size_t</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> K &amp;key)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="type">size_t</span>)key;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;&gt;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">HashFunc</span>&lt;string&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="type">size_t</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> string &amp;key)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="type">size_t</span> val = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> ch : key)</span><br><span class="line">            &#123;</span><br><span class="line">                val *= <span class="number">131</span>;</span><br><span class="line">                val += ch;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> val;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>, <span class="keyword">class</span> <span class="title class_">Hash</span> = HashFunc&lt;K&gt;&gt;</span><br><span class="line">    <span class="keyword">class</span> HashTable</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="type">bool</span> <span class="built_in">insert</span>(<span class="type">const</span> pair&lt;K, V&gt; &amp;data)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">find</span>(data.first))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (_tables.<span class="built_in">size</span>() == <span class="number">0</span> || _size * <span class="number">10</span> / _tables.<span class="built_in">size</span>() &gt;= <span class="number">7</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">size_t</span> newSize = _tables.<span class="built_in">size</span>() == <span class="number">0</span> ? <span class="number">10</span> : _tables.<span class="built_in">size</span>() * <span class="number">2</span>;</span><br><span class="line">                HashTable&lt;K, V, Hash&gt; newHT;</span><br><span class="line">                newHT._tables.<span class="built_in">resize</span>(newSize);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">auto</span> e : _tables)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (e._state == EXIST)</span><br><span class="line">                    &#123;</span><br><span class="line">                        newHT.<span class="built_in">insert</span>(e._kv);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                _tables.<span class="built_in">swap</span>(newHT._tables);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Hash hash;</span><br><span class="line">            <span class="type">size_t</span> hashi = <span class="built_in">hash</span>(data.first) % _tables.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (_tables[hashi]._state == EXIST)</span><br><span class="line">            &#123;</span><br><span class="line">                hashi++;</span><br><span class="line">                hashi %= _tables.<span class="built_in">size</span>();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            _tables[hashi]._kv = data;</span><br><span class="line">            _tables[hashi]._state = EXIST;</span><br><span class="line">            _size++;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">HashData&lt;K, V&gt; *<span class="title">find</span><span class="params">(<span class="type">const</span> K &amp;key)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (_tables.<span class="built_in">size</span>() == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            Hash hash;</span><br><span class="line">            <span class="type">size_t</span> start = <span class="built_in">hash</span>(key) % _tables.<span class="built_in">size</span>();</span><br><span class="line">            <span class="type">size_t</span> hashi = start;</span><br><span class="line">            <span class="keyword">while</span> (_tables[hashi]._state != EMPTY)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (_tables[hashi]._state != DELETE &amp;&amp; _tables[hashi]._kv.first == key)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span> &amp;_tables[hashi];</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                hashi++;</span><br><span class="line">                hashi %= _tables.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (hashi == start)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="type">bool</span> <span class="title">erase</span><span class="params">(<span class="type">const</span> K &amp;key)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            HashData&lt;K, V&gt; *ret = <span class="built_in">find</span>(key);</span><br><span class="line">            <span class="keyword">if</span> (ret)</span><br><span class="line">            &#123;</span><br><span class="line">                ret-&gt;_state = DELETE;</span><br><span class="line">                --_size;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; _tables.<span class="built_in">size</span>(); i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (_tables[i]._state == EXIST)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;[%llu:%d] &quot;</span>, i, _tables[i]._kv.first);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;[%llu:*] &quot;</span>, i);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            cout &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        vector&lt;HashData&lt;K, V&gt;&gt; _tables;</span><br><span class="line">        <span class="type">size_t</span> _size = <span class="number">0</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">test1</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> a[] = &#123;<span class="number">1</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">15</span>, <span class="number">26</span>, <span class="number">7</span>, <span class="number">44</span>&#125;;</span><br><span class="line">        HashTable&lt;<span class="type">int</span>, <span class="type">int</span>&gt; ht;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> e : a)</span><br><span class="line">        &#123;</span><br><span class="line">            ht.<span class="built_in">insert</span>(<span class="built_in">make_pair</span>(e, e));</span><br><span class="line">        &#125;</span><br><span class="line">        ht.<span class="built_in">print</span>();</span><br><span class="line"></span><br><span class="line">        ht.<span class="built_in">erase</span>(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">        cout &lt;&lt; ht.<span class="built_in">find</span>(<span class="number">44</span>)-&gt;_kv.first &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; ht.<span class="built_in">find</span>(<span class="number">4</span>) &lt;&lt; endl;</span><br><span class="line">        ht.<span class="built_in">print</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å¼€æ•£åˆ—">å¼€æ•£åˆ—</h3><p>å¼€æ•£åˆ—æ³•åˆå«é“¾åœ°å€æ³•(å¼€é“¾æ³•)ï¼Œé¦–å…ˆå¯¹å…³é”®ç é›†åˆç”¨æ•£åˆ—å‡½æ•°è®¡ç®—æ•£åˆ—åœ°å€ï¼Œå…·æœ‰ç›¸åŒåœ°<br>å€çš„å…³é”®ç å½’äºåŒä¸€å­é›†åˆï¼Œæ¯ä¸€ä¸ªå­é›†åˆç§°ä¸ºä¸€ä¸ªæ¡¶ï¼Œå„ä¸ªæ¡¶ä¸­çš„å…ƒç´ é€šè¿‡ä¸€ä¸ªå•é“¾è¡¨é“¾<br>æ¥èµ·æ¥ï¼Œå„é“¾è¡¨çš„å¤´ç»“ç‚¹å­˜å‚¨åœ¨å“ˆå¸Œè¡¨ä¸­ã€‚</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212231612112.png" alt=""></p><h3 id="å¼€æ•£åˆ—é—­æ•£åˆ—æ¯”è¾ƒ">å¼€æ•£åˆ—é—­æ•£åˆ—æ¯”è¾ƒ</h3><p>åº”ç”¨é“¾åœ°å€æ³•ï¼ˆå¼€æ•£åˆ—ï¼‰å¤„ç†æº¢å‡ºï¼Œéœ€è¦å¢è®¾é“¾æ¥æŒ‡é’ˆï¼Œä¼¼ä¹å¢åŠ äº†å­˜å‚¨å¼€é”€ã€‚äº‹å®ä¸Šï¼šç”±äºå¼€åœ°å€æ³•å¿…é¡»ä¿æŒå¤§é‡çš„ç©ºé—²ç©ºé—´ä»¥ç¡®ä¿æœç´¢æ•ˆç‡ï¼Œå¦‚äºŒæ¬¡æ¢æŸ¥æ³•è¦æ±‚è£…è½½å› å­a &lt;=  0.7ï¼Œè€Œè¡¨é¡¹æ‰€å ç©ºé—´åˆæ¯”æŒ‡é’ˆå¤§çš„å¤šï¼Œæ‰€ä»¥ä½¿ç”¨é“¾åœ°å€æ³•åè€Œæ¯”å¼€åœ°å€æ³•èŠ‚çœå­˜å‚¨ç©ºé—´ã€‚</p><h1>unordered_mapå’Œunordered_setå°è£…</h1><h2 id="hashè¡¨ï¼ˆå¼€æ•£åˆ—ï¼‰">hashè¡¨ï¼ˆå¼€æ•£åˆ—ï¼‰</h2><p>å‡ ä¸ªç‚¹ï¼š</p><ul><li>æ¨¡æ¿ç±»ï¼Œç¬¬ä¸€ä¸ªæ¨¡æ¿å‚æ•°æ˜¯Kï¼Œç¬¬äºŒä¸ªå‚æ•°Tï¼Œä¸Šå±‚å†³å®šè¿™ä¸ªTæ˜¯ä»€ä¹ˆ</li><li>ä¼ å…¥ä»¿å‡½æ•°KeyOfTï¼Œè¿™ä¸ªå¯ä»¥ä»Tç±»å‹ä¸­å–K</li><li>insertæ’å…¥ï¼Œè¿”å›å€¼è®¾ä¸ºè¿­ä»£å™¨å’Œboolçš„é”®å€¼å¯¹</li><li>è¿­ä»£å™¨ï¼ˆä¸€ä¸ªæ˜¯èŠ‚ç‚¹æŒ‡é’ˆï¼Œä¸€ä¸ªæ˜¯å“ˆå¸Œè¡¨æŒ‡é’ˆï¼‰</li><li>è¿­ä»£å™¨ç”¨äº†å“ˆå¸Œè¡¨ï¼Œéœ€è¦åœ¨è¿­ä»£å™¨å‰é¢è¿›è¡Œå“ˆå¸Œè¡¨çš„å£°æ˜</li><li>è¿­ä»£å™¨æœ‰å“ˆå¸Œè¡¨çš„æŒ‡é’ˆï¼Œæ‰€ä»¥è¦å°†è¿­ä»£å™¨ç±»ï¼Œå£°æ˜ä¸ºå“ˆå¸Œè¡¨ç±»çš„å‹å…ƒ</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">K</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HashFunc</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> K &amp;key)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">size_t</span>)key;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HashFunc</span>&lt;string&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> string &amp;key)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">size_t</span> val = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> ch : key)</span><br><span class="line">        &#123;</span><br><span class="line">            val *= <span class="number">131</span>;</span><br><span class="line">            val += ch;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> val;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> OpenHash</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">HashData</span></span><br><span class="line">    &#123;</span><br><span class="line">        T _data;</span><br><span class="line">        HashData&lt;T&gt; *_next;</span><br><span class="line">        <span class="built_in">HashData</span>(<span class="type">const</span> T &amp;data)</span><br><span class="line">            : _data(data), _next(<span class="literal">nullptr</span>)</span><br><span class="line">        &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">Hash</span>, <span class="keyword">class</span> <span class="title class_">KeyOfT</span>&gt;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">HashTable</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">Hash</span>, <span class="keyword">class</span> <span class="title class_">KeyOfT</span>&gt;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">__HashIterator</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">typedef</span> HashData&lt;T&gt; Node;</span><br><span class="line">        <span class="keyword">typedef</span> HashTable&lt;K, T, Hash, KeyOfT&gt; HT;</span><br><span class="line">        <span class="keyword">typedef</span> __HashIterator&lt;K, T, Hash, KeyOfT&gt; self;</span><br><span class="line"></span><br><span class="line">        Node *_node;</span><br><span class="line">        HT *_pht;</span><br><span class="line"></span><br><span class="line">        __HashIterator(Node *node, HT *pht)</span><br><span class="line">            : _node(node), _pht(pht)</span><br><span class="line">        &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        T &amp;<span class="keyword">operator</span>*()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> _node-&gt;_data;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        T *<span class="keyword">operator</span>-&gt;()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> &amp;_node-&gt;_data;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        self &amp;<span class="keyword">operator</span>++()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (_node-&gt;_next)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœå½“å‰æ¡¶çš„ä¸‹ä¸€ä¸ªä¸ä¸ºç©ºï¼Œç›´æ¥èµ°åˆ°ä¸‹ä¸€ä¸ªä½ç½®</span></span><br><span class="line">                _node = _node-&gt;_next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// è¯´æ˜å½“å‰ä½ç½®ä¸ºç©ºï¼Œè¦æ‰¾ä¸‹ä¸€ä¸ªä¸ä¸ºç©ºçš„æ¡¶</span></span><br><span class="line">                Hash hash;</span><br><span class="line">                KeyOfT kot;</span><br><span class="line">                <span class="type">size_t</span> i = <span class="built_in">hash</span>(<span class="built_in">kot</span>(_node-&gt;_data)) % _pht-&gt;<span class="built_in">size</span>();</span><br><span class="line">                ++i;</span><br><span class="line">                <span class="keyword">for</span> (; i &lt; _pht-&gt;<span class="built_in">size</span>(); ++i)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (_pht-&gt;_tables[i])</span><br><span class="line">                    &#123;</span><br><span class="line">                        _node = _pht-&gt;_tables[i];</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (i == _pht-&gt;<span class="built_in">size</span>())</span><br><span class="line">                &#123;</span><br><span class="line">                    _node = <span class="literal">nullptr</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">bool</span> <span class="keyword">operator</span>!=(<span class="type">const</span> self &amp;s) <span class="type">const</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> _node != s._node;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">bool</span> <span class="keyword">operator</span>==(<span class="type">const</span> self &amp;s) <span class="type">const</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> _node == s._node;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">Hash</span>, <span class="keyword">class</span> <span class="title class_">KeyOfT</span>&gt;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">HashTable</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">friend</span> <span class="keyword">struct</span> <span class="title class_">__HashIterator</span>&lt;K,T,Hash,KeyOfT&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="keyword">typedef</span> HashData&lt;T&gt;</span><br><span class="line">            Node;</span><br><span class="line">        <span class="keyword">typedef</span> __HashIterator&lt;K, T, Hash, KeyOfT&gt; iterator;</span><br><span class="line"></span><br><span class="line">        <span class="function">iterator <span class="title">begin</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; <span class="built_in">size</span>(); i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (_tables[i])</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="built_in">iterator</span>(_tables[i], <span class="keyword">this</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">end</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">iterator <span class="title">end</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">iterator</span>(<span class="literal">nullptr</span>, <span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">inline</span> <span class="type">size_t</span> __stl_next_prime(<span class="type">size_t</span> n)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">static</span> <span class="type">const</span> <span class="type">size_t</span> __stl_num_primes = <span class="number">28</span>;</span><br><span class="line">            <span class="comment">// æŒ‰ç´ æ•°ï¼Œæ‰©å®¹ï¼Œstlæºç ä¸­</span></span><br><span class="line">            <span class="type">static</span> <span class="type">const</span> <span class="type">size_t</span> __stl_prime_list[__stl_num_primes] =</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="number">53</span>, <span class="number">97</span>, <span class="number">193</span>, <span class="number">389</span>, <span class="number">769</span>,</span><br><span class="line">                    <span class="number">1543</span>, <span class="number">3079</span>, <span class="number">6151</span>, <span class="number">12289</span>, <span class="number">24593</span>,</span><br><span class="line">                    <span class="number">49157</span>, <span class="number">98317</span>, <span class="number">196613</span>, <span class="number">393241</span>, <span class="number">786433</span>,</span><br><span class="line">                    <span class="number">1572869</span>, <span class="number">3145739</span>, <span class="number">6291469</span>, <span class="number">12582917</span>, <span class="number">25165843</span>,</span><br><span class="line">                    <span class="number">50331653</span>, <span class="number">100663319</span>, <span class="number">201326611</span>, <span class="number">402653189</span>, <span class="number">805306457</span>,</span><br><span class="line">                    <span class="number">1610612741</span>, <span class="number">3221225473</span>, <span class="number">4294967291</span>&#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; __stl_num_primes; ++i)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (__stl_prime_list[i] &gt; n)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span> __stl_prime_list[i];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ~<span class="built_in">HashTable</span>()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; _tables.<span class="built_in">size</span>(); i++)</span><br><span class="line">            &#123;</span><br><span class="line">                Node *cur = _tables[i];</span><br><span class="line">                <span class="keyword">while</span> (cur)</span><br><span class="line">                &#123;</span><br><span class="line">                    Node *next = cur-&gt;_next;</span><br><span class="line">                    <span class="keyword">delete</span> cur;</span><br><span class="line">                    cur = next;</span><br><span class="line">                &#125;</span><br><span class="line">                _tables[i] = <span class="literal">nullptr</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function">pair&lt;iterator, <span class="type">bool</span>&gt; <span class="title">insert</span><span class="params">(<span class="type">const</span> T &amp;data)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            KeyOfT kot;</span><br><span class="line">            Hash hash;</span><br><span class="line"></span><br><span class="line">            iterator ret = <span class="built_in">find</span>(<span class="built_in">kot</span>(data));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (ret != <span class="built_in">end</span>())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">make_pair</span>(ret, <span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (_tables.<span class="built_in">size</span>() == _size)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// size_t newSize = _tables.size() == 0 ? 10 : 2 * _tables.size();</span></span><br><span class="line">                vector&lt;Node *&gt; newTables;</span><br><span class="line">                newTables.<span class="built_in">resize</span>(__stl_next_prime(_tables.<span class="built_in">size</span>()), <span class="literal">nullptr</span>);</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; _tables.<span class="built_in">size</span>(); i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    Node *cur = _tables[i];</span><br><span class="line">                    <span class="keyword">while</span> (cur)</span><br><span class="line">                    &#123;</span><br><span class="line">                        Node *next = cur-&gt;_next;</span><br><span class="line">                        <span class="type">size_t</span> hashi = <span class="built_in">hash</span>(<span class="built_in">kot</span>(cur-&gt;_data)) % newTables.<span class="built_in">size</span>();</span><br><span class="line">                        cur-&gt;_next = newTables[hashi];</span><br><span class="line">                        newTables[hashi] = cur;</span><br><span class="line">                        cur = next;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    _tables[i] = <span class="literal">nullptr</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                _tables.<span class="built_in">swap</span>(newTables);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">size_t</span> hashi = <span class="built_in">hash</span>(<span class="built_in">kot</span>(data)) % _tables.<span class="built_in">size</span>();</span><br><span class="line">            Node *newNode = <span class="keyword">new</span> <span class="built_in">Node</span>(data);</span><br><span class="line">            newNode-&gt;_next = _tables[hashi];</span><br><span class="line">            _tables[hashi] = newNode;</span><br><span class="line">            ++_size;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">make_pair</span>(<span class="built_in">iterator</span>(newNode, <span class="keyword">this</span>), <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">iterator <span class="title">find</span><span class="params">(<span class="type">const</span> K &amp;key)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            Hash hash;</span><br><span class="line">            KeyOfT kot;</span><br><span class="line">            <span class="keyword">if</span> (_tables.<span class="built_in">size</span>() == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">end</span>();</span><br><span class="line">            <span class="type">size_t</span> hashi = <span class="built_in">hash</span>(key) % _tables.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">            Node *cur = _tables[hashi];</span><br><span class="line">            <span class="keyword">while</span> (cur)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">kot</span>(cur-&gt;_data) == key)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="built_in">iterator</span>(cur, <span class="keyword">this</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                cur = cur-&gt;_next;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">end</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="type">bool</span> <span class="title">erase</span><span class="params">(<span class="type">const</span> K &amp;key)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (_tables.<span class="built_in">size</span>() == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            Hash hash;</span><br><span class="line">            <span class="type">size_t</span> hashi = <span class="built_in">hash</span>(key) % _tables.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">            Node *cur = _tables[hashi];</span><br><span class="line">            Node *parent = <span class="literal">nullptr</span>;</span><br><span class="line">            <span class="keyword">while</span> (cur)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (cur-&gt;_kv.first == key)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 1ã€å¤´åˆ </span></span><br><span class="line">                    <span class="comment">// 2ã€ä¸­é—´åˆ </span></span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (parent == <span class="literal">nullptr</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        _tables[hashi] = cur-&gt;_next;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        parent-&gt;_next = cur-&gt;_next;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">delete</span> cur;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                parent = cur;</span><br><span class="line">                cur = cur-&gt;_next;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="type">size_t</span> <span class="title">size</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> _tables.<span class="built_in">size</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¡¶çš„ä¸ªæ•°</span></span><br><span class="line">        <span class="function"><span class="type">size_t</span> <span class="title">bucket_num</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="type">size_t</span> num = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; _tables.<span class="built_in">size</span>(); ++i)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (_tables[i])</span><br><span class="line">                &#123;</span><br><span class="line">                    ++num;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> num;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="type">size_t</span> <span class="title">maxbucket_lenth</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="type">size_t</span> maxlen = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; <span class="built_in">size</span>(); i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">size_t</span> len = <span class="number">0</span>;</span><br><span class="line">                Node *cur = _tables[i];</span><br><span class="line">                <span class="keyword">while</span> (cur)</span><br><span class="line">                &#123;</span><br><span class="line">                    len++;</span><br><span class="line">                    cur = cur-&gt;_next;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (len &gt; maxlen)</span><br><span class="line">                &#123;</span><br><span class="line">                    maxlen = len;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> maxlen;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        vector&lt;Node *&gt; _tables;</span><br><span class="line">        <span class="type">size_t</span> _size = <span class="number">0</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="unordered-map">unordered_map</h2><p>unordered_mapçš„åº•å±‚æ˜¯å“ˆå¸Œè¡¨ï¼Œç¬¬äºŒä¸ªæ¨¡æ¿å‚æ•°ä¼ ä¸ªpair&lt;K,V&gt;ï¼ŒåŒæ—¶è¦é…å¯¹åº”çš„ä»¿å‡½æ•°ï¼Œè¿”å›first</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;hash.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> st</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>, <span class="keyword">class</span> <span class="title class_">Hash</span> = HashFunc&lt;K&gt;&gt;</span><br><span class="line">    <span class="keyword">class</span> unordered_map</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">struct</span> KeyOfT</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">const</span> K &amp;<span class="built_in">operator</span>()(<span class="type">const</span> pair&lt;K, V&gt; &amp;kv)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> kv.first;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="keyword">typedef</span> <span class="keyword">typename</span> OpenHash::HashTable&lt;K, pair&lt;K, V&gt;, Hash, KeyOfT&gt;::iterator iterator;</span><br><span class="line"></span><br><span class="line">        <span class="function">iterator <span class="title">begin</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> _ht.<span class="built_in">begin</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">iterator <span class="title">end</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> _ht.<span class="built_in">end</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">pair&lt;iterator, <span class="type">bool</span>&gt; <span class="title">insert</span><span class="params">(<span class="type">const</span> pair&lt;K, V&gt; &amp;kv)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> _ht.<span class="built_in">insert</span>(kv);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        V &amp;<span class="keyword">operator</span>[](<span class="type">const</span> K &amp;key)</span><br><span class="line">        &#123;</span><br><span class="line">            pair&lt;iterator, <span class="type">bool</span>&gt; ret = _ht.<span class="built_in">insert</span>(<span class="built_in">make_pair</span>(key, <span class="built_in">V</span>()));</span><br><span class="line">            <span class="keyword">return</span> ret.first-&gt;second;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        OpenHash::HashTable&lt;K, pair&lt;K, V&gt;, Hash, KeyOfT&gt; _ht;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        unordered_map&lt;string, <span class="type">int</span>&gt; countMap;</span><br><span class="line">        string arr[] = &#123;<span class="string">&quot;a&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;d&quot;</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> e : arr)</span><br><span class="line">        &#123;</span><br><span class="line">            countMap[e]++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;kv : countMap)</span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; kv.first &lt;&lt; <span class="string">&quot;:&quot;</span> &lt;&lt; kv.second &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="unordered-set">unordered_set</h2><p>unordered_setçš„åº•å±‚ä¹Ÿæ˜¯å“ˆå¸Œè¡¨ï¼Œç¬¬äºŒä¸ªæ¨¡æ¿å‚æ•°ä¼ ä¸ªKï¼ŒåŒæ—¶è¦é…å¯¹åº”çš„ä»¿å‡½æ•°ï¼Œè¿”å›Kå°±å¥½äº†</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;hash.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> st</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">Hash</span> = HashFunc&lt;K&gt;&gt;</span><br><span class="line">    <span class="keyword">class</span> unordered_set</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">struct</span> KeyOfT</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">const</span> K &amp;<span class="built_in">operator</span>()(<span class="type">const</span> K&amp; key)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> key;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="keyword">typedef</span> <span class="keyword">typename</span> OpenHash::HashTable&lt;K, K, Hash, KeyOfT&gt;::iterator iterator;</span><br><span class="line"></span><br><span class="line">        <span class="function">iterator <span class="title">begin</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> _ht.<span class="built_in">begin</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">iterator <span class="title">end</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> _ht.<span class="built_in">end</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">pair&lt;iterator, <span class="type">bool</span>&gt; <span class="title">insert</span><span class="params">(<span class="type">const</span> K&amp; key)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> _ht.<span class="built_in">insert</span>(key);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        OpenHash::HashTable&lt;K, K, Hash, KeyOfT&gt; _ht;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">test_set</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        unordered_set&lt;string&gt; s;</span><br><span class="line">        string arr[] = &#123;<span class="string">&quot;a&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;d&quot;</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> e: arr)</span><br><span class="line">        &#123;</span><br><span class="line">            s.<span class="built_in">insert</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> e: s)</span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; e &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹è¯­è¨€ </category>
          
          <category> CPP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> STL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mapå’Œset</title>
      <link href="/posts/3902343519/"/>
      <url>/posts/3902343519/</url>
      
        <content type="html"><![CDATA[<p>å…³è”å¼å®¹å™¨ä¹Ÿæ˜¯ç”¨æ¥å­˜å‚¨æ•°æ®çš„ï¼Œä¸åºåˆ—å¼å®¹å™¨ä¸åŒçš„æ˜¯ï¼Œå…¶é‡Œé¢å­˜å‚¨çš„æ˜¯&lt;key, value&gt;ç»“æ„çš„é”®å€¼å¯¹ï¼Œåœ¨æ•°æ®æ£€ç´¢æ—¶æ¯”åºåˆ—å¼å®¹å™¨æ•ˆç‡æ›´é«˜</p><h1>set</h1><p>æ’åº+å»é‡</p><p>findæ‰¾ä¸åˆ°ä¼šè¿”å›end</p><p>lower_bound(val)  è¿”å›å¤§äºæˆ–è€…ç­‰äºvalçš„ä½ç½®<br>upper_bound(val) è¿”å›å¤§äºvalçš„ä½ç½®</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a[] = &#123; <span class="number">3</span>,<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">8</span>,<span class="number">3</span>, <span class="number">5</span>,<span class="number">3</span>&#125;;</span><br><span class="line"><span class="function">multiset&lt;<span class="type">int</span>&gt; <span class="title">s</span><span class="params">(a, a + <span class="keyword">sizeof</span>(a) / <span class="keyword">sizeof</span>(<span class="type">int</span>))</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ’åº</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> e : s)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; e &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; s.<span class="built_in">count</span>(<span class="number">1</span>) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="comment">// findæ—¶ï¼Œå¦‚æœæœ‰å¤šä¸ªå€¼ï¼Œè¿”å›ä¸­åºçš„ç¬¬ä¸€ä¸ª</span></span><br><span class="line"><span class="keyword">auto</span> pos = s.<span class="built_in">find</span>(<span class="number">3</span>);</span><br><span class="line"><span class="keyword">while</span> (pos != s.<span class="built_in">end</span>())</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; *pos &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">++pos;</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤æ‰€æœ‰çš„3</span></span><br><span class="line">s.<span class="built_in">erase</span>(<span class="number">3</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> e : s)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; e &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">pos = s.<span class="built_in">find</span>(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span> (pos != s.<span class="built_in">end</span>())</span><br><span class="line">&#123;</span><br><span class="line">s.<span class="built_in">erase</span>(pos);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> e : s)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; e &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; endl;</span><br></pre></td></tr></table></figure><h1>map</h1><p>é‡è½½çš„æ–¹æ‹¬å·</p><ul><li>mapä¸­æœ‰è¿™ä¸ªkeyï¼Œè¿”å›valueçš„å¼•ç”¨ã€‚ï¼ˆæŸ¥æ‰¾ã€ä¿®æ”¹valueï¼‰</li><li>mapä¸­æ²¡æœ‰è¿™ä¸ªkeyï¼Œä¼šæ’å…¥ä¸€ä¸ªpair(key,V())ï¼Œè¿”å›valueçš„å¼•ç”¨ã€‚ï¼ˆæ’å…¥+ä¿®æ”¹ï¼‰</li></ul><p>å…·ä½“ç‚¹ï¼š</p><ul><li>keyåœ¨mapä¸­ï¼Œè¿”å›pair(key_iterator, false)       è¿™ä¸ª<strong>pair</strong>æ˜¯insertè¿”å›çš„</li><li>keyä¸åœ¨mapä¸­ï¼Œè¿”å›pair(new_key_iterator, true)</li></ul><p>å®ç°</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">V&amp; <span class="keyword">operator</span>[](<span class="type">const</span> K&amp; key)</span><br><span class="line">&#123;</span><br><span class="line">pair&lt;iterator,<span class="type">bool</span>&gt;ret=<span class="built_in">insert</span>(<span class="built_in">make_pair</span>(key, <span class="built_in">V</span>()));</span><br><span class="line"><span class="keyword">return</span> (ret.first)-&gt;second;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>mapå’Œsetå°è£…</h1><h2 id="è¿­ä»£å™¨ï¼ˆçº¢é»‘æ ‘ï¼‰">è¿­ä»£å™¨ï¼ˆçº¢é»‘æ ‘ï¼‰</h2><blockquote><p>è¿­ä»£å™¨çš„beginæ˜¯ä¸­åºçš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æœ€å·¦èŠ‚ç‚¹ï¼Œè¿™é‡Œå°†endè®¾ç½®ä¸ºç©ºï¼Œå°è£…é‡ç‚¹æ˜¯++å’Œâ€“çš„é€»è¾‘</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212201523942.png" alt=""></p><h3 id="é‡è½½">é‡è½½++</h3><ul><li>å³å­æ ‘ä¸ä¸ºç©ºï¼Œ++å°±æ˜¯æ‰¾å³å­æ ‘ä¸­åºç¬¬ä¸€ä¸ªï¼ˆæœ€å·¦èŠ‚ç‚¹ï¼‰</li><li>å³å­æ ‘ä¸ºç©ºï¼Œ++æ‰¾å­©å­ä¸æ˜¯çˆ¶äº²å³çš„é‚£ä¸ªç¥–å…ˆ</li></ul><h3 id="é‡è½½â€“">é‡è½½â€“</h3><ul><li>å·¦å­æ ‘ä¸ä¸ºç©ºï¼Œâ€“å°±æ˜¯æ‰¾å·¦å­æ ‘çš„æœ€å³èŠ‚ç‚¹</li><li>å·¦å­æ ‘ä¸ºç©ºï¼Œâ€“æ‰¾å­©å­ä¸æ˜¯çˆ¶äº²å·¦çš„é‚£ä¸ªç¥–å…ˆ</li></ul><h3 id="ä»£ç ">ä»£ç </h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">Ref</span>, <span class="keyword">class</span> <span class="title class_">Ptr</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">__RBTreeIterator</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">typedef</span> RBTreeNode&lt;T&gt; Node;</span><br><span class="line">    Node *_node;</span><br><span class="line">    <span class="keyword">typedef</span> __RBTreeIterator&lt;T, Ref, Ptr&gt; self;</span><br><span class="line"></span><br><span class="line">    __RBTreeIterator(Node *node) : _node(node)</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    T &amp;<span class="keyword">operator</span>*()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> _node-&gt;_data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Ptr <span class="keyword">operator</span>-&gt;()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> &amp;_node-&gt;_data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    self &amp;<span class="keyword">operator</span>++()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_node-&gt;_right) <span class="comment">// å³å­æ ‘ä¸ä¸ºç©ºï¼Œå³å­æ ‘çš„æœ€å·¦å°±æ˜¯ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        &#123;</span><br><span class="line">            Node *left = _node-&gt;_right;</span><br><span class="line">            <span class="keyword">while</span> (left-&gt;_left) <span class="comment">// æœ‰ä¸ªé—®é¢˜ï¼Œå½“å‰èŠ‚ç‚¹å¦‚æœæ˜¯25ï¼Œä¸‹ä¸ªèŠ‚ç‚¹æ˜¯27ï¼ŒleftæŒ‡å‘27ï¼Œè¿™æ ·å†™ï¼Œleftå˜æˆç©º</span></span><br><span class="line">            &#123;</span><br><span class="line">                left = left-&gt;_left;</span><br><span class="line">            &#125;</span><br><span class="line">            _node = left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="comment">// å³å­æ ‘ä¸ºç©ºï¼Œæ‰¾å­©å­ä¸æ˜¯çˆ¶äº²å³çš„é‚£ä¸ªç¥–å…ˆ</span></span><br><span class="line">        &#123;</span><br><span class="line">            Node *parent = _node-&gt;_parent;</span><br><span class="line">            Node *cur = _node;</span><br><span class="line">            <span class="keyword">while</span> (parent &amp;&amp; cur == parent-&gt;_right)</span><br><span class="line">            &#123;</span><br><span class="line">                cur = parent;</span><br><span class="line">                parent = parent-&gt;_parent;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            _node = parent;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    self &amp;<span class="keyword">operator</span>--()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_node-&gt;_left) <span class="comment">// å·¦å­æ ‘ä¸ä¸ºç©ºï¼Œå·¦å­æ ‘çš„æœ€å³å°±æ˜¯ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        &#123;</span><br><span class="line">            Node *right = _node-&gt;_left;</span><br><span class="line">            <span class="keyword">while</span> (right-&gt;_right)</span><br><span class="line">            &#123;</span><br><span class="line">                right = right-&gt;_right;</span><br><span class="line">            &#125;</span><br><span class="line">            _node = right;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="comment">// å·¦å­æ ‘ä¸ºç©ºï¼Œæ‰¾å­©å­ä¸æ˜¯çˆ¶äº²å·¦çš„é‚£ä¸ªç¥–å…ˆ</span></span><br><span class="line">        &#123;</span><br><span class="line">            Node *parent = _node-&gt;_parent;</span><br><span class="line">            Node *cur = _node;</span><br><span class="line">            <span class="keyword">while</span> (parent &amp;&amp; cur == parent-&gt;_left)</span><br><span class="line">            &#123;</span><br><span class="line">                cur = parent;</span><br><span class="line">                parent = parent-&gt;_parent;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            _node = parent;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>!=(<span class="type">const</span> self &amp;s) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> _node != s._node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>==(<span class="type">const</span> self &amp;s) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> _node == s._node;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="mapå°è£…">mapå°è£…</h2><p>mapçš„çº¢é»‘æ ‘ <strong>RBTree&lt;K, pair&lt;K, V&gt;, MapKeyOfT&gt;</strong>ï¼Œç¬¬ä¸€ä¸ªæ¨¡æ¿å‚æ•°æ˜¯keyï¼Œç¬¬äºŒä¸ªæ¨¡æ¿å‚æ•°æ˜¯pair</p><h3 id="ä»£ç -2">ä»£ç </h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">map</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MapKeyOfT</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="type">const</span> K &amp;<span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> pair&lt;K, V&gt; &amp;kv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> kv.first;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">typename</span> RBTree&lt;K, pair&lt;K, V&gt;, MapKeyOfT&gt;::iterator iterator;</span><br><span class="line"></span><br><span class="line"><span class="function">iterator <span class="title">begin</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="type">_t</span>.<span class="built_in">begin</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">iterator <span class="title">end</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="type">_t</span>.<span class="built_in">end</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">pair&lt;iterator, <span class="type">bool</span>&gt; <span class="title">insert</span><span class="params">(<span class="type">const</span> pair&lt;K, V&gt; &amp;kv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="type">_t</span>.<span class="built_in">insert</span>(kv);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">V &amp;<span class="keyword">operator</span>[](<span class="type">const</span> K &amp;key)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="type">_t</span>.<span class="built_in">insert</span>(<span class="built_in">make_pair</span>(key, <span class="built_in">V</span>())).first-&gt;second;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">RBTree&lt;K, pair&lt;K, V&gt;, MapKeyOfT&gt; <span class="type">_t</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="setå°è£…">setå°è£…</h2><p>setçš„çº¢é»‘æ ‘ <strong>RBTree&lt;K, K, SetKeyOfT&gt;</strong>ï¼Œç¬¬ä¸€ä¸ªæ¨¡æ¿å‚æ•°æ˜¯keyï¼Œç¬¬äºŒä¸ªæ¨¡æ¿å‚æ•°æ˜¯pair</p><h3 id="ä»£ç -3">ä»£ç </h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">K</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">set</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SetKeyOfT</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="type">const</span> K &amp;<span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> K &amp;key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> key;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">typename</span> RBTree&lt;K, K, SetKeyOfT&gt;::iterator iterator;</span><br><span class="line"></span><br><span class="line"><span class="function">iterator <span class="title">begin</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="type">_t</span>.<span class="built_in">begin</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">iterator <span class="title">end</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="type">_t</span>.<span class="built_in">end</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">pair&lt;iterator, <span class="type">bool</span>&gt; <span class="title">insert</span><span class="params">(<span class="type">const</span> K &amp;k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="type">_t</span>.<span class="built_in">insert</span>(k);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">RBTree&lt;K, K, SetKeyOfT&gt; <span class="type">_t</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹è¯­è¨€ </category>
          
          <category> CPP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> STL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çº¢é»‘æ ‘</title>
      <link href="/posts/4171019779/"/>
      <url>/posts/4171019779/</url>
      
        <content type="html"><![CDATA[<h2 id="çº¢é»‘æ ‘æ¦‚å¿µ">çº¢é»‘æ ‘æ¦‚å¿µ</h2><blockquote><p>çº¢é»‘æ ‘ï¼Œæ˜¯ä¸€ç§äºŒå‰æœç´¢æ ‘ï¼Œä½†åœ¨æ¯ä¸ªç»“ç‚¹ä¸Šå¢åŠ ä¸€ä¸ªå­˜å‚¨ä½è¡¨ç¤ºç»“ç‚¹çš„é¢œè‰²ï¼Œå¯ä»¥æ˜¯Redæˆ– Blackã€‚ é€šè¿‡å¯¹ä»»ä½•ä¸€æ¡ä»æ ¹åˆ°å¶å­çš„è·¯å¾„ä¸Šå„ä¸ªç»“ç‚¹ç€è‰²æ–¹å¼çš„é™åˆ¶ï¼Œçº¢é»‘æ ‘ç¡®ä¿æ²¡æœ‰ä¸€æ¡è·¯å¾„ä¼šæ¯”å…¶ä»–è·¯å¾„é•¿å‡ºä¿©å€ï¼Œå› è€Œæ˜¯æ¥è¿‘å¹³è¡¡çš„ã€‚</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212141540682.png" alt=""></p><h2 id="çº¢é»‘æ ‘çš„æ€§è´¨">çº¢é»‘æ ‘çš„æ€§è´¨</h2><ol><li>æ¯ä¸ªç»“ç‚¹ä¸æ˜¯çº¢è‰²å°±æ˜¯é»‘è‰²</li><li>æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²çš„</li><li>å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œåˆ™å®ƒçš„ä¸¤ä¸ªå­©å­ç»“ç‚¹æ˜¯é»‘è‰²çš„ï¼Œ<strong>æ ‘ä¸­æ²¡æœ‰è¿ç»­çš„çº¢èŠ‚ç‚¹</strong></li><li>å¯¹äºæ¯ä¸ªç»“ç‚¹ï¼Œä»è¯¥ç»“ç‚¹åˆ°å…¶æ‰€æœ‰åä»£å¶ç»“ç‚¹çš„ç®€å•è·¯å¾„ä¸Šï¼Œå‡åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²ç»“ç‚¹</li><li>æ¯ä¸ªå¶å­ç»“ç‚¹éƒ½æ˜¯é»‘è‰²çš„(æ­¤å¤„çš„å¶å­ç»“ç‚¹æŒ‡çš„æ˜¯ç©ºç»“ç‚¹)</li></ol><p>ä¸ºä»€ä¹ˆæ»¡è¶³ä¸Šé¢çš„æ€§è´¨ï¼Œçº¢é»‘æ ‘å°±èƒ½ä¿è¯ï¼šå…¶æœ€é•¿è·¯å¾„ä¸­èŠ‚ç‚¹ä¸ªæ•°ä¸ä¼šè¶…è¿‡æœ€çŸ­è·¯å¾„ä¸­èŠ‚ç‚¹ä¸ªæ•°çš„ä¸¤å€ï¼Ÿ</p><p>æé™æœ€çŸ­ï¼šå…¨é»‘<br>æé™æœ€é•¿ï¼šä¸€é»‘ä¸€çº¢</p><h2 id="çº¢é»‘æ ‘ç»“æ„">çº¢é»‘æ ‘ç»“æ„</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Color</span></span><br><span class="line">&#123;</span><br><span class="line">    RED,</span><br><span class="line">    BLACK</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">RBTreeNode</span></span><br><span class="line">&#123;</span><br><span class="line">    RBTreeNode&lt;K, V&gt; *_parent;</span><br><span class="line">    RBTreeNode&lt;K, V&gt; *_left;</span><br><span class="line">    RBTreeNode&lt;K, V&gt; *_right;</span><br><span class="line">    pair&lt;K, V&gt; _kv;</span><br><span class="line">    Color _col;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">RBTreeNode</span>(<span class="type">const</span> pair&lt;K, V&gt; &amp;kv)</span><br><span class="line">        : _parent(<span class="literal">nullptr</span>), _left(<span class="literal">nullptr</span>), _right(<span class="literal">nullptr</span>), _kv(kv), _col(RED)</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RBTree</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">typedef</span> RBTreeNode&lt;K, V&gt; Node;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">insert</span><span class="params">(<span class="type">const</span> pair&lt;K, V&gt; &amp;kv)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Node *_root = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="çº¢é»‘æ ‘æ“ä½œ">çº¢é»‘æ ‘æ“ä½œ</h2><h3 id="æ’å…¥">æ’å…¥</h3><blockquote><p>çº¢é»‘æ ‘çš„å”å”æ˜¯å…³é”®<br>uå­˜åœ¨ä¸”ä¸ºçº¢ï¼Œå˜è‰²ç»§ç»­å‘ä¸Šå¤„ç†<br>uä¸å­˜åœ¨æˆ–å­˜åœ¨ä¸”ä¸ºé»‘ï¼Œæ—‹è½¬ï¼ˆå•æ—‹+åŒæ—‹ï¼‰+å˜è‰²</p></blockquote><p>æƒ…å†µä¸€ï¼š<strong>curä¸ºçº¢ï¼Œparentä¸ºçº¢ï¼Œgrandfatherä¸ºé»‘</strong>ï¼ˆå›ºå®šï¼‰ï¼Œuncleå­˜åœ¨ä¸”ä¸ºçº¢</p><p>å¤„ç†ï¼špã€uå˜é»‘ï¼Œgå˜çº¢ï¼Œç»§ç»­æŠŠgå½“æˆcur</p><ul><li>gä¸æ˜¯æ ¹ï¼Œå¾€ä¸Šç»§ç»­å¤„ç†</li><li>gæ˜¯æ ¹ï¼Œå†æŠŠgå˜æˆé»‘è‰²</li></ul><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212181030394.png" alt=""></p><p>æƒ…å†µäºŒï¼š<strong>curä¸ºçº¢ï¼Œparentä¸ºçº¢ï¼Œgrandfatherä¸ºé»‘</strong>ï¼ˆå›ºå®šï¼‰ï¼Œuä¸å­˜åœ¨/uå­˜åœ¨ä¸”ä¸ºé»‘ï¼ˆ<strong>å•æ—‹+å˜è‰²</strong>ï¼‰</p><p>å¤„ç†ï¼š</p><ul><li>gå³å•æ—‹</li><li>på˜é»‘ï¼Œgå˜çº¢</li></ul><p>è¯´æ˜ï¼šuncleçš„æƒ…å†µæœ‰ä¸¤ç§</p><ul><li>å¦‚æœuèŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆcurä¸€å®šæ˜¯æ–°æ’å…¥èŠ‚ç‚¹ï¼Œå› ä¸ºå¦‚æœcurä¸æ˜¯æ–°æ’å…¥èŠ‚ç‚¹ï¼Œåˆ™curå’Œpä¸€å®šæœ‰ä¸ªèŠ‚ç‚¹é¢œè‰²æ˜¯é»‘è‰²ï¼Œå°±ä¸æ»¡è¶³æ€§è´¨4ï¼šæ¯æ¡è·¯å¾„é»‘è‰²èŠ‚ç‚¹çš„ä¸ªæ•°ç›¸åŒã€‚</li><li>å¦‚æœuèŠ‚ç‚¹å­˜åœ¨ï¼Œé‚£ä¹ˆcurèŠ‚ç‚¹åŸæ¥çš„é¢œè‰²ä¸€å®šæ˜¯é»‘è‰²çš„ï¼ˆä¿è¯æ€§è´¨4ï¼‰ï¼Œç°åœ¨çœ‹åˆ°å…¶æ˜¯çº¢è‰²çš„åŸå› æ˜¯å› ä¸ºcurçš„å­æ ‘åœ¨è°ƒæ•´çš„è¿‡ç¨‹ä¸­å°†curèŠ‚ç‚¹çš„é¢œè‰²ç”±é»‘è‰²æ”¹ä¸ºçº¢è‰²ã€‚</li></ul><p>uä¸å­˜åœ¨</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212181055273.png" alt=""></p><p>uå­˜åœ¨ä¸”ä¸ºé»‘</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212181342714.png" alt=""></p><p>æƒ…å†µä¸‰ï¼š<strong>curä¸ºçº¢ï¼Œparentä¸ºçº¢ï¼Œgrandfatherä¸ºé»‘</strong>ï¼ˆå›ºå®šï¼‰ï¼Œuä¸å­˜åœ¨/uå­˜åœ¨ä¸”ä¸ºé»‘ï¼ˆ<strong>åŒæ—‹+å˜è‰²</strong>ï¼‰</p><p>uä¸å­˜åœ¨</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212181111798.png" alt=""></p><p>uå­˜åœ¨ä¸”ä¸ºé»‘</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212181446123.png" alt=""></p><p>æ’å…¥ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">insert</span><span class="params">(<span class="type">const</span> pair&lt;K, V&gt; &amp;kv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (_root == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">_root = <span class="keyword">new</span> <span class="built_in">Node</span>(kv);</span><br><span class="line">_root-&gt;_col = BLACK;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Node *parent = <span class="literal">nullptr</span>;</span><br><span class="line">Node *cur = _root;</span><br><span class="line"><span class="keyword">while</span> (cur)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (cur-&gt;_kv.first &lt; kv.first)</span><br><span class="line">&#123;</span><br><span class="line">parent = cur;</span><br><span class="line">cur = cur-&gt;_right;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (cur-&gt;_kv.first &gt; kv.first)</span><br><span class="line">&#123;</span><br><span class="line">parent = cur;</span><br><span class="line">cur = cur-&gt;_left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cur = <span class="keyword">new</span> <span class="built_in">Node</span>(kv);</span><br><span class="line"><span class="comment">// è¿˜å¾—é“¾æ¥ä¸Š</span></span><br><span class="line"><span class="keyword">if</span> (parent-&gt;_kv.first &lt; kv.first)</span><br><span class="line">&#123;</span><br><span class="line">parent-&gt;_right = cur;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">parent-&gt;_left = cur;</span><br><span class="line">&#125;</span><br><span class="line">cur-&gt;_parent = parent;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰¾åˆ°äº†åº”è¯¥æ’å…¥çš„ä½ç½®</span></span><br><span class="line"><span class="keyword">while</span> (parent &amp;&amp; parent-&gt;_col == RED) <span class="comment">// parentä¸ä¸ºç©ºå¹¶ä¸”é¢œè‰²ä¸ºçº¢ç»§ç»­å¤„ç†</span></span><br><span class="line">&#123;</span><br><span class="line">Node *grandfather = parent-&gt;_parent;</span><br><span class="line"><span class="comment">// å¦‚æœçˆ¶äº²å­˜åœ¨ä¸”é¢œè‰²ä¸ºçº¢ï¼Œé‚£ä¹ˆç¥–çˆ¶ä¸€å®šå­˜åœ¨é¢œè‰²ä¸ºé»‘</span></span><br><span class="line"><span class="built_in">assert</span>(grandfather);</span><br><span class="line"><span class="built_in">assert</span>(grandfather-&gt;_col = BLACK);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…ˆçœ‹parentæ˜¯grandfatherçš„å·¦è¿˜æ˜¯å³</span></span><br><span class="line"><span class="keyword">if</span> (parent == grandfather-&gt;_left)</span><br><span class="line">&#123;</span><br><span class="line">Node *uncle = grandfather-&gt;_right;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æƒ…å†µ1ã€å”å”å­˜åœ¨ä¸”ä¸ºçº¢ï¼Œå˜è‰²ç»§ç»­å‘ä¸Šå¤„ç†</span></span><br><span class="line"><span class="keyword">if</span> (uncle &amp;&amp; uncle-&gt;_col == RED)</span><br><span class="line">&#123;</span><br><span class="line">parent-&gt;_col = uncle-&gt;_col = BLACK;</span><br><span class="line">grandfather-&gt;_col = RED;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»§ç»­å‘ä¸Šå¤„ç†</span></span><br><span class="line">cur = grandfather;</span><br><span class="line">parent = cur-&gt;_parent;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="comment">// æƒ…å†µ2ã€3ï¼šuncleä¸å­˜åœ¨  å­˜åœ¨ä¸”ä¸ºé»‘</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// åˆ†ä¸¤ç§</span></span><br><span class="line"><span class="comment">// 1ã€å³å•æ—‹+å˜è‰²</span></span><br><span class="line"><span class="comment">//     g</span></span><br><span class="line"><span class="comment">//   p   u</span></span><br><span class="line"><span class="comment">// c</span></span><br><span class="line"><span class="keyword">if</span> (cur == parent-&gt;_left)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">RotateR</span>(grandfather);</span><br><span class="line">parent-&gt;_col = BLACK;</span><br><span class="line">grandfather-&gt;_col = RED;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// å…ˆå¯¹p å·¦å•æ—‹ï¼Œå†å¯¹g å³å•æ—‹ï¼Œæœ€åå˜è‰²</span></span><br><span class="line"><span class="comment">//     g</span></span><br><span class="line"><span class="comment">//   p   u</span></span><br><span class="line"><span class="comment">//     c</span></span><br><span class="line"><span class="built_in">RotateL</span>(parent);</span><br><span class="line"><span class="built_in">RotateR</span>(grandfather);</span><br><span class="line">cur-&gt;_col = BLACK;</span><br><span class="line">grandfather-&gt;_col = RED;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="comment">// parent=grand-&gt;right</span></span><br><span class="line">&#123;</span><br><span class="line">Node *grandfather = parent-&gt;_parent;</span><br><span class="line"><span class="comment">// å¦‚æœçˆ¶äº²å­˜åœ¨ä¸”é¢œè‰²ä¸ºçº¢ï¼Œé‚£ä¹ˆç¥–çˆ¶ä¸€å®šå­˜åœ¨é¢œè‰²ä¸ºé»‘</span></span><br><span class="line"><span class="built_in">assert</span>(grandfather);</span><br><span class="line"><span class="built_in">assert</span>(grandfather-&gt;_col = BLACK);</span><br><span class="line"></span><br><span class="line">Node *uncle = grandfather-&gt;_left;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æƒ…å†µ1ã€å”å”å­˜åœ¨ä¸”ä¸ºçº¢ï¼Œå˜è‰²ç»§ç»­å‘ä¸Šå¤„ç†</span></span><br><span class="line"><span class="keyword">if</span> (uncle &amp;&amp; uncle-&gt;_col == RED)</span><br><span class="line">&#123;</span><br><span class="line">parent-&gt;_col = uncle-&gt;_col = BLACK;</span><br><span class="line">grandfather-&gt;_col = RED;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»§ç»­å‘ä¸Šå¤„ç†</span></span><br><span class="line">cur = grandfather;</span><br><span class="line">parent = cur-&gt;_parent;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="comment">// æƒ…å†µ2ã€3ï¼šuncleä¸å­˜åœ¨  å­˜åœ¨ä¸”ä¸ºé»‘</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// åˆ†ä¸¤ç§</span></span><br><span class="line"><span class="comment">//     g</span></span><br><span class="line"><span class="comment">//   u   p</span></span><br><span class="line"><span class="comment">//         c</span></span><br><span class="line"><span class="keyword">if</span> (cur == parent-&gt;_right)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">RotateL</span>(grandfather);</span><br><span class="line">parent-&gt;_col = BLACK;</span><br><span class="line">grandfather-&gt;_col = RED;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//     g</span></span><br><span class="line"><span class="comment">//   u   p</span></span><br><span class="line"><span class="comment">//     c</span></span><br><span class="line"><span class="built_in">RotateR</span>(parent);</span><br><span class="line"><span class="built_in">RotateL</span>(grandfather);</span><br><span class="line">cur-&gt;_col = BLACK;</span><br><span class="line">grandfather-&gt;_col = RED;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">_root-&gt;_col = BLACK;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ£€æŸ¥">æ£€æŸ¥</h3><ul><li>æ ¹æ˜¯é»‘è‰²</li><li>æ²¡æœ‰è¿ç»­çš„çº¢èŠ‚ç‚¹</li><li>æ¯æ¡è·¯å¾„çš„é»‘è‰²èŠ‚ç‚¹æ•°é‡ç›¸åŒ</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">is_balance</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (_root == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (_root-&gt;_col == RED)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;æ ¹èŠ‚ç‚¹ä¸æ˜¯é»‘è‰²&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> bench_mark = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">prev_check</span>(_root, <span class="number">0</span>, bench_mark);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">prev_check</span><span class="params">(Node *root, <span class="type">int</span> bnum, <span class="type">int</span> &amp;bench_mark)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (root == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (bench_mark == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">bench_mark = bnum;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (bench_mark != bnum)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;æŸæ¡é»‘è‰²èŠ‚ç‚¹çš„æ•°é‡ä¸ç›¸ç­‰&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (root-&gt;_col == BLACK)</span><br><span class="line">&#123;</span><br><span class="line">++bnum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (root-&gt;_col == RED &amp;&amp; root-&gt;_parent-&gt;_col == RED)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;å­˜åœ¨è¿ç»­çš„çº¢è‰²èŠ‚ç‚¹&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">prev_check</span>(root-&gt;_left, bnum, bench_mark) &amp;&amp; <span class="built_in">prev_check</span>(root-&gt;_right, bnum, bench_mark);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é«˜é˜¶æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœç´¢æ ‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AVLæ ‘</title>
      <link href="/posts/2536969901/"/>
      <url>/posts/2536969901/</url>
      
        <content type="html"><![CDATA[<h2 id="AVLæ¦‚å¿µ">AVLæ¦‚å¿µ</h2><blockquote><p>å½“å‘äºŒå‰æœç´¢æ ‘ä¸­æ’å…¥æ–°ç»“ç‚¹åï¼Œå¦‚æœèƒ½ä¿è¯æ¯ä¸ªç»“ç‚¹çš„å·¦å³å­æ ‘é«˜åº¦ä¹‹å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡1(éœ€è¦å¯¹æ ‘ä¸­çš„ç»“ç‚¹è¿›è¡Œè°ƒæ•´)ï¼Œå³å¯é™ä½æ ‘çš„é«˜åº¦ï¼Œä»è€Œå‡å°‘å¹³å‡æœç´¢é•¿åº¦ã€‚</p></blockquote><p>ä¸€æ£µAVLæ ‘æˆ–è€…æ˜¯ç©ºæ ‘ï¼Œæˆ–è€…æ˜¯å…·æœ‰ä»¥ä¸‹æ€§è´¨çš„äºŒå‰æœç´¢æ ‘ï¼š</p><ul><li>å®ƒçš„å·¦å³å­æ ‘éƒ½æ˜¯AVLæ ‘</li><li>å·¦å³å­æ ‘é«˜åº¦ä¹‹å·®(ç®€ç§°å¹³è¡¡å› å­)çš„ç»å¯¹å€¼ä¸è¶…è¿‡1(-1/0/1)</li></ul><p>å¦‚æœä¸€æ£µäºŒå‰æœç´¢æ ‘æ˜¯é«˜åº¦å¹³è¡¡çš„ï¼Œå®ƒå°±æ˜¯AVLæ ‘ã€‚å¦‚æœå®ƒæœ‰nä¸ªç»“ç‚¹ï¼Œå…¶é«˜åº¦å¯ä¿æŒåœ¨<br><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(log_2 n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>ï¼Œæœç´¢æ—¶é—´å¤æ‚åº¦O(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mi>n</mi></mrow><annotation encoding="application/x-tex">log_2 n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">n</span></span></span></span>)</p><h2 id="AVLæ“ä½œ">AVLæ“ä½œ</h2><h3 id="æ’å…¥">æ’å…¥</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">insert</span><span class="params">(<span class="type">const</span> pair&lt;K, V&gt; &amp;kv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (_root == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">_root = <span class="keyword">new</span> <span class="built_in">Node</span>(kv);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Node *parent = <span class="literal">nullptr</span>;</span><br><span class="line">Node *cur = _root;</span><br><span class="line"><span class="keyword">while</span> (cur)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// æ’å…¥å…ˆæ‰¾ä½ç½®</span></span><br><span class="line"><span class="keyword">if</span> (cur-&gt;_kv.first &gt; kv.first)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// å…ˆè®°å½•parent</span></span><br><span class="line">parent = cur;</span><br><span class="line"><span class="comment">// æ’å…¥çš„æ¯”å½“å‰å€¼å°ï¼Œå¾€å·¦è¾¹èµ°</span></span><br><span class="line">cur = cur-&gt;_left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (cur-&gt;_kv.first &lt; kv.first)</span><br><span class="line">&#123;</span><br><span class="line">parent = cur;</span><br><span class="line"><span class="comment">// æ’å…¥å€¼æ¯”å·¦è¾¹å¤§ï¼Œå¾€å³è¾¹èµ°</span></span><br><span class="line">cur = cur-&gt;_right;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// ç›¸ç­‰çš„ä½ç½®</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// èµ°åˆ°è¿™é‡Œcurä¸ºç©ºï¼Œè¯´æ˜ï¼Œæ‰¾åˆ°äº†è¯¥æ’å…¥çš„ä½ç½®</span></span><br><span class="line">cur = <span class="keyword">new</span> <span class="built_in">Node</span>(kv);</span><br><span class="line"><span class="comment">// é“¾æ¥</span></span><br><span class="line"><span class="keyword">if</span> (parent-&gt;_kv.first &gt; kv.first)</span><br><span class="line">&#123;</span><br><span class="line">parent-&gt;_left = cur;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">parent-&gt;_right = cur;</span><br><span class="line">&#125;</span><br><span class="line">cur-&gt;_parent = parent;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ’å…¥æˆåŠŸã€‚ç°åœ¨éœ€è¦æ§åˆ¶å¹³è¡¡ï¼Œæ›´æ–°å¹³è¡¡å› å­</span></span><br><span class="line"><span class="comment">// å‘ä¸Šæ›´æ–°ç›´åˆ°parentä¸ºç©º</span></span><br><span class="line"><span class="keyword">while</span> (parent)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (parent-&gt;_left == cur)</span><br><span class="line">&#123;</span><br><span class="line">parent-&gt;_bf--;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">parent-&gt;_bf++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (parent-&gt;_bf == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// else if(parent-&gt;_bf==1 || parent-&gt;_bf==-1)</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">abs</span>(parent-&gt;_bf) == <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// cur = parent;</span></span><br><span class="line"><span class="comment">// parent = parent-&gt;_parent;</span></span><br><span class="line">parent = parent-&gt;_parent;</span><br><span class="line">cur = cur-&gt;_parent;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">abs</span>(parent-&gt;_bf) == <span class="number">2</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (parent-&gt;_bf == <span class="number">2</span> &amp;&amp; cur-&gt;_bf == <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// å·¦å•æ—‹</span></span><br><span class="line"><span class="built_in">RotateL</span>(parent);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (parent-&gt;_bf == <span class="number">-2</span> &amp;&amp; cur-&gt;_bf == <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// å³å•æ—‹</span></span><br><span class="line"><span class="built_in">RotateR</span>(parent);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (parent-&gt;_bf == <span class="number">2</span> &amp;&amp; cur-&gt;_bf == <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// å³å·¦æ—‹</span></span><br><span class="line"><span class="built_in">RotateRL</span>(parent);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (parent-&gt;_bf == <span class="number">-2</span> &amp;&amp; cur-&gt;_bf == <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// å·¦å³æ—‹</span></span><br><span class="line"><span class="built_in">RotateLR</span>(parent);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">assert</span>(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒæ•´å®Œæˆä¹‹åbreak;</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">assert</span>(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ¤æ–­å¹³è¡¡">åˆ¤æ–­å¹³è¡¡</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">is_balance</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> _is_balance(_root);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">get_height</span><span class="params">(Node *root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (root == <span class="literal">nullptr</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> left = <span class="built_in">get_height</span>(root-&gt;_left);</span><br><span class="line"><span class="type">int</span> right = <span class="built_in">get_height</span>(root-&gt;_right);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">max</span>(left, right) + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> _is_balance(Node *root)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (root == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> left = <span class="built_in">get_height</span>(root-&gt;_left);</span><br><span class="line"><span class="type">int</span> right = <span class="built_in">get_height</span>(root-&gt;_right);</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> diff = right-left;</span><br><span class="line"><span class="keyword">if</span> (diff != root-&gt;_bf)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; root-&gt;_kv.first &lt;&lt; <span class="string">&quot; å¹³è¡¡å› å­å¼‚å¸¸&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">abs</span>(diff) &lt; <span class="number">2</span> &amp;&amp; _is_balance(root-&gt;_left) &amp;&amp; _is_balance(root-&gt;_right);</span><br><span class="line"><span class="comment">// if(abs(left-right)&gt;=2)</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     return false;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å¹³è¡¡å› å­æ›´æ–°">å¹³è¡¡å› å­æ›´æ–°</h2><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212131300912.png" alt=""></p><p>æ›´æ–°å¹³è¡¡å› å­çš„è§„åˆ™</p><ul><li>æ–°å¢åœ¨å³ï¼Œparent-&gt;bf++ï¼Œæ–°å¢åœ¨å·¦ï¼Œparent-&gt;bfâ€“</li><li>æ›´æ–°åï¼Œparent-&gt;bf  == 1 or -1, è¯´æ˜parentæ’å…¥å‰çš„å¹³è¡¡å› å­æ˜¯0ï¼Œè¯´æ˜å·¦å³å­æ ‘é«˜åº¦ç›¸ç­‰ï¼Œæ’å…¥åæœ‰ä¸€è¾¹é«˜ï¼Œparenté«˜åº¦å˜äº†ï¼Œéœ€è¦ç»§ç»­å¾€ä¸Šæ›´æ–°</li><li>æ›´æ–°åï¼Œparent-&gt;bf == 0ï¼Œè¯´æ˜parentæ’å…¥å‰çš„å¹³è¡¡å› å­æ˜¯1 or -1ï¼Œ è¯´æ˜å·¦å³å­æ ‘ä¸€è¾¹é«˜ä¸€è¾¹ä½ï¼Œæ’å…¥åä¸¤è¾¹ä¸€æ ·é«˜ï¼Œæ’å…¥å¡«ä¸Šäº†çŸ®çš„é‚£è¾¹ï¼Œparentæ‰€åœ¨å­æ ‘é«˜åº¦ä¸å˜ï¼Œä¸éœ€è¦å¾€ä¸Šæ›´æ–°</li><li>æ›´æ–°åï¼Œparent-&gt;bf == 2 or -2 ï¼Œè¯´æ˜parentæ’å…¥å‰çš„å¹³è¡¡å› å­æ˜¯1 or -1ï¼Œå·²ç»å¹³è¡¡ä¸´ç•Œå€¼ï¼Œæ’å…¥åå˜æˆ2 or -2ï¼Œæ‰“ç ´å¹³è¡¡ï¼Œparentæ‰€åœ¨å­æ ‘éœ€è¦æ—‹è½¬å¤„ç†</li><li>æ›´æ–°åï¼Œparent-&gt;bf &gt;2 or &lt; -2ï¼Œä¸å¯èƒ½ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è¯´æ˜æ’å…¥å‰å°±ä¸æ˜¯AVLæ ‘ï¼Œéœ€è¦å»æ£€æŸ¥ä¹‹å‰æ“ä½œçš„é—®é¢˜</li></ul><h2 id="æ—‹è½¬çš„åœºæ™¯">æ—‹è½¬çš„åœºæ™¯</h2><p>æ—‹è½¬çš„ä»·å€¼å’Œæ„ä¹‰ï¼š</p><ul><li>å¹³è¡¡</li><li>é™ä½é«˜åº¦ï¼ˆé«˜åº¦æ¢å¤åˆ°æ’å…¥ä¹‹å‰çš„æ ·å­ï¼‰</li></ul><h3 id="å·¦å•æ—‹">å·¦å•æ—‹</h3><h4 id="æƒ…æ™¯åˆ†æ">æƒ…æ™¯åˆ†æ</h4><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212131542366.png" alt=""></p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212131543737.png" alt=""></p><p>å…·ä½“è¿›è¡Œå·¦æ—‹çš„æ—¶å€™ä¹Ÿè¦åˆ†ä¸¤ç§æƒ…å†µ</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212131544284.png" alt=""></p><p>è°ƒæ•´å®Œæˆä¹‹åï¼Œparentçš„å¹³è¡¡å› å­å˜ä¸º0ï¼ŒsubRå˜ä¸ºæ–°çš„æ ¹ï¼ŒåŒæ—¶å¹³è¡¡å› å­ä¹Ÿå˜ä¸º0</p><h4 id="ä»£ç ">ä»£ç </h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å·¦å•æ—‹</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">RotateL</span><span class="params">(Node* parent)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//å³è¾¹é«˜</span></span><br><span class="line">Node *subR = parent-&gt;_right;</span><br><span class="line">Node *subRL = subR-&gt;_left;</span><br><span class="line"></span><br><span class="line">parent-&gt;_right = subRL;</span><br><span class="line"><span class="keyword">if</span>(subRL)</span><br><span class="line">&#123;</span><br><span class="line">subRL-&gt;_parent = parent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Node *ppNode = parent-&gt;_parent;</span><br><span class="line">subR-&gt;_left = parent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(parent==_root)</span><br><span class="line">&#123;</span><br><span class="line">_root = subR;</span><br><span class="line">subR-&gt;_parent = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(ppNode-&gt;_left=parent)</span><br><span class="line">&#123;</span><br><span class="line">ppNode-&gt;_left = subR;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">ppNode-&gt;_right = subR;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">subR-&gt;_parent = ppNode;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å³å•æ—‹">å³å•æ—‹</h3><h4 id="æƒ…æ™¯åˆ†æâ€˜">æƒ…æ™¯åˆ†æâ€˜</h4><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212131547708.png" alt=""></p><h4 id="ä»£ç -2">ä»£ç </h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">//å³å•æ—‹</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">RotateR</span><span class="params">(Node* parent)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//å·¦è¾¹é«˜</span></span><br><span class="line">Node* subL = parent-&gt;_left;</span><br><span class="line">Node *subLR = subL-&gt;_right;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å…ˆè®°å½•ä¸€äº›parentçš„çˆ¶äº²</span></span><br><span class="line">Node *ppNode = parent-&gt;_parent;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è®©subLçš„å³ç»™parentçš„å·¦ï¼Œç„¶åparentåšsubLçš„å³ï¼ŒsubLåšæ–°çš„æ ¹</span></span><br><span class="line">parent-&gt;_left = subLR;</span><br><span class="line"><span class="comment">// æ³¨æ„ è¦åˆ¤æ–­subLRæ˜¯ä¸æ˜¯ç©º</span></span><br><span class="line"><span class="keyword">if</span>(subLR)</span><br><span class="line">&#123;</span><br><span class="line">subLR-&gt;_parent = parent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">subL-&gt;_right = parent;</span><br><span class="line">parent-&gt;_parent = subL;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™é‡Œä¹Ÿæ³¨æ„,</span></span><br><span class="line"><span class="keyword">if</span>(_root==parent)</span><br><span class="line">&#123;</span><br><span class="line">_root = subL;</span><br><span class="line">subL-&gt;_parent = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (ppNode-&gt;_left == parent)</span><br><span class="line">&#123;</span><br><span class="line">ppNode-&gt;_left = subL;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">ppNode-&gt;_right = subL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç„¶åè®©suLçš„parentæŒ‡å‘ppNode</span></span><br><span class="line">subL-&gt;_parent = ppNode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">subL-&gt;_bf = <span class="number">0</span>;</span><br><span class="line">parent-&gt;_bf = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å·¦å³æ—‹">å·¦å³æ—‹</h3><h4 id="æƒ…æ™¯åˆ†æ-2">æƒ…æ™¯åˆ†æ</h4><p>ä¸‰ç§æƒ…å†µï¼š</p><p>1ã€åœ¨bæ–°å¢ï¼Œé‚£ä¹ˆ60èŠ‚ç‚¹çš„å¹³è¡¡å› å­æ˜¯-1<br>2ã€åœ¨cæ–°å¢ï¼Œé‚£ä¹ˆ60èŠ‚ç‚¹çš„å¹³è¡¡å› å­æ˜¯1</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212131548304.png" alt=""></p><p>3ã€subLRå°±æ˜¯æ–°å¢</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212131609243.png" alt=""></p><h4 id="ä»£ç -3">ä»£ç </h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å·¦å³æ—‹</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">RotateLR</span><span class="params">(Node *parent)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Node *subL = parent-&gt;_left;</span><br><span class="line">Node *subLR = subL-&gt;_right;</span><br><span class="line"><span class="type">int</span> bf = subLR-&gt;_bf;</span><br><span class="line"></span><br><span class="line"><span class="built_in">RotateL</span>(parent-&gt;_left);</span><br><span class="line"><span class="built_in">RotateR</span>(parent);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨æ„ï¼ŒsubLRå˜æˆæ–°çš„æ ¹</span></span><br><span class="line">subLR-&gt;_bf = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (bf == <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// åœ¨bæ’å…¥</span></span><br><span class="line">parent-&gt;_bf = <span class="number">1</span>;</span><br><span class="line">subL-&gt;_bf = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (bf == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// subLRå°±æ˜¯æ–°å¢</span></span><br><span class="line">parent-&gt;_bf = <span class="number">0</span>;</span><br><span class="line">subL-&gt;_bf = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (bf == <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// åœ¨cæ’å…¥</span></span><br><span class="line">parent-&gt;_bf = <span class="number">0</span>;</span><br><span class="line">subL-&gt;_bf = <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">assert</span>(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å³å·¦æ—‹">å³å·¦æ—‹</h3><h4 id="æƒ…æ™¯åˆ†æ-3">æƒ…æ™¯åˆ†æ</h4><p>1ã€æ–°å¢åœ¨bï¼Œé‚£ä¹ˆsubRLå¹³è¡¡å› å­å˜æˆ-1ï¼Œå…ˆå¯¹subRè¿›è¡Œå³æ—‹ï¼Œç„¶åå†å¯¹parentè¿›è¡Œå·¦æ—‹ï¼Œè°ƒæ•´å®Œæˆä¹‹åï¼ŒsubRLä¹Ÿå°±æ˜¯70èŠ‚ç‚¹å˜æˆäº†æ ¹ï¼Œå¹³è¡¡å› å­ä¸º0ï¼Œparentçš„å¹³è¡¡å› å­ä¸º0ï¼ŒsubRå°±æ˜¯90çš„å¹³è¡¡å› å­å˜æˆ1.</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212132009280.png" alt=""></p><p>2ã€æ–°å¢åœ¨cï¼Œé‚£ä¹ˆsubRLå¹³è¡¡å› å­å˜æˆ1ï¼Œå…ˆå¯¹subRè¿›è¡Œå³æ—‹ï¼Œç„¶åå†å¯¹parentè¿›è¡Œå·¦æ—‹ï¼Œè°ƒæ•´å®Œæˆä¹‹åï¼ŒsubRLä¹Ÿå°±æ˜¯70èŠ‚ç‚¹å˜æˆäº†æ ¹ï¼Œå¹³è¡¡å› å­ä¸º0ï¼Œparentçš„å¹³è¡¡å› å­ä¸º-1ï¼ŒsubRå°±æ˜¯90çš„å¹³è¡¡å› å­å˜æˆ0ã€‚</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212131937234.png" alt=""></p><p>3ã€æ–°å¢å°±æ˜¯subRLï¼ŒsubRLå¹³è¡¡å› å­ä¸º0ï¼Œè°ƒæ•´å®Œæˆåéƒ½æ˜¯0</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212131937964.png" alt=""></p><h4 id="ä»£ç -4">ä»£ç </h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å³å·¦æ—‹</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">RotateRL</span><span class="params">(Node *parent)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Node *subR = parent-&gt;_right;</span><br><span class="line">Node *subRL = subR-&gt;_left;</span><br><span class="line"><span class="type">int</span> bf = subRL-&gt;_bf;</span><br><span class="line"></span><br><span class="line"><span class="built_in">RotateR</span>(subR);</span><br><span class="line"><span class="built_in">RotateL</span>(parent);</span><br><span class="line"></span><br><span class="line">subRL-&gt;_bf = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­subRLçš„å¹³è¡¡å› å­æ˜¯å¤šå°‘</span></span><br><span class="line"><span class="keyword">if</span> (bf == <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line">subR-&gt;_bf = <span class="number">1</span>;</span><br><span class="line">parent-&gt;_bf = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (bf == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">parent-&gt;_bf = <span class="number">0</span>;</span><br><span class="line">subR-&gt;_bf = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (bf == <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">parent-&gt;_bf = <span class="number">-1</span>;</span><br><span class="line">subR-&gt;_bf = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">assert</span>(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é«˜é˜¶æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœç´¢æ ‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>606. æ ¹æ®äºŒå‰æ ‘åˆ›å»ºå­—ç¬¦ä¸²</title>
      <link href="/posts/1853189792/"/>
      <url>/posts/1853189792/</url>
      
        <content type="html"><![CDATA[<p><a href="https://leetcode.cn/problems/construct-string-from-binary-tree/">606. æ ¹æ®äºŒå‰æ ‘åˆ›å»ºå­—ç¬¦ä¸²</a></p><h2 id="æˆ‘çš„é”™è¯¯æ€è·¯">æˆ‘çš„é”™è¯¯æ€è·¯</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode() : val(0), left(nullptr), right(nullptr) &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(nullptr), right(nullptr) &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x, TreeNode *left, TreeNode *right) : val(x), left(left), right(right) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">tree2str</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        string str;</span><br><span class="line">        <span class="built_in">fun</span>(root, str);</span><br><span class="line">        <span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">(TreeNode* root, string &amp;s)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">nullptr</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// s+=&#x27;)&#x27;;</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        s+=(root-&gt;val+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(root-&gt;left==<span class="literal">nullptr</span>&amp;&amp;root-&gt;right)</span><br><span class="line">        &#123;</span><br><span class="line">            s+=<span class="string">&quot;()&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(root-&gt;left==<span class="literal">nullptr</span>&amp;&amp;root-&gt;right==<span class="literal">nullptr</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            s+=<span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            s+=<span class="string">&#x27;(&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">fun</span>(root-&gt;left, s);</span><br><span class="line">        <span class="keyword">if</span>(root-&gt;left&amp;&amp;root-&gt;right)</span><br><span class="line">        &#123;</span><br><span class="line">            s+=<span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">            s+=<span class="string">&#x27;(&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(root-&gt;left==<span class="literal">nullptr</span>&amp;&amp;root-&gt;right)</span><br><span class="line">        &#123;</span><br><span class="line">            s+=<span class="string">&#x27;(&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(root-&gt;left&amp;&amp;root-&gt;right==<span class="literal">nullptr</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            s+=<span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">fun</span>(root-&gt;right,s);</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="æ­£ç¡®æ€è·¯">æ­£ç¡®æ€è·¯</h2><p>è¿˜æ˜¯å‰åºéå†ï¼Œæ ¹ã€å·¦ã€å³<br>ä½†æ˜¯è¦æ±‚å°†å·¦å­æ ‘å’Œå³å­æ ‘æ‹¬èµ·æ¥<br>å¦‚æœä¸å…ˆè€ƒè™‘å»æ‹¬å·çš„è¯</p><ul><li>å…ˆåŠ å½“å‰èŠ‚ç‚¹çš„å€¼</li><li>åŠ  (</li><li>é€’å½’å¤„ç†å·¦å­æ ‘</li><li>åŠ  ï¼‰</li><li>åŠ  (</li><li>é€’å½’å¤„ç†å³å­æ ‘</li><li>åŠ  )</li></ul><p>è€ƒè™‘å»æ‹¬å·</p><ul><li>å·¦å³å­æ ‘éƒ½ä¸ºç©ºï¼Œéƒ½å»æ‰</li><li>å³ä¸ºç©ºï¼Œå»æ‰å³</li><li>å·¦ä¸ºç©ºï¼Œå³ä¸ä¸ºç©ºï¼Œä¸èƒ½å»æ‰å·¦</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode() : val(0), left(nullptr), right(nullptr) &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(nullptr), right(nullptr) &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x, TreeNode *left, TreeNode *right) : val(x), left(left), right(right) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">tree2str</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        string str;</span><br><span class="line">        <span class="built_in">fun</span>(root, str);</span><br><span class="line">        <span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">(TreeNode* root, string &amp;s)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">nullptr</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        s+=<span class="built_in">to_string</span>(root-&gt;val);</span><br><span class="line">        <span class="comment">//å·¦è¾¹ä¸ä¸ºç©ºï¼Œæˆ–è€…å·¦è¾¹ä¸ºç©ºä½†æ˜¯å³è¾¹ä¸ä¸ºç©ºï¼Œä¿ç•™</span></span><br><span class="line">        <span class="keyword">if</span>(root-&gt;left||root-&gt;right)</span><br><span class="line">        &#123;</span><br><span class="line">            s+=<span class="string">&#x27;(&#x27;</span>;</span><br><span class="line">            <span class="built_in">fun</span>(root-&gt;left, s);</span><br><span class="line">            s+=<span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root-&gt;right)</span><br><span class="line">        &#123;</span><br><span class="line">            s+=<span class="string">&#x27;(&#x27;</span>;</span><br><span class="line">            <span class="built_in">fun</span>(root-&gt;right,s);</span><br><span class="line">            s+=<span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å¦ä¸€ç§å†™æ³•">å¦ä¸€ç§å†™æ³•</h2><p>è¿™ç§å†™æ³•æœ‰ä¸ªä¸å¥½çš„ç‚¹ï¼Œä¼ å€¼è¿”å›æ¶ˆè€—ç¨å¾®æœ‰ç‚¹å¤šã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">tree2str</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">nullptr</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">string</span>();</span><br><span class="line"></span><br><span class="line">        string str;</span><br><span class="line">        str+=<span class="built_in">to_string</span>(root-&gt;val);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å·¦è¾¹ä¸ä¸ºç©ºï¼Œæˆ–è€…å³è¾¹ä¸ä¸ºç©ºå·¦è¾¹ä¸ºç©ºï¼Œéƒ½éœ€è¦åŠ æ‹¬å·</span></span><br><span class="line">        <span class="keyword">if</span>(root-&gt;left||root-&gt;right)</span><br><span class="line">        &#123;</span><br><span class="line">            str+=<span class="string">&#x27;(&#x27;</span>;</span><br><span class="line">            str+=<span class="built_in">tree2str</span>(root-&gt;left);</span><br><span class="line">            str+=<span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root-&gt;right)</span><br><span class="line">        &#123;</span><br><span class="line">            str+=<span class="string">&#x27;(&#x27;</span>;</span><br><span class="line">            str+=<span class="built_in">tree2str</span>(root-&gt;right);</span><br><span class="line">            str+=<span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> äºŒå‰æ ‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>236. äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</title>
      <link href="/posts/4090094991/"/>
      <url>/posts/4090094991/</url>
      
        <content type="html"><![CDATA[<p><a href="https://leetcode.cn/problems/lowest-common-ancestor-of-a-binary-tree/">236. äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</a></p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212092158148.png" alt=""></p><h2 id="è§£æ³•1">è§£æ³•1</h2><p>è§„åˆ™ï¼š</p><p>ä¸€ä¸ªæ˜¯å·¦å­æ ‘ä¸­çš„èŠ‚ç‚¹ï¼Œä¸€ä¸ªæ˜¯å³å­æ ‘ä¸­çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆä»–å°±æ˜¯æœ€è¿‘çš„å…¬å…±ç¥–å…ˆ</p><p>è¿™ç§åšæ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(H*N)ï¼Œå¦‚æœå…¬å…±ç¥–å…ˆåœ¨å¾ˆä¸‹é¢ï¼Œæ—¶é—´å¤æ‚åº¦å°±æ¯”è¾ƒé«˜</p><p>æ¯æ¬¡æ‰¾é«˜åº¦æ¬¡</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">Find</span><span class="params">(TreeNode* root, TreeNode* x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">nullptr</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">/*if(root==x)</span></span><br><span class="line"><span class="comment">            return true;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        if(Find(root-&gt;left, x))</span></span><br><span class="line"><span class="comment">            return true;</span></span><br><span class="line"><span class="comment">        if(Find(root-&gt;right,x))</span></span><br><span class="line"><span class="comment">            return true;</span></span><br><span class="line"><span class="comment">        return false;*/</span></span><br><span class="line">    <span class="comment">//æ›´å¥½çš„å†™æ³•</span></span><br><span class="line">    retur root==x||<span class="built_in">Find</span>(root-&gt;left,x)||<span class="built_in">Find</span>(root-&gt;right,x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">TreeNode* <span class="title">lowestCommonAncestor</span><span class="params">(TreeNode* root, TreeNode* p, TreeNode* q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">nullptr</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root==p||root==q)</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        </span><br><span class="line">        <span class="type">bool</span> pInLeft,pInRight,qInLeft,qInRight;</span><br><span class="line">        pInLeft=<span class="built_in">Find</span>(root-&gt;left, p);</span><br><span class="line">        pInRight=!pInLeft;</span><br><span class="line"></span><br><span class="line">        qInLeft=<span class="built_in">Find</span>(root-&gt;left, q);</span><br><span class="line">        qInRight=!qInLeft;</span><br><span class="line">        <span class="comment">//1ã€ä¸€ä¸ªåœ¨å·¦ä¸€ä¸ªåœ¨å³ï¼Œrootå°±æ˜¯æœ€è¿‘å…¬å…±ç¥–å…ˆ</span></span><br><span class="line">        <span class="comment">//2ã€éƒ½åœ¨å·¦ï¼Œé€’å½’å»å·¦å­æ ‘æ‰¾</span></span><br><span class="line">        <span class="comment">//3ã€éƒ½åœ¨å³ï¼Œé€’å½’å»å³å­æ ‘æ‰¾</span></span><br><span class="line">        <span class="keyword">if</span>((pInLeft&amp;&amp;qInRight)||(pInRight&amp;&amp;qInLeft))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(pInLeft&amp;&amp;qInLeft)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">lowestCommonAncestor</span>(root-&gt;left, p, q);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(pInRight&amp;&amp;qInRight)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">lowestCommonAncestor</span>(root-&gt;right, p, q);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;pp</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="è§£æ³•2">è§£æ³•2</h2><p>ç”¨æ ˆè®°å½•è·¯å¾„ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(N)</p><p>æ‰¾6çš„è·¯å¾„</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212101302061.png" alt=""></p><p>æ‰¾4çš„è·¯å¾„</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212101302985.png" alt=""></p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212101237692.png" alt=""></p><p>æˆ‘è‡ªå·±å†™çš„</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">find</span><span class="params">(TreeNode* root, TreeNode* x, stack&lt;TreeNode*&gt;&amp; s)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">nullptr</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        s.<span class="built_in">push</span>(root);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root==x)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">find</span>(root-&gt;left, x, s))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">find</span>(root-&gt;right, x ,s))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        s.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">TreeNode* <span class="title">lowestCommonAncestor</span><span class="params">(TreeNode* root, TreeNode* p, TreeNode* q)</span> </span>&#123;</span><br><span class="line">        stack&lt;TreeNode*&gt;s1;</span><br><span class="line">        stack&lt;TreeNode*&gt;s2;</span><br><span class="line">        <span class="built_in">find</span>(root,p, s1);</span><br><span class="line">        <span class="built_in">find</span>(root,q, s2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// while(!s1.empty())</span></span><br><span class="line">        <span class="comment">// &#123;</span></span><br><span class="line">        <span class="comment">//     cout&lt;&lt;s1.top()-&gt;val&lt;&lt;&quot; &quot;;</span></span><br><span class="line">        <span class="comment">//     s1.pop();</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        <span class="comment">// cout&lt;&lt;endl;</span></span><br><span class="line">        <span class="comment">// while(!s2.empty())</span></span><br><span class="line">        <span class="comment">// &#123;</span></span><br><span class="line">        <span class="comment">//     cout&lt;&lt;s2.top()-&gt;val&lt;&lt;&quot; &quot;;</span></span><br><span class="line">        <span class="comment">//     s2.pop();</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        <span class="comment">// cout&lt;&lt;endl;</span></span><br><span class="line">        <span class="keyword">while</span>(!s1.<span class="built_in">empty</span>()&amp;&amp;!s2.<span class="built_in">empty</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(s1.<span class="built_in">top</span>()==s2.<span class="built_in">top</span>())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> s2.<span class="built_in">top</span>();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(s1.<span class="built_in">size</span>()==s2.<span class="built_in">size</span>())</span><br><span class="line">            &#123;</span><br><span class="line">                s1.<span class="built_in">pop</span>();</span><br><span class="line">                s2.<span class="built_in">pop</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(s1.<span class="built_in">size</span>()&gt;s2.<span class="built_in">size</span>())</span><br><span class="line">            &#123;</span><br><span class="line">                s1.<span class="built_in">pop</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                s2.<span class="built_in">pop</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> äºŒå‰æ ‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>105. ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘</title>
      <link href="/posts/2058783557/"/>
      <url>/posts/2058783557/</url>
      
        <content type="html"><![CDATA[<p><a href="https://leetcode.cn/problems/construct-binary-tree-from-preorder-and-inorder-traversal/">105. ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘</a></p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212101725948.png" alt=""></p><p>å‰åºæ„å»ºæ ‘</p><p>å…¶ä¸­ï¼Œé€šè¿‡preoderç¡®å®šæ ¹ï¼Œç„¶åé€šè¿‡inorderåˆ†å·¦å³å­æ ‘</p><p>æ¯”å¦‚ä¸Šè¾¹å›¾ç‰‡çš„ä¾‹å­ï¼Œé€šè¿‡preorderçŸ¥é“3ä¸ºæ ¹ï¼ŒæŸ¥æ‰¾inorderï¼Œæ‰¾åˆ°3æ‰€åœ¨çš„ä½ç½®ï¼Œåˆ†æˆä¸­åºçš„ä¸¤ä¸ªåŒºé—´ï¼Œè®°å½•å·¦å­æ ‘èŠ‚ç‚¹çš„ä¸ªæ•°ï¼Œå°†å‰åºåºåˆ—ä¹Ÿåˆ†ä¸ºä¸¤ä¸ªåŒºé—´ï¼Œç„¶åé€’å½’å¤„ç†å·¦å­æ ‘å’Œå³å­æ ‘</p><p>æˆ‘å†™çš„</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    <span class="function">TreeNode* <span class="title">buildTree</span><span class="params">(vector&lt;<span class="type">int</span>&gt; preorder, vector&lt;<span class="type">int</span>&gt; inorder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preorder.<span class="built_in">size</span>()==<span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">auto</span> mid= <span class="built_in">find</span>(inorder.<span class="built_in">begin</span>(),inorder.<span class="built_in">end</span>(), preorder[<span class="number">0</span>]);</span><br><span class="line">        <span class="type">int</span> nl=mid-inorder.<span class="built_in">begin</span>();</span><br><span class="line"></span><br><span class="line">        TreeNode* root=<span class="keyword">new</span> <span class="built_in">TreeNode</span>(preorder[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">        root-&gt;left=<span class="built_in">buildTree</span>(<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(preorder.<span class="built_in">begin</span>()+<span class="number">1</span>,preorder.<span class="built_in">begin</span>()+<span class="number">1</span>+nl) ,<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(inorder.<span class="built_in">begin</span>(),mid));</span><br><span class="line">        root-&gt;right=<span class="built_in">buildTree</span>(<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(preorder.<span class="built_in">begin</span>()+<span class="number">1</span>+nl, preorder.<span class="built_in">end</span>()) ,<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(mid+<span class="number">1</span>,inorder.<span class="built_in">end</span>()));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="å¦ä¸€ç§å†™æ³•">å¦ä¸€ç§å†™æ³•</h2><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212101815889.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> äºŒå‰æ ‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>102. äºŒå‰æ ‘çš„å±‚åºéå†</title>
      <link href="/posts/232521577/"/>
      <url>/posts/232521577/</url>
      
        <content type="html"><![CDATA[<p><a href="https://leetcode.cn/problems/binary-tree-level-order-traversal/">102. äºŒå‰æ ‘çš„å±‚åºéå†</a></p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212091957445.png" alt=""></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode() : val(0), left(nullptr), right(nullptr) &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(nullptr), right(nullptr) &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x, TreeNode *left, TreeNode *right) : val(x), left(left), right(right) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">fun</span><span class="params">(TreeNode* root)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">nullptr</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> left=<span class="built_in">fun</span>(root-&gt;left);</span><br><span class="line">        <span class="type">int</span> right=<span class="built_in">fun</span>(root-&gt;right);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>+(left&gt;right?left:right);</span><br><span class="line">    &#125;</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">levelOrder</span>(TreeNode* root) &#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">nullptr</span>)</span><br><span class="line">            <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">        <span class="type">int</span> h =<span class="built_in">fun</span>(root);</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;<span class="built_in">v</span>(h, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;());</span><br><span class="line">        queue&lt;TreeNode*&gt;q;</span><br><span class="line">        q.<span class="built_in">push</span>(root);</span><br><span class="line">        <span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®°å½•ä¸Šä¸€å±‚èŠ‚ç‚¹çš„æ•°é‡</span></span><br><span class="line">        <span class="type">int</span> pre=<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">        <span class="comment">// é‡åˆ°çš„éš¾ç‚¹1ã€æ€ä¹ˆç¡®å®šæ¯å±‚çš„èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">while</span>(!q.<span class="built_in">empty</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            TreeNode* node = q.<span class="built_in">front</span>();</span><br><span class="line">            <span class="keyword">if</span>(pre==<span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                pre=cnt;</span><br><span class="line">                i++;</span><br><span class="line">                cnt=<span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            v[i].<span class="built_in">push_back</span>(node-&gt;val);</span><br><span class="line">            q.<span class="built_in">pop</span>();</span><br><span class="line">            pre--;</span><br><span class="line">            <span class="keyword">if</span>(node-&gt;left)</span><br><span class="line">            &#123;</span><br><span class="line">                q.<span class="built_in">push</span>(node-&gt;left);</span><br><span class="line">                cnt++;</span><br><span class="line">            &#125;</span><br><span class="line">                </span><br><span class="line">            <span class="keyword">if</span>(node-&gt;right)</span><br><span class="line">            &#123;</span><br><span class="line">                q.<span class="built_in">push</span>(node-&gt;right);</span><br><span class="line">                cnt++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="ç®€æ´å†™æ³•">ç®€æ´å†™æ³•</h2><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212092004473.png" alt=""></p><h2 id="åŒé˜Ÿåˆ—è§£æ³•">åŒé˜Ÿåˆ—è§£æ³•</h2><p>ä¸€ä¸ªé˜Ÿåˆ—å­˜èŠ‚ç‚¹æŒ‡é’ˆ<br>ä¸€ä¸ªé˜Ÿåˆ—å­˜å±‚æ•°</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212092012600.png" alt=""></p><p>è¿˜æ˜¯è¦æ±‚æ·±åº¦ï¼Œè¦ä¸è¿˜æ˜¯ä¸å¤§å¥½æ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">fun</span><span class="params">(TreeNode* root)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">nullptr</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> left=<span class="built_in">fun</span>(root-&gt;left);</span><br><span class="line">        <span class="type">int</span> right=<span class="built_in">fun</span>(root-&gt;right);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>+(left&gt;right?left:right);</span><br><span class="line">    &#125;</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">levelOrder</span>(TreeNode* root) &#123;</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt;level;</span><br><span class="line">        queue&lt;TreeNode*&gt;q;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root)</span><br><span class="line">        &#123;</span><br><span class="line">            q.<span class="built_in">push</span>(root);</span><br><span class="line">            level.<span class="built_in">push</span>(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> h=<span class="built_in">fun</span>(root);</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;<span class="built_in">vv</span>(h,<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;());</span><br><span class="line">        <span class="keyword">while</span>(!q.<span class="built_in">empty</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            TreeNode* front = q.<span class="built_in">front</span>();</span><br><span class="line">            <span class="type">int</span> pre=level.<span class="built_in">front</span>();</span><br><span class="line">            q.<span class="built_in">pop</span>();</span><br><span class="line">            level.<span class="built_in">pop</span>();</span><br><span class="line"></span><br><span class="line">            vv[pre].<span class="built_in">push_back</span>(front-&gt;val);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(front-&gt;left)</span><br><span class="line">            &#123;</span><br><span class="line">                q.<span class="built_in">push</span>(front-&gt;left);</span><br><span class="line">                level.<span class="built_in">push</span>(pre+<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(front-&gt;right)</span><br><span class="line">            &#123;</span><br><span class="line">                q.<span class="built_in">push</span>(front-&gt;right);</span><br><span class="line">                level.<span class="built_in">push</span>(pre+<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> vv;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> äºŒå‰æ ‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>äºŒå‰æœç´¢æ ‘</title>
      <link href="/posts/2091589126/"/>
      <url>/posts/2091589126/</url>
      
        <content type="html"><![CDATA[<h1>äºŒå‰æœç´¢æ ‘æ¦‚å¿µ</h1><blockquote><p>äºŒå‰æœç´¢æ ‘åˆç§°äºŒå‰æ’åºæ ‘ï¼Œå®ƒæˆ–è€…æ˜¯ä¸€æ£µç©ºæ ‘ï¼Œæˆ–è€…æ˜¯å…·æœ‰ä»¥ä¸‹æ€§è´¨çš„äºŒå‰æ ‘:</p><ul><li>è‹¥å®ƒçš„å·¦å­æ ‘ä¸ä¸ºç©ºï¼Œåˆ™å·¦å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼éƒ½å°äºæ ¹èŠ‚ç‚¹çš„å€¼</li><li>è‹¥å®ƒçš„å³å­æ ‘ä¸ä¸ºç©ºï¼Œåˆ™å³å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼éƒ½å¤§äºæ ¹èŠ‚ç‚¹çš„å€¼</li><li>å®ƒçš„å·¦å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æœç´¢æ ‘</li></ul></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212081211954.png" alt=""></p> <span id="more"></span><h1>äºŒå‰æœç´¢æ ‘å®ç°</h1><h2 id="ç»“æ„æ¡†æ¶">ç»“æ„æ¡†æ¶</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">K</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BSTreeNode</span></span><br><span class="line">&#123;</span><br><span class="line">BSTreeNode *left;</span><br><span class="line">BSTreeNode *right;</span><br><span class="line">K _key;</span><br><span class="line"><span class="built_in">BSTreeNode</span>(<span class="type">const</span> K &amp;key) : <span class="built_in">left</span>(<span class="literal">nullptr</span>), <span class="built_in">right</span>(<span class="literal">nullptr</span>), _key(key)&#123;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">K</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BSTree</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">typedef</span> BSTreeNode&lt;K&gt; Node;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">Node *_root = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">    </span><br></pre></td></tr></table></figure><h2 id="æ„é€ ">æ„é€ </h2><p>è®©ç¼–è¯‘å™¨æä¾›ä¸ªé»˜è®¤ç”Ÿæˆçš„å°±å¯ä»¥äº†ï¼Œå¦‚æœä¸å†™è¿™ä¸ªï¼Œåˆå†™äº†æ‹·è´æ„é€ ï¼Œç¼–è¯‘å™¨å°±ä¸ä¼šè‡ªå·±è‡ªåŠ¨ç”Ÿæˆäº†ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">BSTree</span>() = <span class="keyword">default</span>;</span><br></pre></td></tr></table></figure><h2 id="æ‹·è´æ„é€ ">æ‹·è´æ„é€ </h2><p>é€’å½’æ‹·è´å·¦ï¼Œå³ï¼Œæ ¹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ‹·è´æ„é€ </span></span><br><span class="line"></span><br><span class="line"><span class="built_in">BSTree</span>(<span class="type">const</span> BSTree&lt;K&gt; &amp;t)</span><br><span class="line">&#123;</span><br><span class="line">_root = _copy(t._root);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Node *_copy(Node *root)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// TODO æ‹·è´æ„é€  èµ‹å€¼è¿ç®—ç¬¦é‡è½½</span></span><br><span class="line"><span class="keyword">if</span> (root == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Node *node = <span class="keyword">new</span> <span class="built_in">Node</span>(root-&gt;_key);</span><br><span class="line"></span><br><span class="line">node-&gt;left = _copy(root-&gt;left);</span><br><span class="line">node-&gt;right = _copy(root-&gt;right);</span><br><span class="line"><span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="èµ‹å€¼è¿ç®—ç¬¦é‡è½½">èµ‹å€¼è¿ç®—ç¬¦é‡è½½</h2><p>å†™å®Œæ‹·è´æ„é€ ä¹‹åå¯ä»¥ç›´æ¥ç”¨ç°åœ¨å†™æ³•å°±OKäº†</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">BSTree&lt;K&gt; <span class="keyword">operator</span>=(BSTree&lt;K&gt; t)</span><br><span class="line">&#123;</span><br><span class="line">std::<span class="built_in">swap</span>(_root, t._root);</span><br><span class="line"><span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ææ„">ææ„</h2><p>é€’å½’ï¼Œå·¦ã€å³ã€æ ¹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> _destory(Node *&amp;root)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (root == <span class="literal">nullptr</span>)</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">_destory(root-&gt;left);</span><br><span class="line">_destory(root-&gt;right);</span><br><span class="line"><span class="keyword">delete</span> root;</span><br><span class="line">root = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ’å…¥">æ’å…¥</h2><p>æ¯”å®ƒå¤§å¾€å³èµ°ï¼Œæ¯”ä»–å°å¾€å·¦èµ°ï¼Œèµ°åˆ°ç©ºï¼Œæ‰¾å®ƒçˆ¶äº²é“¾æ¥èµ·æ¥</p><h3 id="éé€’å½’ä»£ç ">éé€’å½’ä»£ç </h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="type">bool</span> <span class="title">insert</span><span class="params">(<span class="type">const</span> K &amp;key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (_root == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">_root = <span class="keyword">new</span> <span class="built_in">Node</span>(key);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">Node *cur = _root;</span><br><span class="line">Node *parent = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="keyword">while</span> (cur)</span><br><span class="line">&#123;</span><br><span class="line">parent = cur;</span><br><span class="line"><span class="keyword">if</span> (cur-&gt;_key &gt; key)</span><br><span class="line">&#123;</span><br><span class="line">cur = cur-&gt;left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (cur-&gt;_key &lt; key)</span><br><span class="line">&#123;</span><br><span class="line">cur = cur-&gt;right;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// key==cur-&gt;key</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¿™é‡Œcurèµ°åˆ°äº†ç©º è¿›è¡Œæ’å…¥</span></span><br><span class="line">Node *new_node = <span class="keyword">new</span> <span class="built_in">Node</span>(key);</span><br><span class="line"><span class="keyword">if</span> (parent-&gt;_key &gt; key)</span><br><span class="line">&#123;</span><br><span class="line">parent-&gt;left = new_node;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">parent-&gt;right = new_node;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é€’å½’ä»£ç ">é€’å½’ä»£ç </h3><p>é‡ç‚¹æ˜¯å‚æ•°åˆ—è¡¨çš„å¼•ç”¨<br>å¦‚æœèµ°åˆ°äº†rootä¸ºç©ºï¼Œè¯´æ˜åˆ°äº†è¯¥æ’å…¥çš„ä½ç½®ï¼Œç°åœ¨çš„rootå°±æ˜¯ä¸Šä¸€å±‚çˆ¶äº²å·¦å­©å­æˆ–è€…å³å­©å­é‚£ä¸ªæŒ‡é’ˆçš„åˆ«å</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> _insert_r(Node *&amp;root, <span class="type">const</span> K &amp;key)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (root == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">root = <span class="keyword">new</span> <span class="built_in">Node</span>(key);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (root-&gt;_key &gt; key)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _insert_r(root-&gt;left, key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (root-&gt;_key &lt; key)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _insert_r(root-&gt;right, key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="éå†">éå†</h2><p>æä¾›ä¸€ä¸ªinorderçš„æ¥å£ï¼Œè°ƒç”¨_inorder()</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">inorder</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">_inorder(_root);</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="type">void</span> _inorder(Node *root)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (root == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">_inorder(root-&gt;left);</span><br><span class="line">cout &lt;&lt; root-&gt;_key &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">_inorder(root-&gt;right);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤">åˆ é™¤</h2><h3 id="æƒ…å†µ1ã€å·¦å³å­©å­éƒ½ä¸ºç©º">æƒ…å†µ1ã€å·¦å³å­©å­éƒ½ä¸ºç©º</h3><p>å¯ä»¥è®°å½•çˆ¶äº²çš„å€¼ï¼Œç›´æ¥å¹²æ‰å½“å‰èŠ‚ç‚¹ï¼Œåˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯çˆ¶äº²çš„å·¦è¿˜æ˜¯å³ï¼Œç„¶åç”¨ç©ºæ›¿ä»£å½“å‰èŠ‚ç‚¹</p><p>æƒ…å†µ1å¯ä»¥å½’ä¸ºæƒ…å†µ2çš„ç‰¹ä¾‹</p><h3 id="æƒ…å†µ2ã€å·¦å³å­©å­æœ‰ä¸€ä¸ªä¸ºç©º">æƒ…å†µ2ã€å·¦å³å­©å­æœ‰ä¸€ä¸ªä¸ºç©º</h3><h4 id="å·¦å­©å­ä¸ºç©º">å·¦å­©å­ä¸ºç©º</h4><blockquote><p>åˆ é™¤çš„æ˜¯æ ¹</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212081334295.png" alt=""></p><blockquote><p>åˆ é™¤çš„ä¸æ˜¯æ ¹ï¼Œä¾ç„¶ä¸¤ç§æƒ…å†µï¼Œä¸»è¦çœ‹è¿™ä¸ªè¦åˆ é™¤çš„èŠ‚ç‚¹æ˜¯çˆ¶äº²çš„å·¦è¿˜æ˜¯å³</p></blockquote><p>å¦‚æœæ˜¯çˆ¶äº²çš„å·¦ï¼Œå°±æŠŠcurçš„å³ç»™çˆ¶äº²çš„å·¦</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212081352923.png" alt=""></p><p>å¦‚æœæ˜¯çˆ¶äº²çš„å³ï¼Œå°±æŠŠcurçš„å³ç»™çˆ¶äº²çš„å³<br><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212081353553.png" alt=""></p><h4 id="å³å­©å­ä¸ºç©º">å³å­©å­ä¸ºç©º</h4><blockquote><p>å…ˆåˆ¤æ–­ç‰¹æ®Šæƒ…å†µï¼Œåˆ é™¤çš„èŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹</p></blockquote><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212081333711.png" alt=""></p><p>å…¶ä»–æƒ…å†µä¸å·¦å­©å­ä¸ºç©ºæƒ…å†µå¤§æ¦‚ç›¸åŒ</p><ul><li>å¦‚æœï¼Œcurä¸ºçˆ¶äº²çš„å·¦ï¼Œé‚£ä¹ˆè®©çˆ¶äº²çš„å·¦ï¼ŒæŒ‡å‘curçš„å·¦</li><li>å¦‚æœï¼Œcurä¸ºçˆ¶äº²çš„å³ï¼Œé‚£ä¹ˆè®©çˆ¶äº²çš„å³ï¼ŒæŒ‡å‘curçš„å³</li></ul><h3 id="æƒ…å†µ3ã€å·¦å³å­©å­éƒ½ä¸ä¸ºç©º">æƒ…å†µ3ã€å·¦å³å­©å­éƒ½ä¸ä¸ºç©º</h3><ul><li>æ‰¾å³æ ‘çš„æœ€å°èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯å³æ ‘çš„æœ€å·¦</li><li>æ‰¾å·¦æ ‘çš„æœ€å¤§èŠ‚ç‚¹ ï¼Œä¹Ÿå°±æ˜¯å·¦æ ‘çš„æœ€å³</li></ul><p>æƒ…å†µ1<br><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212081509463.png" alt=""></p><p>æƒ…å†µ2</p><p><img src="https://tong-1306822294.cos.ap-beijing.myqcloud.com/tong/picture/202212081509737.png" alt=""></p><h3 id="éé€’å½’ä»£ç -2">éé€’å½’ä»£ç </h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">erase</span><span class="params">(<span class="type">const</span> K &amp;key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (_root == <span class="literal">nullptr</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="comment">//å…ˆæ‰¾åˆ°è¦åˆ é™¤çš„èŠ‚ç‚¹ï¼ŒåŒæ—¶è®°å½•çˆ¶èŠ‚ç‚¹çš„ä½ç½®</span></span><br><span class="line">Node *cur = _root;</span><br><span class="line">Node *parent = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="keyword">while</span> (cur)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//å­˜ä¸€ä¸‹cur</span></span><br><span class="line"><span class="keyword">if</span> (cur-&gt;_key &gt; key)</span><br><span class="line">&#123;</span><br><span class="line">parent = cur;</span><br><span class="line"><span class="comment">// key &lt; å½“å‰èŠ‚ç‚¹çš„keyï¼Œ å¾€èŠ‚ç‚¹çš„å·¦å­æ ‘æ‰¾</span></span><br><span class="line">cur = cur-&gt;left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (cur-&gt;_key &lt; key)</span><br><span class="line">&#123;</span><br><span class="line">parent = cur;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰èŠ‚ç‚¹çš„keyå°äºè¦åˆ é™¤çš„keyï¼Œ å¾€å³å­æ ‘æ‰¾</span></span><br><span class="line">cur = cur-&gt;right;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//è¿™é‡Œè¯´æ˜cur-&gt;_key==key å¯ä»¥è¿›è¡Œåˆ é™¤äº†</span></span><br><span class="line"><span class="comment">//æƒ…å†µæœ‰ä¸€ä¸ªå­©å­æˆ–è€…ä¸€ä¸ªå­©å­éƒ½æ²¡æœ‰</span></span><br><span class="line"><span class="keyword">if</span> (cur-&gt;left == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// curå·¦å­©å­ä¸ºç©º ã€å³å­©å­å¯èƒ½ä¸ºç©ºï¼Œå¯èƒ½ä¸ä¸ºç©º</span></span><br><span class="line"><span class="keyword">if</span> (cur == _root)  <span class="comment">//æƒ…å†µ1</span></span><br><span class="line">&#123;</span><br><span class="line">_root = cur-&gt;right;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (parent-&gt;left == cur)</span><br><span class="line">&#123;</span><br><span class="line">parent-&gt;left = cur-&gt;right;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">parent-&gt;right = cur-&gt;right;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> cur;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (cur-&gt;right == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// curå³å­©å­ä¸ºç©º   å·¦å­©å­å¯èƒ½ä¸ºç©ºï¼Œä¹Ÿå¯èƒ½ä¸ä¸ºç©º</span></span><br><span class="line"><span class="keyword">if</span> (cur == _root)</span><br><span class="line">&#123;</span><br><span class="line">_root = cur-&gt;left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (parent-&gt;left == cur)</span><br><span class="line">&#123;</span><br><span class="line">parent-&gt;left = cur-&gt;left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">parent-&gt;right = cur-&gt;left;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> cur;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//å·¦å³å­©å­éƒ½ä¸ä¸ºç©º</span></span><br><span class="line"><span class="comment">//å…ˆæ‰¾å½“å‰èŠ‚ç‚¹å³æ ‘çš„æœ€å°èŠ‚ç‚¹</span></span><br><span class="line">Node *parent = cur;</span><br><span class="line">Node *min = cur-&gt;right;</span><br><span class="line"><span class="keyword">while</span> (min-&gt;left)</span><br><span class="line">&#123;</span><br><span class="line">parent = min;</span><br><span class="line">min = min-&gt;left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ‰¾åˆ°äº†å³æ ‘çš„æœ€å·¦èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">//å¦‚æœæ˜¯æ ¹èŠ‚ç‚¹ã€æ¯”å¦‚åˆ é™¤8ï¼Œé‚£ä¹ˆminç°åœ¨æ˜¯10ï¼Œparent=8</span></span><br><span class="line">std::<span class="built_in">swap</span>(min-&gt;_key, cur-&gt;_key);</span><br><span class="line"><span class="comment">//å¦‚æœåˆ é™¤3ã€</span></span><br><span class="line"><span class="keyword">if</span> (parent-&gt;left == min)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// parentçš„å·¦ç­‰äºminï¼Œæ¯”å¦‚åˆ é™¤</span></span><br><span class="line">parent-&gt;left = min-&gt;right;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">parent-&gt;right = min-&gt;right;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> min;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//èµ°åˆ°è¿™é‡Œè¯´æ˜æ•°ä¸­æ²¡æœ‰è¦åˆ é™¤çš„èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é€’å½’ä»£ç -2">é€’å½’ä»£ç </h3><p>è¿‡ç¨‹ï¼š</p><ol><li>å¦‚æœæ ¹ä¸ºç©ºï¼Œè¿”å›false</li><li>å¦‚æœå½“å‰å€¼å¤§äºkeyï¼Œé€’å½’åˆ é™¤å·¦</li><li>å¦‚æœå½“å‰å€¼å°äºkeyï¼Œé€’å½’åˆ é™¤å³</li><li>å¦‚æœç›¸ç­‰ï¼Œåˆ™è¿›å…¥åˆ é™¤é€»è¾‘</li></ol><blockquote><p>åˆ†ä¸‰ç§æƒ…å†µ</p><ul><li>å·¦å­©å­ä¸ºç©º</li><li>å³å­©å­ä¸ºç©º</li><li>å·¦å³å­©å­éƒ½ä¸ä¸ºç©º</li></ul></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> _erase_r(Node *&amp;root, <span class="type">const</span> K &amp;key)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (root == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (root-&gt;_key &gt; key)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _erase_r(root-&gt;left, key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (root-&gt;_key &lt; key)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _erase_r(root-&gt;right, key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//å°±æ˜¯å½“å‰èŠ‚ç‚¹</span></span><br><span class="line">Node *del = root;</span><br><span class="line"><span class="keyword">if</span> (root-&gt;left == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">root = root-&gt;right;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (root-&gt;right == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">root = root-&gt;left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//å·¦å³éƒ½ä¸ä¸ºç©º</span></span><br><span class="line">Node *min = root-&gt;right;</span><br><span class="line"><span class="keyword">while</span> (min)</span><br><span class="line">&#123;</span><br><span class="line">min = min-&gt;left;</span><br><span class="line">&#125;</span><br><span class="line">std::<span class="built_in">swap</span>(min-&gt;_key, root-&gt;_key);</span><br><span class="line"><span class="comment">//æ³¨æ„</span></span><br><span class="line"><span class="keyword">return</span> _erase_r(root-&gt;right, key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">delete</span> del;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æŸ¥æ‰¾">æŸ¥æ‰¾</h2><h3 id="éé€’å½’ä»£ç -3">éé€’å½’ä»£ç </h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">find</span><span class="params">(<span class="type">const</span> K&amp; key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Node* cur = _root;</span><br><span class="line"><span class="keyword">while</span> (cur)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (cur-&gt;_key &lt; key)</span><br><span class="line">&#123;</span><br><span class="line">cur = cur-&gt;_right;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (cur-&gt;_key &gt; key)</span><br><span class="line">&#123;</span><br><span class="line">cur = cur-&gt;_left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="é€’å½’ä»£ç -3">é€’å½’ä»£ç </h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> _find_r(Node *root, <span class="type">const</span> K &amp;key)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (root == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (root-&gt;_key &gt; key)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _find_r(root-&gt;left, key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (root-&gt;_key &lt; key)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _find_r(root-&gt;right, key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é«˜é˜¶æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœç´¢æ ‘ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
